// Decompiled with JetBrains decompiler
// Type: JHVbkHiTkalVc.jgpVPznpNOOOs
// Assembly: Udby4Jt48oXkJ, Version=3.17.2.31, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
// MVID: 37899E89-D673-4F5B-A193-2E4DF6A54096
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.MSIL.Gorgon.gen-bf535869266eca7a958714acade2ede1bff0e73f0aaa2702f389ededee6a8d6a.exe

using bu8pNrX0TZwPh;
using DrtahteR2mfQY;
using HqLTLdqt37SZu;
using hujG0QbsYScYh;
using L7XR5cqt17ZIR;
using lMEYJgxmJ9OP9;
using lqWc8fBl1n0fS;
using LsuEmqhbehFHp;
using mhZ8amQVr4JAO;
using NugWWfiT0QZrW;
using O4LdamDRj1Bfo;
using pS5NmjNcWKtJP;
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Runtime.CompilerServices;
using System.Threading.Tasks;
using u1QgJKQJKYhz7;
using vC3HcEDatY9WC;
using wRO897uUcpmYd;

namespace JHVbkHiTkalVc
{
  internal class jgpVPznpNOOOs : vmgkKHlLDILn4
  {
    internal n1IcPKd2Lx0L1 TR3cMiWbLqE9x;
    private readonly Uri wzpTMt4leWDXP;
    private readonly string yKIEr8XivRzDM;
    private readonly IPlatformParameters GmJOpSiIMissZ;
    private readonly string pKhTevNYhvf6k;
    private readonly IWebUI lgGGZBE0wf1Ac;
    private readonly XFIxBPlxEkgu4 dlw3cyCjH26X7;
    private readonly string SOAN9iVVqF4JT;

    public jgpVPznpNOOOs(
      z7eJc8CpoGMSq requestData,
      Uri redirectUri,
      IPlatformParameters parameters,
      XFIxBPlxEkgu4 userId,
      string extraQueryParameters,
      IWebUI webUI,
      string claims)
      : base(requestData)
    {
      this.wzpTMt4leWDXP = this.platformInformation.\u0035szPGOfWKxJVu(redirectUri, this.xngTL11QRuwcB);
      if (!string.IsNullOrWhiteSpace(this.wzpTMt4leWDXP.Fragment))
        throw new ArgumentException("'redirectUri' must NOT include a fragment component", nameof (redirectUri));
      this.GmJOpSiIMissZ = parameters;
      this.yKIEr8XivRzDM = this.platformInformation.SBPUFyCm14jRs(this.wzpTMt4leWDXP, this.xngTL11QRuwcB);
      this.dlw3cyCjH26X7 = userId != null ? userId : throw new ArgumentNullException(nameof (userId), "If you do not need access token for any specific user, pass userId=UserIdentifier.AnyUser instead of userId=null.");
      if (!string.IsNullOrEmpty(extraQueryParameters) && extraQueryParameters[0] == '&')
        extraQueryParameters = extraQueryParameters.Substring(1);
      this.pKhTevNYhvf6k = extraQueryParameters;
      this.lgGGZBE0wf1Ac = webUI;
      this.xyKZ2abKFD3mx = userId.pJQHe79XYKV3r;
      this.\u0037hhgMEalYqxkj = userId.KM0cCT4YkZB8u;
      this.dfcJd7GYcJsXj = userId.DDEvzwVXzfcaU;
      this.wv77vsl2OHrKS = true;
      if (!string.IsNullOrEmpty(claims))
      {
        this.Y0M4cVFfxJYK1 = false;
        this.xngTL11QRuwcB.\u0031CII3TGnWWaPA.moZ2DmWwVvE2r(this.xngTL11QRuwcB, "Claims present. Skip cache lookup.", "E:\\A\\_work\\115\\s\\src\\Microsoft.IdentityModel.Clients.ActiveDirectory\\Internal\\Flows\\jgpVPznpNOOOs.cs");
        this.SOAN9iVVqF4JT = claims;
      }
      else
        this.Y0M4cVFfxJYK1 = requestData.rnVyzzJfpc432 != null && parameters != null && this.platformInformation.Qste0HNxq7eZ9(parameters);
      this.brokerParameters["force"] = "NO";
      if (userId != XFIxBPlxEkgu4.qCfuiaq6lYRRa)
        this.brokerParameters["username"] = userId.MjzQO3JA4THFQ;
      else
        this.brokerParameters["username"] = string.Empty;
      this.brokerParameters["username_type"] = userId.DDEvzwVXzfcaU.ToString();
      this.brokerParameters["redirect_uri"] = this.wzpTMt4leWDXP.AbsoluteUri;
      this.brokerParameters["extra_qp"] = extraQueryParameters;
      this.brokerParameters[nameof (claims)] = claims;
      this.brokerHelper.\u00347xMsJa7HWFPd = this.GmJOpSiIMissZ;
    }

    protected override Task PreTokenRequest()
    {
      // ISSUE: variable of a compiler-generated type
      jgpVPznpNOOOs.MBeHWiYmAr09u stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.HbMsWzfSXZ58Z = this;
      // ISSUE: reference to a compiler-generated field
      stateMachine.zTX0zj3MP2F4J = AsyncTaskMethodBuilder.Create();
      // ISSUE: cast to a reference type
      // ISSUE: explicit reference operation
      // ISSUE: reference to a compiler-generated field
      (^(vmgkKHlLDILn4.mdjMzyQz0xF8R&) ref stateMachine).UK34EQl0cTJmP = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.zTX0zj3MP2F4J.Start<jgpVPznpNOOOs.MBeHWiYmAr09u>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.zTX0zj3MP2F4J.Task;
    }

    internal Task kgCswMTqlMkSf()
    {
      // ISSUE: variable of a compiler-generated type
      jgpVPznpNOOOs.JBneD6wii4bw0 stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.MWz7XRDdCgUo1 = this;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0033tY9ChhXuf4zF = AsyncTaskMethodBuilder.Create();
      // ISSUE: cast to a reference type
      // ISSUE: explicit reference operation
      // ISSUE: reference to a compiler-generated field
      (^(jgpVPznpNOOOs.MBeHWiYmAr09u&) ref stateMachine).\u0036Bj9n92IL5hj4 = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0033tY9ChhXuf4zF.Start<jgpVPznpNOOOs.JBneD6wii4bw0>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.\u0033tY9ChhXuf4zF.Task;
    }

    internal Task<Uri> pkU4knI6lQnXM(Guid xyLOPqrDXfwnM)
    {
      // ISSUE: variable of a compiler-generated type
      jgpVPznpNOOOs.VquQzlPmWj7eP stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.RQz0PHs5TjTi0 = this;
      // ISSUE: reference to a compiler-generated field
      stateMachine.subXV6OOtHmcm = xyLOPqrDXfwnM;
      // ISSUE: reference to a compiler-generated field
      stateMachine.Y6kuZCQ176Szo = AsyncTaskMethodBuilder<Uri>.Create();
      // ISSUE: cast to a reference type
      // ISSUE: explicit reference operation
      // ISSUE: reference to a compiler-generated field
      (^(jgpVPznpNOOOs.JBneD6wii4bw0&) ref stateMachine).\u0030YUyW1ZXFk2Tt = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.Y6kuZCQ176Szo.Start<jgpVPznpNOOOs.VquQzlPmWj7eP>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.Y6kuZCQ176Szo.Task;
    }

    protected override void AddAditionalRequestParameters(dooNxm6mSPOHK requestParameters)
    {
      requestParameters["grant_type"] = "authorization_code";
      requestParameters["code"] = this.TR3cMiWbLqE9x.\u0035FsVRq3WDJGR0;
      requestParameters["redirect_uri"] = this.yKIEr8XivRzDM;
    }

    protected override void PostTokenRequest(OHG1qpDK4Ko7V resultEx)
    {
      base.PostTokenRequest(resultEx);
      if (this.\u0037hhgMEalYqxkj == null && this.xyKZ2abKFD3mx == null || this.dfcJd7GYcJsXj == rIKGlR6JQgdan.OptionalDisplayableId)
        return;
      string str1 = resultEx.CMVqaYR8spkSL.VX91kBJ06aKTr == null || resultEx.CMVqaYR8spkSL.VX91kBJ06aKTr.H8otkn8RcSLDl == null ? "NULL" : resultEx.CMVqaYR8spkSL.VX91kBJ06aKTr.H8otkn8RcSLDl;
      string str2 = resultEx.CMVqaYR8spkSL.VX91kBJ06aKTr != null ? resultEx.CMVqaYR8spkSL.VX91kBJ06aKTr.QYTftBzxTSfhq : "NULL";
      if (this.dfcJd7GYcJsXj == rIKGlR6JQgdan.UniqueId && string.Compare(str1, this.xyKZ2abKFD3mx, StringComparison.Ordinal) != 0)
        throw new TzNXqmWQqb5ov(this.xyKZ2abKFD3mx, str1);
      if (this.dfcJd7GYcJsXj == rIKGlR6JQgdan.RequiredDisplayableId && string.Compare(str2, this.\u0037hhgMEalYqxkj, StringComparison.OrdinalIgnoreCase) != 0)
        throw new TzNXqmWQqb5ov(this.\u0037hhgMEalYqxkj, str2);
    }

    private Uri ZW7VEG4mRGboc()
    {
      string STnXT65HGNuza = (string) null;
      if (!this.dlw3cyCjH26X7.igNW3WaC91ZJT && (this.dlw3cyCjH26X7.DDEvzwVXzfcaU == rIKGlR6JQgdan.OptionalDisplayableId || this.dlw3cyCjH26X7.DDEvzwVXzfcaU == rIKGlR6JQgdan.RequiredDisplayableId))
        STnXT65HGNuza = this.dlw3cyCjH26X7.MjzQO3JA4THFQ;
      return new Uri(new Uri(this.\u00396xFrZPZRXYHo.b6ouSCA0Lt9nJ), "?" + (object) this.\u0033zPXLwPoNjHK5(STnXT65HGNuza));
    }

    private dooNxm6mSPOHK \u0033zPXLwPoNjHK5(string STnXT65HGNuza)
    {
      dooNxm6mSPOHK U624DINQ524qT = new dooNxm6mSPOHK(this.sJvtWrimEepI7, this.hJC3ityuMYbnG);
      U624DINQ524qT["response_type"] = "code";
      U624DINQ524qT["haschrome"] = "1";
      U624DINQ524qT["redirect_uri"] = this.yKIEr8XivRzDM;
      if (!string.IsNullOrWhiteSpace(STnXT65HGNuza))
        U624DINQ524qT["login_hint"] = STnXT65HGNuza;
      if (!string.IsNullOrWhiteSpace(this.SOAN9iVVqF4JT))
        U624DINQ524qT["claims"] = this.SOAN9iVVqF4JT;
      if (this.xngTL11QRuwcB != null && this.xngTL11QRuwcB.eZN2XN0Q86ZV4 != Guid.Empty)
        U624DINQ524qT["client-request-id"] = this.xngTL11QRuwcB.eZN2XN0Q86ZV4.ToString();
      if (this.GmJOpSiIMissZ != null)
        this.platformInformation.Fg9qYXSQxhzui(this.GmJOpSiIMissZ, U624DINQ524qT);
      foreach (KeyValuePair<string, string> keyValuePair in (IEnumerable<KeyValuePair<string, string>>) GJEiDscb2qzH7.VbxNU8geROHUg())
        U624DINQ524qT[keyValuePair.Key] = keyValuePair.Value;
      if (!string.IsNullOrWhiteSpace(this.pKhTevNYhvf6k))
      {
        foreach (KeyValuePair<string, string> keyValuePair in \u0037BKomckZ2VHww.vvzmwqlHCT7Qk(this.pKhTevNYhvf6k, '&', false, this.xngTL11QRuwcB))
        {
          if (U624DINQ524qT.ContainsKey(keyValuePair.Key))
            throw new LlM9VbgWu20VY("duplicate_query_parameter", string.Format((IFormatProvider) CultureInfo.CurrentCulture, "Duplicate query parameter '{0}' in extraQueryParameters", new object[1]
            {
              (object) keyValuePair.Key
            }));
        }
        U624DINQ524qT.kMNR5BUNiRUXl = this.pKhTevNYhvf6k;
      }
      return U624DINQ524qT;
    }

    private void vup2Ru4ajTLoj()
    {
      if (this.TR3cMiWbLqE9x.KdtiJYBG0jHNl == "login_required")
        throw new LlM9VbgWu20VY("user_interaction_required");
      if (this.TR3cMiWbLqE9x.\u0030u066mBCu3Bz5 != \u0034Q4kewdu41N7r.Success)
        throw new zTDz1kuLRWPxI(this.TR3cMiWbLqE9x.KdtiJYBG0jHNl, this.TR3cMiWbLqE9x.whPlA9q7S8MfE);
    }

    protected override void UpdateBrokerParameters(IDictionary<string, string> parameters)
    {
      Dictionary<string, string> dictionary = \u0037BKomckZ2VHww.vvzmwqlHCT7Qk(\u0037BKomckZ2VHww.MQWBk3uOtEKdI(new Uri(this.TR3cMiWbLqE9x.\u0035FsVRq3WDJGR0).Query), '&', false, this.xngTL11QRuwcB);
      parameters["username"] = dictionary["username"];
    }

    protected override bool BrokerInvocationRequired()
    {
      if (this.TR3cMiWbLqE9x == null || string.IsNullOrEmpty(this.TR3cMiWbLqE9x.\u0035FsVRq3WDJGR0) || !this.TR3cMiWbLqE9x.\u0035FsVRq3WDJGR0.StartsWith("msauth://", StringComparison.OrdinalIgnoreCase))
        return false;
      this.brokerParameters["broker_install_url"] = this.TR3cMiWbLqE9x.\u0035FsVRq3WDJGR0;
      return true;
    }
  }
}
