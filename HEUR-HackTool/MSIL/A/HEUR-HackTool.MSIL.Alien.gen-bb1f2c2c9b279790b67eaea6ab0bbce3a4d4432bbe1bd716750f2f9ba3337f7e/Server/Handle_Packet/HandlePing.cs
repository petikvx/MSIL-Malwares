// Decompiled with JetBrains decompiler
// Type: Server.Handle_Packet.HandlePing
// Assembly: AsyncRAT, Version=0.5.7.0, Culture=neutral, PublicKeyToken=null
// MVID: 51786A10-CF9D-455B-B8A4-B82CB9EDE322
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.04\HEUR-HackTool.MSIL.Alien.gen-bb1f2c2c9b279790b67eaea6ab0bbce3a4d4432bbe1bd716750f2f9ba3337f7e.exe

using Server.Connection;
using Server.MessagePack;
using System.Drawing;
using System.Threading;

namespace Server.Handle_Packet
{
  public class HandlePing
  {
    public void Ping(Clients client, MsgPack unpack_msgpack)
    {
      try
      {
        MsgPack msgPack = new MsgPack();
        msgPack.ForcePathObject("Packet").SetAsString("pong");
        ThreadPool.QueueUserWorkItem(new WaitCallback(client.Send), (object) msgPack.Encode2Bytes());
        lock (Settings.LockListviewClients)
        {
          if (client.LV == null)
            return;
          client.LV.SubItems[Program.form1.lv_act.Index].Text = unpack_msgpack.ForcePathObject("Message").AsString;
        }
      }
      catch
      {
      }
    }

    public void Pong(Clients client, MsgPack unpack_msgpack)
    {
      try
      {
        lock (Settings.LockListviewClients)
        {
          if (client.LV == null)
            return;
          int asInteger = (int) unpack_msgpack.ForcePathObject("Message").AsInteger;
          client.LV.SubItems[Program.form1.lv_ping.Index].Text = asInteger.ToString() + " MS";
          if (asInteger > 400)
            client.LV.SubItems[Program.form1.lv_ping.Index].ForeColor = Color.Red;
          else if (asInteger > 200)
            client.LV.SubItems[Program.form1.lv_ping.Index].ForeColor = Color.Orange;
          else
            client.LV.SubItems[Program.form1.lv_ping.Index].ForeColor = Color.Green;
        }
      }
      catch
      {
      }
    }
  }
}
