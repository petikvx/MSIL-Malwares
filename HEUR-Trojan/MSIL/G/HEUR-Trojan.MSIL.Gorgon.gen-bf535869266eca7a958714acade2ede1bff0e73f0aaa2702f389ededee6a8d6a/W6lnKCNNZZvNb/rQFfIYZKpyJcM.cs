// Decompiled with JetBrains decompiler
// Type: W6lnKCNNZZvNb.rQFfIYZKpyJcM
// Assembly: Udby4Jt48oXkJ, Version=3.17.2.31, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
// MVID: 37899E89-D673-4F5B-A193-2E4DF6A54096
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.MSIL.Gorgon.gen-bf535869266eca7a958714acade2ede1bff0e73f0aaa2702f389ededee6a8d6a.exe

using \u0033s1eDqxyulHOR;
using \u0036mHL90hQ651VX;
using \u0038Mxp6N8NxQSyi;
using f79aMQG1RHkmG;
using HqLTLdqt37SZu;
using lqWc8fBl1n0fS;
using LsuEmqhbehFHp;
using pS5NmjNcWKtJP;
using Q4XJ5K3dbXZ2g;
using QXLuUL1nSmIC4;
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Diagnostics;
using System.Drawing;
using System.Globalization;
using System.Runtime.CompilerServices;
using System.Runtime.InteropServices;
using System.Windows.Forms;
using U0WSQvFZZrSSy;
using Udby4Jt48oXkJ.My;

namespace W6lnKCNNZZvNb
{
  [ComVisible(true)]
  [EditorBrowsable(EditorBrowsableState.Never)]
  public abstract class rQFfIYZKpyJcM : Form
  {
    private static readonly hwLMe0XEsiUpw HDP9up0JlcKNL = new hwLMe0XEsiUpw();
    private static readonly HashSet<string> \u0035q1iCfewEAgM7 = new HashSet<string>((IEqualityComparer<string>) StringComparer.OrdinalIgnoreCase);
    private const int Mw7X7KYdApqPO = 566;
    private const string JbToID3kojMZb = "browser";
    private const string \u0030kyj1SKXpq0On = "javascript";
    private const string \u0033dKSSdzfGBtff = "about:blank";
    private readonly y9WeDGzdnipVD JMK6rBAlC9BRA;
    private Panel NYDXhJoHuzmxn;
    private Keys M16bYLwDCVmtG;
    private Uri mjtlCywuDSuRW;
    protected IWin32Window ownerWindow;

    internal n1IcPKd2Lx0L1 pTbTuawjd8mjE { get; set; }

    protected rQFfIYZKpyJcM(object ownerWindow)
    {
      if (rQFfIYZKpyJcM.gWIv9fqa7K6Gt.VH1MBNbOQPGf5((rQFfIYZKpyJcM.IKK2SQvjca4Sp.g0MpFvse0EfOQ) 0) == 0)
        rQFfIYZKpyJcM.gWIv9fqa7K6Gt.VH1MBNbOQPGf5((rQFfIYZKpyJcM.IKK2SQvjca4Sp.g0MpFvse0EfOQ) 1);
      switch (ownerWindow)
      {
        case null:
          this.ownerWindow = (IWin32Window) null;
          break;
        case IWin32Window _:
          this.ownerWindow = (IWin32Window) ownerWindow;
          break;
        case IntPtr num:
          this.ownerWindow = (IWin32Window) new rQFfIYZKpyJcM.VUbJnoUuZJFNv()
          {
            n1HcpdLNFJ8vf = num
          };
          break;
        default:
          throw new LlM9VbgWu20VY("invalid_owner_window_type", "Invalid owner window type. Expected types are IWin32Window or IntPtr (for window handle).");
      }
      this.JMK6rBAlC9BRA = new y9WeDGzdnipVD();
      this.JMK6rBAlC9BRA.PreviewKeyDown += new PreviewKeyDownEventHandler(this.C3X9nEs7taINA);
      this.pW3dIrCO5CuFQ();
      rQFfIYZKpyJcM.\u0035q1iCfewEAgM7.Add("browser");
    }

    private void C3X9nEs7taINA(object Zk2siClUquFrf, PreviewKeyDownEventArgs MTiyqPmRyT7kq)
    {
      if (MTiyqPmRyT7kq.KeyCode != Keys.Back)
        return;
      this.M16bYLwDCVmtG = Keys.Back;
    }

    public WebBrowser M0JusVAdeNdRj => (WebBrowser) this.JMK6rBAlC9BRA;

    protected virtual void WebBrowserNavigatingHandler(
      object sender,
      WebBrowserNavigatingEventArgs e)
    {
      if (this.JMK6rBAlC9BRA.IsDisposed)
      {
        e.Cancel = true;
      }
      else
      {
        if (this.M16bYLwDCVmtG == Keys.Back)
        {
          this.M16bYLwDCVmtG = Keys.None;
          e.Cancel = true;
        }
        e.Cancel = this.TxmJb6xZy786L(e.Url);
        if (e.Cancel || !e.Url.Scheme.Equals("browser", StringComparison.OrdinalIgnoreCase))
          return;
        Process.Start(new UriBuilder(e.Url)
        {
          Scheme = Uri.UriSchemeHttps
        }.Uri.AbsoluteUri);
        e.Cancel = true;
      }
    }

    private void \u0038MsZjnGctDP5d(
      object GZ5xJl5qTsjgQ,
      WebBrowserNavigatedEventArgs Gbcv6OLnoxWZu)
    {
      this.TxmJb6xZy786L(Gbcv6OLnoxWZu.Url);
    }

    protected virtual void WebBrowserNavigateErrorHandler(object sender, \u0036bsr0w2jcFgCy e)
    {
      if (this.DialogResult == DialogResult.OK)
        return;
      if (this.JMK6rBAlC9BRA.IsDisposed)
      {
        e.Cancel = true;
      }
      else
      {
        if (this.JMK6rBAlC9BRA.ActiveXInstance != e.DyZxzFoQCCRio || e.Fdt4uOygTO2h9 >= 300 && e.Fdt4uOygTO2h9 < 400)
          return;
        e.Cancel = true;
        this.efAvzB7uOMwHu();
        this.OnNavigationCanceled(e.Fdt4uOygTO2h9);
      }
    }

    private bool TxmJb6xZy786L(Uri CKN3gM5CTIRUV)
    {
      bool flag = false;
      if (CKN3gM5CTIRUV.Authority.Equals(this.mjtlCywuDSuRW.Authority, StringComparison.OrdinalIgnoreCase) && CKN3gM5CTIRUV.AbsolutePath.Equals(this.mjtlCywuDSuRW.AbsolutePath, StringComparison.OrdinalIgnoreCase))
      {
        this.pTbTuawjd8mjE = new n1IcPKd2Lx0L1(\u0034Q4kewdu41N7r.Success, CKN3gM5CTIRUV.OriginalString);
        flag = true;
      }
      if (!flag && !rQFfIYZKpyJcM.\u0035q1iCfewEAgM7.Contains(CKN3gM5CTIRUV.Scheme) && !CKN3gM5CTIRUV.AbsoluteUri.Equals("about:blank", StringComparison.OrdinalIgnoreCase) && !CKN3gM5CTIRUV.Scheme.Equals(Uri.UriSchemeHttps, StringComparison.OrdinalIgnoreCase) && !CKN3gM5CTIRUV.Scheme.Equals("javascript", StringComparison.OrdinalIgnoreCase))
      {
        this.pTbTuawjd8mjE = new n1IcPKd2Lx0L1(\u0034Q4kewdu41N7r.ErrorHttp);
        this.pTbTuawjd8mjE.KdtiJYBG0jHNl = "non_https_redirect_failed";
        this.pTbTuawjd8mjE.whPlA9q7S8MfE = "Non-HTTPS url redirect is not supported in webview";
        flag = true;
      }
      if (flag)
      {
        this.efAvzB7uOMwHu();
        this.OnClosingUrl();
      }
      return flag;
    }

    private void efAvzB7uOMwHu()
    {
      if (this.JMK6rBAlC9BRA.IsDisposed || !this.JMK6rBAlC9BRA.IsBusy)
        return;
      Up2ciG6wVdM5T.xgsfAAH34Fgnl.\u0031CII3TGnWWaPA.moZ2DmWwVvE2r((Up2ciG6wVdM5T) null, string.Format((IFormatProvider) CultureInfo.CurrentCulture, " WebBrowser state: IsBusy: {0}, ReadyState: {1}, Created: {2}, Disposing: {3}, IsDisposed: {4}, IsOffline: {5}", (object) this.JMK6rBAlC9BRA.IsBusy, (object) this.JMK6rBAlC9BRA.ReadyState, (object) this.JMK6rBAlC9BRA.Created, (object) this.JMK6rBAlC9BRA.Disposing, (object) this.JMK6rBAlC9BRA.IsDisposed, (object) this.JMK6rBAlC9BRA.IsOffline), "E:\\A\\_work\\115\\s\\src\\Microsoft.IdentityModel.Clients.ActiveDirectory\\Platforms\\net45\\rQFfIYZKpyJcM.cs");
      this.JMK6rBAlC9BRA.Stop();
      Up2ciG6wVdM5T.xgsfAAH34Fgnl.\u0031CII3TGnWWaPA.moZ2DmWwVvE2r((Up2ciG6wVdM5T) null, string.Format((IFormatProvider) CultureInfo.CurrentCulture, " WebBrowser state (after Stop): IsBusy: {0}, ReadyState: {1}, Created: {2}, Disposing: {3}, IsDisposed: {4}, IsOffline: {5}", (object) this.JMK6rBAlC9BRA.IsBusy, (object) this.JMK6rBAlC9BRA.ReadyState, (object) this.JMK6rBAlC9BRA.Created, (object) this.JMK6rBAlC9BRA.Disposing, (object) this.JMK6rBAlC9BRA.IsDisposed, (object) this.JMK6rBAlC9BRA.IsOffline), "E:\\A\\_work\\115\\s\\src\\Microsoft.IdentityModel.Clients.ActiveDirectory\\Platforms\\net45\\rQFfIYZKpyJcM.cs");
    }

    protected abstract void OnClosingUrl();

    protected abstract void OnNavigationCanceled(int statusCode);

    internal n1IcPKd2Lx0L1 P4rKZ4TIm2uvR(Uri _param1, Uri _param2)
    {
      this.mjtlCywuDSuRW = _param2;
      this.pTbTuawjd8mjE = (n1IcPKd2Lx0L1) null;
      this.JMK6rBAlC9BRA.Navigating += new WebBrowserNavigatingEventHandler(this.WebBrowserNavigatingHandler);
      this.JMK6rBAlC9BRA.Navigated += new WebBrowserNavigatedEventHandler(this.\u0038MsZjnGctDP5d);
      this.JMK6rBAlC9BRA.Usak4vwAg3DAK += new pRtD4WrHkWJA9(this.WebBrowserNavigateErrorHandler);
      this.JMK6rBAlC9BRA.Navigate(_param1);
      this.OnAuthenticate();
      return this.pTbTuawjd8mjE;
    }

    protected virtual void OnAuthenticate()
    {
    }

    private void pW3dIrCO5CuFQ()
    {
      int height = (int) ((double) Math.Max((this.ownerWindow != null ? Screen.FromHandle(this.ownerWindow.Handle) : Screen.PrimaryScreen).WorkingArea.Height, 160) * 70.0 / (double) rQFfIYZKpyJcM.gWIv9fqa7K6Gt.QyDdqKG3xjY8u);
      this.NYDXhJoHuzmxn = new Panel();
      this.NYDXhJoHuzmxn.SuspendLayout();
      this.SuspendLayout();
      this.JMK6rBAlC9BRA.Dock = DockStyle.Fill;
      this.JMK6rBAlC9BRA.Location = new Point(0, 25);
      this.JMK6rBAlC9BRA.MinimumSize = new Size(20, 20);
      this.JMK6rBAlC9BRA.Name = "webBrowser";
      this.JMK6rBAlC9BRA.Size = new Size(566, 565);
      this.JMK6rBAlC9BRA.TabIndex = 1;
      this.JMK6rBAlC9BRA.IsWebBrowserContextMenuEnabled = false;
      this.NYDXhJoHuzmxn.Controls.Add((Control) this.JMK6rBAlC9BRA);
      this.NYDXhJoHuzmxn.Dock = DockStyle.Fill;
      this.NYDXhJoHuzmxn.BorderStyle = BorderStyle.None;
      this.NYDXhJoHuzmxn.Location = new Point(0, 0);
      this.NYDXhJoHuzmxn.Name = "webBrowserPanel";
      this.NYDXhJoHuzmxn.Size = new Size(566, height);
      this.NYDXhJoHuzmxn.TabIndex = 2;
      this.AutoScaleDimensions = new SizeF(6f, 13f);
      this.AutoScaleMode = AutoScaleMode.Font;
      this.ClientSize = new Size(566, height);
      this.Controls.Add((Control) this.NYDXhJoHuzmxn);
      this.FormBorderStyle = FormBorderStyle.FixedSingle;
      this.Name = "BrowserAuthenticationWindow";
      this.StartPosition = this.ownerWindow != null ? FormStartPosition.CenterParent : FormStartPosition.CenterScreen;
      this.Text = string.Empty;
      this.ShowIcon = false;
      this.MaximizeBox = false;
      this.MinimizeBox = false;
      this.ShowInTaskbar = this.ownerWindow == null;
      this.NYDXhJoHuzmxn.ResumeLayout(false);
      this.ResumeLayout(false);
    }

    protected override void Dispose(bool disposing)
    {
      if (disposing)
        this.efAvzB7uOMwHu();
      base.Dispose(disposing);
    }

    protected LlM9VbgWu20VY CreateExceptionForAuthenticationUiFailed(int statusCode)
    {
      if (rQFfIYZKpyJcM.HDP9up0JlcKNL.c404929X2bViH.ContainsKey(statusCode))
        return (LlM9VbgWu20VY) new zTDz1kuLRWPxI("authentication_ui_failed", string.Format((IFormatProvider) CultureInfo.CurrentCulture, " The browser based authentication dialog failed to complete. Reason: {0}", new object[1]
        {
          (object) rQFfIYZKpyJcM.HDP9up0JlcKNL.c404929X2bViH[statusCode]
        }))
        {
          eMbEkzYfjyTEh = statusCode
        };
      return (LlM9VbgWu20VY) new zTDz1kuLRWPxI("authentication_ui_failed", string.Format((IFormatProvider) CultureInfo.CurrentCulture, " The browser based authentication dialog failed to complete for an unknown reason. StatusCode: {0}", new object[1]
      {
        (object) statusCode
      }))
      {
        eMbEkzYfjyTEh = statusCode
      };
    }

    private sealed class VUbJnoUuZJFNv : IWin32Window
    {
      public IntPtr n1HcpdLNFJ8vf
      {
        [CompilerGenerated, SpecialName] get => this.gxoAvYOgWvkhm;
        set => ((GVVSSvKR4Ru0m.\u0030eZJoZSlz4Eu8) this).gxoAvYOgWvkhm = value;
      }

      static VUbJnoUuZJFNv()
      {
        IntPtr num1 = zqag0ALhZ2pM6.DWebBrowserEvents2.iGo2217Z8ljt3(IntPtr.Zero);
        double num2;
        double num3;
        if (num1 != IntPtr.Zero)
        {
          num2 = (double) zqag0ALhZ2pM6.\u00345RUqZYAqP8ig.pVEXeSx6aFgNp(num1, 88);
          num3 = (double) zqag0ALhZ2pM6.\u00345RUqZYAqP8ig.pVEXeSx6aFgNp(num1, 90);
          zqag0ALhZ2pM6.\u00345RUqZYAqP8ig.TKloFzVF4DHmv(IntPtr.Zero, num1);
        }
        else
        {
          num2 = 96.0;
          num3 = 96.0;
        }
        rQFfIYZKpyJcM.gWIv9fqa7K6Gt.QyDdqKG3xjY8u = Math.Min((int) (100.0 * (num2 / 96.0)), (int) (100.0 * (num3 / 96.0)));
      }
    }

    protected static class gWIv9fqa7K6Gt
    {
      public static int QyDdqKG3xjY8u { get; private set; }

      [DllImport("IEFRAME.dll", EntryPoint = "SetQueryNetSessionCount", CallingConvention = CallingConvention.StdCall)]
      internal static extern int VH1MBNbOQPGf5(
        rQFfIYZKpyJcM.IKK2SQvjca4Sp.g0MpFvse0EfOQ MspvYneHP3TNp);
    }

    internal static class IKK2SQvjca4Sp
    {
      [DebuggerHidden]
      [SpecialName]
      internal T0 get_GetInstance()
      {
        if ((object) MyProject.Kj8sFKkZ1TAqr<T0>.m_ThreadStaticValue == null)
          MyProject.Kj8sFKkZ1TAqr<T0>.m_ThreadStaticValue = Activator.CreateInstance<T0>();
        return MyProject.Kj8sFKkZ1TAqr<T0>.m_ThreadStaticValue;
      }

      internal enum g0MpFvse0EfOQ
      {
        SESSION_QUERY,
        SESSION_INCREMENT,
        SESSION_DECREMENT,
      }
    }
  }
}
