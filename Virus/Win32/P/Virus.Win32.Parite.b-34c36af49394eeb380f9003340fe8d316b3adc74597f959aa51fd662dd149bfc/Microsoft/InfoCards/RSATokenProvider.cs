// Decompiled with JetBrains decompiler
// Type: Microsoft.InfoCards.RSATokenProvider
// Assembly: infocard, Version=3.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089
// MVID: ADE0A079-11DB-4A46-8BDE-D2A592CA8DEA
// Assembly location: C:\Users\Administrateur\Desktop\Virusshare-00005-msil\Virus.Win32.Parite.b-34c36af49394eeb380f9003340fe8d316b3adc74597f959aa51fd662dd149bfc.exe

using Microsoft.InfoCards.Diagnostics;
using System;
using System.IdentityModel.Selectors;
using System.IdentityModel.Tokens;

namespace Microsoft.InfoCards
{
  internal class RSATokenProvider : SecurityTokenProvider, IDisposable
  {
    private InfoCardPolicy m_policy;
    private InfoCard m_card;
    private SelfIssuedAuthProofToken m_RSAToken;

    public RSATokenProvider(InfoCardPolicy policy, InfoCard card)
    {
      InfoCardTrace.ThrowInvalidArgumentConditional(null == policy, nameof (policy));
      InfoCardTrace.ThrowInvalidArgumentConditional(null == card, nameof (card));
      this.m_policy = policy;
      this.m_card = card;
    }

    public void Dispose()
    {
      if (this.m_RSAToken == null)
        return;
      this.m_RSAToken.Dispose();
      this.m_RSAToken = (SelfIssuedAuthProofToken) null;
    }

    protected override SecurityToken GetTokenCore(TimeSpan timeout)
    {
      if (this.m_RSAToken == null)
        this.m_RSAToken = new SelfIssuedAuthProofToken(this.m_card.GetPrivateCryptography(this.m_policy.Recipient.GetIdentifier()), DateTime.UtcNow + timeout);
      return (SecurityToken) this.m_RSAToken;
    }
  }
}
