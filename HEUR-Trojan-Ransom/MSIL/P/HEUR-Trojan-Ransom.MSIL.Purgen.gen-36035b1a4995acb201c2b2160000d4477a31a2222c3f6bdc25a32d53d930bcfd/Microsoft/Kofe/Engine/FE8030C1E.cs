// Decompiled with JetBrains decompiler
// Type: Microsoft.Kofe.Engine.FE8030C1E
// Assembly: C5C480410, Version=14.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
// MVID: BF642EC0-3F36-4177-B782-3E478BED34CB
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.12-msil\HEUR-Trojan-Ransom.MSIL.Purgen.gen-36035b1a4995acb201c2b2160000d4477a31a2222c3f6bdc25a32d53d930bcfd.exe

using Microsoft.Kofe.IJDWP;
using Microsoft.VisualStudio.Debugger.Interop;
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Linq;

namespace Microsoft.Kofe.Engine
{
  internal class FE8030C1E : IDebugThread2, IDebugThread100
  {
    private readonly B92FAA9B7 C788475F8;
    private readonly IJdwpThread CB44DA434;
    private DC37350B4 AF11F68BB;

    public FE8030C1E(B92FAA9B7 engine, IJdwpThread thread)
    {
      this.C788475F8 = engine;
      this.CB44DA434 = thread;
      this.AF11F68BB = new DC37350B4(this);
      this.F76F8A933();
    }

    internal B92FAA9B7 C11BEDF60 => this.C788475F8;

    internal IJdwpThread BAB7FF789() => this.CB44DA434;

    internal void F76F8A933() => this.AF11F68BB.B9696FDB7();

    internal void D869BD2AD(Constants.StepDepth DDA2D97BE, Constants.StepSize E91040BE1)
    {
      this.AF11F68BB.B9696FDB7();
      this.AF11F68BB.BF93FFDBD(DDA2D97BE, E91040BE1);
      this.C11BEDF60.B3E3893F5.Step(this.BAB7FF789(), E91040BE1, DDA2D97BE);
    }

    internal void A15ACDA04()
    {
      Constants.StepDepth BCB57B034;
      if (!this.AF11F68BB.C521F9647(out BCB57B034))
      {
        this.C788475F8.B3E3893F5.Step(this.CB44DA434, (Constants.StepSize) 1, BCB57B034);
      }
      else
      {
        DDF412AD2 F07AE03F4 = new DDF412AD2();
        this.AF11F68BB.B9696FDB7();
        this.C788475F8.F4F01CC92.D14E82737((IDebugEvent2) F07AE03F4, "0f7f24c1-74d9-4ea6-a3ea-7edb2d81441d", (IDebugThread2) this);
      }
    }

    int IDebugThread2.BE6DCFC82(
      IDebugStackFrame2 B514F573D,
      IDebugCodeContext2 A2314BD58)
    {
      return 1;
    }

    int IDebugThread2.EE045998D(
      enum_FRAMEINFO_FLAGS DB3568E6D,
      uint FBA0ECE74,
      out IEnumDebugFrameInfo2 C8F5F6161)
    {
      C8F5F6161 = (IEnumDebugFrameInfo2) null;
      try
      {
        IJdwpStackFrame[] ijdwpStackFrameArray = new IJdwpStackFrame[0];
        IJdwpStackFrame[] stackFrames;
        try
        {
          stackFrames = this.C788475F8.B3E3893F5.GetStackFrames(this.CB44DA434);
        }
        catch (Exception ex)
        {
          this.C788475F8.F4F01CC92.AEEFE1C6A(string.Format((IFormatProvider) CultureInfo.CurrentCulture, B0E4D9146.F9F8D4179, new object[1]
          {
            (object) ex.Message
          }));
          return -2147467259;
        }
        int length = stackFrames.Length;
        bool flag = false;
        if (stackFrames.Length > this.C788475F8.C58936D0E)
        {
          flag = true;
          length = this.C788475F8.C58936D0E;
        }
        FRAMEINFO[] frameinfoArray = new FRAMEINFO[length];
        for (int index = 0; index < length; ++index)
          new AAC38626A(this.C788475F8, this, stackFrames[index]).B9DAA8335(DB3568E6D, out frameinfoArray[index]);
        if (flag)
        {
          FRAMEINFO F95A3E908;
          new AAC38626A(B0E4D9146.FF0762A3A).B9DAA8335(DB3568E6D, out F95A3E908);
          frameinfoArray = ((IEnumerable<FRAMEINFO>) new List<FRAMEINFO>((IEnumerable<FRAMEINFO>) frameinfoArray)).Concat<FRAMEINFO>((IEnumerable<FRAMEINFO>) new FRAMEINFO[1]
          {
            F95A3E908
          }).ToArray<FRAMEINFO>();
        }
        C8F5F6161 = (IEnumDebugFrameInfo2) new D3A863627(frameinfoArray);
        return 0;
      }
      catch (ComponentException ex)
      {
        return ((Exception) ex).HResult;
      }
      catch (Exception ex)
      {
        this.C788475F8.F4F01CC92.AEEFE1C6A(string.Format((IFormatProvider) CultureInfo.CurrentCulture, B0E4D9146.F9F8D4179, new object[1]
        {
          (object) ex.Message
        }));
        return -2147467259;
      }
    }

    int IDebugThread2.A542EE8F6(out string EBB20C416)
    {
      EBB20C416 = this.CB44DA434.Name;
      return 0;
    }

    int IDebugThread2.B4851F662(out IDebugProgram2 B7D06FEEB)
    {
      B7D06FEEB = (IDebugProgram2) this.C788475F8;
      return 0;
    }

    int IDebugThread2.D675BA79F(out uint E97425022)
    {
      E97425022 = (uint) this.CB44DA434.Id;
      return 0;
    }

    int IDebugThread2.BDA95A2DF(
      enum_THREADPROPERTY_FIELDS C17370E5F,
      THREADPROPERTIES[] CBA6CB741)
    {
      try
      {
        THREADPROPERTIES threadproperties = new THREADPROPERTIES();
        if ((C17370E5F & 1) != null)
        {
          threadproperties.dwThreadId = (uint) this.CB44DA434.Id;
          ref enum_THREADPROPERTY_FIELDS local = ref threadproperties.dwFields;
          // ISSUE: cast to a reference type
          // ISSUE: explicit reference operation
          // ISSUE: cast to a reference type
          // ISSUE: explicit reference operation
          ^(int&) ref local = ^(int&) ref local | 1;
        }
        if ((C17370E5F & 2) != null)
        {
          ref enum_THREADPROPERTY_FIELDS local = ref threadproperties.dwFields;
          // ISSUE: cast to a reference type
          // ISSUE: explicit reference operation
          // ISSUE: cast to a reference type
          // ISSUE: explicit reference operation
          ^(int&) ref local = ^(int&) ref local | 2;
        }
        if ((C17370E5F & 4) != null)
        {
          threadproperties.dwThreadState = 1U;
          ref enum_THREADPROPERTY_FIELDS local = ref threadproperties.dwFields;
          // ISSUE: cast to a reference type
          // ISSUE: explicit reference operation
          // ISSUE: cast to a reference type
          // ISSUE: explicit reference operation
          ^(int&) ref local = ^(int&) ref local | 4;
        }
        if ((C17370E5F & 8) != null)
        {
          threadproperties.bstrPriority = "Normal";
          ref enum_THREADPROPERTY_FIELDS local = ref threadproperties.dwFields;
          // ISSUE: cast to a reference type
          // ISSUE: explicit reference operation
          // ISSUE: cast to a reference type
          // ISSUE: explicit reference operation
          ^(int&) ref local = ^(int&) ref local | 8;
        }
        if ((C17370E5F & 16) != null)
        {
          threadproperties.bstrName = this.CB44DA434.Name;
          ref enum_THREADPROPERTY_FIELDS local = ref threadproperties.dwFields;
          // ISSUE: cast to a reference type
          // ISSUE: explicit reference operation
          // ISSUE: cast to a reference type
          // ISSUE: explicit reference operation
          ^(int&) ref local = ^(int&) ref local | 16;
        }
        if ((C17370E5F & 32) != null)
        {
          threadproperties.bstrLocation = "";
          ref enum_THREADPROPERTY_FIELDS local = ref threadproperties.dwFields;
          // ISSUE: cast to a reference type
          // ISSUE: explicit reference operation
          // ISSUE: cast to a reference type
          // ISSUE: explicit reference operation
          ^(int&) ref local = ^(int&) ref local | 32;
        }
        CBA6CB741[0] = threadproperties;
        return 0;
      }
      catch (ComponentException ex)
      {
        return ((Exception) ex).HResult;
      }
      catch (Exception ex)
      {
        return A09717160.ABD5D2EFF(ex);
      }
    }

    int IDebugThread2.F86CB33EC(out uint C7E4EA542)
    {
      C7E4EA542 = 0U;
      return 1;
    }

    int IDebugThread2.DC9278C8A(
      IDebugStackFrame2 D4DD4C11D,
      IDebugCodeContext2 B2182295C)
    {
      return 1;
    }

    int IDebugThread2.C7FE074AD(out uint CD8E4E834)
    {
      CD8E4E834 = 0U;
      return 1;
    }

    int IDebugThread100.FF39C86AC(string A74BC6429) => 1;

    int IDebugThread100.EE0FE3EF9(out string BF96EB474)
    {
      BF96EB474 = string.Empty;
      return 1;
    }

    int IDebugThread100.D77E3501C() => 1;

    int IDebugThread100.F49B59675(uint F424E64AE) => 1;

    int IDebugThread100.BB2D0E3C2(out uint E7A081B51)
    {
      E7A081B51 = 0U;
      return 1;
    }

    int IDebugThread100.AE358B8EE(uint DD0533762, THREADPROPERTIES100[] D001929DA)
    {
      THREADPROPERTIES[] threadpropertiesArray = new THREADPROPERTIES[1];
      enum_THREADPROPERTY_FIELDS threadpropertyFields = (enum_THREADPROPERTY_FIELDS) ((int) DD0533762 & 63);
      int threadProperties = ((IDebugThread2) this).GetThreadProperties(threadpropertyFields, threadpropertiesArray);
      D001929DA[0].bstrLocation = threadpropertiesArray[0].bstrLocation;
      D001929DA[0].bstrName = threadpropertiesArray[0].bstrName;
      D001929DA[0].bstrDisplayName = string.Empty;
      D001929DA[0].bstrPriority = threadpropertiesArray[0].bstrPriority;
      D001929DA[0].dwFields = (uint) threadpropertiesArray[0].dwFields;
      D001929DA[0].dwSuspendCount = threadpropertiesArray[0].dwSuspendCount;
      D001929DA[0].dwThreadId = threadpropertiesArray[0].dwThreadId;
      D001929DA[0].dwThreadState = threadpropertiesArray[0].dwThreadState;
      if (threadProperties != 0 || (int) DD0533762 == threadpropertyFields)
        return threadProperties;
      if (((int) DD0533762 & 64) != 0)
      {
        D001929DA[0].bstrDisplayName = this.CB44DA434.Name;
        D001929DA[0].dwFields |= 64U;
        D001929DA[0].DisplayNamePriority = 10U;
        D001929DA[0].dwFields |= 128U;
      }
      if (((int) DD0533762 & 256) != 0)
      {
        D001929DA[0].dwThreadCategory = this.CB44DA434.IsMainThread ? 2U : 0U;
        D001929DA[0].dwFields |= 256U;
      }
      if (((int) DD0533762 & 512) != 0)
      {
        D001929DA[0].AffinityMask = 0UL;
        D001929DA[0].dwFields |= 512U;
      }
      if (((int) DD0533762 & 1024) == 0)
        return threadProperties;
      D001929DA[0].priorityId = 0;
      D001929DA[0].dwFields |= 1024U;
      return threadProperties;
    }

    int IDebugThread2.E3EC552CF(
      IDebugStackFrame2 C4A112602,
      out IDebugLogicalThread2 C41FB42D7)
    {
      C41FB42D7 = (IDebugLogicalThread2) null;
      return 1;
    }

    int IDebugThread2.FF28A816B(string BE43F3A8A) => 1;

    private enum BD97424C0
    {
      Worker,
      UI,
      Main,
      RPC,
      Unknown,
    }
  }
}
