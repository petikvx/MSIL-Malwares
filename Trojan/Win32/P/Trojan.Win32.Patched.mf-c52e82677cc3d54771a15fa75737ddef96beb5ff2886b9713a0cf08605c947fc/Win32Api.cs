// Decompiled with JetBrains decompiler
// Type: activation.Win32Api
// Assembly: Activation, Version=1.0.0.10170, Culture=neutral, PublicKeyToken=null
// MVID: 2DB4F8B3-8DF5-4A65-8363-C3E1D25DD750
// Assembly location: C:\Users\Administrateur\Desktop\Virusshare-00005-msil\Trojan.Win32.Patched.mf-c52e82677cc3d54771a15fa75737ddef96beb5ff2886b9713a0cf08605c947fc.exe

using System;
using System.Runtime.InteropServices;

namespace activation
{
  internal class Win32Api
  {
    public const int WINHTTP_ACCESS_TYPE_DEFAULT_PROXY = 0;
    public const int WINHTTP_ACCESS_TYPE_NO_PROXY = 1;
    public const int WINHTTP_ACCESS_TYPE_NAMED_PROXY = 3;
    public const int WINHTTP_AUTOPROXY_AUTO_DETECT = 1;
    public const int WINHTTP_AUTOPROXY_CONFIG_URL = 2;
    public const int WINHTTP_AUTOPROXY_RUN_INPROCESS = 65536;
    public const int WINHTTP_AUTOPROXY_RUN_OUTPROCESS_ONLY = 131072;
    public const int WINHTTP_AUTO_DETECT_TYPE_DHCP = 1;
    public const int WINHTTP_AUTO_DETECT_TYPE_DNS_A = 2;

    [DllImport("winhttp.dll", CharSet = CharSet.Unicode, SetLastError = true)]
    public static extern bool WinHttpGetProxyForUrl(
      IntPtr hSession,
      string lpcwszUrl,
      ref Win32Api.WINHTTP_AUTOPROXY_OPTIONS pAutoProxyOptions,
      ref Win32Api.WINHTTP_PROXY_INFO pProxyInfo);

    [DllImport("winhttp.dll", CharSet = CharSet.Unicode, SetLastError = true)]
    public static extern IntPtr WinHttpOpen(
      string pwszUserAgent,
      int dwAccessType,
      IntPtr pwszProxyName,
      IntPtr pwszProxyBypass,
      int dwFlags);

    [DllImport("winhttp.dll", CharSet = CharSet.Unicode, SetLastError = true)]
    public static extern bool WinHttpCloseHandle(IntPtr hInternet);

    [DllImport("winhttp.dll", CharSet = CharSet.Unicode, SetLastError = true)]
    public static extern bool WinHttpDetectAutoProxyConfigUrl(
      int dwAutoDetectFlags,
      out IntPtr ppwszAutoConfigUrl);

    [DllImport("winhttp.dll", CharSet = CharSet.Unicode, SetLastError = true)]
    public static extern bool WinHttpGetIEProxyConfigForCurrentUser(
      ref Win32Api.WINHTTP_CURRENT_USER_IE_PROXY_CONFIG pstProxyConfig);

    [DllImport("kernel32.dll")]
    public static extern int GetLastError();

    [DllImport("kernel32.dll", SetLastError = true)]
    public static extern IntPtr GlobalFree(IntPtr pMem);

    [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]
    public struct WINHTTP_AUTOPROXY_OPTIONS
    {
      [MarshalAs(UnmanagedType.U4)]
      public int dwFlags;
      [MarshalAs(UnmanagedType.U4)]
      public int dwAutoDetectFlags;
      public string lpszAutoConfigUrl;
      public IntPtr lpvReserved;
      [MarshalAs(UnmanagedType.U4)]
      public int dwReserved;
      public bool fAutoLoginIfChallenged;
    }

    [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]
    public struct WINHTTP_PROXY_INFO
    {
      [MarshalAs(UnmanagedType.U4)]
      public int dwAccessType;
      public IntPtr lpszProxy;
      public IntPtr lpszProxyBypass;
    }

    [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]
    public struct WINHTTP_CURRENT_USER_IE_PROXY_CONFIG
    {
      public bool fAutoDetect;
      public IntPtr lpszAutoConfigUrl;
      public IntPtr lpszProxy;
      public IntPtr lpszProxyBypass;
    }
  }
}
