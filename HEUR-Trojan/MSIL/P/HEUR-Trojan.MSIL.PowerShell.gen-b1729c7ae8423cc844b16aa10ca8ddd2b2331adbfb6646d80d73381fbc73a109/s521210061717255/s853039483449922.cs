// Decompiled with JetBrains decompiler
// Type: s521210061717255.s853039483449922
// Assembly: s968508024776124, Version=2.0.47.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
// MVID: E3596912-35E7-405B-A05A-F5F12AB5E292
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.04\HEUR-Trojan.MSIL.PowerShell.gen-b1729c7ae8423cc844b16aa10ca8ddd2b2331adbfb6646d80d73381fbc73a109.exe

using s021776306633796;
using s755365636060389;
using s850469545382430;
using System;
using System.IO;
using System.Runtime.InteropServices;

namespace s521210061717255
{
  internal sealed class s853039483449922 : Stream
  {
    private s347263595591673 s628380235392653;
    private s667517671108423 s975383036388554;
    private Stream s940710491887109;
    private byte[] s093812409934032 = new byte[256];
    private GCHandle s672433784357700;
    private long s662400459994824;
    private long s069836882189230;

    public s667517671108423 s109496930992696 => this.s975383036388554;

    public s853039483449922(Stream stream, s347263595591673 metadata)
    {
      this.s940710491887109 = stream;
      this.s628380235392653 = metadata;
      this.s672433784357700 = GCHandle.Alloc((object) this.s093812409934032, GCHandleType.Pinned);
      this.s295543753495045();
    }

    protected override void Dispose(bool disposing)
    {
      base.Dispose(disposing);
      if (!this.s672433784357700.IsAllocated)
        return;
      this.s672433784357700.Free();
    }

    private bool s295543753495045()
    {
      do
      {
        int count;
        for (; this.s662400459994824 > 0L; this.s662400459994824 -= (long) count)
        {
          count = (long) this.s093812409934032.Length < this.s662400459994824 ? this.s093812409934032.Length : (int) this.s662400459994824;
          this.s940710491887109.Read(this.s093812409934032, 0, count);
        }
        if (!this.s019697726812043() || !this.s668800806246651())
          return false;
      }
      while (this.s069836882189230 == 0L);
      return true;
    }

    private bool s019697726812043()
    {
      s059513796120190 s444076042830565 = this.s628380235392653.s097842046262845.s444076042830565;
      int num1 = s444076042830565.s556533405975727();
      if (num1 == -1)
        throw new FormatException("Unexpected metadata format.");
      int num2 = s444076042830565.s114514795231324("magic");
      if (num2 < 0)
        throw new FormatException("Unexpected metadata format: No magic field.");
      int num3 = s444076042830565.s114514795231324("stream_id");
      if (num3 < 0)
        throw new FormatException("Unexpected metadata format: No stream_id field.");
      int startIndex1 = num2 / 8;
      int startIndex2 = num3 / 8;
      int count = num1 / 8;
      if (this.s940710491887109.Read(this.s093812409934032, 0, count) != count)
        return false;
      if (BitConverter.ToUInt32(this.s093812409934032, startIndex1) != 3254525889U)
        throw new FormatException("Unknown magic number in trace header.");
      this.s975383036388554 = this.s628380235392653.s315924393909143[(int) BitConverter.ToUInt32(this.s093812409934032, startIndex2)];
      return true;
    }

    private bool s668800806246651()
    {
      s059513796120190 s119115742211419 = this.s975383036388554.s119115742211419;
      int num1 = s119115742211419.s556533405975727();
      if (num1 == -1)
        throw new FormatException("Unexpected metadata format.");
      int num2 = s119115742211419.s114514795231324("content_size");
      if (num2 < 0)
        throw new FormatException("Unexpected metadata format: No context_size field.");
      int num3 = s119115742211419.s114514795231324("packet_size");
      if (num3 < 0)
        throw new FormatException("Unexpected metadata format: No packet_size field.");
      int count = num1 / 8;
      int startIndex1 = num2 / 8;
      int startIndex2 = num3 / 8;
      if (this.s940710491887109.Read(this.s093812409934032, 0, count) != count)
        return false;
      int num4 = this.s628380235392653.s097842046262845.s444076042830565.s556533405975727() / 8 + count;
      this.s069836882189230 = (long) BitConverter.ToUInt64(this.s093812409934032, startIndex1) / 8L - (long) num4;
      this.s662400459994824 = (long) BitConverter.ToUInt64(this.s093812409934032, startIndex2) / 8L - (long) num4;
      return true;
    }

    private void s400159637503213() => this.s975383036388554.s750721611916598.s556533405975727();

    private bool s904160728729193<T>(out T s100532865268880) where T : struct
    {
      int count = Marshal.SizeOf(typeof (T));
      int num = this.s940710491887109.Read(this.s093812409934032, 0, count);
      if (count != num)
      {
        s100532865268880 = default (T);
        return false;
      }
      s100532865268880 = (T) Marshal.PtrToStructure(this.s672433784357700.AddrOfPinnedObject(), typeof (T));
      return true;
    }

    public virtual bool s443998474508148 => true;

    public virtual int s997195747109090()
    {
      if (this.s069836882189230 == 0L && !this.s295543753495045())
        return -1;
      --this.s069836882189230;
      --this.s662400459994824;
      return this.s940710491887109.ReadByte();
    }

    public virtual int s661479221293195(
      byte[] s372036429898621,
      int s412306461782478,
      int s679825238238521)
    {
      int num1 = 0;
      while (num1 < s679825238238521 && (this.s069836882189230 != 0L || this.s295543753495045()))
      {
        int count = (long) s679825238238521 > this.s069836882189230 ? (int) this.s069836882189230 : s679825238238521;
        int num2 = this.s940710491887109.Read(s372036429898621, s412306461782478 + num1, count);
        this.s069836882189230 -= (long) num2;
        this.s662400459994824 -= (long) num2;
        num1 += num2;
        if (num2 != count)
          break;
      }
      return num1;
    }

    public virtual bool s168156846326519 => false;

    public virtual bool s439455356037053 => false;

    public virtual long s153821413436227 => throw new NotImplementedException();

    public virtual long s552777300376144
    {
      get => throw new NotImplementedException();
      set => throw new NotImplementedException();
    }

    public virtual void s789177871801736() => throw new NotImplementedException();

    public virtual long s051160026487226(long s228300534092921, SeekOrigin s754473716021833) => throw new NotImplementedException();

    public virtual void s215851163184022(long s815962317003898) => throw new NotImplementedException();

    public virtual void s610959588207444(
      byte[] s898093865318722,
      int s993041659923157,
      int s701450368159908)
    {
      throw new NotImplementedException();
    }
  }
}
