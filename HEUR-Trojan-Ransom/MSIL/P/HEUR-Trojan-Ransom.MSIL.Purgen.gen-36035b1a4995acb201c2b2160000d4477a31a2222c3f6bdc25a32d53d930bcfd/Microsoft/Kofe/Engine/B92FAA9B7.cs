// Decompiled with JetBrains decompiler
// Type: Microsoft.Kofe.Engine.B92FAA9B7
// Assembly: C5C480410, Version=14.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
// MVID: BF642EC0-3F36-4177-B782-3E478BED34CB
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.12-msil\HEUR-Trojan-Ransom.MSIL.Purgen.gen-36035b1a4995acb201c2b2160000d4477a31a2222c3f6bdc25a32d53d930bcfd.exe

using BD9409C89;
using MICore;
using Microsoft.DebugEngineHost;
using Microsoft.Kofe.IJDWP;
using Microsoft.VisualStudio.Debugger.Interop;
using Microsoft.Win32;
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Runtime.InteropServices;

namespace Microsoft.Kofe.Engine
{
  [ComVisible(true)]
  [Guid("CA454416-95AC-4702-ADD1-FE8B82FD177C")]
  public class B92FAA9B7 : 
    IDebugEngine2,
    IDebugEngineLaunch2,
    IDebugProgram3,
    IDebugProgram2,
    IDebugEngineProgram2,
    IDebugSymbolSettings100,
    IDebugEngine110
  {
    private const string FBFDE56EB = "MaxFrames";
    private const int BCD453819 = 5000;
    private C34CB4AC6 B921E49E4;
    private IJDbg FE7B06DD7;
    private B6DF8D9E3 CCA89DDF4;
    private Guid A68EA7084;
    private string BDC3AC52B;
    private HostConfigurationStore F8EF90C8A;
    private int A3212B05B;
    private DB7064EFF F5382BFA0;
    private IDebugSettingsCallback110 E64F1DCE7;
    private AD_PROCESS_ID FBDEAC594;
    private string B64BEF33F;

    public DAB178BEA BEB396177 { get; private set; }

    public B92FAA9B7()
    {
      this.CCA89DDF4 = new B6DF8D9E3(this);
      this.BEB396177 = new DAB178BEA();
    }

    internal C34CB4AC6 F4F01CC92 => this.B921E49E4;

    internal IJDbg B3E3893F5 => this.FE7B06DD7;

    internal uint C826EF455()
    {
      uint num;
      if (this.E64F1DCE7 == null || this.E64F1DCE7.GetDisplayRadix(ref num) != 0)
        num = 10U;
      return num;
    }

    internal int C58936D0E
    {
      get
      {
        if (this.A3212B05B == 0)
          this.A3212B05B = this.E44E5AEFC();
        return this.A3212B05B;
      }
    }

    public void A41E71F6C(string E8B451AAD, params object[] C35CACB76) => this.F5382BFA0?.CD51BAE3D(E8B451AAD, C35CACB76);

    int IDebugEngine2.F541C0290(
      IDebugProgram2[] EC2F32D01,
      IDebugProgramNode2[] FC53DFFFD,
      uint EF71D4250,
      IDebugEventCallback2 EA6808AA4,
      enum_ATTACH_REASON EE6E8F7FB)
    {
      if (EF71D4250 != 1U)
        throw new ArgumentException();
      try
      {
        AD_PROCESS_ID EB5013784 = A09717160.FD33F459F(EC2F32D01[0]);
        A09717160.BA0F763AF(EC2F32D01[0].GetProgramId(ref this.A68EA7084));
        if (this.FE7B06DD7 == null)
          this.B921E49E4 = new C34CB4AC6(this, EA6808AA4);
        else if (!A09717160.E5CC8D070(EB5013784, this.FBDEAC594))
          return 1;
      }
      catch (ComponentException ex)
      {
        return ((Exception) ex).HResult;
      }
      try
      {
        this.FE7B06DD7.Initialize(this.C33AFA128(), "Java Exceptions");
      }
      catch (Exception ex)
      {
        this.B921E49E4.A61FE0ED3(string.Format((IFormatProvider) CultureInfo.CurrentCulture, B0E4D9146.D80EA1684, new object[1]
        {
          (object) ex.Message
        }));
        return 1;
      }
      BD52E9688.D30D556F9(this);
      EE3ABAF2D.B25F8A1ED(this);
      return 0;
    }

    private Dictionary<string, bool> C33AFA128()
    {
      Dictionary<string, bool> dictionary = new Dictionary<string, bool>();
      using (RegistryKey registryKey1 = Registry.LocalMachine.OpenSubKey(this.BDC3AC52B + "\\AD7Metrics\\Exception\\{029D0BD7-2382-44D7-BBE9-E45D5514E439}"))
      {
        using (RegistryKey registryKey2 = registryKey1.OpenSubKey("Java Exceptions"))
        {
          enum_EXCEPTION_STATE enumExceptionState1 = (enum_EXCEPTION_STATE) registryKey2.GetValue("State");
          dictionary["Java Exceptions"] = (enumExceptionState1 & 1) > 0;
          foreach (string subKeyName in registryKey2.GetSubKeyNames())
          {
            using (RegistryKey registryKey3 = registryKey2.OpenSubKey(subKeyName))
            {
              enum_EXCEPTION_STATE enumExceptionState2 = (enum_EXCEPTION_STATE) registryKey3.GetValue("State");
              dictionary[subKeyName] = (enumExceptionState2 & 1) > 0;
            }
          }
        }
      }
      return dictionary;
    }

    private int E44E5AEFC()
    {
      int num = this.F8EF90C8A.GetDebuggerConfigurationSetting<int>("MaxFrames", 5000);
      if (num < 10 || num > 20000)
        num = 5000;
      return num;
    }

    int IDebugEngine2.D9D6DFEF4() => ((IDebugProgram2) this).CauseBreak();

    int IDebugEngine2.C8F829A11(IDebugEvent2 E61BEE283)
    {
      try
      {
        if (E61BEE283 is A0F065618)
        {
          this.B921E49E4 = (C34CB4AC6) null;
          this.A68EA7084 = Guid.Empty;
          this.FE7B06DD7 = (IJDbg) null;
        }
        else
        {
          EE17CB70B ee17Cb70B = E61BEE283 as EE17CB70B;
        }
      }
      catch (Exception ex)
      {
        return A09717160.ABD5D2EFF(ex);
      }
      return 0;
    }

    int IDebugEngine2.AA9DEFE35(
      IDebugBreakpointRequest2 CA0FDB66A,
      out IDebugPendingBreakpoint2 EC9AA7EB8)
    {
      EC9AA7EB8 = (IDebugPendingBreakpoint2) null;
      try
      {
        this.CCA89DDF4.B0FF78904(CA0FDB66A, out EC9AA7EB8);
      }
      catch (Exception ex)
      {
        return A09717160.ABD5D2EFF(ex);
      }
      return 0;
    }

    internal void BC1C4713E(IJdwpClass CFD373304) => this.CCA89DDF4.D526CA2B6(CFD373304);

    int IDebugEngine2.BD257F92D(IDebugProgram2 ED407BE1C) => -2147218687;

    int IDebugEngine2.E000A21E5(out Guid B87E5F7E1)
    {
      B87E5F7E1 = new Guid("{029D0BD7-2382-44D7-BBE9-E45D5514E439}");
      return 0;
    }

    int IDebugEngine2.E937EC043(ref Guid D4BD8F20D)
    {
      if (D4BD8F20D == Guid.Empty)
        this.FE7B06DD7.ClearExceptionSettings();
      return 0;
    }

    int IDebugEngine2.F59CF301C(EXCEPTION_INFO[] A20A7B321)
    {
      this.FE7B06DD7.SetException(A20A7B321[0].bstrExceptionName, false);
      return 0;
    }

    int IDebugEngine2.DF172B972(EXCEPTION_INFO[] B1A185C8C)
    {
      EXCEPTION_INFO exceptionInfo = B1A185C8C[0];
      this.FE7B06DD7.SetException(exceptionInfo.bstrExceptionName, (exceptionInfo.dwState & 1) > 0);
      return 0;
    }

    int IDebugEngine2.C24B5055B(ushort AAD0A7D93) => 0;

    int IDebugEngine2.E286909B9(string C8077D50A, object B7971E92D) => 0;

    int IDebugEngine2.F25AA8480(string DA4E931D5)
    {
      this.F8EF90C8A = new HostConfigurationStore(DA4E931D5);
      this.F8EF90C8A.SetEngineGuid(new Guid("{029D0BD7-2382-44D7-BBE9-E45D5514E439}"));
      this.BDC3AC52B = DA4E931D5;
      return 0;
    }

    int IDebugEngineLaunch2.A6497CF98(IDebugProcess2 EFFD4A811) => 0;

    int IDebugEngineLaunch2.B943910D4(
      string E67E55034,
      IDebugPort2 ABC3B48E6,
      string C4B7A8E85,
      string BA3E3F45A,
      string B1F20E058,
      string F4C49E085,
      string BDB4F90EE,
      enum_LAUNCH_FLAGS B0362844D,
      uint EADAB60F6,
      uint A447F1D37,
      uint CF7FFFC4E,
      IDebugEventCallback2 F8FACB3F1,
      out IDebugProcess2 E890D7082)
    {
      E890D7082 = (IDebugProcess2) null;
      this.B921E49E4 = new C34CB4AC6(this, F8FACB3F1);
      try
      {
        JavaLaunchOptions instance = (JavaLaunchOptions) LaunchOptions.GetInstance(this.F8EF90C8A, C4B7A8E85, BA3E3F45A, B1F20E058, BDB4F90EE, false, (IDeviceAppLauncherEventCallback) this.B921E49E4, (TargetEngine) 2, (Logger) null);
        this.BEB396177.C4C974AF9 = (IEnumerable<SourceRoot>) instance.SourceRoots;
        this.BEB396177.C1A369FA3();
        this.B64BEF33F = instance.ProcessName;
        this.FE7B06DD7 = JavaFactory.CreateJDbg();
        this.FE7B06DD7.Attach(instance.JVMHost, instance.JVMPort, (IEngineCallback) this.B921E49E4);
        this.F5382BFA0 = DB7064EFF.B8F20CD6F(this.F8EF90C8A);
        this.F5382BFA0.CD51BAE3D(BDB4F90EE);
      }
      catch (Exception ex)
      {
        A747D62C3.B550BC694(ex);
        this.F5382BFA0?.CD51BAE3D(B0E4D9146.A550DE73D, (object) ex.Message);
        return -2147221469;
      }
      AD_PROCESS_ID adProcessId = new AD_PROCESS_ID();
      adProcessId.ProcessIdType = 1U;
      adProcessId.guidProcessId = Guid.NewGuid();
      this.FBDEAC594 = adProcessId;
      return ABC3B48E6.GetProcess(adProcessId, ref E890D7082);
    }

    int IDebugEngineLaunch2.BA73AD92A(IDebugProcess2 B5343178C)
    {
      try
      {
        if (!A09717160.E5CC8D070(A09717160.AEB40F257(B5343178C), this.FBDEAC594))
          return 1;
        IDebugPort2 idebugPort2;
        A09717160.BA0F763AF(B5343178C.GetPort(ref idebugPort2));
        IDebugPortNotify2 idebugPortNotify2;
        A09717160.BA0F763AF(((IDebugDefaultPort2) idebugPort2).GetPortNotify(ref idebugPortNotify2));
        A09717160.BA0F763AF(idebugPortNotify2.AddProgramNode((IDebugProgramNode2) new AA6E8A8A4(this.FBDEAC594, this.B64BEF33F)));
        if (!(this.A68EA7084 == Guid.Empty))
          return 0;
        this.B921E49E4.A61FE0ED3(B0E4D9146.B01C7B211);
        return 1;
      }
      catch (ComponentException ex)
      {
        return ((Exception) ex).HResult;
      }
      catch (Exception ex)
      {
        this.B921E49E4.A61FE0ED3(string.Format((IFormatProvider) CultureInfo.CurrentCulture, B0E4D9146.B27F41BB2, new object[1]
        {
          (object) ex.Message
        }));
        return 1;
      }
    }

    int IDebugEngineLaunch2.CFC13BFC5(IDebugProcess2 E1BFB8B5B)
    {
      try
      {
        if (!A09717160.E5CC8D070(A09717160.AEB40F257(E1BFB8B5B), this.FBDEAC594) || this.FE7B06DD7 == null)
          return 1;
        this.FE7B06DD7.Close();
        return 0;
      }
      catch (ComponentException ex)
      {
        return ((Exception) ex).HResult;
      }
      catch (Exception ex)
      {
        return A09717160.ABD5D2EFF(ex);
      }
      finally
      {
        this.D35CD9549();
      }
    }

    private void D35CD9549()
    {
      if (this.BEB396177 == null)
        return;
      this.BEB396177.DF1712D92();
      this.BEB396177 = (DAB178BEA) null;
    }

    public int F86BEFAF1() => 0;

    public int AD6782D16()
    {
      this.FE7B06DD7.CauseBreak();
      return 0;
    }

    public int DCE5B3F5B(IDebugThread2 CF1326CFF)
    {
      this.FE7B06DD7.Continue();
      return 0;
    }

    public int F59B4DE29()
    {
      this.CCA89DDF4.F76B8B846();
      this.FE7B06DD7.Close();
      this.D35CD9549();
      return 0;
    }

    public int AE9852C9D(IDebugDocumentPosition2 CBC7F021B, out IEnumDebugCodeContexts2 BFF82EFE3) => throw new NotImplementedException();

    public int F6095942F(
      string ECE95F88E,
      IDebugCodeContext2 D8BFF55B3,
      IDebugStackFrame2 B8DE515BC,
      int D6C193648,
      out IEnumCodePaths2 A343A4DA4,
      out IDebugCodeContext2 C263D8F29)
    {
      A343A4DA4 = (IEnumCodePaths2) null;
      C263D8F29 = (IDebugCodeContext2) null;
      return 1;
    }

    public int D2B358B4D(out IEnumDebugModules2 FBAA57C67)
    {
      IJdwpClass[] classes = this.FE7B06DD7.GetClasses();
      E941D6CC6[] modules = new E941D6CC6[classes.Length];
      for (int index = 0; index < classes.Length; ++index)
        modules[index] = new E941D6CC6(classes[index]);
      FBAA57C67 = (IEnumDebugModules2) new D04E124C3((IDebugModule2[]) modules);
      return 0;
    }

    public int C765306A3(out IEnumDebugThreads2 A710E9BB2)
    {
      IJdwpThread[] threads1 = this.FE7B06DD7.GetThreads();
      FE8030C1E[] threads2 = new FE8030C1E[threads1.Length];
      for (int index = 0; index < threads1.Length; ++index)
        threads2[index] = (FE8030C1E) threads1[index].Client;
      A710E9BB2 = (IEnumDebugThreads2) new CA7C58B0D((IDebugThread2[]) threads2);
      return 0;
    }

    public int DB191812B(out IDebugProperty2 E03E1FB15) => throw new NotImplementedException();

    public int A2B354F23(
      enum_DISASSEMBLY_STREAM_SCOPE D546B4416,
      IDebugCodeContext2 ECEA1CBE7,
      out IDebugDisassemblyStream2 B24F71881)
    {
      B24F71881 = (IDebugDisassemblyStream2) null;
      return 1;
    }

    public int BCEACBD70(out object B045A6101)
    {
      B045A6101 = (object) null;
      return -2147467263;
    }

    public int B429FA917(out string CB94BE136, out Guid EA27B67FC)
    {
      CB94BE136 = B0E4D9146.E34BDB9D2;
      EA27B67FC = new Guid("{029D0BD7-2382-44D7-BBE9-E45D5514E439}");
      return 0;
    }

    public int D54B7E72F(out IDebugMemoryBytes2 A95288E34) => throw new NotImplementedException();

    public int CE67D2EE4(out string BCB8E0362)
    {
      BCB8E0362 = this.B64BEF33F;
      return 0;
    }

    public int ECE702C1E(out Guid F9C4D5B67)
    {
      F9C4D5B67 = this.A68EA7084;
      return 0;
    }

    public int C679D8379(IDebugThread2 B3648CA2A, enum_STEPKIND B3390EE01, enum_STEPUNIT A20CDE083)
    {
      FE8030C1E fe8030C1E = (FE8030C1E) B3648CA2A;
      if (fe8030C1E == null || fe8030C1E.BAB7FF789() == null)
      {
        this.B921E49E4.AEEFE1C6A(B0E4D9146.E04609340);
        return 1;
      }
      Constants.StepDepth DDA2D97BE = (Constants.StepDepth) 1;
      switch ((int) B3390EE01)
      {
        case 0:
          DDA2D97BE = (Constants.StepDepth) 0;
          goto case 1;
        case 1:
          Constants.StepSize E91040BE1 = A20CDE083 == 2 ? (Constants.StepSize) 0 : (Constants.StepSize) 1;
          fe8030C1E.D869BD2AD(DDA2D97BE, E91040BE1);
          return 0;
        case 2:
          DDA2D97BE = (Constants.StepDepth) 2;
          goto case 1;
        default:
          throw new NotImplementedException();
      }
    }

    public int C2536A886() => 0;

    public int AE3A99680(enum_DUMPTYPE F3384DE7D, string CDA29C280) => 1;

    public int E337F8ED1(IDebugThread2 F9C2FD4E9)
    {
      this.FE7B06DD7.Execute();
      return 0;
    }

    public int A77840C6C() => throw new NotImplementedException();

    public int CF06D43A1(
      IDebugProgram2 D3DEFB4A0,
      uint DD43D57D4,
      uint F95F890B2,
      IDebugEventCallback2 AA5439379,
      int EAA374AEC)
    {
      return 0;
    }

    public int BFC67E6D1(IDebugProgram2 C96D4C549, uint DF75BEF85, int F22153A1C, uint E4B4F447D) => 0;

    public int B3715A0C4(int E14712C31, int C6BEAA45C, string FE7F5DD76, string CA2E57C04) => 0;

    int IDebugEngine2.F46ECECE7(out IEnumDebugPrograms2 C8C003CE4)
    {
      C8C003CE4 = (IEnumDebugPrograms2) null;
      return 1;
    }

    public int AA223C657(IDebugEventCallback2 F020AD096) => 1;

    public int B8866D6A2(out IDebugProcess2 F05885A4B)
    {
      F05885A4B = (IDebugProcess2) null;
      return 1;
    }

    public int E23AED7B5() => 1;

    public int EE5533C77(IDebugSettingsCallback110 A1D8A59AA)
    {
      this.E64F1DCE7 = A1D8A59AA;
      return 0;
    }
  }
}
