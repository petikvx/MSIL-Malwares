// Decompiled with JetBrains decompiler
// Type: StaggeringIsometricMap.App
// Assembly: MethodToken, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: C6648534-03E9-4D82-90D8-09C2DA46DB59
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.03-msil\HEUR-Trojan-PSW.MSIL.Heye.gen-a5d15ffadc914b29b1a516c7da174cbb76d12b0a08193f606552f27caea0cd08.exe

using System.IO;
using System.Runtime.CompilerServices;
using System.Web.UI;
using System.Web.UI.WebControls;

namespace StaggeringIsometricMap
{
  [ParseChildren]
  public class App : WebControl
  {
    public App()
    {
      this.Name = "app";
      this.VueLight = false;
      this.RenderTemplate = false;
    }

    public string Name { get; set; }

    public bool VueLight { get; set; }

    public bool RenderTemplate { get; set; }

    public string File { get; set; }

    public string DataJS { get; set; }

    protected override void Render(HtmlTextWriter writer)
    {
      if (string.IsNullOrEmpty(this.File))
      {
        StringWriter writer1 = new StringWriter();
        this.RenderChildren(new HtmlTextWriter((TextWriter) writer1));
        string vueTemplate = this.GetVueTemplate(writer1.ToString().Trim());
        if (this.VueLight)
          this.RenderVueLight(vueTemplate, writer);
        else
          this.RenderVueJS(vueTemplate, "{}", writer);
      }
      else
      {
        modHelpers.ParseVueFileResult vueFile = modHelpers.ParseVueFile(this.File);
        if (this.VueLight)
          this.RenderVueLight(vueFile.Template, writer);
        else
          this.RenderVueJS(vueFile.Template, vueFile.Script, writer);
      }
    }

    private void RenderVueJS(string x, string scrpt, HtmlTextWriter writer)
    {
      string str;
      if (this.RenderTemplate)
      {
        writer.WriteLine("<script type=\"x-template\" id=\"" + this.Name + "_template\">");
        writer.Write(x);
        writer.WriteLine("</script>");
        str = "'#" + this.Name + "_template'";
      }
      else
        str = modHelpers.JSStringEncode(x);
      writer.WriteLine("<div id=\"" + this.Name + "\"></div>");
      writer.WriteLine("<script>");
      writer.WriteLine("var " + this.Name + "=new Vue({\r\n  el: '#" + this.Name + "',\r\n  template: " + str + ",\r\n  data: " + this.DataJS + ",\r\n" + scrpt.Substring(1).Trim() + ");");
      writer.WriteLine("</script>");
    }

    private void RenderVueLight(string x, HtmlTextWriter writer)
    {
      if (this.RenderTemplate)
      {
        writer.WriteLine("<script type=\"x-template\">");
        writer.Write(x);
        writer.WriteLine("</script>");
      }
      CompilerOptions co = new CompilerOptions();
      RuntimeHelpers.GetObjectValue(modHelpers.GetContextComponentList());
      writer.WriteLine("<script>");
      writer.WriteLine("(function() {");
      writer.WriteLine("  var data=" + this.DataJS + ";");
      writer.WriteLine("  var render=" + Compiler.Compile(x, co) + ";");
      writer.WriteLine("  document.write(render(data));");
      writer.WriteLine("})();");
      writer.WriteLine("</script>");
    }

    protected virtual string GetVueTemplate(string content) => content;

    public override void RenderBeginTag(HtmlTextWriter writer)
    {
    }

    public override void RenderEndTag(HtmlTextWriter writer)
    {
    }
  }
}
