// Decompiled with JetBrains decompiler
// Type: s65.ys6
// Assembly: uc5uTlQKZwvBJeUwoIoxWYL1o3uBI8gaMfnT9AO, Version=9.8.6.0, Culture=neutral, PublicKeyToken=null
// MVID: 66B519F9-803D-46C9-8343-EC24850CA08A
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.01-msil\HEUR-Trojan-Banker.MSIL.ClipBanker.gen-de0d24df79f99286da0234aa1536470d7596c53e531173d693d6ccc60b98e84c.exe

using \u00357a;
using \u0036t4;
using KtU;
using l1C;
using M8p;
using ofc;
using OT8;
using Q8f;
using r6A;
using System;
using System.Collections.Generic;
using System.IO;
using System.Runtime.CompilerServices;
using System.Runtime.InteropServices;

namespace s65
{
  internal sealed class ys6 : Stream
  {
    protected internal \u0033t2 wq3;
    protected internal ys6.\u0031j9 F4D = ys6.\u0031j9.\u0023c;
    protected internal F9i A51;
    protected internal \u003172 tt4;
    protected internal \u003212 \u00383Q;
    protected internal PIJ fJ9;
    protected internal bool \u0032yi;
    protected internal byte[] Vpj;
    protected internal int \u00355r = 16384;
    protected internal byte[] w88 = new byte[1];
    protected internal Stream \u0038i4;
    protected internal YNv YAD;
    private ov2 \u0033Zw;
    protected internal string f1G;
    protected internal string o75;
    protected internal DateTime jmG;
    protected internal int \u0036Dp;
    private bool \u0032F5;

    [SpecialName]
    internal int \u0032y3() => this.\u0033Zw == null ? 0 : this.\u0033Zw.\u0033D4;

    public ys6([In] Stream obj0, [In] \u003212 obj1, [In] PIJ obj2, [In] \u003172 obj3, [In] bool obj4)
    {
      this.A51 = F9i.\u0023a;
      this.\u0038i4 = obj0;
      this.\u0032yi = obj4;
      this.\u00383Q = obj1;
      this.tt4 = obj3;
      this.fJ9 = obj2;
      if (obj3 != \u003172.\u0023c)
        return;
      this.\u0033Zw = new ov2();
    }

    [SpecialName]
    protected internal bool xw1() => this.\u00383Q == \u003212.\u0023a;

    [SpecialName]
    private \u0033t2 \u00341U()
    {
      if (this.wq3 == null)
      {
        bool flag = this.tt4 == \u003172.\u0023a;
        this.wq3 = new \u0033t2();
        if (this.\u00383Q == \u003212.\u0023b)
        {
          this.wq3.Hrk(flag);
        }
        else
        {
          this.wq3.m97 = this.YAD;
          this.wq3.\u003873(this.fJ9, flag);
        }
      }
      return this.wq3;
    }

    [SpecialName]
    private byte[] Yg7()
    {
      if (this.Vpj == null)
        this.Vpj = new byte[this.\u00355r];
      return this.Vpj;
    }

    void Stream.Z54([In] byte[] obj0, [In] int obj1, [In] int obj2)
    {
      if (this.\u0033Zw != null)
        this.\u0033Zw.x74(obj0, obj1, obj2);
      if (this.F4D == ys6.\u0031j9.\u0023c)
        this.F4D = ys6.\u0031j9.\u0023a;
      else if (this.F4D != ys6.\u0031j9.\u0023a)
        throw new \u0033g4("Cannot Write after Reading.");
      if (obj2 == 0)
        return;
      this.\u00341U().\u0033Dp = obj0;
      this.wq3.X7k = obj1;
      this.wq3.\u0032Dc = obj2;
      bool flag;
      do
      {
        this.wq3.H2D = this.Yg7();
        this.wq3.\u00338b = 0;
        this.wq3.\u0031G5 = this.Vpj.Length;
        switch (this.xw1() ? this.wq3.\u0039E2(this.A51) : this.wq3.Gb5(this.A51))
        {
          case 0:
          case 1:
            this.\u0038i4.Write(this.Vpj, 0, this.Vpj.Length - this.wq3.\u0031G5);
            flag = this.wq3.\u0032Dc == 0 && this.wq3.\u0031G5 != 0;
            if (this.tt4 == \u003172.\u0023c && !this.xw1())
              flag = this.wq3.\u0032Dc == 8 && this.wq3.\u0031G5 != 0;
            continue;
          default:
            throw new \u0033g4((this.xw1() ? "de" : "in") + "flating: " + this.wq3.\u00335v);
        }
      }
      while (!flag);
    }

    private void j1I()
    {
      if (this.wq3 == null)
        return;
      if (this.F4D == ys6.\u0031j9.\u0023a)
      {
        bool flag;
        do
        {
          this.wq3.H2D = this.Yg7();
          this.wq3.\u00338b = 0;
          this.wq3.\u0031G5 = this.Vpj.Length;
          int num = this.xw1() ? this.wq3.\u0039E2(F9i.\u0023e) : this.wq3.Gb5(F9i.\u0023e);
          switch (num)
          {
            case 0:
            case 1:
              if (this.Vpj.Length - this.wq3.\u0031G5 > 0)
                this.\u0038i4.Write(this.Vpj, 0, this.Vpj.Length - this.wq3.\u0031G5);
              flag = this.wq3.\u0032Dc == 0 && this.wq3.\u0031G5 != 0;
              if (this.tt4 == \u003172.\u0023c && !this.xw1())
                flag = this.wq3.\u0032Dc == 8 && this.wq3.\u0031G5 != 0;
              continue;
            default:
              string str = (this.xw1() ? "de" : "in") + "flating";
              if (this.wq3.\u00335v == null)
                throw new \u0033g4(string.Format("{0}: (rc = {1})", (object) str, (object) num));
              throw new \u0033g4(str + ": " + this.wq3.\u00335v);
          }
        }
        while (!flag);
        ((Stream) this).Flush();
        if (this.tt4 != \u003172.\u0023c)
          return;
        if (!this.xw1())
          throw new \u0033g4("Writing with decompression is not supported.");
        this.\u0038i4.Write(BitConverter.GetBytes(this.\u0033Zw.\u0033D4), 0, 4);
        this.\u0038i4.Write(BitConverter.GetBytes((int) (this.\u0033Zw.Vth & (long) uint.MaxValue)), 0, 4);
      }
      else
      {
        if (this.F4D != ys6.\u0031j9.\u0023b || this.tt4 != \u003172.\u0023c)
          return;
        if (this.xw1())
          throw new \u0033g4("Reading with compression is not supported.");
        if (this.wq3.\u00314Z == 0L)
          return;
        byte[] numArray = new byte[8];
        if (this.wq3.\u0032Dc < 8)
        {
          Array.Copy((Array) this.wq3.\u0033Dp, this.wq3.X7k, (Array) numArray, 0, this.wq3.\u0032Dc);
          int count = 8 - this.wq3.\u0032Dc;
          int num = this.\u0038i4.Read(numArray, this.wq3.\u0032Dc, count);
          if (count != num)
            throw new \u0033g4(string.Format("Missing or incomplete GZIP trailer. Expected 8 bytes, got {0}.", (object) (this.wq3.\u0032Dc + num)));
        }
        else
          Array.Copy((Array) this.wq3.\u0033Dp, this.wq3.X7k, (Array) numArray, 0, numArray.Length);
        int int32_1 = BitConverter.ToInt32(numArray, 0);
        int num1 = this.\u0033Zw.\u0033D4;
        int int32_2 = BitConverter.ToInt32(numArray, 4);
        int num2 = (int) (this.wq3.\u00314Z & (long) uint.MaxValue);
        if (num1 != int32_1)
          throw new \u0033g4(string.Format("Bad CRC32 in GZIP trailer. (actual({0:X8})!=expected({1:X8}))", (object) num1, (object) int32_1));
        if (num2 != int32_2)
          throw new \u0033g4(string.Format("Bad size in GZIP trailer. (actual({0})!=expected({1}))", (object) num2, (object) int32_2));
      }
    }

    private void vU1()
    {
      if (this.\u00341U() == null)
        return;
      if (this.xw1())
        this.wq3.\u003477();
      else
        this.wq3.sba();
      this.wq3 = (\u0033t2) null;
    }

    void Stream.\u0035qQ([In] bool obj0)
    {
      // ISSUE: explicit non-virtual call
      __nonvirtual (((Stream) this).Dispose(obj0));
      if (!obj0)
        return;
      if (this.\u0038i4 == null)
        return;
      try
      {
        this.j1I();
      }
      finally
      {
        this.vU1();
        if (!this.\u0032yi)
          this.\u0038i4.Dispose();
        this.\u0038i4 = (Stream) null;
      }
    }

    void Stream.\u003544() => this.\u0038i4.Flush();

    long Stream.kS2([In] long obj0, [In] SeekOrigin obj1) => throw new NotImplementedException();

    void Stream.\u0039tg([In] long obj0) => this.\u0038i4.SetLength(obj0);

    private string l71()
    {
      List<byte> byteList = new List<byte>();
      bool flag = false;
      while (this.\u0038i4.Read(this.w88, 0, 1) == 1)
      {
        if (this.w88[0] == (byte) 0)
          flag = true;
        else
          byteList.Add(this.w88[0]);
        if (flag)
        {
          byte[] array = byteList.ToArray();
          return \u00326L.\u003246.GetString(array, 0, array.Length);
        }
      }
      throw new \u0033g4("Unexpected EOF reading GZIP header.");
    }

    private int \u0039j2()
    {
      int num1 = 0;
      byte[] buffer1 = new byte[10];
      int num2 = this.\u0038i4.Read(buffer1, 0, buffer1.Length);
      switch (num2)
      {
        case 0:
          return 0;
        case 10:
          int num3 = buffer1[0] == (byte) 31 && buffer1[1] == (byte) 139 && buffer1[2] == (byte) 8 ? BitConverter.ToInt32(buffer1, 4) : throw new \u0033g4("Bad GZIP header.");
          this.jmG = \u00326L.\u0036B9.AddSeconds((double) num3);
          int num4 = num1 + num2;
          if (((int) buffer1[3] & 4) == 4)
          {
            int num5 = this.\u0038i4.Read(buffer1, 0, 2);
            int num6 = num4 + num5;
            short length = (short) ((int) buffer1[0] + (int) buffer1[1] * 256);
            byte[] buffer2 = new byte[(int) length];
            int num7 = this.\u0038i4.Read(buffer2, 0, buffer2.Length);
            if (num7 != (int) length)
              throw new \u0033g4("Unexpected end-of-file reading GZIP header.");
            num4 = num6 + num7;
          }
          if (((int) buffer1[3] & 8) == 8)
            this.f1G = this.l71();
          if (((int) buffer1[3] & 16) == 16)
            this.o75 = this.l71();
          if (((int) buffer1[3] & 2) == 2)
            ((Stream) this).Read(this.w88, 0, 1);
          return num4;
        default:
          throw new \u0033g4("Not a valid GZIP stream.");
      }
    }

    int Stream.\u00353z([In] byte[] obj0, [In] int obj1, [In] int obj2)
    {
      if (this.F4D == ys6.\u0031j9.\u0023c)
      {
        if (!this.\u0038i4.CanRead)
          throw new \u0033g4("The stream is not readable.");
        this.F4D = ys6.\u0031j9.\u0023b;
        this.\u00341U().\u0032Dc = 0;
        if (this.tt4 == \u003172.\u0023c)
        {
          this.\u0036Dp = this.\u0039j2();
          if (this.\u0036Dp == 0)
            return 0;
        }
      }
      if (this.F4D != ys6.\u0031j9.\u0023b)
        throw new \u0033g4("Cannot Read after Writing.");
      if (obj2 == 0 || this.\u0032F5 && this.xw1())
        return 0;
      if (obj0 == null)
        throw new ArgumentNullException("buffer");
      if (obj2 < 0)
        throw new ArgumentOutOfRangeException("count");
      if (obj1 < obj0.GetLowerBound(0))
        throw new ArgumentOutOfRangeException("offset");
      if (obj1 + obj2 > obj0.GetLength(0))
        throw new ArgumentOutOfRangeException("count");
      this.wq3.H2D = obj0;
      this.wq3.\u00338b = obj1;
      this.wq3.\u0031G5 = obj2;
      this.wq3.\u0033Dp = this.Yg7();
      int num1;
      do
      {
        if (this.wq3.\u0032Dc == 0 && !this.\u0032F5)
        {
          this.wq3.X7k = 0;
          this.wq3.\u0032Dc = this.\u0038i4.Read(this.Vpj, 0, this.Vpj.Length);
          if (this.wq3.\u0032Dc == 0)
            this.\u0032F5 = true;
        }
        num1 = this.xw1() ? this.wq3.\u0039E2(this.A51) : this.wq3.Gb5(this.A51);
        if (this.\u0032F5 && num1 == -5)
          return 0;
        if (num1 != 0 && num1 != 1)
          throw new \u0033g4(string.Format("{0}flating:  rc={1}  msg={2}", this.xw1() ? (object) "de" : (object) "in", (object) num1, (object) this.wq3.\u00335v));
      }
      while ((!this.\u0032F5 && num1 != 1 || this.wq3.\u0031G5 != obj2) && this.wq3.\u0031G5 > 0 && !this.\u0032F5 && num1 == 0);
      if (this.wq3.\u0031G5 > 0)
      {
        if (num1 == 0)
        {
          int num2 = this.wq3.\u0032Dc;
        }
        if (this.\u0032F5 && this.xw1())
        {
          int num3 = this.wq3.\u0039E2(F9i.\u0023e);
          switch (num3)
          {
            case 0:
            case 1:
              break;
            default:
              throw new \u0033g4(string.Format("Deflating:  rc={0}  msg={1}", (object) num3, (object) this.wq3.\u00335v));
          }
        }
      }
      int num4 = obj2 - this.wq3.\u0031G5;
      if (this.\u0033Zw != null)
        this.\u0033Zw.x74(obj0, obj1, num4);
      return num4;
    }

    [SpecialName]
    bool Stream.X32() => this.\u0038i4.CanRead;

    [SpecialName]
    bool Stream.xlk() => this.\u0038i4.CanSeek;

    [SpecialName]
    bool Stream.sEZ() => this.\u0038i4.CanWrite;

    [SpecialName]
    long Stream.\u0032a1() => this.\u0038i4.Length;

    [SpecialName]
    long Stream.U85() => throw new NotImplementedException();

    [SpecialName]
    void Stream.\u003357([In] long obj0) => throw new NotImplementedException();

    internal enum \u0031j9
    {
      \u0023a,
      \u0023b,
      \u0023c,
    }
  }
}
