// Decompiled with JetBrains decompiler
// Type: DirectX.Capture.AudioCapabilities
// Assembly: p, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 91D63E37-42E0-404C-97F4-07116ACD2D57
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare-00000-msil\Trojan.MSIL.KillAV.ao-27eafab1bfbe5012a9dd5eb6a22a5e09a25b91a1b79c55ba29e0e7098dcc6f9f.exe

using DShowNET;
using System;
using System.Runtime.InteropServices;

namespace DirectX.Capture
{
  public class AudioCapabilities
  {
    public int MinimumChannels;
    public int MaximumChannels;
    public int ChannelsGranularity;
    public int MinimumSampleSize;
    public int MaximumSampleSize;
    public int SampleSizeGranularity;
    public int MinimumSamplingRate;
    public int MaximumSamplingRate;
    public int SamplingRateGranularity;

    internal AudioCapabilities(IAMStreamConfig audioStreamConfig)
    {
      if (audioStreamConfig == null)
        throw new ArgumentNullException(nameof (audioStreamConfig));
      AMMediaType mediaType = (AMMediaType) null;
      IntPtr num = IntPtr.Zero;
      try
      {
        int piCount;
        int piSize;
        int numberOfCapabilities = audioStreamConfig.GetNumberOfCapabilities(out piCount, out piSize);
        if (numberOfCapabilities != 0)
          Marshal.ThrowExceptionForHR(numberOfCapabilities);
        if (piCount <= 0)
          throw new NotSupportedException("This audio device does not report capabilities.");
        if (piSize > Marshal.SizeOf(typeof (AudioStreamConfigCaps)))
          throw new NotSupportedException("Unable to retrieve audio device capabilities. This audio device requires a larger AudioStreamConfigCaps structure.");
        if (piCount <= 1)
          ;
        num = Marshal.AllocCoTaskMem(Marshal.SizeOf(typeof (AudioStreamConfigCaps)));
        IntPtr pmt;
        int streamCaps = audioStreamConfig.GetStreamCaps(0, out pmt, num);
        if (streamCaps != 0)
          Marshal.ThrowExceptionForHR(streamCaps);
        mediaType = (AMMediaType) Marshal.PtrToStructure(pmt, typeof (AMMediaType));
        AudioStreamConfigCaps structure = (AudioStreamConfigCaps) Marshal.PtrToStructure(num, typeof (AudioStreamConfigCaps));
        this.MinimumChannels = structure.MinimumChannels;
        this.MaximumChannels = structure.MaximumChannels;
        this.ChannelsGranularity = structure.ChannelsGranularity;
        this.MinimumSampleSize = structure.MinimumBitsPerSample;
        this.MaximumSampleSize = structure.MaximumBitsPerSample;
        this.SampleSizeGranularity = structure.BitsPerSampleGranularity;
        this.MinimumSamplingRate = structure.MinimumSampleFrequency;
        this.MaximumSamplingRate = structure.MaximumSampleFrequency;
        this.SamplingRateGranularity = structure.SampleFrequencyGranularity;
      }
      finally
      {
        if (num != IntPtr.Zero)
          Marshal.FreeCoTaskMem(num);
        IntPtr zero = IntPtr.Zero;
        if (mediaType != null)
          DsUtils.FreeAMMediaType(mediaType);
      }
    }
  }
}
