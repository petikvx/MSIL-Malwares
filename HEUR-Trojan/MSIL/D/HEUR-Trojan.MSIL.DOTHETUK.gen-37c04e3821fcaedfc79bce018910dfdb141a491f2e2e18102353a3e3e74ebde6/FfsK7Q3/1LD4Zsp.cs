// Decompiled with JetBrains decompiler
// Type: FfsK7Q3.1LD4Zsp
// Assembly: aO8BSlP, Version=2.0.0.0, Culture=neutral, PublicKeyToken=0a613f4dd989e8ae
// MVID: 26D80EA7-FF8D-466E-8999-D26AD81041E3
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.MSIL.DOTHETUK.gen-37c04e3821fcaedfc79bce018910dfdb141a491f2e2e18102353a3e3e74ebde6.exe

using fgnNuBb;
using System;
using System.Diagnostics;
using System.Diagnostics.CodeAnalysis;
using System.Globalization;
using System.Runtime.InteropServices;
using System.Text;

namespace FfsK7Q3
{
  [ExcludeFromCodeCoverage]
  internal static class \u0031LD4Zsp
  {
    public static void ctKjZ6G(string gBoENU4, string UmkG404, byte[] otNnfkF)
    {
      IntPtr zero = IntPtr.Zero;
      IntPtr OyXZabP = IntPtr.Zero;
      try
      {
        int num1 = fQ4PeKD.snhwc4u(IntPtr.Zero, (uint) gBoENU4.Length, gBoENU4, (uint) UmkG404.Length, UmkG404, out uint _, out OyXZabP, out zero);
        switch (num1)
        {
          case -25300:
          case 0:
            if (zero != IntPtr.Zero)
            {
              int num2 = fQ4PeKD.P42j2gF(zero, IntPtr.Zero, (uint) otNnfkF.Length, otNnfkF);
              if (num2 == 0)
                break;
              throw new Exception(string.Format((IFormatProvider) CultureInfo.CurrentCulture, "SecKeychainItemModifyAttributesAndData failed with error code: {0}", new object[1]
              {
                (object) num2
              }));
            }
            int num3 = fQ4PeKD.yLVaoyA(IntPtr.Zero, (uint) gBoENU4.Length, gBoENU4, (uint) UmkG404.Length, UmkG404, (uint) otNnfkF.Length, otNnfkF, out zero);
            if (num3 == 0)
              break;
            throw new Exception(string.Format((IFormatProvider) CultureInfo.CurrentCulture, "SecKeychainAddGenericPassword failed with error code: {0}", new object[1]
            {
              (object) num3
            }));
          default:
            throw new Exception(string.Format((IFormatProvider) CultureInfo.CurrentCulture, "SecKeychainFindGenericPassword failed with error code: {0}", new object[1]
            {
              (object) num1
            }));
        }
      }
      finally
      {
        \u0031LD4Zsp.\u0039UiDd2k(ref zero, ref OyXZabP);
      }
    }

    public static byte[] \u00327ZmAoe(string a5dWVG4, string _param1, TraceSource kVGWRsY = null)
    {
      IntPtr WXD3ZQv = IntPtr.Zero;
      IntPtr OyXZabP = IntPtr.Zero;
      byte[] destination = (byte[]) null;
      StringBuilder stringBuilder = new StringBuilder();
      TraceEventType eventType = TraceEventType.Information;
      try
      {
        stringBuilder.AppendLine("SecKeychainFindGenericPassword, for serviceName " + a5dWVG4 + " and accountName " + _param1);
        uint m5AYNid;
        int num = fQ4PeKD.snhwc4u(IntPtr.Zero, (uint) a5dWVG4.Length, a5dWVG4, (uint) _param1.Length, _param1, out m5AYNid, out OyXZabP, out WXD3ZQv);
        stringBuilder.AppendLine(string.Format("Status: '{0}'", (object) num));
        switch (num)
        {
          case -25300:
            eventType = TraceEventType.Error;
            stringBuilder.AppendLine("Failed, item not found");
            return (byte[]) null;
          case 0:
            if (WXD3ZQv != IntPtr.Zero)
            {
              stringBuilder.AppendLine("SecKeychainFindGenericPassword succeeded");
              destination = new byte[(int) m5AYNid];
              Marshal.Copy(OyXZabP, destination, 0, destination.Length);
              break;
            }
            break;
          default:
            eventType = TraceEventType.Error;
            stringBuilder.AppendLine(string.Format("Failed, other error {0}", (object) num));
            throw new Exception(string.Format((IFormatProvider) CultureInfo.CurrentCulture, "SecKeychainFindGenericPassword failed with error code: {0}", new object[1]
            {
              (object) num
            }));
        }
      }
      finally
      {
        \u0031LD4Zsp.\u0039UiDd2k(ref WXD3ZQv, ref OyXZabP);
        kVGWRsY?.TraceEvent(eventType, 0, stringBuilder.ToString());
      }
      return destination;
    }

    public static void SSEKK0r(string foE0ydc, string X3Drsxs)
    {
      IntPtr WXD3ZQv = IntPtr.Zero;
      IntPtr OyXZabP = IntPtr.Zero;
      try
      {
        int num1 = fQ4PeKD.snhwc4u(IntPtr.Zero, (uint) foE0ydc.Length, foE0ydc, (uint) X3Drsxs.Length, X3Drsxs, out uint _, out OyXZabP, out WXD3ZQv);
        switch (num1)
        {
          case -25300:
            break;
          case 0:
            if (WXD3ZQv == IntPtr.Zero)
              break;
            int num2 = fQ4PeKD.nj00WnB(WXD3ZQv);
            if (num2 == 0)
              break;
            throw new Exception(string.Format((IFormatProvider) CultureInfo.CurrentCulture, "SecKeychainItemDelete failed with error code: {0}", new object[1]
            {
              (object) num2
            }));
          default:
            throw new Exception(string.Format((IFormatProvider) CultureInfo.CurrentCulture, "SecKeychainFindGenericPassword failed with error code: {0}", new object[1]
            {
              (object) num1
            }));
        }
      }
      finally
      {
        \u0031LD4Zsp.\u0039UiDd2k(ref WXD3ZQv, ref OyXZabP);
      }
    }

    private static void \u0039UiDd2k(ref IntPtr atc8luw, ref IntPtr _param1)
    {
      \u0031LD4Zsp.WX7xYsK(ref atc8luw);
      \u0031LD4Zsp.C4AM0qw(ref _param1);
    }

    private static void WX7xYsK(ref IntPtr goRyloc)
    {
      if (!(goRyloc != IntPtr.Zero))
        return;
      fQ4PeKD.\u0039dlU4a0(goRyloc);
      goRyloc = IntPtr.Zero;
    }

    private static void C4AM0qw(ref IntPtr O6diPRg)
    {
      if (!(O6diPRg != IntPtr.Zero))
        return;
      fQ4PeKD.cxRDoMo(IntPtr.Zero, O6diPRg);
      O6diPRg = IntPtr.Zero;
    }
  }
}
