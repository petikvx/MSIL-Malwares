// Decompiled with JetBrains decompiler
// Type: s740588166303995.s754392368222187
// Assembly: s802785987160928, Version=1.0.0.0, Culture=neutral, PublicKeyToken=8d3bb6c79cff225a
// MVID: E562BAAF-678F-45B2-A19A-CFBF160B1BAF
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.04\Trojan.Win64.Injects.byr-71d4abb6ea36ebfca83e1b236cadfd303a41fe6d642637197c630ec1263b20db.exe

using s254766793960553;
using s289738315859184;
using s383511562416887;
using s519416601138884;
using s623716140838033;
using s802785987160928.Properties;
using s989081887701976;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.CompilerServices;
using System.Threading;

namespace s740588166303995
{
  internal class s754392368222187
  {
    private ThreadLocal<Stack<s754392368222187.s904212673197288>> s971829430375063;
    private ThreadLocal<uint> s289242886464250;
    private s315374306116696 s602299264151643;
    private object s598361525497718 = new object();
    private s754392368222187.s844881987130160 s314996707427961 = new s754392368222187.s844881987130160();
    private IRecordAsyncOperations s598993307902311;

    public int s876989202204161
    {
      get
      {
        lock (this.s598361525497718)
          return ((s904867446435478) this.s314996707427961).get_WatchedOperationCount();
      }
    }

    public int s757606825010012
    {
      get
      {
        lock (this.s598361525497718)
          return this.s314996707427961.s703130276088928;
      }
    }

    public int s000438250891468 { get; internal set; }

    public s754392368222187(IRecordAsyncOperations asyncOperations)
    {
      try
      {
        Type.GetType("System.Threading.Tasks.TplEventSource", true).GetField("Log").GetValue((object) null);
      }
      catch (Exception ex)
      {
        try
        {
          Type.GetType("System.Threading.Tasks.TplEtwProvider", true).GetField("Log").GetValue((object) null);
        }
        catch
        {
          s095683830799280.s567800687732192.s807263002219417(ex);
        }
      }
      this.s598993307902311 = asyncOperations;
      this.s971829430375063 = new ThreadLocal<Stack<s754392368222187.s904212673197288>>((Func<Stack<s754392368222187.s904212673197288>>) (() => new Stack<s754392368222187.s904212673197288>()));
      this.s289242886464250 = new ThreadLocal<uint>((Func<uint>) (() => 0U));
    }

    public void s532715851767464(uint s339105908940668)
    {
      this.s289242886464250.Value = s339105908940668;
      lock (this.s598361525497718)
      {
        if (this.s602299264151643 != null)
          return;
        this.s602299264151643 = new s315374306116696(this);
      }
    }

    public void s153396788378840(uint s861948681790522) => this.s289242886464250.Value = s861948681790522;

    public void s963664529984509() => this.s289242886464250.Value = 0U;

    public void s282011253326319(uint s056759849245520)
    {
      this.s289242886464250.Value = 0U;
      lock (this.s598361525497718)
      {
        this.s314996707427961.s769406894177639(s056759849245520);
        if (this.s602299264151643 == null || this.s314996707427961.s762885518114591())
          return;
        this.s602299264151643.Dispose();
        this.s602299264151643 = (s315374306116696) null;
        if (!this.s314996707427961.s141346991160293())
          return;
        s095683830799280.s567800687732192.s276372455039464("s754392368222187: activities completed with uncollected waits.");
      }
    }

    public void s874320315880403(int s399159158718015, string s125574508233555)
    {
      ulong num = s754392368222187.s741739731100457(s399159158718015);
      lock (this.s598361525497718)
      {
        if (!this.s314996707427961.s438429616604449(num, this.s289242886464250.Value))
          return;
        this.s598993307902311.OnAsyncOperationStarted(num);
      }
    }

    public void s244185998830406(int s319322957663467, s319245434172577 s189124709813564)
    {
      lock (this.s598361525497718)
      {
        ulong num = s754392368222187.s741739731100457(s319322957663467);
        if (!this.s314996707427961.s502812751726745(num))
          return;
        this.s598993307902311.OnAsyncOperationCompleted(num, s189124709813564);
      }
    }

    public void s555459194222291(int s571663932070782, s982990207780619 s286039700660124)
    {
      Stack<s754392368222187.s904212673197288> s904212673197288Stack = this.s971829430375063.Value;
      s754392368222187.s844881987130160 s844881987130160 = new s754392368222187.s844881987130160();
      s844881987130160.s265504268475282 = s571663932070782;
      ((s754392368222187.s904212673197288) s844881987130160).s218246829832893 = false;
      s904212673197288Stack.Push((s754392368222187.s904212673197288) s844881987130160);
      lock (this.s598361525497718)
      {
        ulong num = s754392368222187.s741739731100457(s571663932070782);
        if (!this.s314996707427961.s502812751726745(num))
          return;
        this.s314996707427961.s908076813433491(num);
        this.s598993307902311.OnSyncOperationStarted(num, s286039700660124);
      }
    }

    public void s237011330167599(s982990207780619 s296074352608789)
    {
      if (!this.s971829430375063.Value.Any<s754392368222187.s904212673197288>())
        return;
      s754392368222187.s904212673197288 s904212673197288 = this.s971829430375063.Value.Pop();
      lock (this.s598361525497718)
      {
        ulong num = s754392368222187.s741739731100457(((s754392368222187.s844881987130160) s904212673197288).s265504268475282);
        if (!this.s314996707427961.s502812751726745(num))
          return;
        this.s598993307902311.OnSyncOperationCompleted(num, s296074352608789);
        if (s296074352608789 == s982990207780619.CompletionNotification)
        {
          if (this.s971829430375063.Value.Any<s754392368222187.s904212673197288>() && ((s754392368222187.s844881987130160) this.s971829430375063.Value.Peek()).s265504268475282 == ((s754392368222187.s844881987130160) s904212673197288).s265504268475282)
            this.s971829430375063.Value.Peek().s218246829832893 = true;
          else
            this.s314996707427961.s086719585935602(num);
        }
        else
        {
          if (!s904212673197288.s218246829832893)
            return;
          this.s314996707427961.s086719585935602(num);
        }
      }
    }

    public void s645255481984904(int s126091815368916, int s979689238770070, int s916818978267320)
    {
      if (this.s289242886464250.Value == 0U)
        return;
      lock (this.s598361525497718)
      {
        ulong num1 = s754392368222187.s741739731100457(s126091815368916);
        ulong num2 = s754392368222187.s741739731100457(s916818978267320);
        if (this.s314996707427961.s669426653434421(num1, num2))
          this.s598993307902311.OnAsyncWaitStarted(num1, num2);
        else
          s095683830799280.s567800687732192.s276372455039464("s754392368222187: got wait start for operation that has not been created yet? waiting for: {0}, {1}", (object) s126091815368916, (object) s916818978267320);
      }
    }

    public void s644907923496502(int s993877371704115, int s268905527062773)
    {
      lock (this.s598361525497718)
      {
        ulong num = s754392368222187.s741739731100457(s268905527062773);
        if (!this.s314996707427961.s763083593456781(num))
          return;
        this.s598993307902311.OnAsyncWaitCompleted(num);
      }
    }

    private static ulong s741739731100457(int s177253183644133) => (ulong) AppDomain.CurrentDomain.Id << 32 | (ulong) (uint) s177253183644133;

    internal class s844881987130160
    {
      protected Dictionary<ulong, ulong> _waitingOps;
      public int s265504268475282;

      public int s232458279766648
      {
        [SpecialName] get => ((s867198326535392) this)._watchedOps.Count;
      }

      public int s703130276088928 => this._waitingOps.Count;

      public bool s502812751726745(ulong s564639924068662) => ((s867198326535392) this)._watchedOps.ContainsKey(s564639924068662);

      public bool s763083593456781(ulong s925213671188800) => this._waitingOps.ContainsValue(s925213671188800);

      public bool s438429616604449(ulong s537692537853922, uint s498619053513260)
      {
        if (s498619053513260 == 0U)
          return this.s502812751726745(s537692537853922);
        // ISSUE: reference to a compiler-generated field
        ((s867198326535392) this)._watchedOps[s537692537853922] = s498619053513260;
        return true;
      }

      public bool s669426653434421(ulong s629382348204058, ulong s871593209100865)
      {
        uint num;
        // ISSUE: reference to a compiler-generated field
        if (((s867198326535392) this)._watchedOps.TryGetValue(s629382348204058, out num))
        {
          // ISSUE: reference to a compiler-generated field
          ((s867198326535392) this)._watchedOps[s871593209100865] = num;
        }
        this._waitingOps[s871593209100865] = s629382348204058;
        // ISSUE: reference to a compiler-generated field
        return ((s867198326535392) this)._watchedOps.ContainsKey(s871593209100865);
      }

      public bool s908076813433491(ulong s147194795844175) => this._waitingOps.Remove(s147194795844175);

      public void s769406894177639(uint s694400146547692)
      {
        // ISSUE: variable of a compiler-generated type
        s754392368222187.s844881987130160.s222292740250234 s222292740250234 = (s754392368222187.s844881987130160.s222292740250234) new s669558231026334.s440091986190945();
        ((s315374306116696.s217912927157560) s222292740250234).s685220203556005 = s694400146547692;
        // ISSUE: reference to a compiler-generated field
        // ISSUE: reference to a compiler-generated method
        foreach (ulong key in ((s867198326535392) this)._watchedOps.Where<KeyValuePair<ulong, uint>>(new Func<KeyValuePair<ulong, uint>, bool>(s222292740250234.s459449596889137)).Select<KeyValuePair<ulong, uint>, ulong>((Func<KeyValuePair<ulong, uint>, ulong>) (s213771494479734 => s213771494479734.Key)).Distinct<ulong>().ToList<ulong>())
        {
          // ISSUE: reference to a compiler-generated field
          ((s867198326535392) this)._watchedOps.Remove(key);
          this._waitingOps.Remove(key);
        }
      }

      public bool s762885518114591() => ((s867198326535392) this)._watchedOps.Any<KeyValuePair<ulong, uint>>();

      internal void s086719585935602(ulong s052469642457131) => ((s867198326535392) this)._watchedOps.Remove(s052469642457131);

      internal bool s141346991160293()
      {
        if (!this._waitingOps.Any<KeyValuePair<ulong, ulong>>())
          return false;
        this._waitingOps.Clear();
        return true;
      }

      public s844881987130160()
      {
        // ISSUE: reference to a compiler-generated field
        ((s867198326535392) this)._watchedOps = new Dictionary<ulong, uint>();
        this._waitingOps = new Dictionary<ulong, ulong>();
        // ISSUE: explicit constructor call
        base.\u002Ector();
      }

      public s844881987130160()
      {
      }
    }

    internal class s904212673197288
    {
      public bool s218246829832893;
      public static readonly s754392368222187.s933520665798903 s442379416083576 = new s754392368222187.s933520665798903();
    }
  }
}
