// Decompiled with JetBrains decompiler
// Type: xClient.Core.NAudio.Wave.WaveStreams.WaveOutBuffer
// Assembly: $77-Venom, Version=2.1.0.0, Culture=neutral, PublicKeyToken=null
// MVID: DC8E8704-647D-4CA7-99AB-BB7BE936B486
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.02-msil\HEUR-Trojan.MSIL.Zapchast.gen-2e1eda10e2bbd19418706a23888807e50c0407eb191cc26d541c85279193c3db.exe

using System;
using System.Runtime.InteropServices;

namespace xClient.Core.NAudio.Wave.WaveStreams
{
  internal class WaveOutBuffer : IDisposable
  {
    private readonly ﯗ䴺釉왋詃ฬ녹㕪璢ꛤ㼤వ饤儱\uEF79狺\u0880乚找隸 header;
    private readonly int bufferSize;
    private readonly byte[] buffer;
    private readonly ᒅ憁ܳ䥿䣘ꅤ\u288C裬\uF406턉\u2752쉢煫\uF31F\u2B91杔蕨蹯鈭쭫 waveStream;
    private readonly object waveOutLock;
    private GCHandle hBuffer;
    private IntPtr hWaveOut;
    private GCHandle hHeader;
    private GCHandle hThis;

    public WaveOutBuffer(
      IntPtr hWaveOut,
      int bufferSize,
      ᒅ憁ܳ䥿䣘ꅤ\u288C裬\uF406턉\u2752쉢煫\uF31F\u2B91杔蕨蹯鈭쭫 bufferFillStream,
      object waveOutLock)
    {
      this.bufferSize = bufferSize;
      this.buffer = new byte[bufferSize];
      this.hBuffer = GCHandle.Alloc((object) this.buffer, GCHandleType.Pinned);
      this.hWaveOut = hWaveOut;
      this.waveStream = bufferFillStream;
      this.waveOutLock = waveOutLock;
      this.header = new ﯗ䴺釉왋詃ฬ녹㕪璢ꛤ㼤వ饤儱\uEF79狺\u0880乚找隸();
      this.hHeader = GCHandle.Alloc((object) this.header, GCHandleType.Pinned);
      this.header.\uEE9E\u24E9墳Ᏼꇱ弛㓐剬렟寀狀훤詥삝犅靹㨵巉鏢ᘭ = this.hBuffer.AddrOfPinnedObject();
      this.header.埽ᑸハ嬫盍寔\uFFFD嘅붘\u247B㖣孠윆삦怡钴꣯蒬ﮀ鑼 = bufferSize;
      this.header.\uFFFD奏㪅貪\uFFFD뤚봧ːꉔ楅污箜랮뢇ἢ랼푒眨玺瀿 = 1;
      this.hThis = GCHandle.Alloc((object) this);
      this.header.氮䄹癕駩垹쁨\u2B39끦꿡͚\u2876\uA7BD᧓隔ꨩ鵥\uFFFD䍀呞皔 = (IntPtr) this.hThis;
      lock (waveOutLock)
        텆䙫簻冣캶\uFFFDꪃ뗫\u28E0\uFFFD㪠\uF818궤㤿淳寎\uE6B2䁻㡅톈.蹠鬽삕闦ڋଫ퐜螰梬갻\u27EF逇쭗ద먪䐧굚ᢧῇ衜(珸\u25E1단ᑊ눵ꫤ\u1AC3ꥩ\uE659珟㳓坍鎸羅㺝ܩ\u173C\u2891\u2E15힘.ȅ\uFFFD妱\uE24A炿켈蟰\u329F\u3255暤湸롁\u2919䍱宠\uF285ሟ\u2E59䟊뻼(hWaveOut, this.header, Marshal.SizeOf((object) this.header)), "waveOutPrepareHeader");
    }

    ~WaveOutBuffer() => this.Dispose(false);

    public void Dispose()
    {
      GC.SuppressFinalize((object) this);
      this.Dispose(true);
    }

    protected void Dispose(bool disposing)
    {
      int num1 = disposing ? 1 : 0;
      if (this.hHeader.IsAllocated)
        this.hHeader.Free();
      if (this.hBuffer.IsAllocated)
        this.hBuffer.Free();
      if (this.hThis.IsAllocated)
        this.hThis.Free();
      if (!(this.hWaveOut != IntPtr.Zero))
        return;
      lock (this.waveOutLock)
      {
        int num2 = (int) 珸\u25E1단ᑊ눵ꫤ\u1AC3ꥩ\uE659珟㳓坍鎸羅㺝ܩ\u173C\u2891\u2E15힘.议㷭炏欫뤥꽖욣꽠푊စ韉耬㧃\uEE69䁃횆ᾍ\u21DD泡톃(this.hWaveOut, this.header, Marshal.SizeOf((object) this.header));
      }
      this.hWaveOut = IntPtr.Zero;
    }

    internal bool OnDone()
    {
      int num;
      lock (this.waveStream)
        num = this.waveStream.Read(this.buffer, 0, this.buffer.Length);
      if (num == 0)
        return false;
      for (int index = num; index < this.buffer.Length; ++index)
        this.buffer[index] = (byte) 0;
      this.WriteToWaveOut();
      return true;
    }

    public bool InQueue => (this.header.\u1F5C倸\uE875\uEE64\uE328虫놥ᬳ썃\uF185挺춉ž埫뻸䚆\uA63Cꖆ\uF51C䄴 & 춵\uE298\uFFFD\uF128ᤲ䡵\u276C㟡ƣ탉\uFFFDᰒ燀魤돷묆褖斝驩돝.䂌䐠餜쁫礚㡫\uFFFD謥졗뢴\uF2BA奞\uEAB4氈ㅋ\uEE5C塮\u0E75镍ᆢ) == 춵\uE298\uFFFD\uF128ᤲ䡵\u276C㟡ƣ탉\uFFFDᰒ燀魤돷묆褖斝驩돝.䂌䐠餜쁫礚㡫\uFFFD謥졗뢴\uF2BA奞\uEAB4氈ㅋ\uEE5C塮\u0E75镍ᆢ;

    public int BufferSize => this.bufferSize;

    private void WriteToWaveOut()
    {
      濱Ɋ\uF57E穾ꎮᛩ烨᮹旝蚯䂤宫歝퇘勑텸痤펵岛\u4DE9 result;
      lock (this.waveOutLock)
        result = 珸\u25E1단ᑊ눵ꫤ\u1AC3ꥩ\uE659珟㳓坍鎸羅㺝ܩ\u173C\u2891\u2E15힘.뾬痫糠\uE63E\uF8D5ྵ컊\uFFFD軫\u0CE4㮼펭\uEEA0樰ᝍ룺簮핾續\u2F6F(this.hWaveOut, this.header, Marshal.SizeOf((object) this.header));
      if (result != 濱Ɋ\uF57E穾ꎮᛩ烨᮹旝蚯䂤宫歝퇘勑텸痤펵岛\u4DE9.\uEE95顠Ǘ亹\uEF0C㠵梑䍃빼\uE62E鏯ꪍ眱ﵘ\u242E\uE02B䘽ꌌ\u24D5靊)
        throw new 텆䙫簻冣캶\uFFFDꪃ뗫\u28E0\uFFFD㪠\uF818궤㤿淳寎\uE6B2䁻㡅톈(result, "waveOutWrite");
      GC.KeepAlive((object) this);
    }
  }
}
