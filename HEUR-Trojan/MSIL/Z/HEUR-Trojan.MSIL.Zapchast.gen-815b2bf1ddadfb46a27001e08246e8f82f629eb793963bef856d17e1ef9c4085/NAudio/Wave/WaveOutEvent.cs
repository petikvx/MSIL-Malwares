// Decompiled with JetBrains decompiler
// Type: NAudio.Wave.WaveOutEvent
// Assembly: $77-Venom, Version=2.1.0.0, Culture=neutral, PublicKeyToken=null
// MVID: DC8E8704-647D-4CA7-99AB-BB7BE936B486
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.MSIL.Zapchast.gen-815b2bf1ddadfb46a27001e08246e8f82f629eb793963bef856d17e1ef9c4085.exe

using System;
using System.Runtime.InteropServices;
using System.Threading;
using xClient.Core.NAudio.Wave.WaveOutputs;
using xClient.Core.NAudio.Wave.WaveStreams;

namespace NAudio.Wave
{
  public class WaveOutEvent : IWavePlayer, IDisposable, 헥큋Ḭꔻ콂撜鲔鱋\u219E䝷훗\uF1FA綘ዷ変ｯ必閊\u128F뱅
  {
    private readonly object waveOutLock;
    private readonly SynchronizationContext syncContext;
    private IntPtr hWaveOut;
    private WaveOutBuffer[] buffers;
    private 벙灘ꩌ\uFFFDິњ晘\uF867ાⴏ䑛멀뀝譝愡埩\u2225똀覉겝 waveStream;
    private volatile 啌\uE57C뵛喪阵喬䵮巢躙\uEAD6娞迨\u243A\u2799䫺\uFFFD锕켉勳獌 playbackState;
    private AutoResetEvent callbackEvent;
    private float volume = 1f;

    public event EventHandler<눡쩷띉ን臉萑ㄢ崌ⰶ\u2349㣥盠樭윩䥟姩ᰥ拿㩆㹑> PlaybackStopped;

    public int DesiredLatency { get; set; }

    public int NumberOfBuffers { get; set; }

    public int DeviceNumber { get; set; }

    public WaveOutEvent()
    {
      this.syncContext = SynchronizationContext.Current;
      if (this.syncContext != null && (this.syncContext.GetType().Name == "LegacyAspNetSynchronizationContext" || this.syncContext.GetType().Name == "AspNetSynchronizationContext"))
        this.syncContext = (SynchronizationContext) null;
      this.DeviceNumber = 0;
      this.DesiredLatency = 300;
      this.NumberOfBuffers = 2;
      this.waveOutLock = new object();
    }

    public void Init(벙灘ꩌ\uFFFDິњ晘\uF867ાⴏ䑛멀뀝譝愡埩\u2225똀覉겝 waveProvider)
    {
      if (this.playbackState != 啌\uE57C뵛喪阵喬䵮巢躙\uEAD6娞迨\u243A\u2799䫺\uFFFD锕켉勳獌.\uFFFD핍濩\u3383푦碘\u2F1Bꏀ䆸꣠䯤咴悂鯥\uE046Ὂ콝馑韷荒)
        throw new InvalidOperationException("Can't re-initialize during playback");
      if (this.hWaveOut != IntPtr.Zero)
      {
        this.DisposeBuffers();
        this.CloseWaveOut();
      }
      this.callbackEvent = new AutoResetEvent(false);
      this.waveStream = waveProvider;
      int bufferSize = waveProvider.WaveFormat.ӧ卲䚝䂉\uF324뛑ꆹ㝕䕎랮\uF43D㦷\uE8C9㞧ᗙ䔞\uF74E행乮ﻥ((this.DesiredLatency + this.NumberOfBuffers - 1) / this.NumberOfBuffers);
      뭗옢嬿눱옙匭\uF6FE퓭쟛㓚솧匋䑘狸潍緓큂穄톜\u291E result;
      lock (this.waveOutLock)
        result = \uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.\uE0A2뵾쵒\u2961垯趔ሖ퓷濦\u33F2㬷ﵨ큾\uF35B︍颦橜㗠ܣ猞(out this.hWaveOut, (IntPtr) this.DeviceNumber, this.waveStream.WaveFormat, this.callbackEvent.SafeWaitHandle.DangerousGetHandle(), IntPtr.Zero, \uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.\uF8CE\u33B0햜풬닡䣏꽺ꕷ챳浛\uEC8F뼫畬欎Ңܷ醞倗䃵섭.ᅘ中엲쎯쏂勼\u09D1ϖ\uFFFD覶댢皇\uFFFD\u2FB9ບ牳궲깟అ颚);
      㵼眢謟ᱥ︦\u2B28؄秀ᶙᨱ벁蕿\uF60C校쌎흭ä䌾嶆\uE399.定뙟乗廓囿ꮆ\uEE08\u2A64윪웧晪鯫\u2AE1堢蝹\u258C\u0D56뱴ꗂ뺽(result, "waveOutOpen");
      this.buffers = new WaveOutBuffer[this.NumberOfBuffers];
      this.playbackState = 啌\uE57C뵛喪阵喬䵮巢躙\uEAD6娞迨\u243A\u2799䫺\uFFFD锕켉勳獌.\uFFFD핍濩\u3383푦碘\u2F1Bꏀ䆸꣠䯤咴悂鯥\uE046Ὂ콝馑韷荒;
      for (int index = 0; index < this.NumberOfBuffers; ++index)
        this.buffers[index] = new WaveOutBuffer(this.hWaveOut, bufferSize, this.waveStream, this.waveOutLock);
    }

    public void Play()
    {
      if (this.buffers == null || this.waveStream == null)
        throw new InvalidOperationException("Must call Init first");
      if (this.playbackState == 啌\uE57C뵛喪阵喬䵮巢躙\uEAD6娞迨\u243A\u2799䫺\uFFFD锕켉勳獌.\uFFFD핍濩\u3383푦碘\u2F1Bꏀ䆸꣠䯤咴悂鯥\uE046Ὂ콝馑韷荒)
      {
        this.playbackState = 啌\uE57C뵛喪阵喬䵮巢躙\uEAD6娞迨\u243A\u2799䫺\uFFFD锕켉勳獌.\uA4A1ꤢ딙逘ࠨㅗᥱ\uF36C㿗瑏똟륑ⰲ行唴밬\uE540\uF11D\uE3E2\uE950;
        this.callbackEvent.Set();
        ThreadPool.QueueUserWorkItem((WaitCallback) (state => this.PlaybackThread()), (object) null);
      }
      else
      {
        if (this.playbackState != 啌\uE57C뵛喪阵喬䵮巢躙\uEAD6娞迨\u243A\u2799䫺\uFFFD锕켉勳獌.\uE9AF糙鳕豫\u2AA1쇫譌２컰隓琂\u2572䫚춹敭\uE4DE川㐁涐稰)
          return;
        this.Resume();
        this.callbackEvent.Set();
      }
    }

    private void PlaybackThread()
    {
      Exception e = (Exception) null;
      try
      {
        this.DoPlayback();
      }
      catch (Exception ex)
      {
        e = ex;
      }
      finally
      {
        this.playbackState = 啌\uE57C뵛喪阵喬䵮巢躙\uEAD6娞迨\u243A\u2799䫺\uFFFD锕켉勳獌.\uFFFD핍濩\u3383푦碘\u2F1Bꏀ䆸꣠䯤咴悂鯥\uE046Ὂ콝馑韷荒;
        this.RaisePlaybackStoppedEvent(e);
      }
    }

    private void DoPlayback()
    {
      while (this.playbackState != 啌\uE57C뵛喪阵喬䵮巢躙\uEAD6娞迨\u243A\u2799䫺\uFFFD锕켉勳獌.\uFFFD핍濩\u3383푦碘\u2F1Bꏀ䆸꣠䯤咴悂鯥\uE046Ὂ콝馑韷荒)
      {
        if (!this.callbackEvent.WaitOne(this.DesiredLatency))
        {
          int playbackState = (int) this.playbackState;
        }
        if (this.playbackState == 啌\uE57C뵛喪阵喬䵮巢躙\uEAD6娞迨\u243A\u2799䫺\uFFFD锕켉勳獌.\uA4A1ꤢ딙逘ࠨㅗᥱ\uF36C㿗瑏똟륑ⰲ行唴밬\uE540\uF11D\uE3E2\uE950)
        {
          int num = 0;
          foreach (WaveOutBuffer buffer in this.buffers)
          {
            if (buffer.InQueue || buffer.OnDone())
              ++num;
          }
          if (num == 0)
          {
            this.playbackState = 啌\uE57C뵛喪阵喬䵮巢躙\uEAD6娞迨\u243A\u2799䫺\uFFFD锕켉勳獌.\uFFFD핍濩\u3383푦碘\u2F1Bꏀ䆸꣠䯤咴悂鯥\uE046Ὂ콝馑韷荒;
            this.callbackEvent.Set();
          }
        }
      }
    }

    public void Pause()
    {
      if (this.playbackState != 啌\uE57C뵛喪阵喬䵮巢躙\uEAD6娞迨\u243A\u2799䫺\uFFFD锕켉勳獌.\uA4A1ꤢ딙逘ࠨㅗᥱ\uF36C㿗瑏똟륑ⰲ行唴밬\uE540\uF11D\uE3E2\uE950)
        return;
      this.playbackState = 啌\uE57C뵛喪阵喬䵮巢躙\uEAD6娞迨\u243A\u2799䫺\uFFFD锕켉勳獌.\uE9AF糙鳕豫\u2AA1쇫譌２컰隓琂\u2572䫚춹敭\uE4DE川㐁涐稰;
      뭗옢嬿눱옙匭\uF6FE퓭쟛㓚솧匋䑘狸潍緓큂穄톜\u291E result;
      lock (this.waveOutLock)
        result = \uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.㩾䐔粸钝㱆䳋फ़觝涁\uE6B2\uFFFD\uF6EC\uE2EF\uF509塁ᦰ첏튂鍾\u197D(this.hWaveOut);
      if (result != 뭗옢嬿눱옙匭\uF6FE퓭쟛㓚솧匋䑘狸潍緓큂穄톜\u291E.켖재\u203Eᥑ蹁\uA60E뾜䰊\uFFFDᵬﱧ趤嵛焞컯\uFFFD䐮眭쑨主)
        throw new 㵼眢謟ᱥ︦\u2B28؄秀ᶙᨱ벁蕿\uF60C校쌎흭ä䌾嶆\uE399(result, "waveOutPause");
    }

    private void Resume()
    {
      if (this.playbackState != 啌\uE57C뵛喪阵喬䵮巢躙\uEAD6娞迨\u243A\u2799䫺\uFFFD锕켉勳獌.\uE9AF糙鳕豫\u2AA1쇫譌２컰隓琂\u2572䫚춹敭\uE4DE川㐁涐稰)
        return;
      뭗옢嬿눱옙匭\uF6FE퓭쟛㓚솧匋䑘狸潍緓큂穄톜\u291E result;
      lock (this.waveOutLock)
        result = \uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.枛ᰆՈ聾\u21CD鞝ᴮ밒皃䠔\u3367웎쫔빣띔\uFFFD\uECB8攼부Ῐ(this.hWaveOut);
      if (result != 뭗옢嬿눱옙匭\uF6FE퓭쟛㓚솧匋䑘狸潍緓큂穄톜\u291E.켖재\u203Eᥑ蹁\uA60E뾜䰊\uFFFDᵬﱧ趤嵛焞컯\uFFFD䐮眭쑨主)
        throw new 㵼眢謟ᱥ︦\u2B28؄秀ᶙᨱ벁蕿\uF60C校쌎흭ä䌾嶆\uE399(result, "waveOutRestart");
      this.playbackState = 啌\uE57C뵛喪阵喬䵮巢躙\uEAD6娞迨\u243A\u2799䫺\uFFFD锕켉勳獌.\uA4A1ꤢ딙逘ࠨㅗᥱ\uF36C㿗瑏똟륑ⰲ行唴밬\uE540\uF11D\uE3E2\uE950;
    }

    public void Stop()
    {
      if (this.playbackState == 啌\uE57C뵛喪阵喬䵮巢躙\uEAD6娞迨\u243A\u2799䫺\uFFFD锕켉勳獌.\uFFFD핍濩\u3383푦碘\u2F1Bꏀ䆸꣠䯤咴悂鯥\uE046Ὂ콝馑韷荒)
        return;
      this.playbackState = 啌\uE57C뵛喪阵喬䵮巢躙\uEAD6娞迨\u243A\u2799䫺\uFFFD锕켉勳獌.\uFFFD핍濩\u3383푦碘\u2F1Bꏀ䆸꣠䯤咴悂鯥\uE046Ὂ콝馑韷荒;
      뭗옢嬿눱옙匭\uF6FE퓭쟛㓚솧匋䑘狸潍緓큂穄톜\u291E result;
      lock (this.waveOutLock)
        result = \uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.脭奫躂蔱\u2B5C蹆진ጇ쨃㡟\uFFFD肿땵㖹笀棯ᑴ験ﺷぺ(this.hWaveOut);
      if (result != 뭗옢嬿눱옙匭\uF6FE퓭쟛㓚솧匋䑘狸潍緓큂穄톜\u291E.켖재\u203Eᥑ蹁\uA60E뾜䰊\uFFFDᵬﱧ趤嵛焞컯\uFFFD䐮眭쑨主)
        throw new 㵼眢謟ᱥ︦\u2B28؄秀ᶙᨱ벁蕿\uF60C校쌎흭ä䌾嶆\uE399(result, "waveOutReset");
      this.callbackEvent.Set();
    }

    public long GetPosition()
    {
      lock (this.waveOutLock)
      {
        ꦤⶃ鎞餲鮽홨\uA7F1ḑ\u2738\uF2B1읭놝櫠趢᪔\u1BF8\u2672잎吒郚 mmTime = new ꦤⶃ鎞餲鮽홨\uA7F1ḑ\u2738\uF2B1읭놝櫠趢᪔\u1BF8\u2672잎吒郚();
        mmTime.ﳚ諝Ջ痊㠇鶓\uF332\uA60E䔫ïိ쳸滑쪇\uEF0Bᘮ浙櫁㵋\uEFB9 = 4U;
        㵼眢謟ᱥ︦\u2B28؄秀ᶙᨱ벁蕿\uF60C校쌎흭ä䌾嶆\uE399.定뙟乗廓囿ꮆ\uEE08\u2A64윪웧晪鯫\u2AE1堢蝹\u258C\u0D56뱴ꗂ뺽(\uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.\u09DA숆ꍮ\u009D哅ព阥ᆓ\u23EF쪪\u0BF9왁唏䪨啬\u24B4忒쟔檓汵(this.hWaveOut, out mmTime, Marshal.SizeOf((object) mmTime)), "waveOutGetPosition");
        return mmTime.ﳚ諝Ջ痊㠇鶓\uF332\uA60E䔫ïိ쳸滑쪇\uEF0Bᘮ浙櫁㵋\uEFB9 == 4U ? (long) mmTime.鍮Ⅱ씼迨磻恂ꓙՄ㛡ᴠ㕚읪ᬼᦏ娋뿧웕\uFFFD쇁菚 : throw new Exception(string.Format("waveOutGetPosition: wType -> Expected {0}, Received {1}", (object) 4, (object) mmTime.ﳚ諝Ջ痊㠇鶓\uF332\uA60E䔫ïိ쳸滑쪇\uEF0Bᘮ浙櫁㵋\uEFB9));
      }
    }

    public \uF610\uF0D5\uE068䑡쎣أ蕩\u292F\uEC8E\u2EC8\uF4AA\uE1BD퍳ܖ苸\uA630岐꿦ۍ遹 OutputWaveFormat => this.waveStream.WaveFormat;

    public 啌\uE57C뵛喪阵喬䵮巢躙\uEAD6娞迨\u243A\u2799䫺\uFFFD锕켉勳獌 PlaybackState => this.playbackState;

    public float Volume
    {
      get => this.volume;
      set
      {
        WaveOut.SetWaveOutVolume(value, this.hWaveOut, this.waveOutLock);
        this.volume = value;
      }
    }

    public void Dispose()
    {
      GC.SuppressFinalize((object) this);
      this.Dispose(true);
    }

    protected void Dispose(bool disposing)
    {
      this.Stop();
      if (disposing)
        this.DisposeBuffers();
      this.CloseWaveOut();
    }

    private void CloseWaveOut()
    {
      if (this.callbackEvent != null)
      {
        this.callbackEvent.Close();
        this.callbackEvent = (AutoResetEvent) null;
      }
      lock (this.waveOutLock)
      {
        if (!(this.hWaveOut != IntPtr.Zero))
          return;
        int num = (int) \uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.ꞃ璧\uF54D엇\uFFFD楝嵵\u1BFE\uFFFD姡켪젛跖휍딙꼄ឺ磠飅莭(this.hWaveOut);
        this.hWaveOut = IntPtr.Zero;
      }
    }

    private void DisposeBuffers()
    {
      if (this.buffers == null)
        return;
      foreach (WaveOutBuffer buffer in this.buffers)
        buffer.Dispose();
      this.buffers = (WaveOutBuffer[]) null;
    }

    ~WaveOutEvent() => this.Dispose(false);

    private void RaisePlaybackStoppedEvent(Exception e)
    {
      EventHandler<눡쩷띉ን臉萑ㄢ崌ⰶ\u2349㣥盠樭윩䥟姩ᰥ拿㩆㹑> handler = this.PlaybackStopped;
      if (handler == null)
        return;
      if (this.syncContext == null)
        handler((object) this, new 눡쩷띉ን臉萑ㄢ崌ⰶ\u2349㣥盠樭윩䥟姩ᰥ拿㩆㹑(e));
      else
        this.syncContext.Post((SendOrPostCallback) (state => handler((object) this, new 눡쩷띉ን臉萑ㄢ崌ⰶ\u2349㣥盠樭윩䥟姩ᰥ拿㩆㹑(e))), (object) null);
    }
  }
}
