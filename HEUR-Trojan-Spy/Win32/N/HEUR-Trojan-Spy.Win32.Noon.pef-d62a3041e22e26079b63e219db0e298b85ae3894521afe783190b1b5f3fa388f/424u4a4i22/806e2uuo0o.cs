// Decompiled with JetBrains decompiler
// Type: 424u4a4i22.806e2uuo0o
// Assembly: ao2u718188, Version=0.17.1.12262, Culture=neutral, PublicKeyToken=31bf3856ad364e35
// MVID: 3DF97629-1C85-445F-828B-3AC8EB815CA9
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.04\HEUR-Trojan-Spy.Win32.Noon.pef-d62a3041e22e26079b63e219db0e298b85ae3894521afe783190b1b5f3fa388f.exe

using \u00306uo1e5904;
using \u0033oeu1e6192;
using \u003424u4a4i22;
using \u00355oe2u6i33;
using \u0035a6974u213;
using Microsoft.ApplicationInsights.Channel;
using Microsoft.ApplicationInsights.Extensibility.Implementation;
using Microsoft.ApplicationInsights.Extensibility.Implementation.Tracing;
using System;
using System.Collections;
using System.Collections.Generic;
using System.Diagnostics;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Runtime.CompilerServices;
using System.Security.Cryptography;
using System.Security.Principal;
using System.Text;
using System.Threading.Tasks;

namespace \u003424u4a4i22
{
  internal class \u003806e2uuo0o : ooe0i71e11
  {
    private readonly FixedSizeQueue<string> \u003148uoai476;
    private object o59813ieu6;
    private DirectoryInfo \u0030ea468o574;
    private int \u0038o479e2217;
    private string \u00302301iii98;
    private bool \u0034o256u1o35;
    private object a03iu70i79;

    internal virtual string \u0039230u72611 => this.\u00302301iii98;

    internal bool \u0036514u90494
    {
      get => this.\u0034o256u1o35;
      set => this.\u0034o256u1o35 = value;
    }

    internal DirectoryInfo a6937u10u1
    {
      get
      {
        if (!this.\u0034o256u1o35)
        {
          lock (this.a03iu70i79)
          {
            if (!this.\u0034o256u1o35)
            {
              try
              {
                this.\u0030ea468o574 = this.\u00341u6e02291();
              }
              catch (Exception ex)
              {
                this.\u0030ea468o574 = (DirectoryInfo) null;
                string str = string.Format(\u0033457o91ea7.\u0039u51uui516("\u001C\u0004q0&\v0&\u000E?.?4&\u0004\0?n\n+c\"\u0005\u001D<&6\u001C\a?\u0017\"|8_m", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"), (object) ex);
                CoreEventSource.Log.LogVerbose(str, \u0033457o91ea7.\u0039u51uui516("\u0013\v{31\u001Du1\u0015", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"));
              }
              this.\u0034o256u1o35 = true;
              string str1 = string.Format(\u0033457o91ea7.\u0039u51uui516("\t\u0011w.\"\bur\ap!)45JEd-\u0003", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"), this.\u0030ea468o574 == null ? (object) \u0033457o91ea7.\u0039u51uui516("4\u0010t0", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK") : (object) this.\u0030ea468o574.FullName);
              CoreEventSource.Log.LogVerbose(str1, \u0033457o91ea7.\u0039u51uui516("\u0013\v{31\u001Du1\u0015", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"));
            }
          }
        }
        return this.\u0030ea468o574;
      }
    }

    internal virtual \u0036uue6eooo8 \u0034eo4802529()
    {
      IEnumerable<FileInfo> fileInfos = this.\u0034e77332i07(\u0033457o91ea7.\u0039u51uui516("pKl.-", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"));
      lock (this.o59813ieu6)
      {
        foreach (FileInfo fileInfo in fileInfos)
        {
          // ISSUE: variable of a compiler-generated type
          \u003806e2uuo0o.\u00303640u00uo obj = (\u003806e2uuo0o.\u00303640u00uo) new \u0036uue6eooo8();
          // ISSUE: reference to a compiler-generated field
          obj.\u00328317744oe = this;
          // ISSUE: reference to a compiler-generated field
          obj.\u00399a3iua452 = fileInfo;
          try
          {
            // ISSUE: reference to a compiler-generated field
            if (!this.peekedTransmissions.ContainsKey(obj.\u00399a3iua452.Name))
            {
              // ISSUE: reference to a compiler-generated field
              if (!this.\u003148uoai476.Contains(obj.\u00399a3iua452.Name))
              {
                // ISSUE: reference to a compiler-generated field
                \u0036uue6eooo8 result = AwaitExtensions.ConfigureAwait<\u0036uue6eooo8>(\u003806e2uuo0o.\u0035a5i39uu63(obj.\u00399a3iua452), false).GetAwaiter().GetResult();
                // ISSUE: reference to a compiler-generated method
                result.\u0037u333u91e3 = new Action<\u0036uue6eooo8>(obj.i63u6o513u);
                // ISSUE: reference to a compiler-generated field
                // ISSUE: reference to a compiler-generated field
                this.peekedTransmissions.Add(obj.\u00399a3iua452.Name, obj.\u00399a3iua452.FullName);
                return result;
              }
            }
          }
          catch (Exception ex)
          {
            // ISSUE: reference to a compiler-generated field
            string str = string.Format((IFormatProvider) CultureInfo.InvariantCulture, \u0033457o91ea7.\u0039u51uui516("\u001C\u0004q0&\v0&\u000E?!\"0#P\u0004q=\u00170t.B\u001En/4P\u00172\08/7\0b3\u0006zcm7.\u001C\0%=\u0005tlc'\0\u007F%)\u0004\n5\v\"|8^m", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"), new object[2]
            {
              (object) obj.\u00399a3iua452,
              (object) ex
            });
            CoreEventSource.Log.LogVerbose(str, \u0033457o91ea7.\u0039u51uui516("\u0013\v{31\u001Du1\u0015", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"));
          }
        }
      }
      return (\u0036uue6eooo8) null;
    }

    internal virtual void a35881a925(\u0036uue6eooo8 _param1)
    {
      if (this.a6937u10u1 == null)
        return;
      try
      {
        File.Delete(_param1.\u003738a087070);
        this.\u003148uoai476.Enqueue(_param1.\u003242o7ee156);
      }
      catch (IOException ex)
      {
        string str = string.Format((IFormatProvider) CultureInfo.InvariantCulture, \u0033457o91ea7.\u0039u51uui516("\u001C\u0004q0&\v0&\u000E?)(=\"\u0004\0?|^\"x/\aV<&0\u001C\u0006`Ecl>OU*\u0002z=98(\u001E_?fO9", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"), new object[2]
        {
          _param1 == null ? (object) \u0033457o91ea7.\u0039u51uui516("4\u0010t0", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK") : (object) _param1.\u003738a087070,
          (object) ex
        });
        CoreEventSource.Log.LogVerbose(str, \u0033457o91ea7.\u0039u51uui516("\u0013\v{31\u001Du1\u0015", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"));
      }
      catch (UnauthorizedAccessException ex)
      {
        string str = string.Format((IFormatProvider) CultureInfo.InvariantCulture, \u0033457o91ea7.\u0039u51uui516("\u001C\u0004q0&\v0&\u000E?)(=\"\u0004\0?|^\"x/\aV<&0\u001C\u0006`Ecl>OU*\u0002z=98(\u001E_?fO9", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"), new object[2]
        {
          _param1 == null ? (object) \u0033457o91ea7.\u0039u51uui516("4\u0010t0", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK") : (object) _param1.\u003738a087070,
          (object) ex
        });
        CoreEventSource.Log.LogVerbose(str, \u0033457o91ea7.\u0039u51uui516("\u0013\v{31\u001Du1\u0015", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"));
      }
    }

    internal virtual Task \u00347i1o8865a(Transmission _param1)
    {
      // ISSUE: variable of a compiler-generated type
      \u003806e2uuo0o.o80u903395 stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0035u4440e842 = this;
      // ISSUE: reference to a compiler-generated field
      stateMachine.i077ea7i26 = _param1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u00316415a0i45 = AsyncTaskMethodBuilder.Create();
      // ISSUE: reference to a compiler-generated field
      stateMachine.i9722aeuio = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u00316415a0i45.Start<\u003806e2uuo0o.o80u903395>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.\u00316415a0i45.Task;
    }

    private static Task \u0036ai8033a20(Transmission _param0, string _param1)
    {
      // ISSUE: variable of a compiler-generated type
      \u003806e2uuo0o.\u0037e2u0aauoo stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u00320266u1e63 = _param0;
      // ISSUE: reference to a compiler-generated field
      stateMachine.aia2ooa644 = _param1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.u5e02u22u6 = AsyncTaskMethodBuilder.Create();
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003327u41ee49 = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.u5e02u22u6.Start<\u003806e2uuo0o.\u0037e2u0aauoo>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.u5e02u22u6.Task;
    }

    private static Task<\u0036uue6eooo8> \u0035a5i39uu63(FileInfo o09u5e2uie)
    {
      // ISSUE: variable of a compiler-generated type
      \u003806e2uuo0o.\u0036364258u10 stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u00356248i2a68 = o09u5e2uie;
      // ISSUE: reference to a compiler-generated field
      stateMachine.i085eu956a = AsyncTaskMethodBuilder<\u0036uue6eooo8>.Create();
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0038654635266 = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.i085eu956a.Start<\u003806e2uuo0o.\u0036364258u10>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.i085eu956a.Task;
    }

    private static void \u0038519u3e74u(DirectoryInfo _param0) => _param0.GetFiles(\u0033457o91ea7.\u0039u51uui516("\u0005", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"));

    private static string \u0039uo089ua47()
    {
      string str1 = string.Empty;
      try
      {
        str1 = WindowsIdentity.GetCurrent().Name;
      }
      catch (Exception ex)
      {
        CoreEventSource.Log.LogVerbose(string.Format(\u0033457o91ea7.\u0039u51uui516("\u001D\0l\u001D3\u001F|;\u0002~9$>)9\u0001zs\n-e:XXZ!0\u001C\u0006>El3c\u001Du3\u0005?8>45P\f{x\u00100x7\u001BV<\u0005!\u0013\u0006*\u0011q3-U0)Qb", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"), (object) ex), \u0033457o91ea7.\u0039u51uui516("\u0013\v{31\u001Du1\u0015", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"));
      }
      string str2 = string.Empty;
      try
      {
        str2 = AppDomain.CurrentDomain.BaseDirectory;
      }
      catch (AppDomainUnloadedException ex)
      {
        CoreEventSource.Log.LogVerbose(string.Format(\u0033457o91ea7.\u0039u51uui516("\u001D\0l\u001D3\u001F|;\u0002~9$>)9\u0001zs\n-e:XXZ!0\u001C\u0006>El3c\u001Du3\u0005?9%4g\u0014\nr|\u0017*60B\u001A}3<P\a3\u0017}?7\0b+O?\b52\"\0\u0011vr\u0010~18R\u0005", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"), (object) ex), \u0033457o91ea7.\u0039u51uui516("\u0013\v{31\u001Du1\u0015", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"));
      }
      string str3 = string.Empty;
      try
      {
        str3 = Process.GetCurrentProcess().ProcessName;
      }
      catch (Exception ex)
      {
        CoreEventSource.Log.LogVerbose(string.Format(\u0033457o91ea7.\u0039u51uui516("\u001D\0l\u001D3\u001F|;\u0002~9$>)9\u0001zs\n-e:XXZ!0\u001C\u0006>El3c\u001Du3\u0005?9%4g\0\u0017p~\u001B7bc\f\u0019q%wP&\"\u0006},7\u0006\u007F<[?6},", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"), (object) ex), \u0033457o91ea7.\u0039u51uui516("\u0013\v{31\u001Du1\u0015", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"));
      }
      return string.Format(\u0033457o91ea7.\u0039u51uui516("!Ue\u001C8^m)Sb", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"), (object) str1, (object) str2, (object) str3);
    }

    private static string \u00346143i884i(string _param0)
    {
      byte[] bytes = Encoding.Unicode.GetBytes(_param0);
      try
      {
        byte[] hash = new SHA1CryptoServiceProvider().ComputeHash(bytes);
        StringBuilder stringBuilder = new StringBuilder();
        foreach (byte num in hash)
          stringBuilder.Append(num.ToString(\u0033457o91ea7.\u0039u51uui516("\"W", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"), (IFormatProvider) CultureInfo.InvariantCulture));
        return stringBuilder.ToString();
      }
      catch (Exception ex)
      {
        CoreEventSource.Log.LogVerbose(string.Format(\u0033457o91ea7.\u0039u51uui516("\u001D\0l\u000F\v.!\u001A\0l%ev<@\u001884DdW\"\v\u0014y$y\u0004\fz\ry/+A0\u0011\t~#*4g\u0003\u0011mt\u0010#17\rX^!*\u0015UnK8\u0019;\fu\"\u0015v\"#kg\vTb", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"), (object) _param0, (object) ex), \u0033457o91ea7.\u0039u51uui516("\u0013\v{31\u001Du1\u0015", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"));
        return \u0033457o91ea7.\u0039u51uui516("\t\u0011w.\"\bu", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK");
      }
    }

    private DirectoryInfo \u00341u6e02291()
    {
      IDictionary environmentVariables = Environment.GetEnvironmentVariables();
      // ISSUE: object of a compiler-generated type is created
      // ISSUE: variable of a compiler-generated type
      \u0037u0520a894<string, string> obj1 = new \u0037u0520a894<string, string>(environmentVariables[(object) \u0033457o91ea7.\u0039u51uui516("\u0016*[\u001D\u000F.@\u0002%^\u0019\f", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK")] as string, \u0033457o91ea7.\u0039u51uui516("\u0017\f{.,\u001C\u007F4\u0015C\f=!+\u0019\u0006~i\u0017+\u007F\n\f\vu'1\u0004\u0010", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"));
      // ISSUE: object of a compiler-generated type is created
      // ISSUE: variable of a compiler-generated type
      \u0037u0520a894<string, string> obj2 = new \u0037u0520a894<string, string>(environmentVariables[(object) \u0033457o91ea7.\u0039u51uui516("\u000E U\f", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK")] as string, \u0033457o91ea7.\u0039u51uui516("\u0017\f{.,\u001C\u007F4\u0015C\f=!+\u0019\u0006~i\u0017+\u007F\n\f\vu'1\u0004\u0010", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"));
      // ISSUE: object of a compiler-generated type is created
      // ISSUE: variable of a compiler-generated type
      \u0037u0520a894<string, string> obj3 = new \u0037u0520a894<string, string>(environmentVariables[(object) \u0033457o91ea7.\u0039u51uui516("\n\u0017w;1\u000E}\u0016\0k,", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK")] as string, \u0033457o91ea7.\u0039u51uui516("\u0017\f{.,\u001C\u007F4\u0015?\f=!+\u0019\u0006~i\u0017+\u007F\n\f\vu'1\u0004\u0010", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"));
      \u0037u0520a894<string, string>[] objArray = new \u0037u0520a894<string, string>[3]
      {
        obj1,
        obj2,
        obj3
      };
      foreach (\u0037u0520a894<string, string> obj4 in objArray)
      {
        try
        {
          if (!string.IsNullOrEmpty(obj4.u46a0a4i79))
          {
            DirectoryInfo subdirectory = new DirectoryInfo(obj4.u46a0a4i79).CreateSubdirectory(Path.Combine(obj4.o417uaooa1, this.\u00302301iii98));
            \u003806e2uuo0o.\u0038519u3e74u(subdirectory);
            return subdirectory;
          }
        }
        catch (UnauthorizedAccessException ex)
        {
        }
      }
      return (DirectoryInfo) null;
    }

    private bool \u0036170821991()
    {
      if (this.e4a75u5309 == uint.MaxValue && ((\u003CModule\u003E) this).get_CapacityInBytes() == ulong.MaxValue)
        return false;
      FileInfo[] files = this.a6937u10u1.GetFiles();
      return (long) files.Length >= (long) this.e4a75u5309 || (ulong) ((IEnumerable<FileInfo>) files).Sum<FileInfo>((Func<FileInfo, long>) (_param0 => _param0.Length)) >= ((\u003CModule\u003E) this).get_CapacityInBytes();
    }

    private IEnumerable<FileInfo> \u0034e77332i07(string _param1)
    {
      IEnumerable<FileInfo> source = (IEnumerable<FileInfo>) new List<FileInfo>();
      try
      {
        if (this.a6937u10u1 != null)
        {
          source = (IEnumerable<FileInfo>) this.a6937u10u1.GetFiles(_param1, SearchOption.TopDirectoryOnly);
          return (IEnumerable<FileInfo>) source.OrderBy<FileInfo, string>((Func<FileInfo, string>) (uo27o431ei => uo27o431ei.Name));
        }
      }
      catch (Exception ex)
      {
        string str = string.Format((IFormatProvider) CultureInfo.InvariantCulture, \u0033457o91ea7.\u0039u51uui516("\n\0}7c\tq;\rz)m&/\u0019\tz=\u0019!e7\v\u0016{`?\u0019\u000F?\u00168:1\0}r\u0012k\"?0 \u0015K?X\u0006't3\u0016\u0011s.cP", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK") + (object) ex);
        CoreEventSource.Log.LogVerbose(str, \u0033457o91ea7.\u0039u51uui516("\u0013\v{31\u001Du1\u0015", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"));
      }
      return source;
    }

    private void \u0034ei4ee0a73()
    {
      try
      {
        foreach (FileInfo fileInfo in this.\u0034e77332i07(\u0033457o91ea7.\u0039u51uui516("pKl13", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK")))
        {
          if (DateTime.UtcNow - fileInfo.CreationTimeUtc >= TimeSpan.FromMinutes(5.0))
            fileInfo.Delete();
        }
      }
      catch (Exception ex)
      {
        CoreEventSource.Log.LogVerbose(\u0033457o91ea7.\u0039u51uui516("\u001C\u0004q0&\v0&\u000E?)(=\"\u0004\0?i\u001341%\v\u0014y3wP&\"\u0006},7\u0006\u007F<[?", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK") + (object) ex, \u0033457o91ea7.\u0039u51uui516("\u0013\v{31\u001Du1\u0015", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"));
      }
    }

    internal \u003806e2uuo0o(
      ooe0i71e11 storage,
      TelemetryBuffer telemetryBuffer,
      bool supportAutoFlush = true)
    {
      ((\u0038989oi11i5) this).i1i3ae4201 = true;
      // ISSUE: explicit constructor call
      base.\u002Ector();
      ((\u0038989oi11i5) this).a56i99uuo5 = storage;
      ((\u0038989oi11i5) this).\u0031eeo6a5u35 = telemetryBuffer;
      ((\u0038989oi11i5) this).\u0031eeo6a5u35.OnFull = new Action(((\u0038989oi11i5) this).\u0039io85euuu9);
      ((\u0038989oi11i5) this).\u00300ee3ee2au = TimeSpan.FromSeconds(30.0);
      if (!supportAutoFlush)
        return;
      Task.Factory.StartNew(new Action(((\u0038989oi11i5) this).u9eu3a5i2i), TaskCreationOptions.LongRunning).ContinueWith((Action<Task>) (_param0 => CoreEventSource.Log.LogVerbose(\u0033457o91ea7.\u0039u51uui516("\u001C\tm/+\"q<\0x(?kg6\u0004vq\v6tc\v\u0016<\u00065\u0005\u00102)w33U0\u0017\u0019|(=%.\u001F\v%=", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK") + _param0.Exception.ToString(), \u0033457o91ea7.\u0039u51uui516("\u0013\v{31\u001Du1\u0015", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"))), TaskContinuationOptions.OnlyOnFaulted);
    }
  }
}
