// Decompiled with JetBrains decompiler
// Type: 582573968022.Core.615689892570
// Assembly: 582573968022, Version=15.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
// MVID: 22949299-4A50-46F6-851E-C2A296093D37
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Exploit.MSIL.Shellcode.gen-35a63266858befa3a9a9f8f0684d53a6905ab1fbfd8df949e6989c20107cc290.exe

using \u003081605011334;
using \u003129117523387;
using \u003582573968022.Core;
using \u003582573968022.Models;
using \u003582573968022.Utils;
using System;
using System.Collections.Generic;
using System.Drawing;
using System.Drawing.Imaging;
using System.IO;
using System.Linq;
using System.Text;

namespace \u003582573968022.Core
{
  public static class \u003615689892570
  {
    private static void \u003678182863928(
      string _param0,
      string _param1,
      Func<string, \u003677781699288> _param2)
    {
      TimeSpan timeSpan = TimeSpan.FromMinutes(5.0);
      \u003720703864363 obj1 = new \u003720703864363();
      obj1.\u003105076959314 = timeSpan;
      obj1.Encoding = Encoding.UTF8;
      string contents;
      using (\u003720703864363 obj2 = obj1)
      {
        Console.WriteLine("Downloading " + _param0);
        contents = obj2.DownloadString(_param0);
      }
      \u003677781699288 obj3 = _param2(contents);
      string str1 = \u003615689892570.\u003455829033452(obj3);
      string path1 = Path.Combine(_param1, str1 ?? "");
      string str2 = ((IEnumerable<string>) str1.Split('_')).First<string>();
      string path2 = Path.Combine(_param1, str2 + ".xml");
      if (File.Exists(path2) && File.Exists(path1))
      {
        Console.WriteLine("Already have it: " + str2);
      }
      else
      {
        File.WriteAllText(path2, contents);
        try
        {
          \u003295396826917.\u003758564738020(obj3.\u003709285518437, path1);
        }
        catch (Exception ex)
        {
          ex.\u003659348584730();
          File.Delete(path1);
        }
      }
    }

    private static string \u003455829033452(\u003677781699288 _param0)
    {
      string str = Path.GetFileName(_param0.\u003709285518437).\u003059917882951();
      if (str.EndsWith(".jpg", StringComparison.OrdinalIgnoreCase))
        return str;
      Uri uri = new Uri(_param0.\u003709285518437);
      return string.Empty;
    }

    public static void \u003537761177312()
    {
      string path1 = \u003685140021025.\u003654954000279();
      \u003403192968317 obj1 = \u003157953560169.\u003630010080568(path1);
      string str = obj1?.\u003692003380503;
      if (string.IsNullOrWhiteSpace(str) || !File.Exists(str))
      {
        Console.WriteLine(str + " not found.");
      }
      else
      {
        \u003214962158495 obj2 = new \u003214962158495(str);
        ((\u003506217707934) obj2).\u003949493204517 = \u003157953560169.\u003841077402867();
        ((\u003506217707934) obj2).\u003114599259440 = obj1.\u003386565448383;
        ((\u003506217707934) obj2).\u003925463290472 = Color.DarkRed;
        ((\u003506217707934) obj2).\u003270809543490 = \u003265934628062.\u003758641535489;
        ((\u003506217707934) obj2).\u003062287153064 = \u003265934628062.\u003363140924650;
        ((\u003506217707934) obj2).\u003037983126188 = \u003265934628062.\u003355247474227;
        ((\u003506217707934) obj2).\u003778452301755 = \u003265934628062.\u003579536116832;
        ((\u003506217707934) obj2).\u003675261620833 = \u003265934628062.\u003306295284833;
        ((\u003506217707934) obj2).\u003280330890558 = \u003265934628062.\u003103885256777;
        ((\u003506217707934) obj2).\u003469416200105 = \u003265934628062.\u003036047959714;
        using (\u003506217707934 obj3 = (\u003506217707934) obj2)
        {
          using (Image image = obj3.\u003692651495070())
          {
            string filename;
            if (\u003090947780988.get_IsWindows8Plus())
            {
              filename = Path.Combine(path1, "_wallpaper.png");
              image.Save(filename, ImageFormat.Png);
            }
            else
            {
              filename = Path.Combine(path1, "_wallpaper.bmp");
              image.Save(filename, ImageFormat.Bmp);
            }
            \u003403725428846.\u003673893267168(filename);
            \u003403725428846.\u003692545275838(filename);
          }
        }
      }
    }
  }
}
