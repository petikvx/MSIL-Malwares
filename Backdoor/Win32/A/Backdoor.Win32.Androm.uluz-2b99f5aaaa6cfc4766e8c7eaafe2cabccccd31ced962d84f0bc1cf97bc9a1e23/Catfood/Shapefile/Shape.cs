// Decompiled with JetBrains decompiler
// Type: Catfood.Shapefile.Shape
// Assembly: 太城hضd氏bTنH, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: FB883643-FAF4-44BB-B4FC-F1B0FC1059A6
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.03-msil\Backdoor.Win32.Androm.uluz-2b99f5aaaa6cfc4766e8c7eaafe2cabccccd31ced962d84f0bc1cf97bc9a1e23.exe

using System;
using System.Collections;
using System.Collections.Generic;
using System.Collections.Specialized;
using System.Data;

namespace Catfood.Shapefile
{
  public class Shape
  {
    internal ShapeType _type;
    private int _recordNumber;
    private StringDictionary _metadata;
    private IDataRecord _dataRecord;

    protected internal Shape(
      ShapeType shapeType,
      int recordNumber,
      StringDictionary metadata,
      IDataRecord dataRecord)
    {
      this._type = shapeType;
      this._metadata = metadata;
      this._recordNumber = recordNumber;
      this._dataRecord = dataRecord;
    }

    public string GetMetadata(string name) => this._metadata != null && this._metadata.ContainsKey(name) ? this._metadata[name] : (string) null;

    public string[] GetMetadataNames()
    {
      if (this._metadata == null || this._metadata.Keys.Count <= 0)
        return (string[]) null;
      List<string> stringList = new List<string>(this._metadata.Keys.Count);
      foreach (string key in (IEnumerable) this._metadata.Keys)
        stringList.Add(key);
      return stringList.ToArray();
    }

    public IDataRecord DataRecord => this._dataRecord;

    public int RecordNumber => this._recordNumber;

    public ShapeType Type => this._type;

    protected RectangleD ParseBoundingBox(
      byte[] value,
      int startIndex,
      ProvidedOrder order)
    {
      return new RectangleD(EndianBitConverter.ToDouble(value, startIndex, order), EndianBitConverter.ToDouble(value, startIndex + 8, order), EndianBitConverter.ToDouble(value, startIndex + 16, order), EndianBitConverter.ToDouble(value, startIndex + 24, order));
    }

    protected void ParsePolyLineOrPolygon(
      byte[] shapeData,
      out RectangleD boundingBox,
      out List<PointD[]> parts)
    {
      boundingBox = new RectangleD();
      parts = (List<PointD[]>) null;
      if (shapeData == null)
        throw new ArgumentNullException(nameof (shapeData));
      boundingBox = shapeData.Length >= 44 ? this.ParseBoundingBox(shapeData, 12, ProvidedOrder.Little) : throw new InvalidOperationException("Invalid shape data");
      int int32_1 = EndianBitConverter.ToInt32(shapeData, 44, ProvidedOrder.Little);
      int int32_2 = EndianBitConverter.ToInt32(shapeData, 48, ProvidedOrder.Little);
      if (shapeData.Length != 52 + 4 * int32_1 + 16 * int32_2)
        throw new InvalidOperationException("Invalid shape data");
      int num1 = 52 + 4 * int32_1;
      parts = new List<PointD[]>(int32_1);
      for (int index1 = 0; index1 < int32_1; ++index1)
      {
        int num2 = EndianBitConverter.ToInt32(shapeData, 52 + 4 * index1, ProvidedOrder.Little) * 16 + num1;
        int length = (index1 != int32_1 - 1 ? EndianBitConverter.ToInt32(shapeData, 52 + 4 * (index1 + 1), ProvidedOrder.Little) * 16 + num1 - num2 : shapeData.Length - num2) / 16;
        PointD[] pointDArray = new PointD[length];
        for (int index2 = 0; index2 < length; ++index2)
          pointDArray[index2] = new PointD(EndianBitConverter.ToDouble(shapeData, num2 + 16 * index2, ProvidedOrder.Little), EndianBitConverter.ToDouble(shapeData, num2 + 8 + 16 * index2, ProvidedOrder.Little));
        parts.Add(pointDArray);
      }
    }
  }
}
