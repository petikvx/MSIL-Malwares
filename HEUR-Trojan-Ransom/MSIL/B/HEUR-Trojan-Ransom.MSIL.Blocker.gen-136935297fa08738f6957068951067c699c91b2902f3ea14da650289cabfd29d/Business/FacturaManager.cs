// Decompiled with JetBrains decompiler
// Type: Coache.Business.FacturaManager
// Assembly: IsCopyConstruc, Version=5.6.2.1, Culture=neutral, PublicKeyToken=null
// MVID: 1DA50973-FF9A-4563-8B8F-74E2573677DF
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.02-msil\HEUR-Trojan-Ransom.MSIL.Blocker.gen-136935297fa08738f6957068951067c699c91b2902f3ea14da650289cabfd29d.exe

using Coache.Common;
using Data;
using System;
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.Configuration;
using System.Data;

namespace Coache.Business
{
  public class FacturaManager
  {
    public int GenerarFactura(
      Proveedor proveedor,
      BindingList<CompraCupon> compras,
      DateTime fecha)
    {
      DataRow dataRow = SqlDataAccess.ExecuteDataRowQuery(ConfigurationManager.ConnectionStrings["GrouponConnectionString"].ToString(), "GRUPO_N.InsertFactura", SqlDataAccessArgs.CreateWith("@Fecha", (object) fecha).And("@ID_Proveedor", (object) proveedor.UserID).Arguments);
      int num = int.Parse(dataRow["NroFactura"].ToString());
      int idFactura = int.Parse(dataRow["ID_Factura"].ToString());
      foreach (CompraCupon compra in (Collection<CompraCupon>) compras)
        this.AddCompraFactura(compra, idFactura);
      return num;
    }

    private void AddCompraFactura(CompraCupon compra, int idFactura) => SqlDataAccess.ExecuteNonQuery(ConfigurationManager.ConnectionStrings["GrouponConnectionString"].ToString(), "GRUPO_N.InsertFacturaCanjeCupon", SqlDataAccessArgs.CreateWith("@ID_Factura", (object) idFactura).And("@ID_CanjeCupon", (object) compra.ID).Arguments);
  }
}
