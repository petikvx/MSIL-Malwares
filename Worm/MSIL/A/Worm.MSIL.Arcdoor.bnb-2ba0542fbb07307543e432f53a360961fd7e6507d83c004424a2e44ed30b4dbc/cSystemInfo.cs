// Decompiled with JetBrains decompiler
// Type: Stub.cSystemInfo
// Assembly: N0ise, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 21609AF2-EC6A-4FAA-88B3-5930EE31DBBA
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare-00001-msil\Worm.MSIL.Arcdoor.bnb-2ba0542fbb07307543e432f53a360961fd7e6507d83c004424a2e44ed30b4dbc.exe

using Microsoft.Win32;
using System;
using System.Management;

namespace Stub
{
  internal class cSystemInfo
  {
    public string getSystemVersion() => this.getWindowsVersionName() + " " + this.getBitVersion();

    public string getUniqueID()
    {
      string sString = (this.getCPUID() + this.getGraphicDevice() + this.getMoboSerial()).ToString();
      return cMain.FunctionClass.getMD5Hash(sString);
    }

    private string getWindowsVersionName()
    {
      ManagementObjectSearcher managementObjectSearcher = new ManagementObjectSearcher("root\\CIMV2", " SELECT * FROM win32_operatingsystem");
      string empty = string.Empty;
      foreach (ManagementBaseObject managementBaseObject in managementObjectSearcher.Get())
        empty = Convert.ToString(managementBaseObject["Name"]);
      try
      {
        string str = empty.Split('|')[0];
        int length = str.Split(' ')[0].Length;
        return str.Substring(length).TrimStart().TrimEnd();
      }
      catch
      {
        return "Unknown System";
      }
    }

    private string getBitVersion() => Registry.LocalMachine.OpenSubKey("Hardware\\Description\\System\\CentralProcessor\\0").GetValue("Identifier").ToString().Contains("x86") ? "(32 Bit)" : "(64 Bit)";

    private string getCPUID()
    {
      ManagementObjectSearcher managementObjectSearcher = new ManagementObjectSearcher("root\\CIMV2", "SELECT * FROM Win32_Processor WHERE DeviceID = 'CPU0'");
      string empty = string.Empty;
      foreach (ManagementBaseObject managementBaseObject in managementObjectSearcher.Get())
        empty = Convert.ToString(managementBaseObject["ProcessorId"]);
      return empty;
    }

    private string getMoboSerial()
    {
      ManagementObjectSearcher managementObjectSearcher = new ManagementObjectSearcher("root\\CIMV2", "SELECT * FROM Win32_BaseBoard");
      string empty = string.Empty;
      foreach (ManagementBaseObject managementBaseObject in managementObjectSearcher.Get())
        empty = Convert.ToString(managementBaseObject["SerialNumber"]);
      return empty;
    }

    public string getGraphicDevice()
    {
      ManagementObjectSearcher managementObjectSearcher = new ManagementObjectSearcher("root\\CIMV2", "SELECT * FROM Win32_VideoController");
      string empty = string.Empty;
      foreach (ManagementBaseObject managementBaseObject in managementObjectSearcher.Get())
        empty = Convert.ToString(managementBaseObject["Description"]);
      return empty;
    }
  }
}
