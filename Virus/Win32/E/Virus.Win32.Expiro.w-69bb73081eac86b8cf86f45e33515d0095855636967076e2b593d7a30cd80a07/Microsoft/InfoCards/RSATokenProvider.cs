// Decompiled with JetBrains decompiler
// Type: Microsoft.InfoCards.RSATokenProvider
// Assembly: infocard, Version=3.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089
// MVID: 516D8B44-4448-4D2C-8B8E-FFBB3FFE472B
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare-00000-msil\Virus.Win32.Expiro.w-69bb73081eac86b8cf86f45e33515d0095855636967076e2b593d7a30cd80a07.exe

using Microsoft.InfoCards.Diagnostics;
using System;
using System.IdentityModel.Selectors;
using System.IdentityModel.Tokens;

namespace Microsoft.InfoCards
{
  internal class RSATokenProvider : SecurityTokenProvider, IDisposable
  {
    private InfoCardPolicy m_policy;
    private InfoCard m_card;
    private SelfIssuedAuthProofToken m_RSAToken;

    public RSATokenProvider(InfoCardPolicy policy, InfoCard card)
    {
      InfoCardTrace.ThrowInvalidArgumentConditional(null == policy, nameof (policy));
      InfoCardTrace.ThrowInvalidArgumentConditional(null == card, nameof (card));
      this.m_policy = policy;
      this.m_card = card;
    }

    public void Dispose()
    {
      if (this.m_RSAToken == null)
        return;
      this.m_RSAToken.Dispose();
      this.m_RSAToken = (SelfIssuedAuthProofToken) null;
    }

    protected override SecurityToken GetTokenCore(TimeSpan timeout)
    {
      if (this.m_RSAToken == null)
        this.m_RSAToken = new SelfIssuedAuthProofToken(this.m_card.GetPrivateCryptography(this.m_policy.Recipient.GetIdentifier()), DateTime.UtcNow + timeout);
      return (SecurityToken) this.m_RSAToken;
    }
  }
}
