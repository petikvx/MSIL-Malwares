// Decompiled with JetBrains decompiler
// Type: Egebimtes.EtiketBasimi.FrmStok
// Assembly: EgebimtesEtiketBasim, Version=1.0.0.8, Culture=neutral, PublicKeyToken=null
// MVID: D0653F93-40B2-470A-A14A-758CB97E05C0
// Assembly location: C:\Users\Administrateur\Desktop\Virusshare-00005-msil\Virus.Win32.Alman.b-030a4381fa3d09b164161894fccddf864dfa0fa12dc2a8cbb8779f4750301cd1.exe

using System;
using System.Collections;
using System.ComponentModel;
using System.Data;
using System.Diagnostics;
using System.Drawing;
using System.IO;
using System.Text;
using System.Threading;
using System.Windows.Forms;

namespace Egebimtes.EtiketBasimi
{
  public class FrmStok : Form
  {
    private IContainer components;
    private Label lblBasla;
    private Label lblBitis;
    private Label lblStokKodu;
    private TextBox txtStokKoduBasla;
    private TextBox txtStokKoduBitis;
    private GroupBox gbRehber;
    private GroupBox gbStokKoduListe;
    private DataGridView dgvStokKartiListe;
    private Button btnStokKoduBitisRehber;
    private Button btnStokKoduBaslaRehber;
    private Button btnTemizle;
    private Button btnYazdir;
    private Button btnListele;
    private DBConn vtIslemleri;

    protected override void Dispose(bool disposing)
    {
      if (disposing && this.components != null)
        this.components.Dispose();
      base.Dispose(disposing);
    }

    private void InitializeComponent()
    {
      this.lblBasla = new Label();
      this.lblBitis = new Label();
      this.lblStokKodu = new Label();
      this.txtStokKoduBasla = new TextBox();
      this.txtStokKoduBitis = new TextBox();
      this.gbRehber = new GroupBox();
      this.btnTemizle = new Button();
      this.btnYazdir = new Button();
      this.btnListele = new Button();
      this.btnStokKoduBitisRehber = new Button();
      this.btnStokKoduBaslaRehber = new Button();
      this.gbStokKoduListe = new GroupBox();
      this.dgvStokKartiListe = new DataGridView();
      this.gbRehber.SuspendLayout();
      this.gbStokKoduListe.SuspendLayout();
      ((ISupportInitialize) this.dgvStokKartiListe).BeginInit();
      this.SuspendLayout();
      this.lblBasla.AutoSize = true;
      this.lblBasla.Location = new Point(197, 27);
      this.lblBasla.Name = "lblBasla";
      this.lblBasla.Size = new Size(53, 13);
      this.lblBasla.TabIndex = 0;
      this.lblBasla.Text = "Başlangıç";
      this.lblBitis.AutoSize = true;
      this.lblBitis.Location = new Point(445, 27);
      this.lblBitis.Name = "lblBitis";
      this.lblBitis.Size = new Size(26, 13);
      this.lblBitis.TabIndex = 1;
      this.lblBitis.Text = "Bitiş";
      this.lblStokKodu.AutoSize = true;
      this.lblStokKodu.Location = new Point(73, 67);
      this.lblStokKodu.Name = "lblStokKodu";
      this.lblStokKodu.Size = new Size(57, 13);
      this.lblStokKodu.TabIndex = 2;
      this.lblStokKodu.Text = "Stok Kodu";
      this.txtStokKoduBasla.Location = new Point(151, 60);
      this.txtStokKoduBasla.Name = "txtStokKoduBasla";
      this.txtStokKoduBasla.Size = new Size(182, 20);
      this.txtStokKoduBasla.TabIndex = 5;
      this.txtStokKoduBitis.Location = new Point(448, 60);
      this.txtStokKoduBitis.Name = "txtStokKoduBitis";
      this.txtStokKoduBitis.Size = new Size(162, 20);
      this.txtStokKoduBitis.TabIndex = 6;
      this.gbRehber.Controls.Add((Control) this.btnTemizle);
      this.gbRehber.Controls.Add((Control) this.btnYazdir);
      this.gbRehber.Controls.Add((Control) this.btnListele);
      this.gbRehber.Controls.Add((Control) this.btnStokKoduBitisRehber);
      this.gbRehber.Controls.Add((Control) this.btnStokKoduBaslaRehber);
      this.gbRehber.Controls.Add((Control) this.txtStokKoduBasla);
      this.gbRehber.Controls.Add((Control) this.lblBasla);
      this.gbRehber.Controls.Add((Control) this.lblBitis);
      this.gbRehber.Controls.Add((Control) this.lblStokKodu);
      this.gbRehber.Controls.Add((Control) this.txtStokKoduBitis);
      this.gbRehber.Location = new Point(12, 23);
      this.gbRehber.Name = "gbRehber";
      this.gbRehber.Size = new Size(761, 173);
      this.gbRehber.TabIndex = 11;
      this.gbRehber.TabStop = false;
      this.gbRehber.Text = "Stok Kodu Rehberi";
      this.btnTemizle.Location = new Point(542, 116);
      this.btnTemizle.Name = "btnTemizle";
      this.btnTemizle.Size = new Size(103, 32);
      this.btnTemizle.TabIndex = 19;
      this.btnTemizle.Text = "Temizle";
      this.btnTemizle.UseVisualStyleBackColor = true;
      this.btnTemizle.Click += new EventHandler(this.btnTemizle_Click);
      this.btnYazdir.Location = new Point(343, 116);
      this.btnYazdir.Name = "btnYazdir";
      this.btnYazdir.Size = new Size(103, 32);
      this.btnYazdir.TabIndex = 18;
      this.btnYazdir.Text = "Yazdır";
      this.btnYazdir.UseVisualStyleBackColor = true;
      this.btnYazdir.Click += new EventHandler(this.btnYazdir_Click);
      this.btnListele.Location = new Point(151, 116);
      this.btnListele.Name = "btnListele";
      this.btnListele.Size = new Size(103, 32);
      this.btnListele.TabIndex = 17;
      this.btnListele.Text = "Listele";
      this.btnListele.UseVisualStyleBackColor = true;
      this.btnListele.Click += new EventHandler(this.btnListele_Click);
      this.btnStokKoduBitisRehber.Location = new Point(616, 58);
      this.btnStokKoduBitisRehber.Name = "btnStokKoduBitisRehber";
      this.btnStokKoduBitisRehber.Size = new Size(29, 23);
      this.btnStokKoduBitisRehber.TabIndex = 14;
      this.btnStokKoduBitisRehber.Text = "R";
      this.btnStokKoduBitisRehber.UseVisualStyleBackColor = true;
      this.btnStokKoduBitisRehber.Click += new EventHandler(this.btnStokKoduBitisRehber_Click);
      this.btnStokKoduBaslaRehber.Location = new Point(343, 60);
      this.btnStokKoduBaslaRehber.Name = "btnStokKoduBaslaRehber";
      this.btnStokKoduBaslaRehber.Size = new Size(29, 23);
      this.btnStokKoduBaslaRehber.TabIndex = 11;
      this.btnStokKoduBaslaRehber.Text = "R";
      this.btnStokKoduBaslaRehber.UseVisualStyleBackColor = true;
      this.btnStokKoduBaslaRehber.Click += new EventHandler(this.btnStokKoduBaslaRehber_Click);
      this.gbStokKoduListe.Controls.Add((Control) this.dgvStokKartiListe);
      this.gbStokKoduListe.Location = new Point(12, 202);
      this.gbStokKoduListe.Name = "gbStokKoduListe";
      this.gbStokKoduListe.Size = new Size(761, 309);
      this.gbStokKoduListe.TabIndex = 12;
      this.gbStokKoduListe.TabStop = false;
      this.gbStokKoduListe.Text = "Stok Listesi";
      this.dgvStokKartiListe.AllowUserToAddRows = false;
      this.dgvStokKartiListe.AllowUserToDeleteRows = false;
      this.dgvStokKartiListe.AllowUserToOrderColumns = true;
      this.dgvStokKartiListe.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.Fill;
      this.dgvStokKartiListe.ColumnHeadersHeightSizeMode = DataGridViewColumnHeadersHeightSizeMode.AutoSize;
      this.dgvStokKartiListe.Dock = DockStyle.Fill;
      this.dgvStokKartiListe.Location = new Point(3, 16);
      this.dgvStokKartiListe.Name = "dgvStokKartiListe";
      this.dgvStokKartiListe.Size = new Size(755, 290);
      this.dgvStokKartiListe.TabIndex = 0;
      this.AutoScaleDimensions = new SizeF(6f, 13f);
      this.AutoScaleMode = AutoScaleMode.Font;
      this.ClientSize = new Size(785, 523);
      this.Controls.Add((Control) this.gbStokKoduListe);
      this.Controls.Add((Control) this.gbRehber);
      this.Name = nameof (FrmStok);
      this.StartPosition = FormStartPosition.CenterScreen;
      this.Text = "Stok Kartı Formu";
      this.gbRehber.ResumeLayout(false);
      this.gbRehber.PerformLayout();
      this.gbStokKoduListe.ResumeLayout(false);
      ((ISupportInitialize) this.dgvStokKartiListe).EndInit();
      this.ResumeLayout(false);
    }

    public FrmStok()
    {
      this.InitializeComponent();
      this.vtIslemleri = new DBConn();
    }

    private void btnListele_Click(object sender, EventArgs e)
    {
      try
      {
        this.dgvStokKartiListe.DataSource = (object) this.vtIslemleri.StokKartListele(this.txtStokKoduBasla.Text, this.txtStokKoduBitis.Text, string.Empty, string.Empty, string.Empty, string.Empty);
      }
      catch (Exception ex)
      {
        int num = (int) MessageBox.Show("Stok kartları listelenirken bir hata oluştu.\nHata mesajı : " + ex.Message, "Hata", MessageBoxButtons.OK, MessageBoxIcon.Hand);
      }
    }

    private void btnTemizle_Click(object sender, EventArgs e)
    {
      this.dgvStokKartiListe.DataSource = (object) null;
      this.txtStokKoduBasla.Text = "";
      this.txtStokKoduBitis.Text = "";
    }

    private void btnStokKoduBaslaRehber_Click(object sender, EventArgs e)
    {
      int num = (int) new FrmStokRehber(this, StokKoduTipi.Baslangic).ShowDialog();
    }

    private void btnStokKoduBitisRehber_Click(object sender, EventArgs e)
    {
      int num = (int) new FrmStokRehber(this, StokKoduTipi.Bitis).ShowDialog();
    }

    private void btnYazdir_Click(object sender, EventArgs e)
    {
      OpenFileDialog openFileDialog = new OpenFileDialog();
      openFileDialog.Title = "Etiket basımı için dizayn dosyası seçin";
      openFileDialog.Filter = "Printer Output files (*.prn)|*.prn|Text files (*.txt)|*.txt";
      openFileDialog.Multiselect = false;
      if (openFileDialog.ShowDialog() == DialogResult.Cancel)
      {
        int num1 = (int) MessageBox.Show("Etiket dizaynı seçilmeden basım yapılamaz.", "Etiket Basım");
      }
      else
      {
        Program.strSablonDosya = openFileDialog.FileName;
        try
        {
          foreach (DataGridViewRow row in (IEnumerable) this.dgvStokKartiListe.Rows)
          {
            if ((bool) row.Cells["SEC"].Value)
            {
              DataTable dtStokBilgi = this.vtIslemleri.StokBilgiOku(row.Cells["STOK KODU"].Value.ToString());
              if (dtStokBilgi == null || dtStokBilgi.Rows.Count == 0)
              {
                int num2 = (int) MessageBox.Show("Stok kaydı bulunamadı.", "Hata", MessageBoxButtons.OK);
                break;
              }
              this.EtiketYazdir(dtStokBilgi, (int) row.Cells["BASIM MIKTARI"].Value);
            }
          }
        }
        catch (Exception ex)
        {
          int num3 = (int) MessageBox.Show("Etiketler yazdirilirken bir hata oluştu.\nHata mesajı : " + ex.Message, "Hata", MessageBoxButtons.OK, MessageBoxIcon.Hand);
        }
      }
    }

    private void EtiketYazdir(DataTable dtStokBilgi, int intBasimMiktari)
    {
      this.DosyaDuzelt(Program.strSablonDosya, dtStokBilgi.Rows[0]);
      for (int index = 0; index < intBasimMiktari; ++index)
      {
        string arguments = "/C print ETIKETTMP.txt /d:" + Program.strPort;
        Process process = new Process();
        process.EnableRaisingEvents = false;
        Process.Start("CMD.exe", arguments);
        Thread.Sleep(1000);
        process.Close();
      }
    }

    private void DosyaDuzelt(string strDosya, DataRow rowStok)
    {
      StreamReader streamReader = new StreamReader(strDosya, Encoding.Default);
      StreamWriter streamWriter = new StreamWriter("ETIKETTMP.txt", false, Encoding.Default);
      string str1 = "";
      while (streamReader.Peek() >= 0)
      {
        string str2 = streamReader.ReadLine();
        str1 = str2;
        string newValue1 = rowStok["STOK_KODU"].ToString();
        string newValue2 = rowStok["STOK_ADI"].ToString();
        string newValue3 = Convert.ToDecimal(rowStok["PAY_1"]).ToString("#,##0.00");
        string newValue4 = Convert.ToDecimal(rowStok["PAYDA_1"]).ToString("#,##0.00");
        string newValue5 = Convert.ToDecimal(rowStok["PAY2"]).ToString("#,##0.00");
        string newValue6 = Convert.ToDecimal(rowStok["PAYDA2"]).ToString("#,##0.00");
        string newValue7 = rowStok["OLCU_BR1"].ToString();
        string newValue8 = rowStok["OLCU_BR2"].ToString();
        string newValue9 = rowStok["OLCU_BR3"].ToString();
        rowStok["GRUP_KODU"].ToString();
        string newValue10 = rowStok["SATIS_FIAT1"].ToString();
        string newValue11 = rowStok["SATIS_FIAT2"].ToString();
        string newValue12 = rowStok["SATIS_FIAT3"].ToString();
        string newValue13 = rowStok["SATIS_FIAT4"].ToString();
        string newValue14 = rowStok["KULL1S"].ToString();
        string newValue15 = rowStok["KULL2S"].ToString();
        string newValue16 = rowStok["KULL3S"].ToString();
        string newValue17 = rowStok["KULL4S"].ToString();
        string newValue18 = rowStok["KULL5S"].ToString();
        string newValue19 = rowStok["KULL6S"].ToString();
        string newValue20 = rowStok["KULL7S"].ToString();
        string newValue21 = rowStok["KULL8S"].ToString();
        string newValue22 = rowStok["KULL1N"].ToString();
        string newValue23 = rowStok["KULL2N"].ToString();
        string newValue24 = rowStok["KULL3N"].ToString();
        string newValue25 = rowStok["KULL4N"].ToString();
        string newValue26 = rowStok["KULL5N"].ToString();
        string newValue27 = rowStok["KULL6N"].ToString();
        string newValue28 = rowStok["KULL7N"].ToString();
        string newValue29 = rowStok["KULL8N"].ToString();
        string newValue30 = rowStok["INGISIM"].ToString();
        string str3 = str2.Replace("[*0*]", newValue1).Replace("[*1*]", newValue2).Replace("[*20*]", newValue10).Replace("[*21*]", newValue11).Replace("[*22*]", newValue12).Replace("[*23*]", newValue13).Replace("[*6*]", newValue7).Replace("[*7*]", newValue8).Replace("[*8*]", newValue3).Replace("[*9*]", newValue4).Replace("[*10*]", newValue9).Replace("[*11*]", newValue5).Replace("[*12*]", newValue6);
        string str4 = newValue2.Length <= 30 ? str3.Replace("[*1;30,1*]", newValue2).Replace("[*1;30,2*]", "") : str3.Replace("[*1;30,1*]", newValue2.Substring(0, 30)).Replace("[*1;30,2*]", newValue2.Substring(30));
        string str5 = (newValue2.Length <= 15 ? str4.Replace("[*1;15,1*]", newValue2).Replace("[*1;15,2*]", "") : str4.Replace("[*1;15,1*]", newValue2.Substring(0, 15)).Replace("[*1;15,2*]", newValue2.Substring(15))).Replace("[*37*]", newValue14).Replace("[*38*]", newValue15).Replace("[*39*]", newValue16).Replace("[*40*]", newValue17).Replace("[*59*]", newValue18).Replace("[*60*]", newValue19).Replace("[*61*]", newValue20).Replace("[*62*]", newValue21).Replace("[*41*]", newValue22).Replace("[*42*]", newValue23).Replace("[*43*]", newValue24).Replace("[*44*]", newValue25).Replace("[*63*]", newValue26).Replace("[*64*]", newValue27).Replace("[*65*]", newValue28).Replace("[*66*]", newValue29).Replace("[*4207*]", newValue30);
        if (Program.strPrinter == "ZEBRA")
          str5 = str5.Replace("\\", "\\\\");
        streamWriter.WriteLine(str5);
      }
      streamWriter.Close();
      streamReader.Close();
    }

    public void SetStokKodu(string strStokKodu, StokKoduTipi tip)
    {
      switch (tip)
      {
        case StokKoduTipi.Baslangic:
          this.txtStokKoduBasla.Text = strStokKodu;
          break;
        case StokKoduTipi.Bitis:
          this.txtStokKoduBitis.Text = strStokKodu;
          break;
      }
    }
  }
}
