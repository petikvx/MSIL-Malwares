// Decompiled with JetBrains decompiler
// Type: Stub.cTripleDES
// Assembly: Stub, Version=2.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: E9A80B8B-DA65-4E8F-B484-F29861261390
// Assembly location: C:\Users\Administrateur\Desktop\Virusshare-00005-msil\Virus.Win32.Sality.sil-0ca7bb1c2958df0da5225958a1edc77b6cada207469cb6869e1671d557471a16.exe

using Microsoft.VisualBasic;
using Microsoft.VisualBasic.CompilerServices;
using System;
using System.IO;
using System.Security.Cryptography;
using System.Text;

namespace Stub
{
  internal class cTripleDES
  {
    private TripleDESCryptoServiceProvider m_des;
    private UTF8Encoding m_utf8;
    private byte[] m_key;
    private byte[] m_iv;

    public cTripleDES(byte[] key, byte[] iv)
    {
      this.m_des = new TripleDESCryptoServiceProvider();
      this.m_utf8 = new UTF8Encoding();
      this.m_key = key;
      this.m_iv = iv;
    }

    public byte[] Encrypt(byte[] input) => this.Transform(input, this.m_des.CreateEncryptor(this.m_key, this.m_iv));

    public byte[] Decrypt(byte[] input) => this.Transform(input, this.m_des.CreateDecryptor(this.m_key, this.m_iv));

    public string Encrypt(string text) => Convert.ToBase64String(this.Transform(this.m_utf8.GetBytes(text), this.m_des.CreateEncryptor(this.m_key, this.m_iv)));

    public string Decrypt(string text)
    {
      string str;
      try
      {
        str = this.m_utf8.GetString(this.Transform(Convert.FromBase64String(text), this.m_des.CreateDecryptor(this.m_key, this.m_iv)));
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        int num = (int) Interaction.MsgBox((object) "Error, Please check your characters.");
        ProjectData.ClearProjectError();
      }
      return str;
    }

    private byte[] Transform(byte[] input, ICryptoTransform CryptoTransform)
    {
      MemoryStream memoryStream = new MemoryStream();
      CryptoStream cryptoStream = new CryptoStream((Stream) memoryStream, CryptoTransform, CryptoStreamMode.Write);
      cryptoStream.Write(input, 0, input.Length);
      cryptoStream.FlushFinalBlock();
      memoryStream.Position = 0L;
      byte[] buffer = new byte[checked ((int) (memoryStream.Length - 1L) + 1)];
      memoryStream.Read(buffer, 0, buffer.Length);
      memoryStream.Close();
      cryptoStream.Close();
      return buffer;
    }
  }
}
