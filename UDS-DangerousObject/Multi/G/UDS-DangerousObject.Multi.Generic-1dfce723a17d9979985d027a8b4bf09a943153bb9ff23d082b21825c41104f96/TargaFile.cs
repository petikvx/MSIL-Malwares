// Decompiled with JetBrains decompiler
// Type: eg2012.TargaFile
// Assembly: SinkStack, Version=2.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: A02AD0B4-EB98-42A4-95E2-E2AB11E6E27B
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.06-msil\UDS-DangerousObject.Multi.Generic-1dfce723a17d9979985d027a8b4bf09a943153bb9ff23d082b21825c41104f96.exe

using System;
using System.Drawing;
using System.Drawing.Imaging;
using System.IO;
using System.Runtime.InteropServices;

namespace eg2012
{
  public class TargaFile
  {
    public static void SaveAsTarga(string Filename, Bitmap Picture)
    {
      Bitmap bitmap = Picture.Clone(new Rectangle(0, 0, Picture.Width, Picture.Height), PixelFormat.Format32bppPArgb);
      bitmap.RotateFlip(RotateFlipType.Rotate180FlipX);
      using (FileStream output = new FileStream(Filename, FileMode.Create, FileAccess.Write))
      {
        using (BinaryWriter binaryWriter = new BinaryWriter((Stream) output))
        {
          short num1 = 0;
          binaryWriter.Write((byte) 0);
          binaryWriter.Write((byte) 0);
          binaryWriter.Write((byte) 2);
          binaryWriter.Write(num1);
          binaryWriter.Write(num1);
          binaryWriter.Write((byte) 0);
          binaryWriter.Write(num1);
          binaryWriter.Write(num1);
          short width = checked ((short) bitmap.Width);
          binaryWriter.Write(width);
          short height = checked ((short) bitmap.Height);
          binaryWriter.Write(height);
          binaryWriter.Write((byte) 32);
          binaryWriter.Write((byte) 8);
          BitmapData bitmapdata = bitmap.LockBits(new Rectangle(0, 0, bitmap.Width, bitmap.Height), ImageLockMode.ReadOnly, PixelFormat.Format32bppPArgb);
          IntPtr scan0 = bitmapdata.Scan0;
          int length = checked (bitmapdata.Stride * bitmap.Height);
          byte[] numArray = new byte[checked (length - 1 + 1)];
          Marshal.Copy(scan0, numArray, 0, length);
          binaryWriter.Write(numArray);
          bitmap.UnlockBits(bitmapdata);
          int num2 = 0;
          binaryWriter.Write(num2);
          binaryWriter.Write(num2);
          binaryWriter.Write("TRUEVISION-XFILE.");
          binaryWriter.Write((byte) 0);
          bitmap.Dispose();
          binaryWriter.Flush();
          output.Flush();
          binaryWriter.Close();
          output.Close();
        }
      }
    }
  }
}
