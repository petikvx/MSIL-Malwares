// Decompiled with JetBrains decompiler
// Type: s741627039812349.s073460428085580
// Assembly: s968508024776124, Version=2.0.47.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
// MVID: E3596912-35E7-405B-A05A-F5F12AB5E292
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.04\HEUR-Trojan.MSIL.PowerShell.gen-b1729c7ae8423cc844b16aa10ca8ddd2b2331adbfb6646d80d73381fbc73a109.exe

using FastSerialization;
using s009907969975747;
using s035632872522336;
using s528813736053581;
using s742632018787840;
using s859483659459112;
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Globalization;
using System.IO;
using System.Text;
using System.Text.RegularExpressions;
using System.Xml;

namespace s741627039812349
{
  public sealed class s073460428085580 : IFastSerializable
  {
    private XmlReader s429118320675278;
    private byte[] s785279827881357;
    private byte s188531940362748;
    private byte s662681822080236;
    private s089193367613511.s896777389041752 s704732953080126;
    private string s941165595487447;
    private Guid s440497332162865;
    private string s105574425351244;
    private int s320687316667110;
    private string s220506013442530;
    private bool s557287078406538;
    private Exception s270482419478481;

    public s073460428085580(Stream manifestStream, int manifestLen = 2147483647)
    {
      // ISSUE: unable to decompile the method.
    }

    public s073460428085580(string manifestFilePath)
    {
      // ISSUE: unable to decompile the method.
    }

    public void s766628135810357() => this.s025516284684598((Func<s244632129848843, s600954608090611>) (s991473019296685 => s600954608090611.AcceptEvent), false);

    public void s008870034443075(Stream s030792176995212) => s030792176995212.Write(this.s785279827881357, 0, this.s785279827881357.Length);

    public void s401999924786713(string s534474526902734)
    {
      using (FileStream s030792176995212 = File.Create(s534474526902734))
        this.s008870034443075((Stream) s030792176995212);
    }

    public bool s864530122530909 { get; internal set; }

    public string s895558125260583
    {
      get
      {
        if (!this.s557287078406538)
          this.s258267327106375();
        return this.s105574425351244;
      }
    }

    public Guid s364075289213431
    {
      get
      {
        if (!this.s557287078406538)
          this.s258267327106375();
        return this.s440497332162865;
      }
    }

    public int s279861418496957
    {
      get
      {
        if (this.s320687316667110 == 0)
        {
          try
          {
            XmlReader s262431216637354 = this.s262431216637354;
            int num = 0;
            while (s262431216637354.Read())
            {
              if (s262431216637354.NodeType == XmlNodeType.Element && s262431216637354.Name == "event")
              {
                ++this.s320687316667110;
                string attribute1 = s262431216637354.GetAttribute("version");
                int result1;
                if (attribute1 != null && int.TryParse(attribute1, out result1))
                  this.s320687316667110 += result1;
                string attribute2 = s262431216637354.GetAttribute("value");
                int result2;
                if (attribute2 != null && int.TryParse(attribute2, out result2) && result2 > num)
                  num = result2;
              }
            }
            this.s320687316667110 += num * 100;
          }
          catch (Exception ex)
          {
            this.s270482419478481 = ex;
            this.s320687316667110 = -1;
          }
        }
        return this.s320687316667110;
      }
    }

    public string s576078539464758 => this.s941165595487447;

    public bool s278488673950704(s073460428085580 s426140654460838)
    {
      int s279861418496957_1 = this.s279861418496957;
      int s279861418496957_2 = s426140654460838.s279861418496957;
      return s279861418496957_1 != s279861418496957_2 ? s279861418496957_1 > s279861418496957_2 : this.s785279827881357.Length > s426140654460838.s785279827881357.Length;
    }

    public string s706341241397245 => Encoding.UTF8.GetString(this.s785279827881357);

    public XmlReader s262431216637354 => XmlReader.Create((Stream) new MemoryStream(this.s785279827881357), new XmlReaderSettings()
    {
      IgnoreComments = true,
      IgnoreWhitespace = true
    });

    public virtual string s072723389400731() => this.s895558125260583 + " " + (object) this.s364075289213431;

    internal s073460428085580(
      byte[] serializedManifest,
      s089193367613511.s896777389041752 format,
      byte majorVersion,
      byte minorVersion,
      string id)
    {
      // ISSUE: unable to decompile the method.
    }

    internal void s025516284684598(
      Func<s244632129848843, s600954608090611> s846971287927887,
      bool s070664160797727)
    {
      if (this.s270482419478481 == null)
      {
        this.s258267327106375();
        try
        {
          Dictionary<string, int> dictionary1 = new Dictionary<string, int>();
          dictionary1.Add("win:Info", 0);
          dictionary1.Add("win:Start", 1);
          dictionary1.Add("win:Stop", 2);
          dictionary1.Add("win:DC_Start", 3);
          dictionary1.Add("win:DC_Stop", 4);
          dictionary1.Add("win:Extension", 5);
          dictionary1.Add("win:Reply", 6);
          dictionary1.Add("win:Resume", 7);
          dictionary1.Add("win:Suspend", 8);
          dictionary1.Add("win:Send", 9);
          dictionary1.Add("win:Receive", 240);
          Dictionary<string, s073460428085580.s502309271459506> dictionary2 = new Dictionary<string, s073460428085580.s502309271459506>();
          Dictionary<string, s073460428085580.s905509080685543> dictionary3 = new Dictionary<string, s073460428085580.s905509080685543>();
          Dictionary<string, IDictionary<long, string>> s222366858557181 = (Dictionary<string, IDictionary<long, string>>) null;
          Dictionary<string, string> dictionary4 = new Dictionary<string, string>();
          List<s073460428085580.s724692508641558> s724692508641558List = new List<s073460428085580.s724692508641558>();
          bool flag1 = false;
          string strA = (string) null;
          bool flag2 = false;
          while (this.s429118320675278.Read())
          {
            if (this.s429118320675278.NodeType != XmlNodeType.EndElement && this.s429118320675278.Name == "events")
              flag2 = false;
            if (this.s429118320675278.NodeType == XmlNodeType.Element)
            {
              try
              {
                string name1 = this.s429118320675278.Name;
                IDictionary<long, string> dictionary5;
                // ISSUE: reference to a compiler-generated method
                switch (s436242968473850.s836626314656159(name1))
                {
                  case 316203908:
                    if (name1 == "events")
                    {
                      flag2 = true;
                      continue;
                    }
                    continue;
                  case 398550328:
                    if (name1 == "string")
                    {
                      if (!flag1)
                      {
                        dictionary4[this.s429118320675278.GetAttribute("id")] = this.s429118320675278.GetAttribute("value");
                        continue;
                      }
                      continue;
                    }
                    continue;
                  case 1206144148:
                    if (name1 == "valueMap")
                    {
                      dictionary5 = (IDictionary<long, string>) new Dictionary<long, string>();
                      break;
                    }
                    continue;
                  case 1766500875:
                    if (name1 == "template")
                    {
                      string attribute = this.s429118320675278.GetAttribute("tid");
                      using (XmlReader s696599070184316 = this.s429118320675278.ReadSubtree())
                      {
                        dictionary3[attribute] = s073460428085580.s957032429302786(s696599070184316, s222366858557181);
                        continue;
                      }
                    }
                    else
                      continue;
                  case 1893056498:
                    if (name1 == "resources")
                    {
                      if (!flag1)
                      {
                        string name2 = CultureInfo.CurrentCulture.Name;
                        if (strA != null && string.Compare(strA, name2, StringComparison.OrdinalIgnoreCase) == 0)
                          flag1 = true;
                        strA = this.s429118320675278.GetAttribute("culture");
                        continue;
                      }
                      continue;
                    }
                    continue;
                  case 2849802023:
                    if (name1 == "opcode")
                    {
                      dictionary1[this.s429118320675278.GetAttribute("name")] = int.Parse(this.s429118320675278.GetAttribute("value"));
                      continue;
                    }
                    continue;
                  case 3821645446:
                    if (name1 == "bitMap")
                    {
                      dictionary5 = (IDictionary<long, string>) new SortedDictionary<long, string>();
                      break;
                    }
                    continue;
                  case 4098394220:
                    if (name1 == "task")
                    {
                      s073460428085580.s502309271459506 s502309271459506 = (s073460428085580.s502309271459506) new s073460428085580.s724692508641558();
                      ((s073460428085580.s724692508641558) s502309271459506).s137438597062342 = int.Parse(this.s429118320675278.GetAttribute("value"));
                      string attribute = this.s429118320675278.GetAttribute("eventGUID");
                      if (attribute != null)
                        s502309271459506.s559919020366190 = new Guid(attribute);
                      dictionary2[this.s429118320675278.GetAttribute("name")] = s502309271459506;
                      continue;
                    }
                    continue;
                  case 4264611999:
                    if (name1 == "event")
                    {
                      if (flag2)
                      {
                        int task = 0;
                        Guid taskGuid = Guid.Empty;
                        int eventID = int.Parse(this.s429118320675278.GetAttribute("value"));
                        int opcode = 0;
                        string str1 = this.s429118320675278.GetAttribute("opcode");
                        if (str1 != null)
                        {
                          dictionary1.TryGetValue(str1, out opcode);
                          int num = str1.IndexOf(':');
                          if (num >= 0)
                            str1 = str1.Substring(num + 1);
                        }
                        else
                          str1 = "";
                        string str2 = this.s429118320675278.GetAttribute("task");
                        if (str2 != null)
                        {
                          s073460428085580.s502309271459506 s502309271459506;
                          if (dictionary2.TryGetValue(str2, out s502309271459506))
                          {
                            task = ((s073460428085580.s724692508641558) s502309271459506).s137438597062342;
                            taskGuid = s502309271459506.s559919020366190;
                          }
                        }
                        else
                        {
                          str2 = "";
                          string attribute = this.s429118320675278.GetAttribute("symbol");
                          if (attribute != null && str1 == "")
                            str2 = attribute;
                        }
                        s244632129848843 eventTemplate = new s244632129848843((Action<s034852122986107>) null, eventID, task, str2, taskGuid, opcode, str1, this.s364075289213431, this.s895558125260583);
                        // ISSUE: object of a compiler-generated type is created
                        s724692508641558List.Add((s073460428085580.s724692508641558) new s244632129848843.s532146059604485(eventTemplate, this.s429118320675278.GetAttribute("template")));
                        eventTemplate.s614187586217155 = this.s429118320675278.GetAttribute("message");
                        continue;
                      }
                      continue;
                    }
                    continue;
                  default:
                    continue;
                }
                string attribute1 = this.s429118320675278.GetAttribute("name");
                using (XmlReader xmlReader = this.s429118320675278.ReadSubtree())
                {
                  while (xmlReader.Read())
                  {
                    if (xmlReader.Name == "map")
                    {
                      string attribute2 = this.s429118320675278.GetAttribute("value");
                      long key;
                      if (attribute2.StartsWith("0x", StringComparison.OrdinalIgnoreCase))
                      {
                        key = 0L;
                        if (attribute2.Length > 2)
                          key = long.Parse(attribute2.Substring(2), NumberStyles.AllowHexSpecifier);
                      }
                      else
                        key = long.Parse(attribute2);
                      string attribute3 = this.s429118320675278.GetAttribute("message");
                      dictionary5[key] = attribute3;
                    }
                  }
                }
                if (s222366858557181 == null)
                  s222366858557181 = new Dictionary<string, IDictionary<long, string>>();
                s222366858557181[attribute1] = dictionary5;
              }
              catch (Exception ex)
              {
                Trace.WriteLine("An exception occurred while processing the manifest: " + ex.Message);
                Trace.WriteLine("Trying to continue reading, to get a partial result but it is only a best effort.");
              }
            }
          }
          if (s222366858557181 != null)
          {
            foreach (IDictionary<long, string> collection in s222366858557181.Values)
            {
              foreach (KeyValuePair<long, string> keyValuePair in new List<KeyValuePair<long, string>>((IEnumerable<KeyValuePair<long, string>>) collection))
              {
                Match match = Regex.Match(keyValuePair.Value, "^\\$\\(string\\.(.*)\\)$");
                string str;
                if (match.Success && dictionary4.TryGetValue(match.Groups[1].Value, out str))
                  collection[keyValuePair.Key] = str;
              }
            }
          }
          this.s429118320675278 = (XmlReader) null;
          foreach (s073460428085580.s724692508641558 s724692508641558 in s724692508641558List)
          {
            // ISSUE: reference to a compiler-generated field
            s244632129848843 s647150909454669 = ((s244632129848843.s532146059604485) s724692508641558).s647150909454669;
            if (s724692508641558.s173742455960278 != null)
            {
              s073460428085580.s905509080685543 s905509080685543 = dictionary3[s724692508641558.s173742455960278];
              s647150909454669.payloadNames = ((s073460428085580.s502309271459506) s905509080685543).s096317096709211.ToArray();
              s647150909454669.s463622614246125 = s905509080685543.s249269239080602.ToArray();
            }
            else
            {
              s647150909454669.payloadNames = new string[0];
              s647150909454669.s463622614246125 = new s244632129848843.s450921180926046[0];
            }
            string s614187586217155 = s647150909454669.s614187586217155;
            if (s614187586217155 != null)
            {
              s647150909454669.s614187586217155 = (string) null;
              Match match = Regex.Match(s614187586217155, "^\\$\\(string\\.(.*)\\)$");
              if (match.Success)
                dictionary4.TryGetValue(match.Groups[1].Value, out s647150909454669.s614187586217155);
            }
            if (s846971287927887(s647150909454669) == s600954608090611.RejectProvider)
              return;
          }
          int num1 = (int) s846971287927887((s244632129848843) new s390050194578653((Action<s034852122986107>) null, this));
        }
        catch (Exception ex)
        {
          Trace.WriteLine("Error parsing the manifest for the provider " + (this.s105574425351244 ?? "UNKNOWN") + " " + ex.ToString());
          this.s320687316667110 = -1;
          this.s270482419478481 = ex;
        }
      }
      if (!s070664160797727 && this.s270482419478481 != null)
        throw new ApplicationException("Error parsing the manifest for the provider " + (this.s105574425351244 ?? "UNKNOWN"), this.s270482419478481);
    }

    private static s073460428085580.s905509080685543 s957032429302786(
      XmlReader s696599070184316,
      Dictionary<string, IDictionary<long, string>> s222366858557181)
    {
      s073460428085580.s905509080685543 s905509080685543 = (s073460428085580.s905509080685543) new s073460428085580.s502309271459506();
      ((s073460428085580.s502309271459506) s905509080685543).s096317096709211 = new List<string>();
      s905509080685543.s249269239080602 = new List<s244632129848843.s450921180926046>();
      ushort num = 0;
      while (s696599070184316.Read())
      {
        if (s696599070184316.NodeType == XmlNodeType.Element && s696599070184316.Name == "data")
        {
          string attribute1 = s696599070184316.GetAttribute("inType");
          Type type = s073460428085580.s518738856162156(attribute1);
          if (type == (Type) null)
          {
            Trace.WriteLine("Found an unsupported type " + attribute1 + " skipping all fields after that.");
            break;
          }
          ushort size = s244632129848843.s323173860836894(type);
          if (type == typeof (string) && attribute1 == "win:AnsiString")
            size = (ushort) 65519;
          string attribute2 = s696599070184316.GetAttribute("name");
          IDictionary<long, string> map = (IDictionary<long, string>) null;
          string attribute3 = s696599070184316.GetAttribute("map");
          if (attribute3 != null && s222366858557181 != null)
            s222366858557181.TryGetValue(attribute3, out map);
          s244632129848843.s450921180926046 s966790988663901;
          // ISSUE: explicit constructor call
          ((s244632129848843.s719766275477698) ref s966790988663901).\u002Ector(num, size, type, map);
          if (attribute1 == "win:Binary")
          {
            int index = ((s073460428085580.s502309271459506) s905509080685543).s096317096709211.Count - 1;
            string attribute4 = s696599070184316.GetAttribute("length");
            if (attribute4 != null && 0 <= index && attribute4 == ((s073460428085580.s502309271459506) s905509080685543).s096317096709211[index] && (s905509080685543.s249269239080602[index].s736517469557712 == typeof (int) || s905509080685543.s249269239080602[index].s736517469557712 == typeof (uint)))
            {
              if (num != ushort.MaxValue)
                num -= (ushort) 4;
              ((s073460428085580.s502309271459506) s905509080685543).s096317096709211.RemoveAt(index);
              s905509080685543.s249269239080602.RemoveAt(index);
              ushort s922631870052772 = 65534;
              s966790988663901 = s244632129848843.s450921180926046.s233973776017244(num, s966790988663901, s922631870052772);
              size = s966790988663901.s699859390312039;
            }
            else
            {
              Trace.WriteLine("Only support win:Binary with preceding length fields");
              break;
            }
          }
          ((s073460428085580.s502309271459506) s905509080685543).s096317096709211.Add(attribute2);
          s905509080685543.s249269239080602.Add(s966790988663901);
          if (num != ushort.MaxValue)
          {
            if (size < (ushort) 65516)
              num += size;
            else
              num = ushort.MaxValue;
          }
        }
      }
      return s905509080685543;
    }

    private static Type s518738856162156(string s722840672040822)
    {
      // ISSUE: reference to a compiler-generated method
      switch (s436242968473850.s836626314656159(s722840672040822))
      {
        case 506001345:
          if (s722840672040822 == "win:Float")
            return typeof (float);
          goto default;
        case 546717116:
          if (s722840672040822 == "trace:    ")
            goto label_30;
          else
            goto default;
        case 604520517:
          if (s722840672040822 == "win:UnicodeString")
            goto label_35;
          else
            goto default;
        case 646461366:
          if (s722840672040822 == "win:Int8")
            return typeof (sbyte);
          goto default;
        case 893326335:
          if (s722840672040822 == "win:AnsiString")
            goto label_35;
          else
            goto default;
        case 914406827:
          if (s722840672040822 == "win:Int32")
            return typeof (int);
          goto default;
        case 1135530675:
          if (s722840672040822 == "trace:SizeT")
            break;
          goto default;
        case 1176178614:
          if (s722840672040822 == "win:UInt16")
            goto label_28;
          else
            goto default;
        case 1339804294:
          if (s722840672040822 == "win:Pointer")
            break;
          goto default;
        case 1377804232:
          if (s722840672040822 == "win:UInt32")
            goto label_30;
          else
            goto default;
        case 1385948400:
          if (s722840672040822 == "trace:IPAddrV4")
            goto label_30;
          else
            goto default;
        case 1496076995:
          if (s722840672040822 == "win:Boolean")
            return typeof (bool);
          goto default;
        case 2295767560:
          if (s722840672040822 == "win:GUID")
            return typeof (Guid);
          goto default;
        case 2793941440:
          if (s722840672040822 == "win:Int64")
            goto label_31;
          else
            goto default;
        case 2860904821:
          if (s722840672040822 == "win:Int16")
            return typeof (short);
          goto default;
        case 2889304788:
          if (s722840672040822 == "win:Double")
            return typeof (double);
          goto default;
        case 3066647927:
          if (s722840672040822 == "trace:Port")
            goto label_28;
          else
            goto default;
        case 3153072174:
          if (s722840672040822 == "win:FILETIME")
            return typeof (DateTime);
          goto default;
        case 3216400822:
          if (s722840672040822 == "trace:WmiTime")
            goto label_31;
          else
            goto default;
        case 3323463583:
          if (s722840672040822 == "win:UInt64")
            return typeof (ulong);
          goto default;
        case 3458649784:
          if (s722840672040822 == "win:Binary")
            return typeof (byte);
          goto default;
        case 3698774015:
          if (s722840672040822 == "win:UInt8")
            return typeof (byte);
          goto default;
        default:
          return (Type) null;
      }
      return typeof (IntPtr);
label_28:
      return typeof (ushort);
label_30:
      return typeof (uint);
label_31:
      return typeof (long);
label_35:
      return typeof (string);
    }

    void IFastSerializable.s973673643436442(Serializer s640528039260291)
    {
      // ISSUE: unable to decompile the method.
    }

    void IFastSerializable.s497036419315105(Deserializer s622793665174569)
    {
      // ISSUE: unable to decompile the method.
    }

    private void s258267327106375()
    {
      try
      {
        this.s429118320675278 = this.s262431216637354;
        while (this.s429118320675278.Read())
        {
          if (this.s429118320675278.NodeType == XmlNodeType.Element && this.s429118320675278.Name == "provider")
          {
            this.s440497332162865 = new Guid(this.s429118320675278.GetAttribute("guid"));
            this.s105574425351244 = this.s429118320675278.GetAttribute("name");
            this.s220506013442530 = this.s429118320675278.GetAttribute("resourceFileName");
            break;
          }
        }
        if (this.s105574425351244 == null)
          throw new Exception("No provider element found in manifest");
      }
      catch (Exception ex)
      {
        this.s105574425351244 = "";
        this.s270482419478481 = ex;
      }
      this.s557287078406538 = true;
    }

    private class s724692508641558
    {
      public string s173742455960278;
      public int s137438597062342;
    }

    private class s502309271459506
    {
      public Guid s559919020366190;
      public List<string> s096317096709211;
    }

    private class s905509080685543
    {
      public List<s244632129848843.s450921180926046> s249269239080602;
      public static readonly s073460428085580.s418373178063562 s485166350567587 = new s073460428085580.s418373178063562();
    }
  }
}
