// Decompiled with JetBrains decompiler
// Type: Server.Forms.FormChat
// Assembly: AsyncRAT, Version=0.5.7.0, Culture=neutral, PublicKeyToken=null
// MVID: 51786A10-CF9D-455B-B8A4-B82CB9EDE322
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.04\HEUR-HackTool.MSIL.Alien.gen-bb1f2c2c9b279790b67eaea6ab0bbce3a4d4432bbe1bd716750f2f9ba3337f7e.exe

using Microsoft.VisualBasic;
using Server.Algorithm;
using Server.Connection;
using Server.MessagePack;
using System;
using System.ComponentModel;
using System.Drawing;
using System.Threading;
using System.Windows.Forms;

namespace Server.Forms
{
  public class FormChat : Form
  {
    private string Nickname = "Admin";
    private IContainer components;
    public RichTextBox richTextBox1;
    public System.Windows.Forms.Timer timer1;
    public TextBox textBox1;

    public Form1 F { get; set; }

    internal Clients ParentClient { get; set; }

    internal Clients Client { get; set; }

    public FormChat() => this.InitializeComponent();

    private void TextBox1_KeyDown(object sender, KeyEventArgs e)
    {
      if (!this.textBox1.Enabled || e.KeyData != Keys.Return || string.IsNullOrWhiteSpace(this.textBox1.Text))
        return;
      this.richTextBox1.AppendText("ME: " + this.textBox1.Text + Environment.NewLine);
      MsgPack msgPack = new MsgPack();
      msgPack.ForcePathObject("Packet").AsString = "chatWriteInput";
      msgPack.ForcePathObject("Input").AsString = this.Nickname + ": " + this.textBox1.Text;
      ThreadPool.QueueUserWorkItem(new WaitCallback(this.Client.Send), (object) msgPack.Encode2Bytes());
      this.textBox1.Clear();
    }

    private void FormChat_Load(object sender, EventArgs e)
    {
      string str = Interaction.InputBox("TYPE YOUR NICKNAME", "CHAT", "Admin");
      if (string.IsNullOrEmpty(str))
      {
        this.Close();
      }
      else
      {
        this.Nickname = str;
        MsgPack msgPack = new MsgPack();
        msgPack.ForcePathObject("Packet").AsString = "plugin";
        msgPack.ForcePathObject("Dll").AsString = GetHash.GetChecksum("Plugins\\Chat.dll");
        ThreadPool.QueueUserWorkItem(new WaitCallback(this.ParentClient.Send), (object) msgPack.Encode2Bytes());
      }
    }

    private void FormChat_FormClosed(object sender, FormClosedEventArgs e)
    {
      if (this.Client == null)
        return;
      try
      {
        MsgPack msgPack = new MsgPack();
        msgPack.ForcePathObject("Packet").AsString = "chatExit";
        ThreadPool.QueueUserWorkItem(new WaitCallback(this.Client.Send), (object) msgPack.Encode2Bytes());
      }
      catch
      {
      }
    }

    private void Timer1_Tick(object sender, EventArgs e)
    {
      try
      {
        if (this.ParentClient.TcpClient.Connected && this.Client.TcpClient.Connected)
          return;
        this.Close();
      }
      catch
      {
      }
    }

    protected override void Dispose(bool disposing)
    {
      if (disposing && this.components != null)
        this.components.Dispose();
      base.Dispose(disposing);
    }

    private void InitializeComponent()
    {
      this.components = (IContainer) new Container();
      ComponentResourceManager componentResourceManager = new ComponentResourceManager(typeof (FormChat));
      this.richTextBox1 = new RichTextBox();
      this.textBox1 = new TextBox();
      this.timer1 = new System.Windows.Forms.Timer(this.components);
      this.SuspendLayout();
      this.richTextBox1.Anchor = AnchorStyles.Top | AnchorStyles.Bottom | AnchorStyles.Left | AnchorStyles.Right;
      this.richTextBox1.BackColor = SystemColors.Window;
      this.richTextBox1.BorderStyle = BorderStyle.None;
      this.richTextBox1.Location = new Point(12, 12);
      this.richTextBox1.Name = "richTextBox1";
      this.richTextBox1.ReadOnly = true;
      this.richTextBox1.Size = new Size(733, 351);
      this.richTextBox1.TabIndex = 0;
      this.richTextBox1.Text = "";
      this.textBox1.Dock = DockStyle.Bottom;
      this.textBox1.Enabled = false;
      this.textBox1.Location = new Point(0, 384);
      this.textBox1.Name = "textBox1";
      this.textBox1.Size = new Size(757, 26);
      this.textBox1.TabIndex = 1;
      this.textBox1.KeyDown += new KeyEventHandler(this.TextBox1_KeyDown);
      this.timer1.Interval = 1000;
      this.timer1.Tick += new EventHandler(this.Timer1_Tick);
      this.AutoScaleDimensions = new SizeF(9f, 20f);
      this.AutoScaleMode = AutoScaleMode.Font;
      this.BackColor = SystemColors.Window;
      this.ClientSize = new Size(757, 410);
      this.Controls.Add((Control) this.textBox1);
      this.Controls.Add((Control) this.richTextBox1);
      this.Icon = (Icon) componentResourceManager.GetObject("$this.Icon");
      this.Name = nameof (FormChat);
      this.Text = nameof (FormChat);
      this.FormClosed += new FormClosedEventHandler(this.FormChat_FormClosed);
      this.Load += new EventHandler(this.FormChat_Load);
      this.ResumeLayout(false);
      this.PerformLayout();
    }
  }
}
