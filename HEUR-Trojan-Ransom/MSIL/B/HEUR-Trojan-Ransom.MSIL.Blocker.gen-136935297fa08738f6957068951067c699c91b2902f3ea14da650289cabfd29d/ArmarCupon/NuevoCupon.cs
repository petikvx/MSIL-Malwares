// Decompiled with JetBrains decompiler
// Type: Coache.ArmarCupon.NuevoCupon
// Assembly: IsCopyConstruc, Version=5.6.2.1, Culture=neutral, PublicKeyToken=null
// MVID: 1DA50973-FF9A-4563-8B8F-74E2573677DF
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.02-msil\HEUR-Trojan-Ransom.MSIL.Blocker.gen-136935297fa08738f6957068951067c699c91b2902f3ea14da650289cabfd29d.exe

using Coache.Business;
using Coache.Common;
using Coache.Core;
using System;
using System.ComponentModel;
using System.Configuration;
using System.Drawing;
using System.Linq;
using System.Windows.Forms;

namespace Coache.ArmarCupon
{
  [NonNavigable]
  public class NuevoCupon : Form
  {
    private double _precio;
    private double _precioFicticio;
    private int _cantidad;
    private int _cantidadPorUsuario;
    private IContainer components;
    private Label label3;
    private Label label2;
    private TextBox txtCodigo;
    private Label label1;
    private Button btnCancel;
    private Button btnSave;
    private DateTimePicker dtpFechaPublicacion;
    private DateTimePicker dtpFechaVigencia;
    private DateTimePicker dtpFechaVencimiento;
    private Label label4;
    private TextBox txtPrecio;
    private Label label5;
    private TextBox txtPrecioOriginal;
    private Label label6;
    private TextBox txtCantidad;
    private Label label7;
    private TextBox txtCantidadPorUsuario;
    private Label label8;
    private Label cities;
    private CheckedListBox clbCiudades;
    private TextBox txtDescripcion;
    private Label label9;

    public event EventHandler<CuponSavedEventArgs> OnCuponSaved;

    public NuevoCupon()
    {
      this.InitializeComponent();
      new CiudadesManager().GetAll().ForEach((Action<City>) (x => this.clbCiudades.Items.Add((object) x, false)));
      this.clbCiudades.DisplayMember = "Name";
    }

    private void btnCancel_Click(object sender, EventArgs e) => this.Close();

    private void NuevoCupon_Load(object sender, EventArgs e) => this.txtCodigo.Text = CuponManager.GetCodigo();

    private void btnSave_Click(object sender, EventArgs e)
    {
      if (!this.Validate())
        return;
      Cupon cupon1 = new Cupon();
      cupon1.Cantidad = this._cantidad;
      cupon1.CantidadPorUsuario = this._cantidadPorUsuario;
      cupon1.Ciudades = this.clbCiudades.CheckedItems.OfType<City>().ToList<City>();
      cupon1.Codigo = this.txtCodigo.Text;
      cupon1.Descripcion = this.txtDescripcion.Text;
      cupon1.FechaPublicacion = this.dtpFechaPublicacion.Value;
      cupon1.FechaVencimientoConsumo = this.dtpFechaVencimiento.Value;
      cupon1.FechaVencimientoOferta = this.dtpFechaVigencia.Value;
      cupon1.Precio = this._precio;
      cupon1.PrecioOriginal = this._precioFicticio;
      Proveedor proveedor = new Proveedor();
      proveedor.UserID = Session.User.UserID;
      proveedor.UserName = Session.User.UserName;
      cupon1.Proveedor = proveedor;
      cupon1.Publicado = false;
      Cupon cupon2 = cupon1;
      if (this.OnCuponSaved == null)
        return;
      this.OnCuponSaved((object) this, new CuponSavedEventArgs()
      {
        Cupon = cupon2
      });
    }

    private new bool Validate()
    {
      DateTime dateTime = Convert.ToDateTime(ConfigurationManager.AppSettings["FechaSistema"]);
      if (this.dtpFechaPublicacion.Value < dateTime)
      {
        int num = (int) MessageBox.Show(string.Format("La fecha de publicación no puede ser menor a ", (object) dateTime.ToShortDateString()));
        return false;
      }
      if (this.dtpFechaVigencia.Value < this.dtpFechaPublicacion.Value)
      {
        int num = (int) MessageBox.Show("La fecha de vigencia no puede ser menor a la fecha de publicación");
        return false;
      }
      if (this.dtpFechaVencimiento.Value < this.dtpFechaVigencia.Value)
      {
        int num = (int) MessageBox.Show("La fecha de vencimiento no puede ser menor a la fecha de vigencia");
        return false;
      }
      if (!double.TryParse(this.txtPrecio.Text, out this._precio))
      {
        int num = (int) MessageBox.Show("El precio real debe ser numérico");
        return false;
      }
      if (!double.TryParse(this.txtPrecioOriginal.Text, out this._precioFicticio))
      {
        int num = (int) MessageBox.Show("El precio ficticio debe ser numérico");
        return false;
      }
      if (!int.TryParse(this.txtCantidad.Text, out this._cantidad))
      {
        int num = (int) MessageBox.Show("La cantidad de cupones disponibles debe ser numérica");
        return false;
      }
      if (!int.TryParse(this.txtCantidadPorUsuario.Text, out this._cantidadPorUsuario))
      {
        int num = (int) MessageBox.Show("La cantidad de cupones por usuario debe ser numérica");
        return false;
      }
      if (this.clbCiudades.CheckedItems.Count != 0)
        return true;
      int num1 = (int) MessageBox.Show("Debe seleccionar al menos una ciudad");
      return false;
    }

    protected override void Dispose(bool disposing)
    {
      if (disposing && this.components != null)
        this.components.Dispose();
      base.Dispose(disposing);
    }

    private void InitializeComponent()
    {
      this.label3 = new Label();
      this.label2 = new Label();
      this.txtCodigo = new TextBox();
      this.label1 = new Label();
      this.btnCancel = new Button();
      this.btnSave = new Button();
      this.dtpFechaPublicacion = new DateTimePicker();
      this.dtpFechaVigencia = new DateTimePicker();
      this.dtpFechaVencimiento = new DateTimePicker();
      this.label4 = new Label();
      this.txtPrecio = new TextBox();
      this.label5 = new Label();
      this.txtPrecioOriginal = new TextBox();
      this.label6 = new Label();
      this.txtCantidad = new TextBox();
      this.label7 = new Label();
      this.txtCantidadPorUsuario = new TextBox();
      this.label8 = new Label();
      this.cities = new Label();
      this.clbCiudades = new CheckedListBox();
      this.txtDescripcion = new TextBox();
      this.label9 = new Label();
      this.SuspendLayout();
      this.label3.AutoSize = true;
      this.label3.Location = new Point(19, 96);
      this.label3.Name = "label3";
      this.label3.Size = new Size(121, 13);
      this.label3.TabIndex = 17;
      this.label3.Text = "Vencimiento de la oferta";
      this.label2.AutoSize = true;
      this.label2.Location = new Point(30, 70);
      this.label2.Name = "label2";
      this.label2.Size = new Size(110, 13);
      this.label2.TabIndex = 15;
      this.label2.Text = "Fecha de Publicación";
      this.txtCodigo.Location = new Point(141, 13);
      this.txtCodigo.Name = "txtCodigo";
      this.txtCodigo.ReadOnly = true;
      this.txtCodigo.Size = new Size(181, 20);
      this.txtCodigo.TabIndex = 14;
      this.label1.AutoSize = true;
      this.label1.Location = new Point(99, 16);
      this.label1.Name = "label1";
      this.label1.Size = new Size(40, 13);
      this.label1.TabIndex = 13;
      this.label1.Text = "Código";
      this.btnCancel.Anchor = AnchorStyles.Bottom | AnchorStyles.Left;
      this.btnCancel.DialogResult = DialogResult.Cancel;
      this.btnCancel.Location = new Point(22, 402);
      this.btnCancel.Name = "btnCancel";
      this.btnCancel.Size = new Size(75, 23);
      this.btnCancel.TabIndex = 12;
      this.btnCancel.Text = "Cancelar";
      this.btnCancel.UseVisualStyleBackColor = true;
      this.btnCancel.Click += new EventHandler(this.btnCancel_Click);
      this.btnSave.Anchor = AnchorStyles.Bottom | AnchorStyles.Right;
      this.btnSave.Location = new Point(247, 402);
      this.btnSave.Name = "btnSave";
      this.btnSave.Size = new Size(75, 23);
      this.btnSave.TabIndex = 11;
      this.btnSave.Text = "Guardar";
      this.btnSave.UseVisualStyleBackColor = true;
      this.btnSave.Click += new EventHandler(this.btnSave_Click);
      this.dtpFechaPublicacion.Format = DateTimePickerFormat.Short;
      this.dtpFechaPublicacion.Location = new Point(141, 67);
      this.dtpFechaPublicacion.Name = "dtpFechaPublicacion";
      this.dtpFechaPublicacion.Size = new Size(181, 20);
      this.dtpFechaPublicacion.TabIndex = 21;
      this.dtpFechaVigencia.Format = DateTimePickerFormat.Short;
      this.dtpFechaVigencia.Location = new Point(141, 93);
      this.dtpFechaVigencia.Name = "dtpFechaVigencia";
      this.dtpFechaVigencia.Size = new Size(181, 20);
      this.dtpFechaVigencia.TabIndex = 22;
      this.dtpFechaVencimiento.Format = DateTimePickerFormat.Short;
      this.dtpFechaVencimiento.Location = new Point(141, 119);
      this.dtpFechaVencimiento.Name = "dtpFechaVencimiento";
      this.dtpFechaVencimiento.Size = new Size(181, 20);
      this.dtpFechaVencimiento.TabIndex = 24;
      this.label4.AutoSize = true;
      this.label4.Location = new Point(11, 122);
      this.label4.Name = "label4";
      this.label4.Size = new Size(128, 13);
      this.label4.TabIndex = 23;
      this.label4.Text = "Vencimiento del consumo";
      this.txtPrecio.Location = new Point(141, 145);
      this.txtPrecio.Name = "txtPrecio";
      this.txtPrecio.Size = new Size(181, 20);
      this.txtPrecio.TabIndex = 26;
      this.label5.AutoSize = true;
      this.label5.Location = new Point(82, 148);
      this.label5.Name = "label5";
      this.label5.Size = new Size(57, 13);
      this.label5.TabIndex = 25;
      this.label5.Text = "Precio real";
      this.txtPrecioOriginal.Location = new Point(141, 171);
      this.txtPrecioOriginal.Name = "txtPrecioOriginal";
      this.txtPrecioOriginal.Size = new Size(181, 20);
      this.txtPrecioOriginal.TabIndex = 28;
      this.label6.AutoSize = true;
      this.label6.Location = new Point(69, 174);
      this.label6.Name = "label6";
      this.label6.Size = new Size(70, 13);
      this.label6.TabIndex = 27;
      this.label6.Text = "Precio ficticio";
      this.txtCantidad.Location = new Point(141, 198);
      this.txtCantidad.Name = "txtCantidad";
      this.txtCantidad.Size = new Size(181, 20);
      this.txtCantidad.TabIndex = 36;
      this.label7.AutoSize = true;
      this.label7.Location = new Point(41, 201);
      this.label7.Name = "label7";
      this.label7.Size = new Size(99, 13);
      this.label7.TabIndex = 35;
      this.label7.Text = "Cantidad disponible";
      this.txtCantidadPorUsuario.Location = new Point(141, 224);
      this.txtCantidadPorUsuario.Name = "txtCantidadPorUsuario";
      this.txtCantidadPorUsuario.Size = new Size(181, 20);
      this.txtCantidadPorUsuario.TabIndex = 38;
      this.label8.AutoSize = true;
      this.label8.Location = new Point(35, 227);
      this.label8.Name = "label8";
      this.label8.Size = new Size(104, 13);
      this.label8.TabIndex = 37;
      this.label8.Text = "Cantidad por usuario";
      this.cities.AutoSize = true;
      this.cities.Location = new Point(27, 250);
      this.cities.Name = "cities";
      this.cities.Size = new Size(108, 13);
      this.cities.TabIndex = 40;
      this.cities.Text = "Zonas de adquisición";
      this.clbCiudades.FormattingEnabled = true;
      this.clbCiudades.Location = new Point(141, 250);
      this.clbCiudades.Name = "clbCiudades";
      this.clbCiudades.Size = new Size(181, 139);
      this.clbCiudades.TabIndex = 39;
      this.txtDescripcion.Location = new Point(141, 40);
      this.txtDescripcion.Name = "txtDescripcion";
      this.txtDescripcion.Size = new Size(181, 20);
      this.txtDescripcion.TabIndex = 42;
      this.label9.AutoSize = true;
      this.label9.Location = new Point(72, 43);
      this.label9.Name = "label9";
      this.label9.Size = new Size(63, 13);
      this.label9.TabIndex = 41;
      this.label9.Text = "Descripción";
      this.AcceptButton = (IButtonControl) this.btnSave;
      this.AutoScaleDimensions = new SizeF(6f, 13f);
      this.AutoScaleMode = AutoScaleMode.Font;
      this.CancelButton = (IButtonControl) this.btnCancel;
      this.ClientSize = new Size(344, 437);
      this.Controls.Add((Control) this.txtDescripcion);
      this.Controls.Add((Control) this.label9);
      this.Controls.Add((Control) this.cities);
      this.Controls.Add((Control) this.clbCiudades);
      this.Controls.Add((Control) this.txtCantidadPorUsuario);
      this.Controls.Add((Control) this.label8);
      this.Controls.Add((Control) this.txtCantidad);
      this.Controls.Add((Control) this.label7);
      this.Controls.Add((Control) this.txtPrecioOriginal);
      this.Controls.Add((Control) this.label6);
      this.Controls.Add((Control) this.txtPrecio);
      this.Controls.Add((Control) this.label5);
      this.Controls.Add((Control) this.dtpFechaVencimiento);
      this.Controls.Add((Control) this.label4);
      this.Controls.Add((Control) this.dtpFechaVigencia);
      this.Controls.Add((Control) this.dtpFechaPublicacion);
      this.Controls.Add((Control) this.label3);
      this.Controls.Add((Control) this.label2);
      this.Controls.Add((Control) this.txtCodigo);
      this.Controls.Add((Control) this.label1);
      this.Controls.Add((Control) this.btnCancel);
      this.Controls.Add((Control) this.btnSave);
      this.Name = nameof (NuevoCupon);
      this.Text = "Nuevo Cupón";
      this.Load += new EventHandler(this.NuevoCupon_Load);
      this.ResumeLayout(false);
      this.PerformLayout();
    }
  }
}
