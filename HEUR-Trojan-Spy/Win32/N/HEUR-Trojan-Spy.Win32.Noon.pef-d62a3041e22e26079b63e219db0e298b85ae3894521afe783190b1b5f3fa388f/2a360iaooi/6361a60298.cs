// Decompiled with JetBrains decompiler
// Type: 2a360iaooi.6361a60298
// Assembly: ao2u718188, Version=0.17.1.12262, Culture=neutral, PublicKeyToken=31bf3856ad364e35
// MVID: 3DF97629-1C85-445F-828B-3AC8EB815CA9
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.04\HEUR-Trojan-Spy.Win32.Noon.pef-d62a3041e22e26079b63e219db0e298b85ae3894521afe783190b1b5f3fa388f.exe

using \u00306uo1e5904;
using \u0032a360iaooi;
using \u0035a6974u213;
using Microsoft.ApplicationInsights.Extensibility.Implementation.Tracing;
using System;
using System.Collections.Generic;
using System.Threading;
using System.Threading.Tasks;
using ue7345a32o;

namespace \u0032a360iaooi
{
  internal class \u0036361a60298 : IDisposable
  {
    private List<\u00348u8a77i8e> \u003583ei8oiu7;
    private ooe0i71e11 \u0032eui05ua22;
    private CancellationTokenSource \u00386aa184oio;
    private Mutex \u0032263ia1i1e;
    private int ai34e4977a;
    private AutoResetEvent \u00377043a1ai3;

    internal string \u00310oie6ou95 => this.\u0032eui05ua22.\u003244i397600;

    internal TimeSpan ooao97a8uo { get; set; }

    public void \u003757oo810i0()
    {
      if (Interlocked.Increment(ref this.ai34e4977a) != 1)
        return;
      this.\u00386aa184oio.Cancel();
      this.\u00386aa184oio.Dispose();
      if (this.\u0032263ia1i1e != null)
        this.\u0032263ia1i1e.Dispose();
      this.\u00377043a1ai3.Dispose();
      this.e5751ie3e8();
    }

    private void \u0038129051u73(Action _param1)
    {
      if (this.\u0032263ia1i1e == null)
        return;
      while (!this.\u00386aa184oio.IsCancellationRequested)
      {
        try
        {
          this.\u0032263ia1i1e.WaitOne();
          if (this.\u00386aa184oio.IsCancellationRequested)
            break;
          if (_param1 != null)
            _param1();
          this.\u00377043a1ai3.WaitOne();
          break;
        }
        catch (AbandonedMutexException ex)
        {
          CoreEventSource.Log.LogVerbose(\u0033457o91ea7.\u0039u51uui516("\u001B\vw(+\nbr\u0011m\".44\u0003Jku\f!p'B\u0019~!7\u0014\f4El4&O]'\u0015z5aq3\u0002\u001C?i\u0011dp \u0013\ru2<P\n.Ey2'Or7\u0002p (q3\u0018\0?|\u001D0x5\aXh28\u001E\u00107\fl(&\u001D>", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"), \u0033457o91ea7.\u0039u51uui516("\u0013\v{31\u001Du1\u0015", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"));
        }
        catch (ObjectDisposedException ex)
        {
          break;
        }
      }
    }

    private void \u0031u05e9a75i(int au73i31476)
    {
      for (int index = 0; index < au73i31476; ++index)
        this.\u003583ei8oiu7.Add((\u00348u8a77i8e) new \u0036361a60298(this.\u0032eui05ua22, this));
    }

    private void e5751ie3e8()
    {
      if (this.\u003583ei8oiu7 == null)
        return;
      List<Task> taskList = new List<Task>();
      foreach (\u00348u8a77i8e obj in this.\u003583ei8oiu7)
        taskList.Add(obj.\u00318u8a434i5());
      Task.WaitAll(taskList.ToArray());
    }

    internal \u0036361a60298(ooe0i71e11 storage, \u0036361a60298 transmitter, bool startSending = true)
    {
      ((\u00348u8a77i8e) this).\u0034aa64e48u7 = TimeSpan.FromSeconds(10.0);
      ((\u00348u8a77i8e) this).\u0036215o59659 = TimeSpan.FromHours(1.0);
      // ISSUE: explicit constructor call
      base.\u002Ector();
      ((\u00348u8a77i8e) this).\u003628oi75ei5 = false;
      ((\u00348u8a77i8e) this).DelayHandler = new AutoResetEvent(false);
      ((\u00348u8a77i8e) this).\u0036e59i9o771 = new AutoResetEvent(false);
      ((\u00348u8a77i8e) this).\u0031508i06867 = TimeSpan.FromSeconds(100.0);
      ((\u00348u8a77i8e) this).\u0038ouu6269e0 = transmitter;
      ((\u00348u8a77i8e) this).i5oee7i799 = storage;
      if (!startSending)
        return;
      Task.Factory.StartNew(new Action(((\u00348u8a77i8e) this).SendLoop), TaskCreationOptions.LongRunning).ContinueWith((Action<Task>) (eo02o1i235 => CoreEventSource.Log.LogVerbose(\u0033457o91ea7.\u0039u51uui516("\t\0v8&\u001D*r'~$!$5\u0015Evs^\u0017t-\u00064s/)JC\u001F\u001D{93\u001By=\u000F%m", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK") + eo02o1i235.Exception.ToString(), \u0033457o91ea7.\u0039u51uui516("\u0013\v{31\u001Du1\u0015", "rM0tkG8zI7eeyoXM75Vl9kJP4hqXK"))), TaskContinuationOptions.OnlyOnFaulted);
    }
  }
}
