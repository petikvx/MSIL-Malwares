// Decompiled with JetBrains decompiler
// Type: DirectX.Capture.FilterCollection
// Assembly: yes, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 83EB8C5F-168C-47FA-93FE-E25AA6C64B02
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00004-msil\Trojan.MSIL.KillAV.ao-937fd99ab6df975f8ace26b4ce6ead21ae41a82f170fbe18646720cacc517e69.exe

using DShowNET;
using DShowNET.Device;
using System;
using System.Collections;
using System.Runtime.InteropServices;

namespace DirectX.Capture
{
  public class FilterCollection : CollectionBase
  {
    internal FilterCollection(Guid category) => this.getFilters(category);

    protected void getFilters(Guid category)
    {
      object o = (object) null;
      ICreateDevEnum createDevEnum = (ICreateDevEnum) null;
      UCOMIEnumMoniker ppEnumMoniker = (UCOMIEnumMoniker) null;
      UCOMIMoniker[] rgelt = new UCOMIMoniker[1];
      try
      {
        o = Activator.CreateInstance(Type.GetTypeFromCLSID(Clsid.SystemDeviceEnum));
        ((ICreateDevEnum) o).CreateClassEnumerator(ref category, out ppEnumMoniker, 0);
        while (ppEnumMoniker.Next(1, rgelt, out int _) == 0 && rgelt[0] != null)
        {
          this.InnerList.Add((object) new Filter(rgelt[0]));
          Marshal.ReleaseComObject((object) rgelt[0]);
          rgelt[0] = (UCOMIMoniker) null;
        }
        this.InnerList.Sort();
      }
      finally
      {
        createDevEnum = (ICreateDevEnum) null;
        if (rgelt[0] != null)
          Marshal.ReleaseComObject((object) rgelt[0]);
        rgelt[0] = (UCOMIMoniker) null;
        if (ppEnumMoniker != null)
          Marshal.ReleaseComObject((object) ppEnumMoniker);
        if (o != null)
          Marshal.ReleaseComObject(o);
      }
    }

    public Filter this[int index] => (Filter) this.InnerList[index];
  }
}
