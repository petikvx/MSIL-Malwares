// Decompiled with JetBrains decompiler
// Type: IngressoVip.clsExecuta
// Assembly: IngressoVip, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: B67C4084-86FB-4B3F-B072-28F5697F4668
// Assembly location: C:\Users\Administrateur\Desktop\Virusshare-00005-msil\Virus.Win32.Sality.ae-115d93ab771edf65ec0d5a50e51f618fc5159020bdb0762845d86c2a74f94f06.exe

using Microsoft.VisualBasic;
using Microsoft.VisualBasic.CompilerServices;
using System;
using System.Collections;
using System.Data;
using System.IO;
using System.Net.Sockets;
using System.Runtime.CompilerServices;
using System.Text;
using System.Threading;

namespace IngressoVip
{
  public class clsExecuta
  {
    private clsLigacao objLigacao;
    private clsFutebol objTimes;
    private clsShows objArtista;
    private clsCinema objFilme;
    private clsCinema objShopping;
    private clsShows objShow;
    private clsShows objAcentoShow;
    private clsFutebol objJogos;
    private clsFutebol objLocais;
    private string strString;
    private TcpClient socketClienteUra;
    private TcpClient socketServidorRemoto;

    public clsExecuta()
    {
      this.objLigacao = new clsLigacao();
      this.objTimes = new clsFutebol();
      this.objArtista = new clsShows();
      this.objFilme = new clsCinema();
      this.objShopping = new clsCinema();
      this.objShow = new clsShows();
      this.objAcentoShow = new clsShows();
      this.objJogos = new clsFutebol();
      this.objLocais = new clsFutebol();
      this.socketClienteUra = new TcpClient();
      this.socketServidorRemoto = new TcpClient();
    }

    public void TrataString(
      ref TcpClient SkClient,
      ref TcpClient SkServidor,
      ref string TrataString,
      ref Hashtable listaCliente)
    {
      this.strString = TrataString;
      this.socketClienteUra = SkClient;
      this.socketServidorRemoto = SkServidor;
      new Thread(new ThreadStart(this.ProcessaString)).Start();
    }

    private void ProcessaString()
    {
      DataSet dataSet1 = new DataSet();
      DataSet dataSet2 = new DataSet();
      DataSet dataSet3 = new DataSet();
      DataSet dataSet4 = new DataSet();
      DataSet dataSet5 = new DataSet();
      clsMensagem clsMensagem1 = new clsMensagem();
      clsFuncoes clsFuncoes1 = new clsFuncoes();
      clsFuncoes1.MsgConsole(this.strString);
      clsFuncoes1.MsgConsole("");
      clsFuncoes1.MsgConsole("");
      try
      {
        clsFuncoes1.MsgConsole("VALOR DE strString: " + this.strString);
        clsMensagem clsMensagem2 = clsMensagem1.Recupera_Mensagem(ref this.strString);
        clsFuncoes1.MsgConsole("Valor de protocolo " + clsMensagem2.msgProtocolo);
        if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(clsMensagem2.msgProtocolo, "P01", false) == 0)
        {
          clsFuncoes1.MsgConsole("Entrou no P01");
          NetworkStream stream1 = this.socketServidorRemoto.GetStream();
          StreamWriter streamWriter = new StreamWriter((Stream) stream1);
          string str1 = Conversions.ToString(clsMensagem2.GeraMensagemP01());
          clsFuncoes1.MsgConsole("VALOR ENVIADO DO P01 " + str1);
          streamWriter.WriteLine(str1);
          streamWriter.Flush();
          string texto = new StreamReader((Stream) stream1).ReadLine().ToString();
          clsFuncoes1.MsgConsole(texto);
          clsMensagem clsMensagem3 = clsMensagem2;
          string str2 = "1" + texto;
          ref string local = ref str2;
          clsMensagem clsMensagem4 = clsMensagem3.Recupera_Mensagem(ref local);
          if (Conversions.ToInteger(clsFuncoes1.Calcular_Check_Sum(clsMensagem4.msgProtocolo + clsMensagem4.msgTN + clsMensagem4.msgVersao + clsMensagem4.msgTelefone + "*" + clsMensagem4.msgCelular + "*" + clsMensagem4.msgRespostaP01 + clsMensagem4.msgCodRegiao)) == Conversions.ToInteger(clsMensagem4.msgCheckSum))
          {
            if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(clsMensagem4.msgRespostaP01, "2", false) == 0)
            {
              string str3 = clsMensagem4.msgTN + " " + clsMensagem4.msgRespostaP01 + " 0";
              clsFuncoes1.MsgConsole("VALOR DO strRespostaServidor no IF " + str3);
              clsFuncoes1.MsgConsole(str3);
              NetworkStream stream2 = this.socketClienteUra.GetStream();
              byte[] bytes = Encoding.ASCII.GetBytes(str3);
              stream2.Write(bytes, 0, bytes.Length);
              this.socketClienteUra.Close();
            }
            else if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(clsMensagem4.msgRespostaP01, "3", false) == 0)
            {
              string str4 = clsMensagem4.msgTN + " " + clsMensagem4.msgRespostaP01 + " 0";
              clsFuncoes1.MsgConsole("VALOR DO strRespostaServidor no ELSE " + str4);
              clsFuncoes1.MsgConsole(str4);
              NetworkStream stream3 = this.socketClienteUra.GetStream();
              byte[] bytes = Encoding.ASCII.GetBytes(str4);
              stream3.Write(bytes, 0, bytes.Length);
              this.socketClienteUra.Close();
            }
            else if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(clsMensagem4.msgRespostaP01, "0", false) == 0)
            {
              string str5 = clsMensagem4.msgTN + " " + clsMensagem4.msgRespostaP01 + " " + clsMensagem4.msgCodRegiao;
              clsFuncoes1.MsgConsole(str5);
              NetworkStream stream4 = this.socketClienteUra.GetStream();
              byte[] bytes = Encoding.ASCII.GetBytes(str5);
              stream4.Write(bytes, 0, bytes.Length);
              this.socketClienteUra.Close();
            }
            else if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(clsMensagem4.msgRespostaP01, "1", false) == 0)
            {
              string str6 = clsMensagem4.msgTN + " " + clsMensagem4.msgRespostaP01 + " " + clsMensagem4.msgCodRegiao;
              clsFuncoes1.MsgConsole(str6);
              NetworkStream stream5 = this.socketClienteUra.GetStream();
              byte[] bytes = Encoding.ASCII.GetBytes(str6);
              stream5.Write(bytes, 0, bytes.Length);
              this.socketClienteUra.Close();
            }
          }
          else
          {
            string s = clsMensagem4.msgTN + " " + clsMensagem4.msgRespostaP01 + " 0";
            NetworkStream stream6 = this.socketClienteUra.GetStream();
            byte[] bytes = Encoding.ASCII.GetBytes(s);
            stream6.Write(bytes, 0, bytes.Length);
            this.socketClienteUra.Close();
            clsFuncoes1.MsgConsole("VALOR DE strRespostaServidor Checksum nao valido: " + s);
          }
        }
        else if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(clsMensagem2.msgProtocolo, "P02", false) == 0)
        {
          clsFuncoes1.MsgConsole("Entrou no P02");
          NetworkStream stream7 = this.socketServidorRemoto.GetStream();
          StreamWriter streamWriter = new StreamWriter((Stream) stream7);
          string texto1 = Conversions.ToString(clsMensagem2.GeraMensagemP02());
          streamWriter.WriteLine(texto1);
          clsFuncoes1.MsgConsole(texto1);
          streamWriter.Flush();
          string texto2 = new StreamReader((Stream) stream7).ReadLine().ToString();
          clsFuncoes1.MsgConsole(texto2);
          clsMensagem clsMensagem5 = clsMensagem2;
          string str7 = "1" + texto2;
          ref string local1 = ref str7;
          clsMensagem clsMensagem6 = clsMensagem5.Recupera_Mensagem(ref local1);
          if (Conversions.ToInteger(clsFuncoes1.Calcular_Check_Sum(clsMensagem6.msgProtocolo + clsMensagem6.msgTN + clsMensagem6.msgVersao + clsMensagem6.msgTelefone + "*" + clsMensagem6.msgCelular + "*" + clsMensagem6.msgDiversao + clsMensagem6.msgEvento + clsMensagem6.msgLocal + clsMensagem6.msgTipoLocal + clsMensagem6.msgQTD + clsMensagem6.msgQTDMeia + clsMensagem6.msgQTDIntMeia + clsMensagem6.msgValorCompra + clsMensagem6.msgTaxaServico + clsMensagem6.msgParcelado + clsMensagem6.msgRespostaP02)) == Conversions.ToInteger(clsMensagem6.msgCheckSum))
          {
            clsFuncoes clsFuncoes2 = clsFuncoes1;
            clsMensagem clsMensagem7 = clsMensagem6;
            string msgTaxaServico = clsMensagem7.msgTaxaServico;
            ref string local2 = ref msgTaxaServico;
            int num1 = clsFuncoes2.RemoveZeros(ref local2, 2);
            clsMensagem7.msgTaxaServico = msgTaxaServico;
            int num2 = num1;
            Conversions.ToInteger(clsMensagem6.msgQTD);
            Conversions.ToInteger(clsMensagem6.msgQTDMeia);
            clsFuncoes1.MsgConsole("VALOR DA TAXA DE SERVICO CONVERTIDA: " + Conversions.ToString(num2));
            string strValor = Conversions.ToString(num2) + "00";
            int length = strValor.Length;
            while (length <= 6)
            {
              strValor = "0" + strValor;
              checked { ++length; }
            }
            string extenso1 = clsFuncoes1.NumeroToExtenso(clsMensagem6.msgValorCompra);
            clsFuncoes1.MsgConsole("VALOR DA COMPRA: " + extenso1);
            clsFuncoes1.MsgConsole("VALOR DE taxa: " + strValor);
            clsFuncoes1.MsgConsole("VALOR DE taxa POR EXTENSO: " + clsFuncoes1.NumeroToExtenso(strValor));
            string[] strArray1 = new string[14]
            {
              clsMensagem6.msgTN,
              " ",
              clsMensagem6.msgRespostaP02,
              " ",
              clsMensagem6.msgParcelado,
              " ",
              clsMensagem6.msgVagas,
              clsFuncoes1.ContaPalavras(ref extenso1).ToString(),
              " ",
              extenso1,
              " ",
              null,
              null,
              null
            };
            string[] strArray2 = strArray1;
            clsFuncoes clsFuncoes3 = clsFuncoes1;
            string extenso2 = clsFuncoes1.NumeroToExtenso(strValor);
            ref string local3 = ref extenso2;
            string str8 = clsFuncoes3.ContaPalavras(ref local3).ToString();
            strArray2[11] = str8;
            strArray1[12] = " ";
            strArray1[13] = clsFuncoes1.NumeroToExtenso(strValor);
            string str9 = string.Concat(strArray1);
            NetworkStream stream8 = this.socketClienteUra.GetStream();
            byte[] bytes = Encoding.ASCII.GetBytes(str9);
            stream8.Write(bytes, 0, bytes.Length);
            this.socketClienteUra.Close();
            clsFuncoes1.MsgConsole(str9);
          }
          else
          {
            streamWriter.WriteLine("Erro no resultado do calculo de verificacao");
            NetworkStream stream9 = this.socketClienteUra.GetStream();
            byte[] buffer = (byte[]) NewLateBinding.LateGet((object) Encoding.ASCII, (Type) null, "GetBytes", new object[1]
            {
              RuntimeHelpers.GetObjectValue(clsMensagem6.GeraErro())
            }, (string[]) null, (Type[]) null, (bool[]) null);
            stream9.Write(buffer, 0, buffer.Length);
            this.socketClienteUra.Close();
            clsFuncoes1.MsgConsole(Conversions.ToString(clsMensagem6.GeraErro()));
          }
        }
        else if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(clsMensagem2.msgProtocolo, "P03", false) == 0)
        {
          clsFuncoes1.MsgConsole("Entrou no P03");
          NetworkStream stream10 = this.socketServidorRemoto.GetStream();
          StreamWriter streamWriter = new StreamWriter((Stream) stream10);
          string str10 = Conversions.ToString(clsMensagem2.GeraMensagemP03());
          clsFuncoes1.MsgConsole("strRespostaServidor do envio P03 " + str10);
          streamWriter.WriteLine(str10);
          streamWriter.Flush();
          string str11 = new StreamReader((Stream) stream10).ReadLine().ToString();
          clsFuncoes1.MsgConsole("strRespostaServidor do recebimento P03 " + str11);
          clsMensagem clsMensagem8 = clsMensagem2;
          string str12 = "1" + str11;
          ref string local = ref str12;
          clsMensagem clsMensagem9 = clsMensagem8.Recupera_Mensagem(ref local);
          if (Conversions.ToInteger(clsFuncoes1.Calcular_Check_Sum(clsMensagem9.msgProtocolo + clsMensagem9.msgTN + clsMensagem9.msgVersao + clsMensagem9.msgTelefone + "*" + clsMensagem9.msgCelular + "*" + clsMensagem9.msgDiversao + clsMensagem9.msgPromoto + clsMensagem9.msgEvento + clsMensagem9.msgLocal + clsMensagem9.msgTipoLocal + clsMensagem9.msgDataEvento + clsMensagem9.msgHoraEvento + clsMensagem9.msgQTD + clsMensagem9.msgQTDMeia + clsMensagem9.msgQTDIntMeia + clsMensagem9.msgCartao + "*" + clsMensagem9.msgVencimento + clsMensagem9.msgCodigo + "*" + clsMensagem9.msgFormaPagamento + clsMensagem9.msgParecela + "*" + clsMensagem9.msgRespostaP03)) == Conversions.ToInteger(clsMensagem9.msgCheckSum))
          {
            clsFuncoes1.MsgConsole("IF DO P03 VALOR DE msgRespostaP03 " + clsMensagem9.msgRespostaP03);
            NetworkStream stream11 = this.socketClienteUra.GetStream();
            byte[] bytes = Encoding.ASCII.GetBytes(clsMensagem9.msgRespostaP03);
            stream11.Write(bytes, 0, bytes.Length);
            this.socketClienteUra.Close();
            clsFuncoes1.MsgConsole("VALOR DE P03 IF " + clsMensagem9.msgRespostaP03);
          }
          else
          {
            clsFuncoes1.MsgConsole("ELSE DO P03 VALOR DE msgRespostaP03");
            streamWriter.WriteLine("Erro no resultado do calculo de verificacao");
            NetworkStream stream12 = this.socketClienteUra.GetStream();
            byte[] buffer = (byte[]) NewLateBinding.LateGet((object) Encoding.ASCII, (Type) null, "GetBytes", new object[1]
            {
              RuntimeHelpers.GetObjectValue(clsMensagem9.GeraErro())
            }, (string[]) null, (Type[]) null, (bool[]) null);
            stream12.Write(buffer, 0, buffer.Length);
            this.socketClienteUra.Close();
            clsFuncoes1.MsgConsole(Conversions.ToString(Microsoft.VisualBasic.CompilerServices.Operators.ConcatenateObject((object) "VALOR DO P03 NO ELSE ", clsMensagem9.GeraErro())));
          }
        }
        else if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(clsMensagem2.msgProtocolo, "P04", false) == 0)
        {
          clsFuncoes1.MsgConsole("Entrou no P04");
          string msgDiversao = clsMensagem2.msgDiversao;
          if (msgDiversao.Equals("01"))
          {
            clsFutebol objJogos = this.objJogos;
            clsMensagem clsMensagem10 = clsMensagem2;
            string msgPromoto = clsMensagem10.msgPromoto;
            ref string local = ref msgPromoto;
            DataSet dataSet6 = objJogos.PegaJogos(ref local);
            clsMensagem10.msgPromoto = msgPromoto;
            dataSet4 = dataSet6;
            string str13 = (string) null;
            string Left = (string) null;
            string str14 = (string) null;
            int num3 = 0;
            string str15 = "0";
            if (dataSet4.Tables[0].Rows.Count > 0)
            {
              int num4 = dataSet4.Tables[0].Rows.Count <= 2 ? dataSet4.Tables[0].Rows.Count : 2;
              int num5 = checked (num4 - 1);
              int index = 0;
              while (index <= num5)
              {
                Left = Left + clsFuncoes1.ZerosEsquerda(Conversions.ToInteger(dataSet4.Tables[0].Rows[index]["idjogo"]), 6).ToString() + " ";
                str13 = str13 + clsFuncoes1.ZerosEsquerda(Conversions.ToInteger(dataSet4.Tables[0].Rows[index]["jogo"].ToString().Substring(0, 3)), 4) + " " + clsFuncoes1.ZerosEsquerda(Conversions.ToInteger(dataSet4.Tables[0].Rows[index]["jogo"].ToString().Substring(3, 3)), 4) + " ";
                str14 = str14 + Strings.Format(RuntimeHelpers.GetObjectValue(dataSet4.Tables[0].Rows[index]["data"]), "dd") + " " + Strings.Format(RuntimeHelpers.GetObjectValue(dataSet4.Tables[0].Rows[index]["data"]), "MM") + " ";
                clsFuncoes1.MsgConsole("CODIGO DO JOGO P04 " + Left);
                clsFuncoes1.MsgConsole("TIMES DO P04 " + str13);
                clsFuncoes1.MsgConsole("DATA JOGOS DO JOGO P04 " + str14);
                checked { ++index; }
              }
              string str16 = num4.ToString();
              clsFuncoes1.MsgConsole("QUANTIDADE DO JOGO P04 " + str16);
              if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(Left, (string) null, false) != 0)
                Left = " " + Left;
              string str17 = clsMensagem2.msgTN + " " + str16 + Left + str13 + str14;
              clsFuncoes1.MsgConsole(str17);
              NetworkStream stream = this.socketClienteUra.GetStream();
              byte[] bytes = Encoding.ASCII.GetBytes(str17);
              stream.Write(bytes, 0, bytes.Length);
              this.socketClienteUra.Close();
            }
            else
            {
              num3 = 0;
              string str18 = clsMensagem2.msgTN + " " + str15;
              clsFuncoes1.MsgConsole(str18);
              NetworkStream stream = this.socketClienteUra.GetStream();
              byte[] bytes = Encoding.ASCII.GetBytes(str18);
              stream.Write(bytes, 0, bytes.Length);
              this.socketClienteUra.Close();
            }
          }
          else if (msgDiversao.Equals("02"))
          {
            string Left = (string) null;
            int num6 = 0;
            string str19 = "0";
            clsCinema objFilme = this.objFilme;
            clsMensagem clsMensagem11 = clsMensagem2;
            string msgPromoto = clsMensagem11.msgPromoto;
            ref string local = ref msgPromoto;
            DataSet dataSet7 = objFilme.PegaFilmes(ref local);
            clsMensagem11.msgPromoto = msgPromoto;
            DataSet dataSet8 = dataSet7;
            if (dataSet8.Tables[0].Rows.Count > 0)
            {
              int count = dataSet8.Tables[0].Rows.Count;
              int num7 = checked (count - 1);
              int index = 0;
              while (index <= num7)
              {
                Left = Left + clsFuncoes1.ZerosEsquerda(Conversions.ToInteger(dataSet8.Tables[0].Rows[index]["filme"]), 6).ToString() + " ";
                clsFuncoes1.MsgConsole("CODIGO DO FILMES P04 " + Left);
                checked { ++index; }
              }
              string str20 = count.ToString();
              clsFuncoes1.MsgConsole("QUANTIDADE DO FILMES P04 " + str20);
              if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(Left, (string) null, false) != 0)
                Left = " " + Left;
              string str21 = clsMensagem2.msgTN + " " + str20 + Left;
              clsFuncoes1.MsgConsole(str21);
              NetworkStream stream = this.socketClienteUra.GetStream();
              byte[] bytes = Encoding.ASCII.GetBytes(str21);
              stream.Write(bytes, 0, bytes.Length);
              this.socketClienteUra.Close();
            }
            else
            {
              num6 = 0;
              string str22 = clsMensagem2.msgTN + " " + str19;
              clsFuncoes1.MsgConsole(str22);
              NetworkStream stream = this.socketClienteUra.GetStream();
              byte[] bytes = Encoding.ASCII.GetBytes(str22);
              stream.Write(bytes, 0, bytes.Length);
              this.socketClienteUra.Close();
            }
          }
          else if (!msgDiversao.Equals("03"))
          {
            if (msgDiversao.Equals("04"))
            {
              clsShows objShow = this.objShow;
              clsMensagem clsMensagem12 = clsMensagem2;
              string msgPromoto = clsMensagem12.msgPromoto;
              ref string local4 = ref msgPromoto;
              clsMensagem clsMensagem13 = clsMensagem2;
              string msgLocal = clsMensagem13.msgLocal;
              ref string local5 = ref msgLocal;
              DataSet dataSet9 = objShow.PegaShows(ref local4, ref local5);
              clsMensagem13.msgLocal = msgLocal;
              clsMensagem12.msgPromoto = msgPromoto;
              dataSet2 = dataSet9;
              string Left = (string) null;
              string str23 = (string) null;
              int num8 = 0;
              string str24 = "0";
              if (dataSet2.Tables[0].Rows.Count > 0)
              {
                int num9 = dataSet2.Tables[0].Rows.Count <= 2 ? dataSet2.Tables[0].Rows.Count : 2;
                int num10 = checked (num9 - 1);
                int index = 0;
                while (index <= num10)
                {
                  Left = Left + clsFuncoes1.ZerosEsquerda(Conversions.ToInteger(dataSet2.Tables[0].Rows[index]["idshow"]), 6).ToString() + " ";
                  str23 = str23 + Strings.Format(RuntimeHelpers.GetObjectValue(dataSet2.Tables[0].Rows[index]["data"]), "dd") + " " + Strings.Format(RuntimeHelpers.GetObjectValue(dataSet2.Tables[0].Rows[index]["data"]), "MM") + " ";
                  clsFuncoes1.MsgConsole("CODIGO DO SHOW P04 " + Left);
                  clsFuncoes1.MsgConsole("DATA SHOW DO JOGO P04 " + str23);
                  checked { ++index; }
                }
                string str25 = num9.ToString();
                clsFuncoes1.MsgConsole("QUANTIDADE DO JOGO P04 " + str25);
                if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(Left, (string) null, false) != 0)
                  Left = " " + Left;
                string str26 = clsMensagem2.msgTN + " " + str25 + Left + str23;
                clsFuncoes1.MsgConsole(str26);
                NetworkStream stream = this.socketClienteUra.GetStream();
                byte[] bytes = Encoding.ASCII.GetBytes(str26);
                stream.Write(bytes, 0, bytes.Length);
                this.socketClienteUra.Close();
              }
              else
              {
                num8 = 0;
                string str27 = clsMensagem2.msgTN + " " + str24;
                clsFuncoes1.MsgConsole(str27);
                NetworkStream stream = this.socketClienteUra.GetStream();
                byte[] bytes = Encoding.ASCII.GetBytes(str27);
                stream.Write(bytes, 0, bytes.Length);
                this.socketClienteUra.Close();
              }
            }
          }
        }
        else if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(clsMensagem2.msgProtocolo, "P05", false) == 0)
        {
          clsFuncoes1.MsgConsole("Entrou no P05");
          string msgDiversao = clsMensagem2.msgDiversao;
          if (msgDiversao.Equals("01"))
          {
            clsFutebol objJogos = this.objJogos;
            clsMensagem clsMensagem14 = clsMensagem2;
            string msgEvento = clsMensagem14.msgEvento;
            ref string local = ref msgEvento;
            DataSet dataSet10 = objJogos.PegaJogoCod(ref local);
            clsMensagem14.msgEvento = msgEvento;
            dataSet4 = dataSet10;
            string str28 = (string) null;
            if (dataSet4.Tables[0].Rows.Count > 0)
            {
              int num = checked (dataSet4.Tables[0].Rows.Count - 1);
              int index = 0;
              while (index <= num)
              {
                str28 = str28 + clsFuncoes1.ZerosEsquerda(Conversions.ToInteger(dataSet4.Tables[0].Rows[index]["jogo"].ToString().Substring(0, 3)), 4) + " " + clsFuncoes1.ZerosEsquerda(Conversions.ToInteger(dataSet4.Tables[0].Rows[index]["jogo"].ToString().Substring(3, 3)), 4) + " ";
                checked { ++index; }
              }
            }
            string str29 = clsMensagem2.msgTN + " " + str28;
            clsFuncoes1.MsgConsole(str29);
            NetworkStream stream = this.socketClienteUra.GetStream();
            byte[] bytes = Encoding.ASCII.GetBytes(str29);
            stream.Write(bytes, 0, bytes.Length);
            this.socketClienteUra.Close();
          }
          else if (msgDiversao.Equals("02"))
          {
            clsCinema objFilme = this.objFilme;
            clsMensagem clsMensagem15 = clsMensagem2;
            string msgEvento = clsMensagem15.msgEvento;
            ref string local6 = ref msgEvento;
            clsMensagem clsMensagem16 = clsMensagem2;
            string msgPromoto = clsMensagem16.msgPromoto;
            ref string local7 = ref msgPromoto;
            clsMensagem clsMensagem17 = clsMensagem2;
            string msgLocal = clsMensagem17.msgLocal;
            ref string local8 = ref msgLocal;
            clsMensagem clsMensagem18 = clsMensagem2;
            string msgTipoLocal = clsMensagem18.msgTipoLocal;
            ref string local9 = ref msgTipoLocal;
            DataSet dataSet11 = objFilme.PegaCodFilme(ref local6, ref local7, ref local8, ref local9);
            clsMensagem18.msgTipoLocal = msgTipoLocal;
            clsMensagem17.msgLocal = msgLocal;
            clsMensagem16.msgPromoto = msgPromoto;
            clsMensagem15.msgEvento = msgEvento;
            DataSet dataSet12 = dataSet11;
            string str30 = (string) null;
            string str31 = (string) null;
            if (dataSet12.Tables[0].Rows.Count > 0)
            {
              int num = checked (dataSet12.Tables[0].Rows.Count - 1);
              int index = 0;
              while (index <= num)
              {
                str30 = str30 + clsFuncoes1.ZerosEsquerda(Conversions.ToInteger(dataSet12.Tables[0].Rows[index]["idfilme"].ToString()), 6) + " ";
                str31 = str31 + Strings.Format(RuntimeHelpers.GetObjectValue(dataSet12.Tables[0].Rows[index]["data"]), "dd") + " " + Strings.Format(RuntimeHelpers.GetObjectValue(dataSet12.Tables[0].Rows[index]["data"]), "MM") + " ";
                checked { ++index; }
              }
            }
            string str32 = clsMensagem2.msgTN + " " + str30 + str31;
            clsFuncoes1.MsgConsole(str32);
            NetworkStream stream = this.socketClienteUra.GetStream();
            byte[] bytes = Encoding.ASCII.GetBytes(str32);
            stream.Write(bytes, 0, bytes.Length);
            this.socketClienteUra.Close();
          }
          else if (!msgDiversao.Equals("03"))
          {
            if (msgDiversao.Equals("04"))
            {
              clsShows objShow = this.objShow;
              clsMensagem clsMensagem19 = clsMensagem2;
              string msgEvento = clsMensagem19.msgEvento;
              ref string local = ref msgEvento;
              DataSet dataSet13 = objShow.PegaShowCod(ref local);
              clsMensagem19.msgEvento = msgEvento;
              dataSet2 = dataSet13;
              string str33 = (string) null;
              string str34 = (string) null;
              string str35 = (string) null;
              if (dataSet2.Tables[0].Rows.Count > 0)
              {
                int num = checked (dataSet2.Tables[0].Rows.Count - 1);
                int index = 0;
                while (index <= num)
                {
                  str33 = str33 + clsFuncoes1.ZerosEsquerda(Conversions.ToInteger(dataSet2.Tables[0].Rows[index]["idshow"].ToString()), 6) + " ";
                  str34 = str34 + Strings.Format(RuntimeHelpers.GetObjectValue(dataSet2.Tables[0].Rows[index]["data"]), "dd") + " " + Strings.Format(RuntimeHelpers.GetObjectValue(dataSet2.Tables[0].Rows[index]["data"]), "MM") + " ";
                  str35 = str35 + clsFuncoes1.ZerosEsquerda(Conversions.ToInteger(dataSet2.Tables[0].Rows[index]["idartista"].ToString()), 4) + " ";
                  checked { ++index; }
                }
              }
              string str36 = clsMensagem2.msgTN + " " + str33 + str35 + str34;
              clsFuncoes1.MsgConsole(str36);
              NetworkStream stream = this.socketClienteUra.GetStream();
              byte[] bytes = Encoding.ASCII.GetBytes(str36);
              stream.Write(bytes, 0, bytes.Length);
              this.socketClienteUra.Close();
            }
          }
        }
        else if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(clsMensagem2.msgProtocolo, "P06", false) == 0)
        {
          clsFuncoes1.MsgConsole("Entrou no P06");
          string msgDiversao = clsMensagem2.msgDiversao;
          if (msgDiversao.Equals("01"))
          {
            clsFutebol objLocais = this.objLocais;
            clsMensagem clsMensagem20 = clsMensagem2;
            string msgEvento = clsMensagem20.msgEvento;
            ref string local = ref msgEvento;
            DataSet dataSet14 = objLocais.PegaLocais(ref local);
            clsMensagem20.msgEvento = msgEvento;
            dataSet5 = dataSet14;
            string str37 = (string) null;
            string str38 = "0";
            if (dataSet5.Tables[0].Rows.Count > 0)
            {
              int num = checked (dataSet5.Tables[0].Rows.Count - 1);
              int index = 0;
              while (index <= num)
              {
                str37 = str37 + clsFuncoes1.ZerosEsquerda(Conversions.ToInteger(dataSet5.Tables[0].Rows[index]["idlugar"]), 6).ToString() + " ";
                checked { ++index; }
              }
              str38 = Conversions.ToString(dataSet5.Tables[0].Rows.Count);
              clsFuncoes1.MsgConsole("QUANTIDADE LOCAIS NO P06 " + str38);
            }
            string str39 = clsMensagem2.msgTN + " " + str38 + " " + str37;
            clsFuncoes1.MsgConsole(str39);
            NetworkStream stream = this.socketClienteUra.GetStream();
            byte[] bytes = Encoding.ASCII.GetBytes(str39);
            stream.Write(bytes, 0, bytes.Length);
            this.socketClienteUra.Close();
          }
          else if (msgDiversao.Equals("02"))
          {
            clsCinema objShopping = this.objShopping;
            clsMensagem clsMensagem21 = clsMensagem2;
            string msgEvento = clsMensagem21.msgEvento;
            ref string local10 = ref msgEvento;
            clsMensagem clsMensagem22 = clsMensagem2;
            string msgPromoto = clsMensagem22.msgPromoto;
            ref string local11 = ref msgPromoto;
            clsMensagem clsMensagem23 = clsMensagem2;
            string msgTipoLocal = clsMensagem23.msgTipoLocal;
            ref string local12 = ref msgTipoLocal;
            DataSet dataSet15 = objShopping.PegaShopping(ref local10, ref local11, ref local12);
            clsMensagem23.msgTipoLocal = msgTipoLocal;
            clsMensagem22.msgPromoto = msgPromoto;
            clsMensagem21.msgEvento = msgEvento;
            dataSet5 = dataSet15;
            string str40 = (string) null;
            string str41 = "0";
            if (dataSet5.Tables[0].Rows.Count > 0)
            {
              int num = checked (dataSet5.Tables[0].Rows.Count - 1);
              int index = 0;
              while (index <= num)
              {
                str40 = str40 + clsFuncoes1.ZerosEsquerda(Conversions.ToInteger(dataSet5.Tables[0].Rows[index]["idshopping"].ToString()), 6) + " ";
                checked { ++index; }
              }
              str41 = Conversions.ToString(dataSet5.Tables[0].Rows.Count);
              clsFuncoes1.MsgConsole("QUANTIDADE LOCAIS NO P06 " + str41);
            }
            string str42 = clsMensagem2.msgTN + " " + str41 + " " + str40;
            clsFuncoes1.MsgConsole(str42);
            NetworkStream stream = this.socketClienteUra.GetStream();
            byte[] bytes = Encoding.ASCII.GetBytes(str42);
            stream.Write(bytes, 0, bytes.Length);
            this.socketClienteUra.Close();
          }
          else if (!msgDiversao.Equals("03"))
          {
            if (msgDiversao.Equals("04"))
            {
              clsShows objAcentoShow = this.objAcentoShow;
              clsMensagem clsMensagem24 = clsMensagem2;
              string msgEvento = clsMensagem24.msgEvento;
              ref string local = ref msgEvento;
              DataSet dataSet16 = objAcentoShow.PegaAcento(ref local);
              clsMensagem24.msgEvento = msgEvento;
              dataSet5 = dataSet16;
              string str43 = (string) null;
              string str44 = (string) null;
              string str45 = "0";
              if (dataSet5.Tables[0].Rows.Count > 0)
              {
                int num = checked (dataSet5.Tables[0].Rows.Count - 1);
                int index = 0;
                while (index <= num)
                {
                  str44 = str44 + clsFuncoes1.ZerosEsquerda(Conversions.ToInteger(dataSet5.Tables[0].Rows[index]["idacento"]), 6).ToString() + " ";
                  string str46 = dataSet5.Tables[0].Rows[index]["nome"].ToString();
                  str43 = str43 + str46.Trim() + " ";
                  checked { ++index; }
                }
                str45 = Conversions.ToString(dataSet5.Tables[0].Rows.Count);
                clsFuncoes1.MsgConsole("QUANTIDADE LOCAIS NO P06 " + str45);
              }
              string str47 = clsMensagem2.msgTN + " " + str45 + " " + str44 + str43;
              clsFuncoes1.MsgConsole(str47);
              NetworkStream stream = this.socketClienteUra.GetStream();
              byte[] bytes = Encoding.ASCII.GetBytes(str47);
              stream.Write(bytes, 0, bytes.Length);
              this.socketClienteUra.Close();
            }
          }
        }
        else if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(clsMensagem2.msgProtocolo, "P07", false) == 0)
        {
          string msgDiversao = clsMensagem2.msgDiversao;
          if (msgDiversao.Equals("01"))
          {
            clsFutebol objTimes = this.objTimes;
            clsMensagem clsMensagem25 = clsMensagem2;
            string msgCodRegiao = clsMensagem25.msgCodRegiao;
            ref string local = ref msgCodRegiao;
            DataSet dataSet17 = objTimes.PegaTimes(ref local);
            clsMensagem25.msgCodRegiao = msgCodRegiao;
            dataSet1 = dataSet17;
            string Left = (string) null;
            string str48 = "0";
            if (dataSet1.Tables[0].Rows.Count > 0)
            {
              int num = checked (dataSet1.Tables[0].Rows.Count - 1);
              int index = 0;
              while (index <= num)
              {
                Left = Left + clsFuncoes1.ZerosEsquerda(Conversions.ToInteger(dataSet1.Tables[0].Rows[index]["idtimes"]), 4) + " ";
                checked { ++index; }
              }
              str48 = Conversions.ToString(dataSet1.Tables[0].Rows.Count);
            }
            if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(Left, (string) null, false) != 0)
              Left = " " + Left;
            string str49 = clsMensagem2.msgTN + " " + str48 + Left;
            clsFuncoes1.MsgConsole(str49);
            NetworkStream stream = this.socketClienteUra.GetStream();
            byte[] bytes = Encoding.ASCII.GetBytes(str49);
            stream.Write(bytes, 0, bytes.Length);
            this.socketClienteUra.Close();
          }
          else if (msgDiversao.Equals("02"))
          {
            clsCinema objFilme = this.objFilme;
            clsMensagem clsMensagem26 = clsMensagem2;
            string msgCodRegiao = clsMensagem26.msgCodRegiao;
            ref string local = ref msgCodRegiao;
            DataSet dataSet18 = objFilme.PegaRedes(ref local);
            clsMensagem26.msgCodRegiao = msgCodRegiao;
            DataSet dataSet19 = dataSet18;
            string Left = (string) null;
            string str50 = "0";
            if (dataSet19.Tables[0].Rows.Count > 0)
            {
              int num = checked (dataSet19.Tables[0].Rows.Count - 1);
              int index = 0;
              while (index <= num)
              {
                Left = Left + clsFuncoes1.ZerosEsquerda(Conversions.ToInteger(dataSet19.Tables[0].Rows[index]["idartista"]), 4) + " ";
                checked { ++index; }
              }
              str50 = Conversions.ToString(dataSet19.Tables[0].Rows.Count);
            }
            if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(Left, (string) null, false) != 0)
              Left = " " + Left;
            string str51 = clsMensagem2.msgTN + " " + str50 + Left;
            clsFuncoes1.MsgConsole(str51);
            NetworkStream stream = this.socketClienteUra.GetStream();
            byte[] bytes = Encoding.ASCII.GetBytes(str51);
            stream.Write(bytes, 0, bytes.Length);
            this.socketClienteUra.Close();
          }
          else if (!msgDiversao.Equals("03"))
          {
            if (msgDiversao.Equals("04"))
            {
              clsShows objArtista = this.objArtista;
              clsMensagem clsMensagem27 = clsMensagem2;
              string msgCodRegiao = clsMensagem27.msgCodRegiao;
              ref string local = ref msgCodRegiao;
              DataSet dataSet20 = objArtista.PegaArtistas(ref local);
              clsMensagem27.msgCodRegiao = msgCodRegiao;
              dataSet2 = dataSet20;
              string Left = (string) null;
              string str52 = "0";
              if (dataSet2.Tables[0].Rows.Count > 0)
              {
                int num = checked (dataSet2.Tables[0].Rows.Count - 1);
                int index = 0;
                while (index <= num)
                {
                  Left = Left + clsFuncoes1.ZerosEsquerda(Conversions.ToInteger(dataSet2.Tables[0].Rows[index]["idartista"]), 4) + " ";
                  checked { ++index; }
                }
                str52 = Conversions.ToString(dataSet2.Tables[0].Rows.Count);
              }
              if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(Left, (string) null, false) != 0)
                Left = " " + Left;
              string str53 = clsMensagem2.msgTN + " " + str52 + Left;
              clsFuncoes1.MsgConsole(str53);
              NetworkStream stream = this.socketClienteUra.GetStream();
              byte[] bytes = Encoding.ASCII.GetBytes(str53);
              stream.Write(bytes, 0, bytes.Length);
              this.socketClienteUra.Close();
            }
          }
        }
        else if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(clsMensagem2.msgProtocolo, "P08", false) == 0)
        {
          clsFuncoes1.MsgConsole("Entrou no P08");
          NetworkStream stream13 = this.socketServidorRemoto.GetStream();
          StreamWriter streamWriter = new StreamWriter((Stream) stream13);
          string texto3 = Conversions.ToString(clsMensagem2.GeraMensagemP02());
          streamWriter.WriteLine(texto3);
          clsFuncoes1.MsgConsole(texto3);
          streamWriter.Flush();
          string texto4 = new StreamReader((Stream) stream13).ReadLine().ToString();
          clsFuncoes1.MsgConsole(texto4);
          clsMensagem clsMensagem28 = clsMensagem2;
          string str54 = "1" + texto4;
          ref string local = ref str54;
          clsMensagem clsMensagem29 = clsMensagem28.Recupera_Mensagem(ref local);
          if (Conversions.ToInteger(clsFuncoes1.Calcular_Check_Sum(clsMensagem29.msgProtocolo + clsMensagem29.msgTN + clsMensagem29.msgVersao + clsMensagem29.msgTelefone + "*" + clsMensagem29.msgCelular + "*" + clsMensagem29.msgDiversao + clsMensagem29.msgEvento + clsMensagem29.msgLocal + clsMensagem29.msgQTD + clsMensagem29.msgQTDMeia + clsMensagem29.msgQTDIntMeia + clsMensagem29.msgValorCompra + clsMensagem29.msgTaxaServico + clsMensagem29.msgParcelado + clsMensagem29.msgVagas + clsMensagem29.msgRespostaP02)) == Conversions.ToInteger(clsMensagem29.msgCheckSum))
          {
            string str55 = clsMensagem29.msgTN + " " + clsMensagem29.msgRespostaP02;
            NetworkStream stream14 = this.socketClienteUra.GetStream();
            byte[] bytes = Encoding.ASCII.GetBytes(str55);
            stream14.Write(bytes, 0, bytes.Length);
            this.socketClienteUra.Close();
            clsFuncoes1.MsgConsole(str55);
          }
          else
          {
            streamWriter.WriteLine("Erro no resultado do calculo de verificacao");
            NetworkStream stream15 = this.socketClienteUra.GetStream();
            byte[] buffer = (byte[]) NewLateBinding.LateGet((object) Encoding.ASCII, (Type) null, "GetBytes", new object[1]
            {
              RuntimeHelpers.GetObjectValue(clsMensagem29.GeraErro())
            }, (string[]) null, (Type[]) null, (bool[]) null);
            stream15.Write(buffer, 0, buffer.Length);
            this.socketClienteUra.Close();
            clsFuncoes1.MsgConsole(Conversions.ToString(clsMensagem29.GeraErro()));
          }
        }
        else if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(clsMensagem2.msgProtocolo, "P09", false) == 0)
        {
          clsCinema objFilme = this.objFilme;
          clsMensagem clsMensagem30 = clsMensagem2;
          string msgEvento = clsMensagem30.msgEvento;
          ref string local13 = ref msgEvento;
          clsMensagem clsMensagem31 = clsMensagem2;
          string msgPromoto = clsMensagem31.msgPromoto;
          ref string local14 = ref msgPromoto;
          clsMensagem clsMensagem32 = clsMensagem2;
          string msgLocal = clsMensagem32.msgLocal;
          ref string local15 = ref msgLocal;
          DataSet dataSet21 = objFilme.PegaDataFilme(ref local13, ref local14, ref local15);
          clsMensagem32.msgLocal = msgLocal;
          clsMensagem31.msgPromoto = msgPromoto;
          clsMensagem30.msgEvento = msgEvento;
          DataSet dataSet22 = dataSet21;
          string str56 = (string) null;
          string str57 = (string) null;
          if (dataSet22.Tables[0].Rows.Count > 0)
          {
            int num = checked (dataSet22.Tables[0].Rows.Count - 1);
            int index = 0;
            while (index <= num)
            {
              str56 = str56 + clsFuncoes1.ZerosEsquerda(Conversions.ToInteger(dataSet22.Tables[0].Rows[index]["iddata"]), 2).ToString() + " ";
              str57 = str57 + Strings.Format(RuntimeHelpers.GetObjectValue(dataSet22.Tables[0].Rows[index]["data"]), "dd") + " " + Strings.Format(RuntimeHelpers.GetObjectValue(dataSet22.Tables[0].Rows[index]["data"]), "MM") + " ";
              checked { ++index; }
            }
          }
          string str58 = dataSet22.Tables[0].Rows.Count.ToString() + " ";
          string str59 = clsMensagem2.msgTN + " " + str58 + str56 + str57;
          clsFuncoes1.MsgConsole(str59);
          NetworkStream stream = this.socketClienteUra.GetStream();
          byte[] bytes = Encoding.ASCII.GetBytes(str59);
          stream.Write(bytes, 0, bytes.Length);
          this.socketClienteUra.Close();
        }
        else if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(clsMensagem2.msgProtocolo, "P10", false) == 0)
        {
          clsCinema objFilme = this.objFilme;
          clsMensagem clsMensagem33 = clsMensagem2;
          string msgEvento = clsMensagem33.msgEvento;
          ref string local16 = ref msgEvento;
          clsMensagem clsMensagem34 = clsMensagem2;
          string msgPromoto = clsMensagem34.msgPromoto;
          ref string local17 = ref msgPromoto;
          clsMensagem clsMensagem35 = clsMensagem2;
          string msgLocal = clsMensagem35.msgLocal;
          ref string local18 = ref msgLocal;
          clsMensagem clsMensagem36 = clsMensagem2;
          string msgTipoLocal = clsMensagem36.msgTipoLocal;
          ref string local19 = ref msgTipoLocal;
          DataSet dataSet23 = objFilme.PegaHoraFilme(ref local16, ref local17, ref local18, ref local19);
          clsMensagem36.msgTipoLocal = msgTipoLocal;
          clsMensagem35.msgLocal = msgLocal;
          clsMensagem34.msgPromoto = msgPromoto;
          clsMensagem33.msgEvento = msgEvento;
          DataSet dataSet24 = dataSet23;
          string str60 = (string) null;
          string str61 = (string) null;
          if (dataSet24.Tables[0].Rows.Count > 0)
          {
            int num = checked (dataSet24.Tables[0].Rows.Count - 1);
            int index = 0;
            while (index <= num)
            {
              str61 = str61 + dataSet24.Tables[0].Rows[index]["hora"].ToString().Trim() + " ";
              checked { ++index; }
            }
            str60 = str60 + clsFuncoes1.ZerosEsquerda(Conversions.ToInteger(dataSet24.Tables[0].Rows[0]["idfilme"]), 6) + " ";
          }
          string str62 = dataSet24.Tables[0].Rows.Count.ToString() + " ";
          string str63 = clsMensagem2.msgTN + " " + str62 + str60 + str61;
          clsFuncoes1.MsgConsole(str63);
          NetworkStream stream = this.socketClienteUra.GetStream();
          byte[] bytes = Encoding.ASCII.GetBytes(str63);
          stream.Write(bytes, 0, bytes.Length);
          this.socketClienteUra.Close();
        }
        else if (Microsoft.VisualBasic.CompilerServices.Operators.CompareString(clsMensagem2.msgProtocolo, "ERRO", false) == 0)
        {
          clsFuncoes1.MsgConsole("ERRO AO RECUPERAR OS DADOS ");
          clsFuncoes1.MsgConsole("CONEXAO FINALIZADA ");
          this.socketServidorRemoto.Close();
        }
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        clsFuncoes1.MsgConsole("CONEXAO FINALIZADA ");
        this.socketServidorRemoto.Close();
        ProjectData.ClearProjectError();
      }
      dataSet1.Dispose();
      dataSet4.Dispose();
      dataSet5.Dispose();
      dataSet2.Dispose();
    }
  }
}
