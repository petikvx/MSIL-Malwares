// Decompiled with JetBrains decompiler
// Type: GUI_Class.SquareControl
// Assembly: AssemblyHa, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: F582D8E5-D67F-4A37-A1B2-DD78DCA9CC78
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.02-msil\Backdoor.Win32.Blakken.vpu-da917e6cce829452a2fefa2c4dd28bed5eefc382e7b5891dc033186e478ef6dd.exe

using System.ComponentModel;
using System.Drawing;
using System.Windows.Forms;

namespace GUI_Class
{
  public class SquareControl : PictureBox
  {
    private Square square;
    private BindingList<Player> players;
    private bool[] containsPlayers = new bool[6];
    public const int SQUARE_SIZE = 95;
    private Font textFont = new Font("Microsoft Sans Serif", 8f);
    private Brush textBrush = Brushes.White;

    public bool[] ContainsPlayers
    {
      get => this.containsPlayers;
      set => this.containsPlayers = value;
    }

    public SquareControl(Square square, BindingList<Player> players)
    {
      this.square = square;
      this.players = players;
      this.Size = new Size(95, 95);
      this.Margin = new Padding(0);
      this.Dock = DockStyle.Fill;
      this.BorderStyle = BorderStyle.FixedSingle;
      this.BackColor = Color.SlateGray;
      this.SetSquareImage();
    }

    private void SetSquareImage()
    {
      if (this.square is WormholeSquare)
      {
        this.LoadImageFromFile("Wormhole entry.png");
        this.textBrush = Brushes.Red;
      }
      else if (this.square is BlackholeSquare)
      {
        this.LoadImageFromFile("Going down.png");
        this.textBrush = Brushes.Red;
      }
      else if (this.square.Name == "Finish")
      {
        this.LoadImageFromFile("Landing.png");
        this.textBrush = Brushes.Black;
        this.textFont = new Font("Microsoft Sans Serif", 8f, FontStyle.Bold);
      }
      else if (this.square.Name == "Start")
      {
        this.LoadImageFromFile("blast-off-rocket.png");
        this.textBrush = Brushes.Black;
        this.textFont = new Font("Microsoft Sans Serif", 8f, FontStyle.Bold);
      }
      else
        this.LoadImageFromFile("Space.png");
    }

    private void LoadImageFromFile(string fileName)
    {
      this.Image = Image.FromFile("Images\\" + fileName);
      this.SizeMode = PictureBoxSizeMode.StretchImage;
    }

    protected override void OnPaint(PaintEventArgs e)
    {
      if (this.Image != null)
        e.Graphics.DrawImage(this.Image, e.ClipRectangle);
      string name = this.square.Name;
      float width = this.textFont.Size * (float) name.Length;
      float height = (float) this.textFont.Height;
      RectangleF layoutRectangle = new RectangleF((float) e.ClipRectangle.Right - width, (float) e.ClipRectangle.Bottom - height, width, height);
      e.Graphics.DrawString(name, this.textFont, this.textBrush, layoutRectangle, new StringFormat()
      {
        Alignment = StringAlignment.Far
      });
      for (int index = 0; index < this.containsPlayers.Length; ++index)
      {
        if (this.containsPlayers[index])
        {
          int num1 = index % 3;
          int num2 = index / 3;
          int x = num1 * 28;
          int y = num2 * 28;
          Brush playerTokenColour = this.players[index].PlayerTokenColour;
          e.Graphics.FillEllipse(playerTokenColour, x, y, 20, 20);
        }
      }
    }
  }
}
