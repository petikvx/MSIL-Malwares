// Decompiled with JetBrains decompiler
// Type: au313u674u28i23uo.io237335e6aoe67ia
// Assembly: e52a71747iaa0aa11, Version=2.1.0.0, Culture=neutral, PublicKeyToken=cac503e1823ce71c
// MVID: 0D894068-CF68-44D1-88F9-023D8A694267
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.06\HEUR-Trojan.MSIL.Crypt.gen-32d8b52e3461f3cf3cd3f6811df29ca82987bb597ad104f4ff2e7064dbd625ad.exe

using \u003029o530898aoa272a;
using \u0038528i86u715785004;
using e63e9u5ue069i1u98;
using eeeo76062a07181uo;
using Microsoft;
using Microsoft.VisualStudio.Threading;
using System;
using System.Buffers;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.IO.Pipelines;
using System.Runtime.CompilerServices;
using System.Text;
using System.Threading;
using System.Threading.Tasks;
using u0o2aaui478u98o07;

namespace au313u674u28i23uo
{
  public class io237335e6aoe67ia : IDisposableObservable, IDisposable
  {
    private const int \u0031391270ai484527e7 = 0;
    private static readonly byte[] ia265a68aauai8153 = new byte[4]
    {
      (byte) 47,
      (byte) 223,
      (byte) 29,
      (byte) 80
    };
    private static readonly Encoding ei161u2auiu10987a = Encoding.UTF8;
    private static readonly io237335e6aoe67ia.a3e56310oe5u6a90a \u00312a2391a4u5aiu403 = (io237335e6aoe67ia.a3e56310oe5u6a90a) new io237335e6aoe67ia.au7a662io2e9029o9();
    private readonly int \u0036ea528a0576o31ii6;
    private readonly bool \u0034e9a27i488a4e6a3u;
    private readonly Stream \u00382a3507u917046ui0;
    private readonly object u25143139e2e1ooii;
    private readonly Dictionary<string, Queue<io237335e6aoe67ia.\u00367o541ue04689e802>> \u003246787374u679631i;
    private readonly Dictionary<string, Queue<TaskCompletionSource<io237335e6aoe67ia.\u00367o541ue04689e802>>> u829943ai68833u3e;
    private readonly Dictionary<int, io237335e6aoe67ia.\u00367o541ue04689e802> \u0037i79a21a30o50a723;
    private readonly SemaphoreSlim u15131ou6u326uu6a;
    private readonly TaskCompletionSource<object> \u0034294e2e42517aeuie;
    private readonly Memory<byte> auo8ea59oua1ei3u4;
    private readonly CancellationTokenSource \u0031a2i105537574e849;
    private int e8io833o15u170960;

    public event EventHandler<io237335e6aoe67ia.au7a662io2e9029o9> \u0032997ia7u9o41io7o3;

    public Task a7336e5658ai776e2 => (Task) this.\u0034294e2e42517aeuie.Task;

    public TraceSource ee7a27i841680370a { get; }

    bool IDisposableObservable.au99uua1u2u2136a9 => this.a7336e5658ai776e2.IsCompleted;

    internal CancellationToken \u0034159io75986154ea0 => this.\u0031a2i105537574e849.Token;

    public static Task<io237335e6aoe67ia> a574755a32e592088(
      Stream _param0,
      CancellationToken _param1 = default (CancellationToken))
    {
      return io237335e6aoe67ia.\u0038u522ua12e24418e1(_param0, (io237335e6aoe67ia.a374a44630e41ai56) null, _param1);
    }

    public static Task<io237335e6aoe67ia> \u0038u522ua12e24418e1(
      Stream _param0,
      io237335e6aoe67ia.a374a44630e41ai56 _param1,
      CancellationToken _param2 = default (CancellationToken))
    {
      // ISSUE: variable of a compiler-generated type
      io237335e6aoe67ia.e378ei3e4i0162345 stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003146oeo513eai49u39 = _param0;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003069i7iu1i07e77698 = _param1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0033e1e35aea270a4o83 = _param2;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003759104i67e1440aee = AsyncTaskMethodBuilder<io237335e6aoe67ia>.Create();
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0034ei652620818a804o = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003759104i67e1440aee.Start<io237335e6aoe67ia.e378ei3e4i0162345>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.\u003759104i67e1440aee.Task;
    }

    public io237335e6aoe67ia.\u00367o541ue04689e802 \u0034u16u439224e32049(
      io237335e6aoe67ia.a3e56310oe5u6a90a _param1 = null)
    {
      // ISSUE: object of a compiler-generated type is created
      io237335e6aoe67ia.\u00367o541ue04689e802 obj = (io237335e6aoe67ia.\u00367o541ue04689e802) new \u0030o62142014631ei62.oiu125o5e680a913o(this, this.\u0036o1o232o90428651o(), string.Empty, _param1 ?? io237335e6aoe67ia.\u00312a2391a4u5aiu403);
      lock (this.u25143139e2e1ooii)
        this.\u0037i79a21a30o50a723.Add(obj.uua0ia13i53590418, obj);
      this.\u0039u87e74785i452u08(io237335e6aoe67ia.\u00375u255ua217i43389.Offer, obj.uua0ia13i53590418);
      return obj;
    }

    public io237335e6aoe67ia.\u00367o541ue04689e802 \u00341097o7auo98ao22i(
      int _param1,
      io237335e6aoe67ia.a3e56310oe5u6a90a _param2 = null)
    {
      io237335e6aoe67ia.\u00367o541ue04689e802 obj;
      lock (this.u25143139e2e1ooii)
      {
        Verify.Operation(this.\u0037i79a21a30o50a723.TryGetValue(_param1, out obj), "No channel with that ID found.");
        if (obj.\u0033i40uoe075301ao07 != null)
        {
          Queue<io237335e6aoe67ia.\u00367o541ue04689e802> ae8u430uo98e458o5;
          if (this.\u003246787374u679631i.TryGetValue(obj.\u0033i40uoe075301ao07, out ae8u430uo98e458o5))
            ae8u430uo98e458o5.\u003017ue4276o7ie4856<io237335e6aoe67ia.\u00367o541ue04689e802>(obj);
        }
      }
      this.\u0036659uua4eiui7o63o(obj, _param2);
      return obj;
    }

    public void \u0037iiuu4ue902i7597a(int i2449a5i3ia9aeu38)
    {
      io237335e6aoe67ia.\u00367o541ue04689e802 obj;
      lock (this.u25143139e2e1ooii)
      {
        Verify.Operation(this.\u0037i79a21a30o50a723.TryGetValue(i2449a5i3ia9aeu38, out obj), "No channel with that ID found.");
        if (obj.\u0033i40uoe075301ao07 != null)
        {
          Queue<io237335e6aoe67ia.\u00367o541ue04689e802> ae8u430uo98e458o5;
          if (this.\u003246787374u679631i.TryGetValue(obj.\u0033i40uoe075301ao07, out ae8u430uo98e458o5))
            ae8u430uo98e458o5.\u003017ue4276o7ie4856<io237335e6aoe67ia.\u00367o541ue04689e802>(obj);
        }
      }
      obj.a0o7ai18066o4o078();
    }

    public Task<io237335e6aoe67ia.\u00367o541ue04689e802> oei2aa934oe1ii77o(
      string _param1,
      CancellationToken _param2)
    {
      return this.\u00313oe19u34a24eoi76(_param1, \u003050a9o68o2u88i543: _param2);
    }

    public Task<io237335e6aoe67ia.\u00367o541ue04689e802> \u00313oe19u34a24eoi76(
      string _param1,
      io237335e6aoe67ia.a3e56310oe5u6a90a ouie7a3e8808241e9 = null,
      CancellationToken _param3 = default (CancellationToken))
    {
      // ISSUE: variable of a compiler-generated type
      io237335e6aoe67ia.\u00339470084444o8ii43 stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u00326a4481i3ae767161 = this;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003046o697oau70e7ooo = _param1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0034o44637084e76u44a = ouie7a3e8808241e9;
      // ISSUE: reference to a compiler-generated field
      stateMachine.a0u1ee95e728a7o43 = _param3;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003975uio3i30eee5841 = AsyncTaskMethodBuilder<io237335e6aoe67ia.\u00367o541ue04689e802>.Create();
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u00391907oo55o8u9i031 = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003975uio3i30eee5841.Start<io237335e6aoe67ia.\u00339470084444o8ii43>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.\u003975uio3i30eee5841.Task;
    }

    public Task<io237335e6aoe67ia.\u00367o541ue04689e802> eai4e37e42e22582o(
      string _param1,
      CancellationToken a8ii15e3e4u2ae0ui)
    {
      return this.u85o583a751259u83(_param1, \u0036aa4437529oo2i68a: a8ii15e3e4u2ae0ui);
    }

    public Task<io237335e6aoe67ia.\u00367o541ue04689e802> u85o583a751259u83(
      string _param1,
      io237335e6aoe67ia.a3e56310oe5u6a90a _param2 = null,
      CancellationToken _param3 = default (CancellationToken))
    {
      // ISSUE: variable of a compiler-generated type
      io237335e6aoe67ia.i7e3o616o28u3a3u8 stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0037328001i3131376e1 = this;
      // ISSUE: reference to a compiler-generated field
      stateMachine.ua5o58u18542u92au = _param1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u00338319765u6u4a8e78 = _param2;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0034a72i08002531875o = _param3;
      // ISSUE: reference to a compiler-generated field
      stateMachine.e2492ioa54i488i1i = AsyncTaskMethodBuilder<io237335e6aoe67ia.\u00367o541ue04689e802>.Create();
      // ISSUE: reference to a compiler-generated field
      stateMachine.o4uao1a181370iio8 = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.e2492ioa54i488i1i.Start<io237335e6aoe67ia.i7e3o616o28u3a3u8>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.e2492ioa54i488i1i.Task;
    }

    public void o98348oa7o9204538() => this.Dispose(true);

    protected virtual void Dispose(bool disposing)
    {
      if (!disposing)
        return;
      this.\u0031a2i105537574e849.Cancel();
      this.\u0034294e2e42517aeuie.TrySetResult((object) null);
      if (this.ee7a27i841680370a.Switch.ShouldTrace(TraceEventType.Information))
        this.ee7a27i841680370a.TraceEvent(TraceEventType.Information, 5, "Disposing.");
      this.\u00382a3507u917046ui0.Dispose();
      lock (this.u25143139e2e1ooii)
      {
        foreach (KeyValuePair<int, io237335e6aoe67ia.\u00367o541ue04689e802> keyValuePair in this.\u0037i79a21a30o50a723)
          keyValuePair.Value.a0o7ai18066o4o078();
        foreach (KeyValuePair<string, Queue<TaskCompletionSource<io237335e6aoe67ia.\u00367o541ue04689e802>>> keyValuePair in this.u829943ai68833u3e)
        {
          foreach (TaskCompletionSource<io237335e6aoe67ia.\u00367o541ue04689e802> completionSource in keyValuePair.Value)
            completionSource.TrySetCanceled();
        }
        this.\u0037i79a21a30o50a723.Clear();
        this.\u003246787374u679631i.Clear();
        this.u829943ai68833u3e.Clear();
      }
    }

    protected virtual void OnChannelOffered(io237335e6aoe67ia.au7a662io2e9029o9 args)
    {
      // ISSUE: reference to a compiler-generated field
      EventHandler<io237335e6aoe67ia.au7a662io2e9029o9> eventHandler = this.\u0035u63a47942u205u4e;
      if (eventHandler == null)
        return;
      eventHandler((object) this, args);
    }

    private static ValueTask<bool> o31e60883007eieei(
      Stream _param0,
      Memory<byte> _param1,
      bool _param2,
      CancellationToken _param3)
    {
      // ISSUE: variable of a compiler-generated type
      io237335e6aoe67ia.\u0031747oe842u6029io6 obj;
      // ISSUE: reference to a compiler-generated field
      obj.\u00320i7u8o1ei2447a01 = _param0;
      // ISSUE: reference to a compiler-generated field
      obj.i8a4o17i12741415e = _param1;
      // ISSUE: reference to a compiler-generated field
      obj.a5aaieoa299ua4e09 = _param2;
      // ISSUE: reference to a compiler-generated field
      obj.\u0035ea11o121481i1i6u = _param3;
      // ISSUE: reference to a compiler-generated field
      obj.aaae4u98769083i5o = AsyncValueTaskMethodBuilder<bool>.Create();
      // ISSUE: reference to a compiler-generated field
      obj.\u00349410e9ao68491287 = -1;
      // ISSUE: reference to a compiler-generated field
      obj.aaae4u98769083i5o.Start<io237335e6aoe67ia.\u0031747oe842u6029io6>(ref obj);
      // ISSUE: reference to a compiler-generated field
      return obj.aaae4u98769083i5o.Task;
    }

    private static ReadOnlyMemory<T> \u00336a761a9o43468i52<T>(
      ReadOnlySequence<T> _param0,
      Memory<T> u1521i8370u082664)
    {
      if (_param0.IsSingleSegment)
        return _param0.First;
      BuffersExtensions.CopyTo<T>(ref _param0, u1521i8370u082664.Span);
      return Memory<T>.op_Implicit(u1521i8370u082664.Slice(0, (int) _param0.Length));
    }

    private static unsafe string \u003801u42a161374885o(ReadOnlyMemory<byte> e3i1o73aae825a69u)
    {
      using (MemoryHandle memoryHandle = e3i1o73aae825a69u.Pin())
        return io237335e6aoe67ia.ei161u2auiu10987a.GetString((byte*) ((MemoryHandle) ref memoryHandle).Pointer, e3i1o73aae825a69u.Length);
    }

    private static Task \u0035a3o080i59oau12ue(
      Stream a9i0e7aau6i8e4160,
      ArraySegment<byte> aa07e5315eao07037,
      CancellationToken iee617ee2ue6445ao)
    {
      // ISSUE: variable of a compiler-generated type
      io237335e6aoe67ia.u921oe9e04i8704u7 stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003183693962ea2501o0 = a9i0e7aau6i8e4160;
      // ISSUE: reference to a compiler-generated field
      stateMachine.eu30u777aioa3u15o = aa07e5315eao07037;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0036o30592911o33e6oo = iee617ee2ue6445ao;
      // ISSUE: reference to a compiler-generated field
      stateMachine.iaee71057e120i4u7 = AsyncTaskMethodBuilder.Create();
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u00306345oaa995eao5i9 = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.iaee71057e120i4u7.Start<io237335e6aoe67ia.u921oe9e04i8704u7>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.iaee71057e120i4u7.Task;
    }

    private Task \u003922eio16oi2ua59ao()
    {
      // ISSUE: variable of a compiler-generated type
      io237335e6aoe67ia.\u003307ue14uoo5oa5200 stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u00383eae7695321384u4 = this;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0039o7307587u5443305 = AsyncTaskMethodBuilder.Create();
      // ISSUE: reference to a compiler-generated field
      stateMachine.i1i0u5a89euoeu5o6 = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0039o7307587u5443305.Start<io237335e6aoe67ia.\u003307ue14uoo5oa5200>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.\u0039o7307587u5443305.Task;
    }

    private void \u00307eua29o1o3u0i229(int _param1)
    {
      io237335e6aoe67ia.\u00367o541ue04689e802 obj;
      lock (this.u25143139e2e1ooii)
      {
        if (this.\u0037i79a21a30o50a723.TryGetValue(_param1, out obj))
        {
          this.\u0037i79a21a30o50a723.Remove(_param1);
          if (obj.\u0033i40uoe075301ao07 != null)
          {
            Queue<io237335e6aoe67ia.\u00367o541ue04689e802> ae8u430uo98e458o5;
            if (this.\u003246787374u679631i.TryGetValue(obj.\u0033i40uoe075301ao07, out ae8u430uo98e458o5))
              ae8u430uo98e458o5.\u003017ue4276o7ie4856<io237335e6aoe67ia.\u00367o541ue04689e802>(obj);
          }
        }
      }
      obj?.a0o7ai18066o4o078();
    }

    private void \u0036ua281e2u427o14u5(int _param1)
    {
      io237335e6aoe67ia.\u00367o541ue04689e802 obj;
      lock (this.u25143139e2e1ooii)
        obj = this.\u0037i79a21a30o50a723[_param1];
      obj.\u00340392i0i5o807e716.Complete((Exception) null);
    }

    private ValueTask<FlushResult> \u0030o2697aa914o5e0a2(
      io237335e6aoe67ia.\u00312e8ue3ue6733i408 i0i425o100e793u4a,
      CancellationToken _param2)
    {
      // ISSUE: variable of a compiler-generated type
      io237335e6aoe67ia.\u0030oiu80u94a2514o5a obj;
      // ISSUE: reference to a compiler-generated field
      obj.\u0037684uo0750ae759ei = this;
      // ISSUE: reference to a compiler-generated field
      obj.o3191942a13781443 = i0i425o100e793u4a;
      // ISSUE: reference to a compiler-generated field
      obj.i979ae9i60435i6e0 = _param2;
      // ISSUE: reference to a compiler-generated field
      obj.\u00360241uu6uaiaii6eo = AsyncValueTaskMethodBuilder<FlushResult>.Create();
      // ISSUE: reference to a compiler-generated field
      obj.\u0033ei599376a7648u2u = -1;
      // ISSUE: reference to a compiler-generated field
      obj.\u00360241uu6uaiaii6eo.Start<io237335e6aoe67ia.\u0030oiu80u94a2514o5a>(ref obj);
      // ISSUE: reference to a compiler-generated field
      return obj.\u00360241uu6uaiaii6eo.Task;
    }

    private void \u00317213e1i2866eiu55(int _param1)
    {
      io237335e6aoe67ia.\u00367o541ue04689e802 obj;
      lock (this.u25143139e2e1ooii)
      {
        if (!this.\u0037i79a21a30o50a723.TryGetValue(_param1, out obj))
          throw new e3o6133uu4i64ue4i("Unexpected channel created with ID " + (object) _param1);
      }
      if (obj.e56129689uo17u209() || !this.ee7a27i841680370a.Switch.ShouldTrace(TraceEventType.Warning))
        return;
      this.ee7a27i841680370a.TraceEvent(TraceEventType.Warning, 3, "Ignoring OfferAccepted message for channel {0} that we already canceled our offer for.", (object) obj.uua0ia13i53590418);
    }

    private ValueTask u37u286oui46617o9(
      int _param1,
      Memory<byte> _param2,
      CancellationToken _param3)
    {
      // ISSUE: variable of a compiler-generated type
      io237335e6aoe67ia.o763106ou0ai0e89a o763106ou0ai0e89a;
      // ISSUE: reference to a compiler-generated field
      o763106ou0ai0e89a.u061ee2356aei9e99 = this;
      // ISSUE: reference to a compiler-generated field
      o763106ou0ai0e89a.\u00370ia8aa74523ueioe = _param1;
      // ISSUE: reference to a compiler-generated field
      o763106ou0ai0e89a.\u0030uuoo9o49u6i9a8a8 = _param2;
      // ISSUE: reference to a compiler-generated field
      o763106ou0ai0e89a.ii63o1o9eo50ou44e = _param3;
      // ISSUE: reference to a compiler-generated field
      o763106ou0ai0e89a.i9ie31e365165e7io = AsyncValueTaskMethodBuilder.Create();
      // ISSUE: reference to a compiler-generated field
      o763106ou0ai0e89a.\u0037500u912e9eo078i6 = -1;
      // ISSUE: reference to a compiler-generated field
      AsyncValueTaskMethodBuilder i9ie31e365165e7io = o763106ou0ai0e89a.i9ie31e365165e7io;
      ((AsyncValueTaskMethodBuilder) ref i9ie31e365165e7io).Start<io237335e6aoe67ia.o763106ou0ai0e89a>(ref o763106ou0ai0e89a);
      // ISSUE: reference to a compiler-generated field
      return ((AsyncValueTaskMethodBuilder) ref o763106ou0ai0e89a.i9ie31e365165e7io).Task;
    }

    private bool oo8u81o7uau58a2a2(
      io237335e6aoe67ia.\u00367o541ue04689e802 uu30i9a5i2i29755o,
      io237335e6aoe67ia.a3e56310oe5u6a90a _param2)
    {
      Requires.NotNull<io237335e6aoe67ia.\u00367o541ue04689e802>(uu30i9a5i2i29755o, "channel");
      if (!uu30i9a5i2i29755o.\u00372ee97ei914ua58a3(_param2))
        return false;
      this.\u0039u87e74785i452u08(io237335e6aoe67ia.\u00375u255ua217i43389.OfferAccepted, uu30i9a5i2i29755o.uua0ia13i53590418);
      return true;
    }

    private void \u0036659uua4eiui7o63o(
      io237335e6aoe67ia.\u00367o541ue04689e802 _param1,
      io237335e6aoe67ia.a3e56310oe5u6a90a _param2)
    {
      if (this.oo8u81o7uau58a2a2(_param1, _param2))
        return;
      if (_param1.eouae63646u81i207)
        throw new InvalidOperationException("Channel is already accepted.");
      if (_param1.uo5524i2e6a472594)
        throw new InvalidOperationException("Channel is no longer available for acceptance.");
      throw new InvalidOperationException("Channel could not be accepted.");
    }

    private void \u003672961716ia884490(io237335e6aoe67ia.\u00367o541ue04689e802 _param1)
    {
      Requires.NotNull<io237335e6aoe67ia.\u00367o541ue04689e802>(_param1, "channel");
      if (this.a7336e5658ai776e2.IsCompleted)
        return;
      if (this.ee7a27i841680370a.Switch.ShouldTrace(TraceEventType.Information))
        this.ee7a27i841680370a.TraceEvent(TraceEventType.Information, 10, "Local channel \"{0}\" stream disposed.", (object) _param1.\u0033i40uoe075301ao07);
      this.\u0039u87e74785i452u08(io237335e6aoe67ia.\u00375u255ua217i43389.ChannelTerminated, _param1.uua0ia13i53590418);
    }

    private void \u00304o518e6a2819237a(
      io237335e6aoe67ia.\u00367o541ue04689e802 e6u0a0194aao3709e)
    {
      Requires.NotNull<io237335e6aoe67ia.\u00367o541ue04689e802>(e6u0a0194aao3709e, "channel");
      lock (this.u25143139e2e1ooii)
      {
        if (e6u0a0194aao3709e.\u0039714884i092iii132 || !this.\u0037i79a21a30o50a723.ContainsKey(e6u0a0194aao3709e.uua0ia13i53590418))
          return;
        this.\u0039u87e74785i452u08(io237335e6aoe67ia.\u00375u255ua217i43389.ContentWritingCompleted, e6u0a0194aao3709e.uua0ia13i53590418);
      }
    }

    private void \u0039u87e74785i452u08(
      io237335e6aoe67ia.\u00375u255ua217i43389 _param1,
      int e1777i714e16e7221)
    {
      if (this.a7336e5658ai776e2.IsCompleted)
        return;
      this.\u0034e458i04667iu9aa6(this.u81a5340o8441i148(new io237335e6aoe67ia.\u00312e8ue3ue6733i408()
      {
        u064iea593372o98e = _param1,
        ioi81uiua43u206i0 = e1777i714e16e7221,
        aou6o2506e1708ui3 = 0
      }, new ReadOnlySequence<byte>(), CancellationToken.None));
    }

    private Task ooooo6a963o483iou(CancellationToken _param1)
    {
      // ISSUE: variable of a compiler-generated type
      io237335e6aoe67ia.\u003728oeo7o2a9913001 stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u00399527986a6iu5ua02 = this;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0030032650ee6e22a453 = _param1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003022736669482a8806 = AsyncTaskMethodBuilder.Create();
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003588e6617i972354aa = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003022736669482a8806.Start<io237335e6aoe67ia.\u003728oeo7o2a9913001>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.\u003022736669482a8806.Task;
    }

    private Task u81a5340o8441i148(
      io237335e6aoe67ia.\u00312e8ue3ue6733i408 _param1,
      ReadOnlySequence<byte> _param2,
      CancellationToken _param3)
    {
      // ISSUE: variable of a compiler-generated type
      io237335e6aoe67ia.\u0037i45o3a7u2393376e stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003315ao49ua3e5o968i = this;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0037917oi3e371eou686 = _param1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0035o1o0761e2au04eu1 = _param2;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u00352e12411e32149167 = _param3;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u00321u16e9iu3i8o835i = AsyncTaskMethodBuilder.Create();
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003247ui0e0i2i7e48i9 = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u00321u16e9iu3i8o835i.Start<io237335e6aoe67ia.\u0037i45o3a7u2393376e>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.\u00321u16e9iu3i8o835i.Task;
    }

    private int \u0036o1o232o90428651o() => Interlocked.Add(ref this.e8io833o15u170960, 2);

    private void \u00356e4089u592ou100o(object au1474eu19e7ou4oo)
    {
      Requires.NotNull<object>(au1474eu19e7ou4oo, "state");
      io237335e6aoe67ia.\u00367o541ue04689e802 obj = (io237335e6aoe67ia.\u00367o541ue04689e802) au1474eu19e7ou4oo;
      if (this.ee7a27i841680370a.Switch.ShouldTrace(TraceEventType.Information))
        this.ee7a27i841680370a.TraceEvent(TraceEventType.Information, 11, "Offer of channel {1} (\"{0}\") canceled.", (object) obj.\u0033i40uoe075301ao07, (object) obj.uua0ia13i53590418);
      obj.a0o7ai18066o4o078();
    }

    private void \u003050ao8669e1u94a13(object _param1)
    {
      Requires.NotNull<object>(_param1, "state");
      TaskCompletionSource<io237335e6aoe67ia.\u00367o541ue04689e802> completionSource1;
      string str;
      ((Tuple<TaskCompletionSource<io237335e6aoe67ia.\u00367o541ue04689e802>, string>) _param1).Deconstruct<TaskCompletionSource<io237335e6aoe67ia.\u00367o541ue04689e802>, string>(out completionSource1, out str);
      TaskCompletionSource<io237335e6aoe67ia.\u00367o541ue04689e802> completionSource2 = completionSource1;
      string key = str;
      if (completionSource2.TrySetCanceled())
      {
        if (this.ee7a27i841680370a.Switch.ShouldTrace(TraceEventType.Information))
          this.ee7a27i841680370a.TraceEvent(TraceEventType.Information, 8, "Cancelling AcceptChannelAsync for \"{0}\"", (object) key);
        lock (this.u25143139e2e1ooii)
        {
          Queue<TaskCompletionSource<io237335e6aoe67ia.\u00367o541ue04689e802>> ae8u430uo98e458o5;
          if (!this.u829943ai68833u3e.TryGetValue(key, out ae8u430uo98e458o5))
            return;
          Assumes.True(ae8u430uo98e458o5.\u003017ue4276o7ie4856<TaskCompletionSource<io237335e6aoe67ia.\u00367o541ue04689e802>>(completionSource2), (string) null);
        }
      }
      else
      {
        if (!this.ee7a27i841680370a.Switch.ShouldTrace(TraceEventType.Information))
          return;
        this.ee7a27i841680370a.TraceEvent(TraceEventType.Information, 8, "Cancelling AcceptChannelAsync for \"{0}\" attempted but failed.", (object) key);
      }
    }

    private void \u0034e458i04667iu9aa6(Task o765u8iioa124eu12)
    {
      Requires.NotNull(o765u8iioa124eu12, "task");
      if (o765u8iioa124eu12.IsCompleted)
      {
        if (!o765u8iioa124eu12.IsFaulted)
          return;
        this.\u003009ua0e37i93e7376(o765u8iioa124eu12.Exception.InnerException ?? (Exception) o765u8iioa124eu12.Exception);
      }
      else
        TplExtensions.Forget(o765u8iioa124eu12.ContinueWith((Action<Task, object>) ((o8u55u345916e67e4, _param2) => ((io237335e6aoe67ia) _param2).\u003009ua0e37i93e7376(o8u55u345916e67e4.Exception.InnerException ?? (Exception) o8u55u345916e67e4.Exception)), (object) this, CancellationToken.None, TaskContinuationOptions.OnlyOnFaulted, TaskScheduler.Default));
    }

    private void \u003009ua0e37i93e7376(Exception _param1)
    {
      if (this.ee7a27i841680370a.Switch.ShouldTrace(TraceEventType.Critical))
        this.ee7a27i841680370a.TraceEvent(TraceEventType.Critical, 2, "Disposing self due to exception: {0}", (object) _param1);
      this.\u0034294e2e42517aeuie.TrySetException(_param1);
      this.o98348oa7o9204538();
    }

    public io237335e6aoe67ia(Stream underlyingStream, long length)
      : this()
    {
      Requires.NotNull<Stream>(underlyingStream, nameof (underlyingStream));
      Requires.Range(length >= 0L, nameof (length), (string) null);
      Requires.Argument(underlyingStream.CanRead, nameof (underlyingStream), "Stream must be readable.");
      ((\u0030o247o51u472584ii) this).ia77388432926o7i0 = underlyingStream;
      ((\u0030o247o51u472584ii) this).\u00386i3i99e98io4u0o2 = length;
    }

    [DebuggerDisplay("{DebuggerDisplay}")]
    public class \u00367o541ue04689e802 : IDisposableObservable, IDisposable, IDuplexPipe
    {
      private readonly TaskCompletionSource<object> \u0032a665u01006ieoe1e;
      private readonly TaskCompletionSource<object> o45ai791i23o73486;
      private readonly Pipe \u0035ia8425542oo19219;
      private readonly Pipe \u0030i9oaa29277u80828;

      public int uua0ia13i53590418 { get; }

      public TraceSource oo8i96aa506308u2o { get; private set; }

      public bool \u0039714884i092iii132 => this.\u0030u61o1o123i500a7e.IsCompleted;

      public PipeReader \u0031e0341oo874u77e61 => this.\u0035ia8425542oo19219.Reader;

      public PipeWriter \u0034ii737ueaua12o226 => this.\u0030i9oaa29277u80828.Writer;

      public Task \u0037uu2u4a9u7884eaoe => (Task) this.\u0032a665u01006ieoe1e.Task;

      public Task \u0030u61o1o123i500a7e => (Task) this.o45ai791i23o73486.Task;

      internal io237335e6aoe67ia \u0039208e6a5386965ae3 { get; }

      internal string \u0033i40uoe075301ao07 { get; set; }

      internal bool eouae63646u81i207 => this.\u0037uu2u4a9u7884eaoe.Status == TaskStatus.RanToCompletion;

      internal bool uo5524i2e6a472594 => this.\u0037uu2u4a9u7884eaoe.Status == TaskStatus.Canceled;

      internal PipeWriter \u00340392i0i5o807e716 => this.\u0035ia8425542oo19219.Writer;

      private string u42ioo0i5ei639521 => string.Format("{0} {1}", (object) this.uua0ia13i53590418, (object) (this.\u0033i40uoe075301ao07 ?? "(anonymous)"));

      public void a0o7ai18066o4o078()
      {
        if (this.\u0039714884i092iii132)
          return;
        this.\u0032a665u01006ieoe1e.TrySetCanceled();
        this.\u0035ia8425542oo19219.Writer.Complete((Exception) null);
        this.\u0030i9oaa29277u80828.Reader.Complete((Exception) null);
        this.o45ai791i23o73486.TrySetResult((object) null);
        this.\u0039208e6a5386965ae3.\u003672961716ia884490(this);
      }

      internal bool \u00372ee97ei914ua58a3(io237335e6aoe67ia.a3e56310oe5u6a90a _param1)
      {
        if (!this.\u0032a665u01006ieoe1e.TrySetResult((object) null))
          return false;
        if (_param1 != null && _param1.\u0038e09905eo7oa7u292 != null)
          this.oo8i96aa506308u2o = _param1.\u0038e09905eo7oa7u292;
        return true;
      }

      internal void o27o3a7352300ei16()
      {
        this.\u0039208e6a5386965ae3.\u003672961716ia884490(this);
        this.a0o7ai18066o4o078();
      }

      internal bool e56129689uo17u209() => this.\u0032a665u01006ieoe1e.TrySetResult((object) null);

      private Task i6u1a977346110e1u()
      {
        // ISSUE: variable of a compiler-generated type
        io237335e6aoe67ia.\u00367o541ue04689e802.\u003008509480o237euao stateMachine;
        // ISSUE: reference to a compiler-generated field
        stateMachine.\u00329o8a1i2i70834i70 = this;
        // ISSUE: reference to a compiler-generated field
        stateMachine.\u0039ioa6e4i90014iu21 = AsyncTaskMethodBuilder.Create();
        // ISSUE: reference to a compiler-generated field
        stateMachine.\u00387aoe184e1u9i02a9 = -1;
        // ISSUE: reference to a compiler-generated field
        stateMachine.\u0039ioa6e4i90014iu21.Start<io237335e6aoe67ia.\u00367o541ue04689e802.\u003008509480o237euao>(ref stateMachine);
        // ISSUE: reference to a compiler-generated field
        return stateMachine.\u0039ioa6e4i90014iu21.Task;
      }

      private Task i5u3ao890787383o0()
      {
        // ISSUE: variable of a compiler-generated type
        io237335e6aoe67ia.\u00367o541ue04689e802.\u0033e36oe382eaa872i0 stateMachine;
        // ISSUE: reference to a compiler-generated field
        stateMachine.i1ia01i4018o54359 = this;
        // ISSUE: reference to a compiler-generated field
        stateMachine.\u00310i18131a6o68715o = AsyncTaskMethodBuilder.Create();
        // ISSUE: reference to a compiler-generated field
        stateMachine.\u00364eie0996o99a6188 = -1;
        // ISSUE: reference to a compiler-generated field
        stateMachine.\u00310i18131a6o68715o.Start<io237335e6aoe67ia.\u00367o541ue04689e802.\u0033e36oe382eaa872i0>(ref stateMachine);
        // ISSUE: reference to a compiler-generated field
        return stateMachine.\u00310i18131a6o68715o.Task;
      }

      private void \u00354i7a05a670u7oo33(Exception _param1)
      {
        if (this.oo8i96aa506308u2o.Switch.ShouldTrace(TraceEventType.Critical))
          this.oo8i96aa506308u2o.TraceEvent(TraceEventType.Critical, 2, "67o541ue04689e802 Closing self due to exception: {0}", (object) _param1);
        this.\u0030i9oaa29277u80828.Reader.Complete(_param1);
        this.a0o7ai18066o4o078();
      }

      private void \u003489674o1ea5aao746(Task eao8739244e50e118)
      {
        Requires.NotNull(eao8739244e50e118, "task");
        if (eao8739244e50e118.IsCompleted)
        {
          if (!eao8739244e50e118.IsFaulted)
            return;
          this.\u00354i7a05a670u7oo33(eao8739244e50e118.Exception.InnerException ?? (Exception) eao8739244e50e118.Exception);
        }
        else
          TplExtensions.Forget(eao8739244e50e118.ContinueWith((Action<Task, object>) ((a8aoi4o8iei54uou6, ae8u1o1io05e6e58e) => ((io237335e6aoe67ia.\u00367o541ue04689e802) ae8u1o1io05e6e58e).\u00354i7a05a670u7oo33(a8aoi4o8iei54uou6.Exception.InnerException ?? (Exception) a8aoi4o8iei54uou6.Exception)), (object) this, CancellationToken.None, TaskContinuationOptions.OnlyOnFaulted, TaskScheduler.Default));
      }

      internal \u00367o541ue04689e802(int id, string name, bool isAccepted)
        : this()
      {
        // ISSUE: reference to a compiler-generated field
        ((io237335e6aoe67ia.au7a662io2e9029o9) this).o128ouo14554i06ua = id;
        // ISSUE: reference to a compiler-generated field
        ((io237335e6aoe67ia.au7a662io2e9029o9) this).\u0033uuoeo36uao0907a6 = name;
        // ISSUE: reference to a compiler-generated field
        ((io237335e6aoe67ia.au7a662io2e9029o9) this).\u00364i1u34o4ei997ii6 = isAccepted;
      }
    }

    public class au7a662io2e9029o9 : EventArgs
    {
      public int \u0032048a8uu8250345o3 { get; }

      public string u3070io47e35a90e5 { get; }

      public bool \u00389u89332710auoa89 { get; }
    }

    public class a3e56310oe5u6a90a
    {
      public TraceSource \u0038e09905eo7oa7u292 { get; set; }

      [SpecialName]
      internal static int get_HeaderLength() => 7;
    }

    private enum \u00375u255ua217i43389 : byte
    {
      Offer,
      OfferAccepted,
      Content,
      ContentWritingCompleted,
      ChannelTerminated,
    }

    private enum i71o9783u11u83e2i
    {
      HandshakeSuccessful,
      HandshakeFailed,
      FatalError,
      UnexpectedChannelAccept,
      ChannelAutoClosing,
      StreamDisposed,
      AcceptChannelWaiting,
      AcceptChannelAlreadyOffered,
      AcceptChannelCanceled,
      ChannelOfferReceived,
      ChannelDisposed,
      OfferChannelCanceled,
      FrameSent,
      FrameReceived,
      FrameSentPayload,
      FrameReceivedPayload,
    }

    private struct \u00312e8ue3ue6733i408
    {
      internal static int u546721i76o5e83u0
      {
        [SpecialName] get => 7;
      }

      internal io237335e6aoe67ia.\u00375u255ua217i43389 u064iea593372o98e { get; set; }

      internal int ioi81uiua43u206i0 { get; set; }

      internal int aou6o2506e1708ui3 { get; set; }

      internal static io237335e6aoe67ia.\u00312e8ue3ue6733i408 \u0032o71eu10e320uiia0(
        ReadOnlySpan<byte> _param0)
      {
        Requires.Argument(_param0.Length == io237335e6aoe67ia.a3e56310oe5u6a90a.get_HeaderLength(), "buffer", "Buffer must be header length.");
        return new io237335e6aoe67ia.\u00312e8ue3ue6733i408()
        {
          u064iea593372o98e = (io237335e6aoe67ia.\u00375u255ua217i43389) _param0[0],
          ioi81uiua43u206i0 = u3021uoee96187e83.\u0035348334141u28361u(_param0.Slice(1, 4)),
          aou6o2506e1708ui3 = u3021uoee96187e83.\u0035348334141u28361u(_param0.Slice(5, 2))
        };
      }

      internal void \u003702208306e9386929(Span<byte> _param1)
      {
        Requires.Argument(_param1.Length == io237335e6aoe67ia.a3e56310oe5u6a90a.get_HeaderLength(), "buffer", "Buffer must be header length.");
        _param1[0] = (byte) this.u064iea593372o98e;
        u3021uoee96187e83.i2o3iuee4ue041450(_param1.Slice(1, 4), this.ioi81uiua43u206i0);
        u3021uoee96187e83.\u0039510a4e25u5654533(_param1.Slice(5, 2), (ushort) this.aou6o2506e1708ui3);
      }

      [SpecialName]
      public TraceSource get_TraceSource() => (^(io237335e6aoe67ia.a374a44630e41ai56&) ref this).\u00385a821e7a60uoau61;
    }

    public class a374a44630e41ai56
    {
      private TraceSource \u00385a821e7a60uoau61 = new TraceSource("MultiplexingStream", SourceLevels.Critical);

      public TraceSource \u0032a27o382393217u81
      {
        [SpecialName] get => (^(io237335e6aoe67ia.a374a44630e41ai56&) ref this).\u00385a821e7a60uoau61;
        set
        {
          Requires.NotNull<TraceSource>(value, nameof (value));
          this.\u00385a821e7a60uoau61 = value;
        }
      }

      private void \u00357u22e69eu5909820()
      {
        // ISSUE: unable to decompile the method.
      }
    }
  }
}
