// Decompiled with JetBrains decompiler
// Type: u1QgJKQJKYhz7.vmgkKHlLDILn4
// Assembly: Udby4Jt48oXkJ, Version=3.17.2.31, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
// MVID: 37899E89-D673-4F5B-A193-2E4DF6A54096
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.MSIL.Gorgon.gen-bf535869266eca7a958714acade2ede1bff0e73f0aaa2702f389ededee6a8d6a.exe

using \u0031QlkzJZBRpL9X;
using \u0036mHL90hQ651VX;
using bu8pNrX0TZwPh;
using C5vXuJJXlKLsz;
using ceA4g63ooLxLL;
using crbLK9c6NNzhr;
using DeEOd4t4s8aNC;
using DrtahteR2mfQY;
using dyHCVWuthaSsK;
using HqLTLdqt37SZu;
using hujG0QbsYScYh;
using jOeQ7EJbTbCTw;
using KOByjZAY6KWH4;
using O4LdamDRj1Bfo;
using ozBQ0i9pPHFwI;
using QSS3PlDQAyMp9;
using RyoVh3LEVVetm;
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Runtime.CompilerServices;
using System.Threading.Tasks;
using u41D9eBpCXrDi;
using wRO897uUcpmYd;
using yE0EiDmmbWE5z;
using zEyumjZP9noHu;
using ZL5KLxyBdwApi;

namespace u1QgJKQJKYhz7
{
  internal abstract class vmgkKHlLDILn4
  {
    protected const string NullResource = "null_resource_as_optional";
    protected static readonly Task CompletedTask = (Task) Task.FromResult<bool>(false);
    private readonly mmmB47sOgxXDe \u0035kOhYGkIFGyIH;
    protected readonly IDictionary<string, string> brokerParameters;
    protected \u0038O7Jpl7WloY9G CacheQueryData = new \u0038O7Jpl7WloY9G();
    protected readonly kMEY2SobgXcEX brokerHelper = new kMEY2SobgXcEX();
    private ykkPlLjyntbr5 \u0035F6C3t3EdNqFF;
    protected HgU9ZQtKaZBWN platformInformation = new HgU9ZQtKaZBWN();

    protected vmgkKHlLDILn4(z7eJc8CpoGMSq requestData)
    {
      this.\u00396xFrZPZRXYHo = requestData.\u0036ttRNCcehmULN;
      this.xngTL11QRuwcB = vmgkKHlLDILn4.b7NJHkAt5Gsmo(this.\u00396xFrZPZRXYHo.rhafajw6KTC34);
      this.brokerHelper.\u0034uUAjOFn6wti5 = this.xngTL11QRuwcB;
      this.xngTL11QRuwcB.\u0031CII3TGnWWaPA.wRuYhG7t3Jqcm((Up2ciG6wVdM5T) null, string.Format((IFormatProvider) CultureInfo.CurrentCulture, "ADAL {0} with assembly version '{1}', file version '{2}' and informational version '{3}' is running...", (object) this.platformInformation.cZ8YS5Oy1ejJU(), (object) GJEiDscb2qzH7.\u0039fmFdguYAgAMz(), (object) GJEiDscb2qzH7.m12tIIuHEBh1J(), (object) GJEiDscb2qzH7.ckkJ3357Z26xO()), "E:\\A\\_work\\115\\s\\src\\Microsoft.IdentityModel.Clients.ActiveDirectory\\Internal\\Flows\\vmgkKHlLDILn4.cs");
      \u0032QyqUxR49Y8x9 obj = this.xngTL11QRuwcB.\u0031CII3TGnWWaPA;
      Up2ciG6wVdM5T xngTl11QruwcB = this.xngTL11QRuwcB;
      CultureInfo currentCulture = CultureInfo.CurrentCulture;
      object[] objArray = new object[5]
      {
        (object) requestData.\u0036ttRNCcehmULN.zhjvQCF1C6DTp,
        (object) requestData.IBZlrn6tkj8Zz,
        (object) requestData.I5yi3FLxXLkNu.a5ixq1JzNmU1F,
        null,
        null
      };
      string str;
      if (this.\u0035kOhYGkIFGyIH == null)
        str = "null";
      else
        str = this.\u0035kOhYGkIFGyIH.GetType().FullName + string.Format((IFormatProvider) CultureInfo.CurrentCulture, " ({0} items)", new object[1]
        {
          (object) this.\u0035kOhYGkIFGyIH.q1SLGejmyGeYe
        });
      objArray[3] = (object) str;
      objArray[4] = (object) requestData.\u0031Ghr9anYeHksc;
      string iXuSpIMprpLrb = string.Format((IFormatProvider) currentCulture, "=== Token Acquisition started:\n\tAuthority: {0}\n\tResource: {1}\n\tClientId: {2}\n\tCacheType: {3}\n\tAuthentication Target: {4}\n\t", objArray);
      obj.wRuYhG7t3Jqcm(xngTl11QruwcB, iXuSpIMprpLrb, "E:\\A\\_work\\115\\s\\src\\Microsoft.IdentityModel.Clients.ActiveDirectory\\Internal\\Flows\\vmgkKHlLDILn4.cs");
      this.\u0035kOhYGkIFGyIH = requestData.rnVyzzJfpc432;
      if (string.IsNullOrWhiteSpace(requestData.IBZlrn6tkj8Zz))
        throw new ArgumentNullException("resource");
      this.sJvtWrimEepI7 = requestData.IBZlrn6tkj8Zz != "null_resource_as_optional" ? requestData.IBZlrn6tkj8Zz : (string) null;
      this.hJC3ityuMYbnG = requestData.I5yi3FLxXLkNu;
      this.\u00382TAm7XnFYFYX = requestData.\u0031Ghr9anYeHksc;
      this.Y0M4cVFfxJYK1 = this.\u0035kOhYGkIFGyIH != null;
      this.sqngMitBREpni = this.\u0035kOhYGkIFGyIH != null;
      this.wv77vsl2OHrKS = false;
      this.brokerParameters = (IDictionary<string, string>) new Dictionary<string, string>();
      this.brokerParameters["authority"] = requestData.\u0036ttRNCcehmULN.zhjvQCF1C6DTp;
      this.brokerParameters["resource"] = requestData.IBZlrn6tkj8Zz;
      this.brokerParameters["client_id"] = requestData.I5yi3FLxXLkNu.a5ixq1JzNmU1F;
      this.brokerParameters["correlation_id"] = this.xngTL11QRuwcB.eZN2XN0Q86ZV4.ToString();
      this.brokerParameters["client_version"] = GJEiDscb2qzH7.\u0039fmFdguYAgAMz();
      this.nLukgESToGmrh = (OHG1qpDK4Ko7V) null;
      this.CacheQueryData.\u003990y5HezgXJYZ = requestData.yu9HEil6cFJxt;
    }

    internal Up2ciG6wVdM5T xngTL11QRuwcB { get; set; }

    protected bool wv77vsl2OHrKS { get; set; }

    protected ZXanyxTevNgJC \u00396xFrZPZRXYHo { get; set; }

    protected string sJvtWrimEepI7 { get; set; }

    protected k9GIezgLKxgFf hJC3ityuMYbnG { get; private set; }

    protected OHG1qpDK4Ko7V nLukgESToGmrh { get; set; }

    protected TsAQp4QdsQ5ZM \u00382TAm7XnFYFYX { get; private set; }

    protected string xyKZ2abKFD3mx { get; set; }

    protected string \u0037hhgMEalYqxkj { get; set; }

    protected rIKGlR6JQgdan dfcJd7GYcJsXj { get; set; }

    protected bool Y0M4cVFfxJYK1 { get; set; }

    protected bool sqngMitBREpni { get; set; }

    public Task<MbllA5kmgxVTq> DUBIAEASN1Ipj()
    {
      // ISSUE: variable of a compiler-generated type
      vmgkKHlLDILn4.bCZXukSC7RZJ1 stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0037F7rzgf0T4EBu = this;
      // ISSUE: reference to a compiler-generated field
      stateMachine.Zj2mz2FSjx0o0 = AsyncTaskMethodBuilder<MbllA5kmgxVTq>.Create();
      // ISSUE: cast to a reference type
      // ISSUE: explicit reference operation
      (^(\u0036xajKQm2H98wt.ZdKLvDTJokYFp&) ref stateMachine).fFsaeexNtp3sL = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.Zj2mz2FSjx0o0.Start<vmgkKHlLDILn4.bCZXukSC7RZJ1>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.Zj2mz2FSjx0o0.Task;
    }

    private void D7PDTtnOwBb48(ref bool zaQigkmGYCN63)
    {
      if (!this.sqngMitBREpni)
        return;
      if (!zaQigkmGYCN63)
      {
        this.\u00340uRDoIyoZFp5();
        zaQigkmGYCN63 = true;
      }
      this.\u0035kOhYGkIFGyIH.dX5Dw2fhkHNIC(this.nLukgESToGmrh, this.\u00396xFrZPZRXYHo.zhjvQCF1C6DTp, this.sJvtWrimEepI7, this.hJC3ityuMYbnG.a5ixq1JzNmU1F, this.\u00382TAm7XnFYFYX, this.xngTL11QRuwcB);
    }

    private Task rfWNYcCAeLyLm()
    {
      // ISSUE: variable of a compiler-generated type
      vmgkKHlLDILn4.HzJgrdNn3bjV6 stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0037Bzy5TNCBaAhZ = this;
      // ISSUE: reference to a compiler-generated field
      stateMachine.JuCATL1dBzL1W = AsyncTaskMethodBuilder.Create();
      // ISSUE: cast to a reference type
      // ISSUE: explicit reference operation
      // ISSUE: reference to a compiler-generated field
      (^(vmgkKHlLDILn4.bCZXukSC7RZJ1&) ref stateMachine).X9ineKQqqFzjY = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.JuCATL1dBzL1W.Start<vmgkKHlLDILn4.HzJgrdNn3bjV6>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.JuCATL1dBzL1W.Task;
    }

    protected virtual void UpdateBrokerParameters(IDictionary<string, string> parameters)
    {
    }

    protected virtual bool BrokerInvocationRequired() => false;

    public static Up2ciG6wVdM5T b7NJHkAt5Gsmo(Guid l6ZwrWNM1ecBE)
    {
      l6ZwrWNM1ecBE = l6ZwrWNM1ecBE != Guid.Empty ? l6ZwrWNM1ecBE : Guid.NewGuid();
      return new Up2ciG6wVdM5T(l6ZwrWNM1ecBE);
    }

    protected virtual Task PostRunAsync(MbllA5kmgxVTq result)
    {
      this.\u00366Yi34TYUdMX8(result);
      return vmgkKHlLDILn4.CompletedTask;
    }

    protected virtual Task PreRunAsync()
    {
      // ISSUE: variable of a compiler-generated type
      vmgkKHlLDILn4.s2s3Io7S6akVV stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0030vWiTuhBeZ7Ug = this;
      // ISSUE: reference to a compiler-generated field
      stateMachine.AaYWJECTWyVcH = AsyncTaskMethodBuilder.Create();
      // ISSUE: cast to a reference type
      // ISSUE: explicit reference operation
      // ISSUE: reference to a compiler-generated field
      (^(vmgkKHlLDILn4.HzJgrdNn3bjV6&) ref stateMachine).yrEFflN4QqSY1 = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.AaYWJECTWyVcH.Start<vmgkKHlLDILn4.s2s3Io7S6akVV>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.AaYWJECTWyVcH.Task;
    }

    protected virtual Task PreTokenRequest() => vmgkKHlLDILn4.CompletedTask;

    protected virtual void PostTokenRequest(OHG1qpDK4Ko7V result) => this.\u00396xFrZPZRXYHo.JwlbfuLnMEs4n(result.CMVqaYR8spkSL.NbIhWNFBkG1DN);

    protected abstract void AddAditionalRequestParameters(dooNxm6mSPOHK requestParameters);

    protected virtual Task<OHG1qpDK4Ko7V> SendTokenRequestAsync()
    {
      // ISSUE: variable of a compiler-generated type
      vmgkKHlLDILn4.lPdOENNLAUGHG stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.O7haz3ABbBey7 = this;
      // ISSUE: reference to a compiler-generated field
      stateMachine.lpaFe0jVgQNDO = AsyncTaskMethodBuilder<OHG1qpDK4Ko7V>.Create();
      // ISSUE: cast to a reference type
      // ISSUE: explicit reference operation
      // ISSUE: reference to a compiler-generated field
      (^(vmgkKHlLDILn4.s2s3Io7S6akVV&) ref stateMachine).\u0036DZzuWLyacpxG = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.lpaFe0jVgQNDO.Start<vmgkKHlLDILn4.lPdOENNLAUGHG>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.lpaFe0jVgQNDO.Task;
    }

    protected Task<OHG1qpDK4Ko7V> SendTokenRequestByRefreshTokenAsync(
      string refreshToken)
    {
      // ISSUE: variable of a compiler-generated type
      vmgkKHlLDILn4.\u0031Xm4RQEboYBUp stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.sUpMcXyJbNamw = this;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u00344lXlF3CGmuJh = refreshToken;
      // ISSUE: reference to a compiler-generated field
      stateMachine.OUf02ni1Z5tza = AsyncTaskMethodBuilder<OHG1qpDK4Ko7V>.Create();
      // ISSUE: cast to a reference type
      // ISSUE: explicit reference operation
      // ISSUE: reference to a compiler-generated field
      (^(vmgkKHlLDILn4.lPdOENNLAUGHG&) ref stateMachine).byfu1yvqVrAN9 = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.OUf02ni1Z5tza.Start<vmgkKHlLDILn4.\u0031Xm4RQEboYBUp>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.OUf02ni1Z5tza.Task;
    }

    private Task<OHG1qpDK4Ko7V> piDdfMrcu4dO8(OHG1qpDK4Ko7V tCd2CmheRP0fO)
    {
      // ISSUE: variable of a compiler-generated type
      vmgkKHlLDILn4.W3LLGkJ4emtir stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.ulFADn5VTzisY = this;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0037JVQUCyHlHkiG = tCd2CmheRP0fO;
      // ISSUE: reference to a compiler-generated field
      stateMachine.NOP4iV0P6GzGX = AsyncTaskMethodBuilder<OHG1qpDK4Ko7V>.Create();
      // ISSUE: cast to a reference type
      // ISSUE: explicit reference operation
      // ISSUE: reference to a compiler-generated field
      (^(vmgkKHlLDILn4.\u0031Xm4RQEboYBUp&) ref stateMachine).U06IXqdcneFcD = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.NOP4iV0P6GzGX.Start<vmgkKHlLDILn4.W3LLGkJ4emtir>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.NOP4iV0P6GzGX.Task;
    }

    private Task<OHG1qpDK4Ko7V> uLDedWFeWEOnr(IRequestParameters _param1)
    {
      // ISSUE: variable of a compiler-generated type
      vmgkKHlLDILn4.mdjMzyQz0xF8R stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.AwOxA01JlHw4i = this;
      // ISSUE: reference to a compiler-generated field
      stateMachine.BMSZoUt07j7ki = _param1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0037xeQhZY3fmfg1 = AsyncTaskMethodBuilder<OHG1qpDK4Ko7V>.Create();
      // ISSUE: cast to a reference type
      // ISSUE: explicit reference operation
      // ISSUE: reference to a compiler-generated field
      (^(vmgkKHlLDILn4.W3LLGkJ4emtir&) ref stateMachine).vcEpWzaDIX0gf = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u0037xeQhZY3fmfg1.Start<vmgkKHlLDILn4.mdjMzyQz0xF8R>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.\u0037xeQhZY3fmfg1.Task;
    }

    private void \u00340uRDoIyoZFp5() => this.\u0035kOhYGkIFGyIH.x4ORo75HDmrsT(new ZFijnBG2WYFfa()
    {
      cu7euFx8dM2ja = this.\u0035kOhYGkIFGyIH,
      vAiITLaBeG6rh = this.sJvtWrimEepI7,
      Y6LsGRDGr8QMQ = this.hJC3ityuMYbnG.a5ixq1JzNmU1F,
      PvaKCgoPMjzNm = this.xyKZ2abKFD3mx,
      aIjWNjLctPQ4N = this.\u0037hhgMEalYqxkj
    });

    private void rWrGxUYw9niIP() => this.\u0035kOhYGkIFGyIH.EQhtLjkqENEAr(new ZFijnBG2WYFfa()
    {
      cu7euFx8dM2ja = this.\u0035kOhYGkIFGyIH,
      vAiITLaBeG6rh = this.sJvtWrimEepI7,
      Y6LsGRDGr8QMQ = this.hJC3ityuMYbnG.a5ixq1JzNmU1F,
      PvaKCgoPMjzNm = this.xyKZ2abKFD3mx,
      aIjWNjLctPQ4N = this.\u0037hhgMEalYqxkj
    });

    private void \u00366Yi34TYUdMX8(MbllA5kmgxVTq s1uKoSER60Zi4)
    {
      if (s1uKoSER60Zi4.YKabxx3CPRicT == null)
        return;
      this.xngTL11QRuwcB.\u0031CII3TGnWWaPA.wRuYhG7t3Jqcm(this.xngTL11QRuwcB, string.Format((IFormatProvider) CultureInfo.CurrentCulture, "=== Token Acquisition finished successfully. An access token was retuned:\n\tAccess Token Hash: {0}\n\tExpiration Time: {1}\n\tUser Hash: {2}\n\t", new object[3]
      {
        (object) ihsplD1QXK7uN.MSuw3KhqLAYoY(s1uKoSER60Zi4.YKabxx3CPRicT),
        (object) s1uKoSER60Zi4.\u0039ueub5MMEv9y8,
        s1uKoSER60Zi4.VX91kBJ06aKTr != null ? (object) ihsplD1QXK7uN.MSuw3KhqLAYoY(s1uKoSER60Zi4.VX91kBJ06aKTr.H8otkn8RcSLDl) : (object) "null"
      }), "E:\\A\\_work\\115\\s\\src\\Microsoft.IdentityModel.Clients.ActiveDirectory\\Internal\\Flows\\vmgkKHlLDILn4.cs");
    }

    protected void ValidateAuthorityType()
    {
      if (!this.wv77vsl2OHrKS && this.\u00396xFrZPZRXYHo.NyQUHwnQg72Kv == kb6kJoyftgn0H.ADFS)
        throw new LlM9VbgWu20VY("invalid_authority_type", string.Format((IFormatProvider) CultureInfo.InvariantCulture, "Invalid authority type. This method overload is not supported by '{0}'", new object[1]
        {
          (object) this.\u00396xFrZPZRXYHo.zhjvQCF1C6DTp
        }));
    }
  }
}
