// Decompiled with JetBrains decompiler
// Type: 143783383269.921403065316
// Assembly: 582573968022, Version=15.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
// MVID: 22949299-4A50-46F6-851E-C2A296093D37
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Exploit.MSIL.Shellcode.gen-35a63266858befa3a9a9f8f0684d53a6905ab1fbfd8df949e6989c20107cc290.exe

using \u003000054842937;
using \u003033954469293;
using \u003138676380795;
using \u003416370324195;
using \u003515313451822;
using \u003550713291285;
using \u003756014722366;
using \u003885349723817;
using Microsoft.VisualStudio.TestPlatform.CoreUtilities.Helpers;
using Microsoft.VisualStudio.TestPlatform.CoreUtilities.Tracing;
using Microsoft.VisualStudio.TestPlatform.CoreUtilities.Tracing.Interfaces;
using Microsoft.VisualStudio.TestPlatform.ObjectModel;
using Microsoft.VisualStudio.TestPlatform.ObjectModel.Client;
using Microsoft.VisualStudio.TestPlatform.ObjectModel.Client.Interfaces;
using Microsoft.VisualStudio.TestPlatform.PlatformAbstractions;
using Microsoft.VisualStudio.TestPlatform.PlatformAbstractions.Interfaces;
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Globalization;
using System.Linq;

namespace \u003143783383269
{
  public class \u003921403065316 : IVsTestConsoleWrapper
  {
    private readonly IProcessManager \u003130196269334;
    private readonly ITranslationLayerRequestSender \u003715270834314;
    private readonly IProcessHelper \u003232517265390;
    private bool \u003276976832674;
    private IEnumerable<string> \u003771130264404;
    private readonly \u003487586627016 \u003922680364785;
    private readonly ITestPlatformEventSource \u003188995021492;

    public \u003921403065316(string vstestConsolePath)
      : this(vstestConsolePath, \u003487586627016.\u003929606578394)
    {
    }

    public \u003921403065316(string vstestConsolePath, \u003487586627016 consoleParameters)
      : this((ITranslationLayerRequestSender) new \u003088539235942(), (IProcessManager) new \u003034583373100(vstestConsolePath), consoleParameters, TestPlatformEventSource.Instance, (IProcessHelper) new ProcessHelper())
    {
    }

    internal \u003921403065316(
      string vstestConsolePath,
      string dotnetExePath,
      \u003487586627016 consoleParameters)
      : this((ITranslationLayerRequestSender) new \u003088539235942(), (IProcessManager) new \u003034583373100(vstestConsolePath, dotnetExePath), consoleParameters, TestPlatformEventSource.Instance, (IProcessHelper) new ProcessHelper())
    {
    }

    internal \u003921403065316(
      ITranslationLayerRequestSender requestSender,
      IProcessManager processManager,
      \u003487586627016 consoleParameters,
      ITestPlatformEventSource testPlatformEventSource,
      IProcessHelper processHelper)
    {
      this.\u003715270834314 = requestSender;
      this.\u003130196269334 = processManager;
      this.\u003922680364785 = consoleParameters;
      this.\u003188995021492 = testPlatformEventSource;
      this.\u003232517265390 = processHelper;
      this.\u003771130264404 = (IEnumerable<string>) new List<string>();
      this.\u003130196269334.ProcessExited += (EventHandler) ((_param1, _param2) => this.\u003715270834314.OnProcessExited());
      this.\u003276976832674 = false;
    }

    public void \u003072941785819()
    {
      if (EqtTrace.IsInfoEnabled)
        EqtTrace.Info("921403065316.StartSession: Starting 921403065316 session.");
      this.\u003188995021492.TranslationLayerInitializeStart();
      int num = this.\u003715270834314.InitializeCommunication();
      if (num > 0)
      {
        this.\u003922680364785.\u003056443432085 = Process.GetCurrentProcess().Id;
        this.\u003922680364785.\u003087355123483 = num;
        this.\u003130196269334.StartProcess(this.\u003922680364785);
      }
      else
      {
        this.\u003715270834314.Close();
        throw new \u003105248700764("Error hosting communication channel");
      }
    }

    public void \u003218589536671(IEnumerable<string> _param1)
    {
      this.\u003140138631182();
      this.\u003771130264404 = (IEnumerable<string>) _param1.ToList<string>();
      this.\u003715270834314.InitializeExtensions(this.\u003771130264404);
    }

    public void \u003554494572682(
      IEnumerable<string> _param1,
      string _param2,
      ITestDiscoveryEventsHandler _param3)
    {
      this.\u003188995021492.TranslationLayerDiscoveryStart();
      this.\u003140138631182();
      \u003794233157239 discoveryEventsHandler = new \u003794233157239(_param3);
      this.\u003715270834314.DiscoverTests(_param1, _param2, (TestPlatformOptions) null, (ITestDiscoveryEventsHandler2) discoveryEventsHandler);
    }

    public void \u003379390658821(
      IEnumerable<string> _param1,
      string _param2,
      TestPlatformOptions _param3,
      ITestDiscoveryEventsHandler2 _param4)
    {
      this.\u003188995021492.TranslationLayerDiscoveryStart();
      this.\u003140138631182();
      this.\u003715270834314.DiscoverTests(_param1, _param2, _param3, _param4);
    }

    public void \u003309139507238() => this.\u003715270834314.CancelDiscovery();

    public void \u003343564475100(
      IEnumerable<string> _param1,
      string _param2,
      ITestRunEventsHandler _param3)
    {
      this.\u003239163682196(_param1, _param2, (TestPlatformOptions) null, _param3);
    }

    public void \u003239163682196(
      IEnumerable<string> _param1,
      string _param2,
      TestPlatformOptions _param3,
      ITestRunEventsHandler _param4)
    {
      List<string> list = _param1.ToList<string>();
      this.\u003188995021492.TranslationLayerExecutionStart(0L, (long) list.Count, 0L, _param2 ?? string.Empty);
      this.\u003140138631182();
      this.\u003715270834314.StartTestRun((IEnumerable<string>) list, _param2, _param3, _param4);
    }

    public void \u003091210555735(
      IEnumerable<TestCase> _param1,
      string _param2,
      ITestRunEventsHandler _param3)
    {
      List<TestCase> list = _param1.ToList<TestCase>();
      this.\u003188995021492.TranslationLayerExecutionStart(0L, 0L, (long) list.Count, _param2 ?? string.Empty);
      this.\u003140138631182();
      this.\u003715270834314.StartTestRun((IEnumerable<TestCase>) list, _param2, (TestPlatformOptions) null, _param3);
    }

    public void \u003601768291906(
      IEnumerable<TestCase> _param1,
      string _param2,
      TestPlatformOptions _param3,
      ITestRunEventsHandler _param4)
    {
      List<TestCase> list = _param1.ToList<TestCase>();
      this.\u003188995021492.TranslationLayerExecutionStart(0L, 0L, (long) list.Count, _param2 ?? string.Empty);
      this.\u003140138631182();
      this.\u003715270834314.StartTestRun((IEnumerable<TestCase>) list, _param2, _param3, _param4);
    }

    public void \u003471338233818(
      IEnumerable<string> _param1,
      string _param2,
      ITestRunEventsHandler _param3,
      ITestHostLauncher _param4)
    {
      this.\u003511033494193(_param1, _param2, (TestPlatformOptions) null, _param3, _param4);
    }

    public void \u003511033494193(
      IEnumerable<string> _param1,
      string _param2,
      TestPlatformOptions _param3,
      ITestRunEventsHandler _param4,
      ITestHostLauncher _param5)
    {
      List<string> list = _param1.ToList<string>();
      this.\u003188995021492.TranslationLayerExecutionStart(1L, (long) list.Count, 0L, _param2 ?? string.Empty);
      this.\u003140138631182();
      this.\u003715270834314.StartTestRunWithCustomHost((IEnumerable<string>) list, _param2, _param3, _param4, _param5);
    }

    public void \u003774584219715(
      IEnumerable<TestCase> _param1,
      string _param2,
      ITestRunEventsHandler _param3,
      ITestHostLauncher _param4)
    {
      List<TestCase> list = _param1.ToList<TestCase>();
      this.\u003188995021492.TranslationLayerExecutionStart(1L, 0L, (long) list.Count, _param2 ?? string.Empty);
      this.\u003140138631182();
      this.\u003715270834314.StartTestRunWithCustomHost((IEnumerable<TestCase>) list, _param2, (TestPlatformOptions) null, _param3, _param4);
    }

    public void \u003900640586679(
      IEnumerable<TestCase> _param1,
      string _param2,
      TestPlatformOptions _param3,
      ITestRunEventsHandler _param4,
      ITestHostLauncher _param5)
    {
      List<TestCase> list = _param1.ToList<TestCase>();
      this.\u003188995021492.TranslationLayerExecutionStart(1L, 0L, (long) list.Count, _param2 ?? string.Empty);
      this.\u003140138631182();
      this.\u003715270834314.StartTestRunWithCustomHost((IEnumerable<TestCase>) list, _param2, _param3, _param4, _param5);
    }

    public void \u003179785949606() => this.\u003715270834314.CancelTestRun();

    public void \u003254000427144() => this.\u003715270834314.AbortTestRun();

    public void \u003319719743225()
    {
      EqtTrace.Info("921403065316.EndSession: Ending 921403065316 session");
      this.\u003715270834314.EndSession();
      this.\u003715270834314.Close();
      this.\u003130196269334.ShutdownProcess();
      this.\u003276976832674 = false;
    }

    private void \u003140138631182()
    {
      if (!this.\u003130196269334.IsProcessInitialized())
      {
        EqtTrace.Info("921403065316.EnsureInitialized: Process is not started.");
        this.\u003072941785819();
        this.\u003276976832674 = this.\u003342173632401();
        if (this.\u003276976832674)
        {
          EqtTrace.Info("921403065316.EnsureInitialized: Send a request to initialize extensions.");
          this.\u003715270834314.InitializeExtensions(this.\u003771130264404);
        }
      }
      if (this.\u003276976832674 || this.\u003715270834314 == null)
        return;
      EqtTrace.Info("921403065316.EnsureInitialized: Process Started.");
      this.\u003276976832674 = this.\u003342173632401();
    }

    private bool \u003342173632401()
    {
      EqtTrace.Info("921403065316.WaitForConnection: Waiting for connection to command line runner.");
      int connectionTimeout = EnvironmentHelper.GetConnectionTimeout();
      if (!this.\u003715270834314.WaitForRequestHandlerConnection(connectionTimeout * 1000))
        throw new \u003105248700764(string.Format((IFormatProvider) CultureInfo.CurrentUICulture, Microsoft.VisualStudio.TestPlatform.CommunicationUtilities.Resources.Resources.ConnectionTimeoutErrorMessage, (object) this.\u003232517265390.GetCurrentProcessFileName(), (object) "vstest.console", (object) connectionTimeout, (object) "VSTEST_CONNECTION_TIMEOUT"));
      this.\u003188995021492.TranslationLayerInitializeStop();
      return true;
    }
  }
}
