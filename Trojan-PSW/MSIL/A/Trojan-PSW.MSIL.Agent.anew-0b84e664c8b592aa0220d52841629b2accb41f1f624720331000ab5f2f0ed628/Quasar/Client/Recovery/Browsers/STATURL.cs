// Decompiled with JetBrains decompiler
// Type: Quasar.Client.Recovery.Browsers.STATURL
// Assembly: Client, Version=1.4.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 73C3C7FC-0EA2-48C4-8CEF-33A8CFDA287C
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\Trojan-PSW.MSIL.Agent.anew-0b84e664c8b592aa0220d52841629b2accb41f1f624720331000ab5f2f0ed628.exe

using System;
using System.Runtime.InteropServices;

namespace Quasar.Client.Recovery.Browsers
{
  public struct STATURL
  {
    public int cbSize;
    [MarshalAs(UnmanagedType.LPWStr)]
    public string pwcsUrl;
    [MarshalAs(UnmanagedType.LPWStr)]
    public string pwcsTitle;
    public System.Runtime.InteropServices.ComTypes.FILETIME ftLastVisited;
    public System.Runtime.InteropServices.ComTypes.FILETIME ftLastUpdated;
    public System.Runtime.InteropServices.ComTypes.FILETIME ftExpires;
    public STATURLFLAGS dwFlags;

    public string URL => this.pwcsUrl;

    public string UrlString
    {
      get
      {
        int length = this.pwcsUrl.IndexOf('?');
        return length >= 0 ? this.pwcsUrl.Substring(0, length) : this.pwcsUrl;
      }
    }

    public string Title => this.pwcsUrl.StartsWith("file:") ? Win32api.CannonializeURL(this.pwcsUrl, Win32api.shlwapi_URL.URL_UNESCAPE).Substring(8).Replace('/', '\\') : this.pwcsTitle;

    public DateTime LastVisited => Win32api.FileTimeToDateTime(this.ftLastVisited).ToLocalTime();

    public DateTime LastUpdated => Win32api.FileTimeToDateTime(this.ftLastUpdated).ToLocalTime();

    public DateTime Expires
    {
      get
      {
        try
        {
          DateTime expires = Win32api.FileTimeToDateTime(this.ftExpires);
          expires = expires.ToLocalTime();
          return expires;
        }
        catch (Exception ex)
        {
          return DateTime.Now;
        }
      }
    }

    public override string ToString() => this.pwcsUrl;
  }
}
