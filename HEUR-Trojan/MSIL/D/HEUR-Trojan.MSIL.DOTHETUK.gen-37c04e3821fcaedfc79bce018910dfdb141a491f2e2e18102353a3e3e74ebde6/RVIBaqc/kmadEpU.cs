// Decompiled with JetBrains decompiler
// Type: RVIBaqc.kmadEpU
// Assembly: aO8BSlP, Version=2.0.0.0, Culture=neutral, PublicKeyToken=0a613f4dd989e8ae
// MVID: 26D80EA7-FF8D-466E-8999-D26AD81041E3
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.MSIL.DOTHETUK.gen-37c04e3821fcaedfc79bce018910dfdb141a491f2e2e18102353a3e3e74ebde6.exe

using SWswj9r;
using System;
using System.Diagnostics;
using System.IO;
using System.Text;
using System.Threading;

namespace RVIBaqc
{
  internal class kmadEpU : IDisposable
  {
    internal const int \u00313zeh81 = 100;
    internal const int NwvB45n = 600;
    private FileStream E4WXDpD;

    public kmadEpU(string lockfilePath, int lockFileRetryDelay = 100, int lockFileRetryCount = 600)
    {
      Exception innerException = (Exception) null;
      FileStream fileStream = (FileStream) null;
      Directory.CreateDirectory(Path.GetDirectoryName(lockfilePath));
      for (int index = 0; index < lockFileRetryCount; ++index)
      {
        try
        {
          FileShare share = FileShare.None;
          if (AKWzGCu.tAeuM3K())
            share = FileShare.Read;
          fileStream = new FileStream(lockfilePath, FileMode.OpenOrCreate, FileAccess.ReadWrite, share, 4096, FileOptions.DeleteOnClose);
          using (StreamWriter streamWriter = new StreamWriter((Stream) fileStream, Encoding.UTF8, 4096, true))
          {
            streamWriter.WriteLine(string.Format("{0} {1}", (object) Process.GetCurrentProcess().Id, (object) Process.GetCurrentProcess().ProcessName));
            break;
          }
        }
        catch (IOException ex)
        {
          innerException = (Exception) ex;
          Thread.Sleep(lockFileRetryDelay);
        }
        catch (UnauthorizedAccessException ex)
        {
          innerException = (Exception) ex;
          Thread.Sleep(lockFileRetryCount);
        }
      }
      this.E4WXDpD = fileStream ?? throw new InvalidOperationException("Could not get access to the shared lock file.", innerException);
    }

    public void cB2rb0F()
    {
      this.E4WXDpD?.Dispose();
      this.E4WXDpD = (FileStream) null;
    }
  }
}
