// Decompiled with JetBrains decompiler
// Type: Repository.DatabaseFactory
// Assembly: AnsiCharMarsha, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 45449883-CB33-464D-BFFF-85C1D8F95247
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\Trojan-PSW.Win32.Stealer.aipl-731355759034e0ae5cff6011792f40d5154dccd99fac792da878777bbc532ce2.exe

using Core;
using Core.Configuration;
using Core.Helpers;
using Core.Infrastructure.Logging;
using System.Data.Linq;
using System.IO;

namespace Repository
{
  public class DatabaseFactory : DisposableResource, IDatabaseFactory
  {
    private readonly string _connectionString;
    private readonly ILogWriter _logWriter;
    public IDatabase _database;

    public DatabaseFactory(IConnectionString connectionString, ILogWriter logWriter)
    {
      Checks.Argument.IsNotNull((object) connectionString, nameof (connectionString));
      this._connectionString = connectionString.Value;
      this._logWriter = logWriter;
    }

    public IDatabase Get()
    {
      if (this._database == null)
      {
        DataLoadOptions dataLoadOptions = new DataLoadOptions();
        Database database = new Database(this._connectionString);
        database.LoadOptions = dataLoadOptions;
        database.DeferredLoadingEnabled = true;
        database.Log = this._logWriter == null ? (TextWriter) null : this._logWriter.Get();
        this._database = (IDatabase) database;
      }
      return this._database;
    }
  }
}
