// Decompiled with JetBrains decompiler
// Type: IngressoVip.clsLigacao
// Assembly: IngressoVip, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: B67C4084-86FB-4B3F-B072-28F5697F4668
// Assembly location: C:\Users\Administrateur\Desktop\Virusshare-00005-msil\Virus.Win32.Sality.ae-115d93ab771edf65ec0d5a50e51f618fc5159020bdb0762845d86c2a74f94f06.exe

using Microsoft.VisualBasic.CompilerServices;
using MySql.Data.MySqlClient;
using System;
using System.Data;
using System.Data.Common;

namespace IngressoVip
{
  public class clsLigacao
  {
    private clsConexao objConn;
    private MySqlConnection CnnLocal;
    private clsMensagem msg;
    private clsFuncoes objFuncoes;

    public clsLigacao()
    {
      this.objConn = new clsConexao();
      this.CnnLocal = new MySqlConnection(this.objConn.connLocal());
      this.msg = new clsMensagem();
      this.objFuncoes = new clsFuncoes();
    }

    public void GravaLog(
      ref string msgTN,
      ref string msgTel,
      ref string msgCel,
      ref string codMenu,
      ref string codJogo,
      ref int intEtapa)
    {
      DataSet dataSet1 = new DataSet();
      try
      {
        object msgTN1 = (object) msgTN;
        DataSet dataSet2 = this.CarregaLog(ref msgTN1);
        msgTN = Conversions.ToString(msgTN1);
        dataSet1 = dataSet2;
        if (this.CnnLocal.State == ConnectionState.Closed)
          this.CnnLocal.Open();
        if (intEtapa == 1)
        {
          if (dataSet1.Tables[0].Rows.Count > 0)
          {
            new MySqlCommand("UPDATE cad_ligacao SET str_tel = '" + msgTel + "',str_cel = '" + msgCel + "',int_cod_menu = " + codMenu + " ,int_cod_jogo = " + codJogo + "' WHERE str_tn = '" + dataSet1.Tables[0].Rows[0]["str_tn"].ToString() + "'", this.CnnLocal).ExecuteNonQuery();
            this.CnnLocal.Close();
          }
          else
          {
            new MySqlCommand("INSERT INTO cad_ligacao (dt_datahora, str_tn, str_tel, str_cel) VALUES (now(), '" + msgTN + "','" + msgTel + "','" + msgCel + "')", this.CnnLocal).ExecuteNonQuery();
            this.CnnLocal.Close();
          }
        }
        else if (intEtapa == 2)
        {
          if (dataSet1.Tables[0].Rows.Count > 0)
          {
            new MySqlCommand("UPDATE cad_ligacao SET str_tel = '" + msgTel + "',str_cel = '" + msgCel + "',int_cod_menu = " + codMenu + " ,int_cod_jogo = " + codJogo + "' WHERE str_tn = '" + dataSet1.Tables[0].Rows[0]["str_tn"].ToString() + "'", this.CnnLocal).ExecuteNonQuery();
            this.CnnLocal.Close();
          }
          else
          {
            new MySqlCommand("INSERT INTO cad_ligacao (dt_datahora, str_tn, str_tel, str_cel) VALUES (now(), '" + msgTN + "','" + msgTel + "','" + msgCel + "')", this.CnnLocal).ExecuteNonQuery();
            this.CnnLocal.Close();
          }
        }
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        this.objFuncoes.MsgConsole(ex.ToString());
        this.CnnLocal.Close();
        ProjectData.ClearProjectError();
      }
      dataSet1.Dispose();
    }

    private DataSet CarregaLog(ref object msgTN)
    {
      DataSet dataSet1 = new DataSet();
      DataSet dataSet2;
      try
      {
        if (this.CnnLocal.State == ConnectionState.Closed)
          this.CnnLocal.Open();
        ((DbDataAdapter) new MySqlDataAdapter(new MySqlCommand(Conversions.ToString(Microsoft.VisualBasic.CompilerServices.Operators.ConcatenateObject(Microsoft.VisualBasic.CompilerServices.Operators.ConcatenateObject((object) "SELECT * FROM cad_ligacao WHERE str_tn = '", msgTN), (object) "'")), this.CnnLocal))).Fill(dataSet1, "cad_ligacao");
        this.CnnLocal.Close();
        dataSet2 = dataSet1;
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        this.objFuncoes.MsgConsole(ex.ToString());
        this.CnnLocal.Close();
        dataSet2 = dataSet1;
        ProjectData.ClearProjectError();
      }
      return dataSet2;
    }
  }
}
