// Decompiled with JetBrains decompiler
// Type: s909044072760651.s393135817591258
// Assembly: s968508024776124, Version=2.0.47.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
// MVID: E3596912-35E7-405B-A05A-F5F12AB5E292
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.04\HEUR-Trojan.MSIL.PowerShell.gen-b1729c7ae8423cc844b16aa10ca8ddd2b2331adbfb6646d80d73381fbc73a109.exe

using s051718566454480;
using s111377166353221;
using s220824736514050;
using s457615980405427;
using s528813736053581;
using s648185729169454;
using s688185510374240;
using s859483659459112;
using s962360155664524;
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Runtime.CompilerServices;
using System.Runtime.InteropServices;

namespace s909044072760651
{
  public sealed class s393135817591258 : s280990392871393
  {
    public unsafe s393135817591258(s470725726477034 source, bool dontRegister = false)
      : base(source, dontRegister)
    {
      s101197287898668 s101197287898668 = new s101197287898668(source);
      s101197287898668.s711913278192271 += (Action<s198851119344699>) (s527126471377084 =>
      {
        s244632129848843 key = ((s393135817591258.s799243894950828) new s393135817591258.s358668344142389((byte*) (void*) s527126471377084.s969799445044717, (s134995860702422.s648877553938236*) null, this.s147232450406747)).s919852828438177();
        this.s156684821671068.s570221837347640[(s034852122986107) key] = key;
      });
      s101197287898668.s419390802185524 += (Action<s198851119344699>) (s124092711404374 =>
      {
        try
        {
          Guid providerID = *(Guid*) (void*) s124092711404374.s969799445044717;
          byte* s046172977534436 = (byte*) (void*) (s124092711404374.s969799445044717 + sizeof (Guid));
          s393135817591258.s672608465792891* s973174984863557 = (s393135817591258.s672608465792891*) s046172977534436;
          IDictionary<long, string> dictionary = s393135817591258.s799243894950828.s012990302429081(s973174984863557, s046172977534436);
          if (((s393135817591258.s235686066146071*) s973174984863557)->s329011872795859 >= s124092711404374.s268530766974660 - 16)
            return;
          string mapName = new string((char*) (s046172977534436 + ((s393135817591258.s235686066146071*) s973174984863557)->s329011872795859));
          this.s147232450406747.Add(new s136528962726033(providerID, mapName), dictionary);
        }
        catch (Exception ex)
        {
        }
      });
    }

    public static string s805690463667687(string s423151363583633)
    {
      Guid s153850766447476 = s820276167648377.s591057928635590(s423151363583633);
      return !(s153850766447476 == Guid.Empty) ? s393135817591258.s384946734286333(s153850766447476) : throw new ApplicationException("Could not find provider with name " + s423151363583633);
    }

    public static string s384946734286333(Guid s153850766447476)
    {
      // ISSUE: unable to decompile the method.
    }

    private static string s384930408122155(CultureInfo s019711107378865)
    {
      string name = s019711107378865.Name;
      if (name == "zh-CHT")
        return "zh-Hant";
      return name == "zh-CHS" ? "zh-Hans" : s019711107378865.Name;
    }

    private static string s040725392908697(string s002031565172098)
    {
      s002031565172098 = s002031565172098.Replace(" ", "");
      s002031565172098 = s002031565172098.Replace("-", "_");
      return s002031565172098;
    }

    private static string s040511811112714(
      SortedDictionary<ulong, string> s004347500658505,
      ulong s283443611232922)
    {
      string str1 = "";
      for (int index = 0; index < 48; ++index)
      {
        ulong key = 1UL << index;
        if (((long) key & (long) s283443611232922) != 0L)
        {
          string str2;
          if (!s004347500658505.TryGetValue(key, out str2))
          {
            str2 = "keyword_" + key.ToString("x");
            s004347500658505[key] = str2;
          }
          if (str1.Length != 0)
            str1 += " ";
          str1 += str2;
        }
      }
      return str1;
    }

    private static string s954126559838288(string s788038749800785) => s788038749800785.Length == 0 || char.IsUpper(s788038749800785[0]) ? s788038749800785 : s788038749800785.Substring(1).ToUpper() + s788038749800785.Substring(1);

    internal virtual s244632129848843 s232494213077349(
      s034852122986107 s361521736633699)
    {
      return s393135817591258.s524764105178689(s361521736633699, this.s147232450406747);
    }

    internal static unsafe s244632129848843 s524764105178689(
      s034852122986107 s817149524307717,
      Dictionary<s136528962726033, IDictionary<long, string>> s911661929027937 = null)
    {
      s244632129848843 s244632129848843 = (s244632129848843) null;
      if (RuntimeInformation.IsOSPlatform(OSPlatform.Windows))
      {
        bool flag = false;
        for (int index = 0; index != (int) s817149524307717.s598076025198321->s934424027936993; ++index)
        {
          switch (s817149524307717.s598076025198321->s884679247404646[index].s270740346342371)
          {
            case 10:
            case 11:
              flag = true;
              goto label_6;
            default:
              continue;
          }
        }
label_6:
        int cb = 9000;
        byte* numPtr = (byte*) (void*) Marshal.AllocHGlobal(cb);
        int num = s393135817591258.s809766851305633(s817149524307717.s598076025198321, 0U, (void*) null, numPtr, &cb);
        if (num == 122)
        {
          Marshal.FreeHGlobal((IntPtr) (void*) numPtr);
          numPtr = (byte*) (void*) Marshal.AllocHGlobal(cb);
          num = s393135817591258.s809766851305633(s817149524307717.s598076025198321, 0U, (void*) null, numPtr, &cb);
        }
        if (num == 0)
        {
          s244632129848843 = ((s393135817591258.s799243894950828) new s393135817591258.s358668344142389(numPtr, s817149524307717.s598076025198321, s911661929027937)).s919852828438177();
          s244632129848843.s312333162110197 = flag;
        }
        Marshal.FreeHGlobal((IntPtr) (void*) numPtr);
      }
      return s244632129848843;
    }

    [DllImport("tdh.dll", EntryPoint = "TdhGetEventInformation")]
    internal static extern unsafe int s809766851305633(
      s134995860702422.s648877553938236* s354959077310537,
      uint s362497634111535,
      void* s008953394183322,
      byte* s819926207521718,
      int* s694005147021891);

    [DllImport("tdh.dll", EntryPoint = "TdhGetEventMapInformation", CharSet = CharSet.Unicode)]
    internal static extern unsafe int s874796326968536(
      s134995860702422.s648877553938236* s400437249767496,
      string s773701359682560,
      s393135817591258.s672608465792891* s209304749426553,
      ref int s696168496365391);

    private class s358668344142389
    {
      public SortedDictionary<int, string> s481024790632636;
      private unsafe s393135817591258.s285125324501501* s014730444434970;

      public unsafe s358668344142389(
        byte* eventInfo,
        s134995860702422.s648877553938236* eventRecord,
        Dictionary<s136528962726033, IDictionary<long, string>> mapTable)
      {
        ((s393135817591258.s799243894950828) this).s925517578388585 = eventInfo;
        this.s014730444434970 = (s393135817591258.s285125324501501*) eventInfo;
        ((s393135817591258.s799243894950828) this).s562578311821766 = &this.s014730444434970->s011736138157239;
        ((s393135817591258.s799243894950828) this).s380871512069339 = eventRecord;
        ((s393135817591258.s799243894950828) this).s118793590682606 = mapTable;
      }
    }

    internal class s799243894950828
    {
      private unsafe s134995860702422.s648877553938236* s380871512069339;
      private Dictionary<s136528962726033, IDictionary<long, string>> s118793590682606;
      private unsafe s393135817591258.s177554964873474* s562578311821766;
      private unsafe byte* s925517578388585;
      [SpecialName]
      public int value__;

      public unsafe s244632129848843 s919852828438177()
      {
        s393135817591258.s177554964873474* s177554964873474Ptr = &((s393135817591258.s358668344142389) this).s014730444434970->s011736138157239;
        string taskName = (string) null;
        if (((s393135817591258.s358668344142389) this).s014730444434970->s628898672385665 != 0)
          taskName = s393135817591258.s040725392908697(new string((char*) (this.s925517578388585 + ((s393135817591258.s358668344142389) this).s014730444434970->s628898672385665)));
        string opcodeName = (string) null;
        if (((s393135817591258.s358668344142389) this).s014730444434970->s900666096226851 != 0)
        {
          string s002031565172098 = new string((char*) (this.s925517578388585 + ((s393135817591258.s358668344142389) this).s014730444434970->s900666096226851));
          if (s002031565172098.StartsWith("win:"))
            s002031565172098 = s002031565172098.Substring(4);
          opcodeName = s393135817591258.s040725392908697(s002031565172098);
        }
        string providerName = "UnknownProvider";
        if (((s393135817591258.s358668344142389) this).s014730444434970->s640330987597221 != 0)
          providerName = new string((char*) (this.s925517578388585 + ((s393135817591258.s358668344142389) this).s014730444434970->s640330987597221));
        // ISSUE: cast to a reference type
        // ISSUE: explicit reference operation
        ushort eventID = (^(s393135817591258.s285125324501501&) ref ((s393135817591258.s358668344142389) this).s014730444434970->s446855925824217).s910373018299811;
        if (((s393135817591258.s358668344142389) this).s014730444434970->s997517007338692 == 1)
          eventID = ushort.MaxValue;
        s244632129848843 s244632129848843 = new s244632129848843((Action<s034852122986107>) null, (int) eventID, (int) ((s393135817591258.s358668344142389) this).s014730444434970->s446855925824217.s815537033711383, taskName, ((s393135817591258.s358668344142389) this).s014730444434970->s583831631169980, (int) ((s393135817591258.s358668344142389) this).s014730444434970->s446855925824217.s214613911199067, opcodeName, ((s393135817591258.s672608465792891*) ((s393135817591258.s358668344142389) this).s014730444434970)->s960404605101023, providerName);
        if (eventID == ushort.MaxValue)
          s244632129848843.s208437401079489 = true;
        if (((s393135817591258.s358668344142389) this).s014730444434970->s779112074645277 != 0)
          s244632129848843.s614187586217155 = new string((char*) (this.s925517578388585 + ((s393135817591258.s358668344142389) this).s014730444434970->s779112074645277));
        s244632129848843.s303826056829119 s303826056829119 = this.s346464569545834(0, ((s393135817591258.s358668344142389) this).s014730444434970->s698708221777871);
        s244632129848843.payloadNames = s303826056829119.s432145469492164;
        s244632129848843.s463622614246125 = ((s244632129848843.s450921180926046) s303826056829119).s909052708399886;
        return s244632129848843;
      }

      private s244632129848843.s303826056829119 s346464569545834(
        int s075827499674612,
        int s528346089740243)
      {
        // ISSUE: unable to decompile the method.
      }

      internal static IDictionary<long, string> s012990302429081(
        s393135817591258.s672608465792891* s973174984863557,
        byte* s046172977534436)
      {
        // ISSUE: unable to decompile the method.
      }

      [SpecialName]
      public int get_StructStartIndex()
      {
        // ISSUE: unable to decompile the method.
      }
    }

    [Flags]
    internal enum s452930003287583
    {
      EVENTMAP_INFO_FLAG_MANIFEST_VALUEMAP = 1,
      EVENTMAP_INFO_FLAG_MANIFEST_BITMAP = 2,
      EVENTMAP_INFO_FLAG_MANIFEST_PATTERNMAP = 4,
      EVENTMAP_INFO_FLAG_WBEM_VALUEMAP = 8,
      EVENTMAP_INFO_FLAG_WBEM_BITMAP = 16, // 0x00000010
      EVENTMAP_INFO_FLAG_WBEM_FLAG = 32, // 0x00000020
      EVENTMAP_INFO_FLAG_WBEM_NO_MAP = 64, // 0x00000040
    }

    internal struct s235686066146071
    {
      public int s505615043145866;
      public int s329011872795859;
    }

    internal struct s672608465792891
    {
      public s393135817591258.s452930003287583 s881642384739589;
      public int s218324411906261;
      public int s010956517579604;
      public s393135817591258.s235686066146071 s191285551998766;
      public Guid s960404605101023;
    }

    internal struct s285125324501501
    {
      public Guid s583831631169980;
      public s393135817591258.s818191766870065 s446855925824217;
      public int s997517007338692;
      public int s640330987597221;
      public int s903640280176245;
      public int s545767254620988;
      public int s429067326582851;
      public int s628898672385665;
      public int s900666096226851;
      public int s779112074645277;
      public int s860499080721197;
      public int s980114244383457;
      public int s143519252717310;
      public int s010231399532764;
      public int s515692528483641;
      public int s449315309815617;
      public int s698708221777871;
      public int s266716946396046;
      public s393135817591258.s177554964873474 s011736138157239;
      public ushort s910373018299811;
    }

    public struct s818191766870065
    {
      public byte s314362989344590;
      public byte s246666705150640;
      public byte s474760420510754;
      public byte s214613911199067;
      public ushort s815537033711383;
      public ulong s859375757553880;
      public s393135817591258.s963771308363060 s593180757478857;
    }

    internal struct s177554964873474
    {
      public int s543830198563745;
      public s393135817591258.s412159084864104 s107432000231247;
      public ushort s801824381321749;
      public int s898860833920129;
      public ushort s711369085435008;
      public ushort s371533947912623;
      public int s462667549773615;
      [SpecialName]
      public int value__;

      public int s835452980421155
      {
        [SpecialName] get
        {
          // ISSUE: unable to decompile the method.
        }
      }

      public int s147059347272527 => (int) this.s801824381321749;

      public bool s814349341084180(
        s034852122986107 s738786413066298,
        s034852122986107 s828771975286062)
      {
        if (s738786413066298.s208437401079489 != s828771975286062.s208437401079489 || s738786413066298.s558741114055760 != s828771975286062.s558741114055760)
          return false;
        return s738786413066298.s208437401079489 ? s738786413066298.s966949059091664 == s828771975286062.s966949059091664 && s738786413066298.s770722554724548 == s828771975286062.s770722554724548 : (s738786413066298.s558741114055760 ? s738786413066298.s966949059091664 == s828771975286062.s966949059091664 && s738786413066298.s228250182984697 == s828771975286062.s228250182984697 : s738786413066298.s066186047870744 == s828771975286062.s066186047870744 && s738786413066298.s228250182984697 == s828771975286062.s228250182984697);
      }
    }

    [Flags]
    internal enum s963771308363060 : ushort
    {
      None = 0,
      Struct = 1,
      ParamLength = 2,
      ParamCount = 4,
      WbemXmlFragment = 8,
      ParamFixedLength = 16, // 0x00000010
    }

    internal enum s412159084864104
    {
      Null = 0,
      UnicodeString = 1,
      AnsiString = 2,
      Int8 = 3,
      UInt8 = 4,
      Int16 = 5,
      UInt16 = 6,
      Int32 = 7,
      UInt32 = 8,
      Int64 = 9,
      UInt64 = 10, // 0x000A
      Float = 11, // 0x000B
      Double = 12, // 0x000C
      Boolean = 13, // 0x000D
      Binary = 14, // 0x000E
      GUID = 15, // 0x000F
      Pointer = 16, // 0x0010
      FILETIME = 17, // 0x0011
      SYSTEMTIME = 18, // 0x0012
      SID = 19, // 0x0013
      HexInt32 = 20, // 0x0014
      HexInt64 = 21, // 0x0015
      CountedUtf16String = 22, // 0x0016
      CountedMbcsString = 23, // 0x0017
      Struct = 24, // 0x0018
      CountedString = 300, // 0x012C
      CountedAnsiString = 301, // 0x012D
      ReversedCountedString = 302, // 0x012E
      ReversedCountedAnsiString = 303, // 0x012F
      NonNullTerminatedString = 304, // 0x0130
      NonNullTerminatedAnsiString = 305, // 0x0131
      UnicodeChar = 306, // 0x0132
      AnsiChar = 307, // 0x0133
      SizeT = 308, // 0x0134
      HexDump = 309, // 0x0135
      WbemSID = 310, // 0x0136
    }
  }
}
