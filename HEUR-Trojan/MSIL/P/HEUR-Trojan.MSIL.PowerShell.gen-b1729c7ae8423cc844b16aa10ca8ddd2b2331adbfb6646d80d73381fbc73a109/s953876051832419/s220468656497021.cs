// Decompiled with JetBrains decompiler
// Type: s953876051832419.s220468656497021
// Assembly: s968508024776124, Version=2.0.47.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
// MVID: E3596912-35E7-405B-A05A-F5F12AB5E292
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.04\HEUR-Trojan.MSIL.PowerShell.gen-b1729c7ae8423cc844b16aa10ca8ddd2b2331adbfb6646d80d73381fbc73a109.exe

using s068979146915301;
using s077414222832753;
using s134096877844438;
using s354939329968896;
using s421409323735343;
using s430663705211726;
using s502762629278250;
using s524124129995258;
using s528813736053581;
using s535820167059183;
using s651029396580935;
using s686708834606903;
using s719272214711671;
using s743898255106522;
using s786292081343583;
using s790378171014915;
using s800090574810683;
using s851819648760407;
using s861533304863238;
using s874166642857481;
using s877373011507287;
using s928707304529159;
using s987482687111829;
using System;
using System.Collections.Generic;

namespace s953876051832419
{
  public class s220468656497021 : s293547439506271
  {
    private GrowableArray<s220468656497021.s390022282378977> s350466776474520;
    private int s937945968757058;
    private Dictionary<s220468656497021.s390022282378977, int> s888995309062427;
    private s124232551204041 s691743177888642;
    private s473104975773947 s714153118040087;
    private s689802712977948 s028837389723718;
    internal s953925013719849 s811601286656942;

    public s220468656497021(s473104975773947 events)
    {
      if (events != null)
        this.s811601286656942 = events.s720149476373935;
      this.s028837389723718 = s689802712977948.Invalid;
      this.s691743177888642 = new s124232551204041((s293547439506271) this);
      this.s691743177888642.s084801687846570 = (float) events.s720149476373935.s407580712989469.TotalMilliseconds;
      this.s714153118040087 = events;
      this.s937945968757058 = this.s811601286656942.s517247949554964.s117445044974708 * 2 + this.s811601286656942.s132713297009023.s141151785930897;
    }

    public s953925013719849 s740232737369485 => this.s811601286656942;

    public bool s141718234535712 { get; set; }

    public void s733783401112767(
      int s440617592751524,
      s435790585148060 s134055944007963,
      s293547439506271 s692483721914244 = null,
      Predicate<s045113750567070> s270931634469203 = null)
    {
      // ISSUE: variable of a compiler-generated type
      s220468656497021.s908318746148813 s908318746148813 = (s220468656497021.s908318746148813) new s220468656497021.s390022282378977();
      if (s692483721914244 == null)
        s692483721914244 = (s293547439506271) this;
      s134055944007963.s682952334786273.WriteLine("Resolving all symbols for modules with inclusive times > {0}", (object) s440617592751524);
      if ((s134055944007963.s640920822593308 & s996935620943990.CacheOnly) != s996935620943990.None)
        s134055944007963.s682952334786273.WriteLine("Cache-Only set: will only look on the local machine.");
      s220468656497021.s735365250405810[] s760994970224157 = new s220468656497021.s735365250405810[s692483721914244.s746014364480903];
      ((s220468656497021.s390022282378977) s908318746148813).s135655435841493 = new int[s692483721914244.s746014364480903];
      // ISSUE: reference to a compiler-generated field
      s908318746148813.s334611755326372 = 0;
      // ISSUE: reference to a compiler-generated method
      s692483721914244.s827465297263042(new Action<s124232551204041>(s908318746148813.s563577977270460));
      // ISSUE: reference to a compiler-generated field
      s134055944007963.s682952334786273.WriteLine("Got a total of {0} samples", (object) s908318746148813.s334611755326372);
      int[] numArray = new int[this.s740232737369485.s427569464106482.s358648014414773];
      for (int s688706509805048 = 0; s688706509805048 < ((s220468656497021.s390022282378977) s908318746148813).s135655435841493.Length; ++s688706509805048)
      {
        int num = ((s220468656497021.s390022282378977) s908318746148813).s135655435841493[s688706509805048];
        if (num > 0)
        {
          for (s220468656497021.s735365250405810 s735365250405810 = this.s714012324937127(s760994970224157, (s457867646003930) s688706509805048); s735365250405810 != null; s735365250405810 = s735365250405810.s749696088484870)
            numArray[(int) ((s645758109343855.s650893925187870<>) s735365250405810).s034655998058606.s286262124234738] += num;
        }
      }
      for (int moduleFileIndex = 0; moduleFileIndex < numArray.Length; ++moduleFileIndex)
      {
        if (numArray[moduleFileIndex] >= s440617592751524)
        {
          s045113750567070 s055553797713474 = this.s740232737369485.s427569464106482.get_Item((s689802712977948) moduleFileIndex);
          if (s270931634469203 == null || s270931634469203(s055553797713474))
          {
            s134055944007963.s682952334786273.WriteLine("Resolving symbols (count={0}) for module {1} ", (object) numArray[moduleFileIndex], (object) s055553797713474.s369986943707552);
            this.s740232737369485.s331550318228488.s462846571074637.s953723846432476(s134055944007963, s055553797713474);
          }
        }
      }
      s134055944007963.s682952334786273.WriteLine("Done Resolving all symbols for modules with inclusive times > {0}", (object) s440617592751524);
    }

    public s320811790897239 s497445036332360(s275977756270514 s456849916818107)
    {
      uint num = (uint) (s456849916818107 - 4);
      return (long) num >= (long) this.s811601286656942.s517247949554964.s117445044974708 ? s320811790897239.Invalid : (s320811790897239) num;
    }

    public virtual void s642393090268120(Action<s124232551204041> s524818008044732)
    {
      this.s714153118040087.s300461368285923();
      foreach (s034852122986107 s553955667813902 in (IEnumerable<s034852122986107>) this.s714153118040087)
      {
        this.s691743177888642.s953068594617511 = this.s907792610541785(s553955667813902);
        this.s691743177888642.s413641156979027 = s553955667813902.s739924403627474;
        s524818008044732(this.s691743177888642);
      }
    }

    public virtual double s764977164555541 => this.s811601286656942.s116609282890674;

    public virtual s275977756270514 s300089447596357(
      s457867646003930 s064659163642040)
    {
      int s687774124953307 = (int) s064659163642040;
      if (s687774124953307 < this.s811601286656942.s331550318228488.s205966286230606)
        return (s275977756270514) (this.s811601286656942.s331550318228488.s772228772378070((s147978847785798) s687774124953307) + 4);
      int num1 = s687774124953307 - this.s811601286656942.s331550318228488.s205966286230606;
      if (num1 < this.s811601286656942.s132713297009023.s141151785930897 + this.s811601286656942.s386698456584430.s022024230865801)
        return (s275977756270514) (num1 + this.s811601286656942.s517247949554964.s117445044974708 + 4);
      int num2 = num1 - (this.s811601286656942.s132713297009023.s141151785930897 + this.s811601286656942.s386698456584430.s022024230865801);
      if (num2 < this.s811601286656942.s132713297009023.s141151785930897)
        return s275977756270514.Broken;
      int num3 = num2 - this.s811601286656942.s132713297009023.s141151785930897;
      return num3 < this.s350466776474520.Count ? (s275977756270514) (this.s350466776474520[num3].s802899828167129 + 4) : s275977756270514.Invalid;
    }

    public virtual s457867646003930 s377661580454549(
      s457867646003930 s488637152247853)
    {
      int num1 = (int) s488637152247853;
      int num2 = 0;
      if (num1 < this.s811601286656942.s331550318228488.s205966286230606)
      {
        s147978847785798 s147978847785798 = this.s811601286656942.s331550318228488.s140621582222871((s147978847785798) num1);
        int num3;
        if (s147978847785798 == s147978847785798.Invalid)
        {
          int num4 = num2 + this.s811601286656942.s331550318228488.s205966286230606;
          s543941511077464 s374631394070476 = this.s811601286656942.s331550318228488.s191562946397054((s147978847785798) num1);
          num3 = (int) (num4 + s374631394070476);
          if (!this.s932149717672746 && !this.s917300110616957(s488637152247853, s374631394070476))
            num3 += this.s811601286656942.s132713297009023.s141151785930897 + this.s811601286656942.s386698456584430.s022024230865801;
        }
        else
          num3 = (int) (num2 + s147978847785798);
        return (s457867646003930) num3;
      }
      int threadIndex = num1 - this.s811601286656942.s331550318228488.s205966286230606;
      int num5 = num2 + this.s811601286656942.s331550318228488.s205966286230606;
      if (threadIndex < this.s811601286656942.s132713297009023.s141151785930897)
        return (s457867646003930) (num5 + this.s811601286656942.s132713297009023.s141151785930897 + this.s811601286656942.s132713297009023.get_Item((s543941511077464) threadIndex).s772648742937858.s140946683671142);
      int num6 = threadIndex - this.s811601286656942.s132713297009023.s141151785930897;
      if (num6 < this.s811601286656942.s386698456584430.s022024230865801)
        return s457867646003930.Invalid;
      int num7 = num6 - this.s811601286656942.s386698456584430.s022024230865801;
      if (num7 < this.s811601286656942.s132713297009023.s141151785930897)
        return (s457867646003930) (num5 + num7);
      int num8 = num7 - this.s811601286656942.s132713297009023.s141151785930897;
      return num8 < this.s350466776474520.Count ? (s457867646003930) (num5 + (this.s811601286656942.s132713297009023.s141151785930897 + this.s811601286656942.s386698456584430.s022024230865801) + this.s350466776474520[num8].s778349165575246) : s457867646003930.Invalid;
    }

    public s541749027096251 s558665667305281(
      s275977756270514 s044593011978214,
      s435790585148060 s811523824737877)
    {
      uint s498952900792319 = (uint) (s044593011978214 - 4);
      return (long) s498952900792319 >= (long) this.s811601286656942.s517247949554964.s117445044974708 ? (s541749027096251) null : this.s811601286656942.s517247949554964.s375267035135285(s811523824737877, (s320811790897239) s498952900792319);
    }

    public virtual string s368871343264692(s275977756270514 s427449102563343, bool s284874836950927)
    {
      string str1 = "?";
      if (s427449102563343 < s275977756270514.Start)
      {
        if (s427449102563343 == s275977756270514.Broken)
          return "BROKEN";
        if (s427449102563343 == s275977756270514.Overhead)
          return "OVERHEAD";
        return s427449102563343 == s275977756270514.Root ? "ROOT" : "?!?";
      }
      int num1 = (int) (s427449102563343 - 4);
      if (num1 < this.s811601286656942.s517247949554964.s117445044974708)
      {
        s320811790897239 s320811790897239 = (s320811790897239) num1;
        s708248100786105 s812424188887864 = this.s811601286656942.s331550318228488.s462846571074637.s859185969078076(s320811790897239);
        if (s812424188887864 != s708248100786105.Invalid)
          str1 = this.s811601286656942.s517247949554964.s964865809619446.s348310645789345(s812424188887864);
        else if (this.s141718234535712)
          str1 = "0x" + this.s811601286656942.s331550318228488.s462846571074637.s131180383102416(s320811790897239).ToString("x");
        s689802712977948 moduleFileIndex = this.s811601286656942.s517247949554964.s119857474429490(s320811790897239);
        string str2 = "?";
        if (moduleFileIndex != s689802712977948.Invalid)
        {
          if (s284874836950927)
          {
            str2 = this.s811601286656942.s517247949554964.s575685476659282.get_Item(moduleFileIndex).s369986943707552;
            if (str2.EndsWith(".dll", StringComparison.OrdinalIgnoreCase) || str2.EndsWith(".exe", StringComparison.OrdinalIgnoreCase))
              str2 = str2.Substring(0, str2.Length - 4);
          }
          else
            str2 = this.s811601286656942.s517247949554964.s575685476659282.get_Item(moduleFileIndex).s589987884624410;
        }
        return str2 + "!" + str1;
      }
      int threadIndex = num1 - this.s811601286656942.s517247949554964.s117445044974708;
      if (threadIndex < this.s811601286656942.s132713297009023.s141151785930897)
        return this.s811601286656942.s132713297009023.get_Item((s543941511077464) threadIndex).s901891550376301;
      int processIndex = threadIndex - this.s811601286656942.s132713297009023.s141151785930897;
      if (processIndex >= this.s811601286656942.s386698456584430.s022024230865801)
        return "";
      s572171018010254 s572171018010254 = this.s811601286656942.s386698456584430.get_Item((s878863610233214) processIndex);
      string str3 = s572171018010254.s412096044998296 ? "64" : "32";
      string str4 = s572171018010254.s381739167324001;
      if (str4.Length > 0)
      {
        int num2 = str4[0] != '"' ? str4.IndexOf(' ') : str4.IndexOf('"', 1);
        if (0 <= num2)
          str4 = str4.Substring(num2 + 1, str4.Length - num2 - 1);
      }
      return "Process" + str3 + " " + s572171018010254.s657075392570271 + " (" + (object) s572171018010254.s308323137639863 + ") Args: " + str4;
    }

    public virtual int s074221326370611 => this.s811601286656942.s331550318228488.s205966286230606 + 2 * this.s811601286656942.s132713297009023.s141151785930897 + this.s811601286656942.s386698456584430.s022024230865801 + this.s937945968757058;

    public virtual int s773077944535749 => 4 + this.s811601286656942.s517247949554964.s117445044974708 + this.s811601286656942.s132713297009023.s141151785930897 + this.s811601286656942.s386698456584430.s022024230865801;

    private s220468656497021.s735365250405810 s714012324937127(
      s220468656497021.s735365250405810[] s760994970224157,
      s457867646003930 s688706509805048)
    {
      s220468656497021.s735365250405810 s242896541718277 = s760994970224157[(int) s688706509805048];
      if (s242896541718277 == null)
      {
        s457867646003930 s688706509805048_1 = this.s578756348595744(s688706509805048);
        if (s688706509805048_1 != s457867646003930.Invalid)
          s242896541718277 = this.s714012324937127(s760994970224157, s688706509805048_1);
        s275977756270514 s456849916818107 = this.s275938953343520(s688706509805048);
        if (s456849916818107 != s275977756270514.Invalid)
        {
          s320811790897239 s262273746905063 = this.s497445036332360(s456849916818107);
          if (s262273746905063 != s320811790897239.Invalid)
          {
            s689802712977948 moduleFileIndex = this.s740232737369485.s331550318228488.s462846571074637.s119857474429490(s262273746905063);
            if (moduleFileIndex != s689802712977948.Invalid)
              s242896541718277 = s645758109343855.s650893925187870<>.s706989176055072(this.s740232737369485.s427569464106482.get_Item(moduleFileIndex), s242896541718277);
          }
        }
        s760994970224157[(int) s688706509805048] = s242896541718277;
      }
      return s242896541718277;
    }

    internal s220468656497021(s953925013719849 log)
    {
      this.s811601286656942 = log;
      this.s028837389723718 = s689802712977948.Invalid;
      this.s691743177888642 = new s124232551204041((s293547439506271) this);
      this.s691743177888642.s084801687846570 = (float) log.s407580712989469.TotalMilliseconds;
    }

    private int s048075607380671(
      s543941511077464 s839805697287933,
      s320811790897239 s247370842355044)
    {
      if (this.s888995309062427 == null)
        this.s888995309062427 = new Dictionary<s220468656497021.s390022282378977, int>();
      s220468656497021.s390022282378977 key;
      // ISSUE: explicit constructor call
      ((s220468656497021.s735365250405810) ref key).\u002Ector(s839805697287933, s247370842355044);
      int num;
      if (this.s888995309062427.TryGetValue(key, out num))
        return num;
      int count = this.s350466776474520.Count;
      if (count >= this.s937945968757058)
        return -1;
      this.s350466776474520.Add(key);
      this.s888995309062427.Add(key, count);
      return count;
    }

    private s457867646003930 s907792610541785(s034852122986107 s553955667813902)
    {
      int num1 = (int) s553955667813902.s896522493390522();
      if (num1 == -1)
      {
        s399735979708807 s399735979708807 = s553955667813902.s294168149113671();
        if (s399735979708807 == null)
          return s457867646003930.Invalid;
        s320811790897239 s247370842355044 = s320811790897239.Invalid;
        if (s553955667813902 is s842589405245694 s821642611750501)
          s247370842355044 = s821642611750501.s984782378736331();
        else if (s553955667813902 is s420649588448282)
          s247370842355044 = s821642611750501.s984782378736331();
        if (s247370842355044 != s320811790897239.Invalid)
        {
          int num2 = this.s048075607380671(s399735979708807.s519833341027850, s247370842355044);
          if (0 <= num2)
            num1 = this.s811601286656942.s331550318228488.s205966286230606 + 2 * this.s811601286656942.s132713297009023.s141151785930897 + this.s811601286656942.s386698456584430.s022024230865801 + num2;
        }
        if (num1 == -1)
          num1 = (int) (this.s811601286656942.s331550318228488.s205966286230606 + s399735979708807.s519833341027850);
      }
      return (s457867646003930) num1;
    }

    private bool s917300110616957(
      s457867646003930 s996846504952092,
      s543941511077464 s374631394070476)
    {
      uint s687774124953307 = (uint) s996846504952092;
      if (s687774124953307 >= (uint) this.s811601286656942.s331550318228488.s205966286230606)
        return false;
      s320811790897239 s320811790897239 = this.s811601286656942.s331550318228488.s772228772378070((s147978847785798) s687774124953307);
      s689802712977948 s689802712977948 = this.s811601286656942.s331550318228488.s462846571074637.s119857474429490(s320811790897239);
      if (this.s028837389723718 == s689802712977948)
        return true;
      s045113750567070 s045113750567070 = this.s811601286656942.s331550318228488.s462846571074637.s253661179799257(s320811790897239);
      if (s045113750567070 == null)
        return false;
      if (s045113750567070.s369986943707552.EndsWith("ntdll.dll", StringComparison.OrdinalIgnoreCase))
      {
        this.s028837389723718 = s689802712977948;
        return true;
      }
      if (s045113750567070.s369986943707552.EndsWith("ntoskrnl.exe", StringComparison.OrdinalIgnoreCase))
      {
        switch (this.s811601286656942.s132713297009023.get_Item(s374631394070476).s772648742937858.s308323137639863)
        {
          case 0:
          case 4:
            this.s028837389723718 = s689802712977948;
            return true;
        }
      }
      return false;
    }

    private class s735365250405810
    {
      public s220468656497021.s735365250405810 s749696088484870;
      public s543941511077464 s778349165575246;

      public static bool s820059826356585(
        s045113750567070 s168213818784257,
        s220468656497021.s735365250405810 s323798303784368)
      {
        for (; s323798303784368 != null; s323798303784368 = s323798303784368.s749696088484870)
        {
          if (s168213818784257 == ((s645758109343855.s650893925187870<>) s323798303784368).s034655998058606)
            return true;
        }
        return false;
      }

      public s735365250405810(s045113750567070 module, s220468656497021.s735365250405810 rest)
      {
        ((s645758109343855.s650893925187870<>) this).s034655998058606 = module;
        this.s749696088484870 = rest;
      }

      public s735365250405810(s543941511077464 threadIndex, s320811790897239 codeAddressIndex)
      {
        this.s778349165575246 = threadIndex;
        ((s220468656497021.s390022282378977) this).s802899828167129 = codeAddressIndex;
      }
    }

    private struct s390022282378977 : IEquatable<s220468656497021.s390022282378977>
    {
      public s320811790897239 s802899828167129;
      public int[] s135655435841493;

      public virtual int s412028075605226() => (int) (this.s802899828167129 + (int) (^(s220468656497021.s735365250405810&) ref this).s778349165575246 * 65536);

      public virtual bool s702867116747821(object s518603054298597) => throw new NotImplementedException();

      public bool s634184117177938(s220468656497021.s390022282378977 s171339401681876) => (^(s220468656497021.s735365250405810&) ref this).s778349165575246 == s171339401681876.s778349165575246 && this.s802899828167129 == s171339401681876.s802899828167129;

      public s390022282378977() => ((object) ref this).\u002Ector();
    }
  }
}
