// Decompiled with JetBrains decompiler
// Type: NAudio.Wave.WaveOutEvent
// Assembly: $77-Venom, Version=2.1.0.0, Culture=neutral, PublicKeyToken=null
// MVID: DC8E8704-647D-4CA7-99AB-BB7BE936B486
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.02-msil\HEUR-Trojan.MSIL.Zapchast.gen-2e1eda10e2bbd19418706a23888807e50c0407eb191cc26d541c85279193c3db.exe

using System;
using System.Runtime.InteropServices;
using System.Threading;
using xClient.Core.NAudio.Wave.WaveOutputs;
using xClient.Core.NAudio.Wave.WaveStreams;

namespace NAudio.Wave
{
  public class WaveOutEvent : 
    IWavePlayer,
    IDisposable,
    \u31E2包זሯ䓹\uA497㺦\u08DD㜳\uE01Cꗃ眦Ѵ\u0011斠㻢쯈鏬\uF4A5唽
  {
    private readonly object waveOutLock;
    private readonly SynchronizationContext syncContext;
    private IntPtr hWaveOut;
    private WaveOutBuffer[] buffers;
    private ᒅ憁ܳ䥿䣘ꅤ\u288C裬\uF406턉\u2752쉢煫\uF31F\u2B91杔蕨蹯鈭쭫 waveStream;
    private volatile ꡨ鬒ꛔ將\uEFF7\uE48E싓㥺숖\uEC59ꙃ쮙ᗉ옮푊谸\uEA67뱾糂ᔗ playbackState;
    private AutoResetEvent callbackEvent;
    private float volume = 1f;

    public event EventHandler<鳷즤핿ེ嵔갔ᬅ벐յ\u297B\u3209䎪䌂\u2AA1侫\u3298嚃鲗쟈\uEDF5> PlaybackStopped;

    public int DesiredLatency { get; set; }

    public int NumberOfBuffers { get; set; }

    public int DeviceNumber { get; set; }

    public WaveOutEvent()
    {
      this.syncContext = SynchronizationContext.Current;
      if (this.syncContext != null && (this.syncContext.GetType().Name == "LegacyAspNetSynchronizationContext" || this.syncContext.GetType().Name == "AspNetSynchronizationContext"))
        this.syncContext = (SynchronizationContext) null;
      this.DeviceNumber = 0;
      this.DesiredLatency = 300;
      this.NumberOfBuffers = 2;
      this.waveOutLock = new object();
    }

    public void Init(
      ᒅ憁ܳ䥿䣘ꅤ\u288C裬\uF406턉\u2752쉢煫\uF31F\u2B91杔蕨蹯鈭쭫 waveProvider)
    {
      if (this.playbackState != ꡨ鬒ꛔ將\uEFF7\uE48E싓㥺숖\uEC59ꙃ쮙ᗉ옮푊谸\uEA67뱾糂ᔗ.\uF594条렩ᒕ亗漴\uFFFD詬ᮉ\uE833妬嶦媙Ⅷ㰋䥥旵闄쳨\u2E20)
        throw new InvalidOperationException("Can't re-initialize during playback");
      if (this.hWaveOut != IntPtr.Zero)
      {
        this.DisposeBuffers();
        this.CloseWaveOut();
      }
      this.callbackEvent = new AutoResetEvent(false);
      this.waveStream = waveProvider;
      int bufferSize = waveProvider.WaveFormat.㖆\uE54Eੲ郊崳\uE609쿚\u0DF9啜뿃\u0383㼻駱㣰偠뫶薟肅\u0001朐((this.DesiredLatency + this.NumberOfBuffers - 1) / this.NumberOfBuffers);
      濱Ɋ\uF57E穾ꎮᛩ烨᮹旝蚯䂤宫歝퇘勑텸痤펵岛\u4DE9 result;
      lock (this.waveOutLock)
        result = 珸\u25E1단ᑊ눵ꫤ\u1AC3ꥩ\uE659珟㳓坍鎸羅㺝ܩ\u173C\u2891\u2E15힘.ၼ崫鹶폣泚선졢\u254E\uE557ꡕ쥝鴌闪\uEC6D﹏뫿寣榺١䓄(out this.hWaveOut, (IntPtr) this.DeviceNumber, this.waveStream.WaveFormat, this.callbackEvent.SafeWaitHandle.DangerousGetHandle(), IntPtr.Zero, 珸\u25E1단ᑊ눵ꫤ\u1AC3ꥩ\uE659珟㳓坍鎸羅㺝ܩ\u173C\u2891\u2E15힘.\u2866媧뗂歑붢竞镞ªⳣꇎ㚢\uED36皲ꁿЬ㲻\uF1EDႈ\uFFFD䦓.뷜ꪀ䑔蝴ʆ䅕\uEDC9ꆬ褛쪠叺嫹씇ᒒ\u089C\u05CD嘡\uFFFD\uFFFD뮀);
      텆䙫簻冣캶\uFFFDꪃ뗫\u28E0\uFFFD㪠\uF818궤㤿淳寎\uE6B2䁻㡅톈.蹠鬽삕闦ڋଫ퐜螰梬갻\u27EF逇쭗ద먪䐧굚ᢧῇ衜(result, "waveOutOpen");
      this.buffers = new WaveOutBuffer[this.NumberOfBuffers];
      this.playbackState = ꡨ鬒ꛔ將\uEFF7\uE48E싓㥺숖\uEC59ꙃ쮙ᗉ옮푊谸\uEA67뱾糂ᔗ.\uF594条렩ᒕ亗漴\uFFFD詬ᮉ\uE833妬嶦媙Ⅷ㰋䥥旵闄쳨\u2E20;
      for (int index = 0; index < this.NumberOfBuffers; ++index)
        this.buffers[index] = new WaveOutBuffer(this.hWaveOut, bufferSize, this.waveStream, this.waveOutLock);
    }

    public void Play()
    {
      if (this.buffers == null || this.waveStream == null)
        throw new InvalidOperationException("Must call Init first");
      if (this.playbackState == ꡨ鬒ꛔ將\uEFF7\uE48E싓㥺숖\uEC59ꙃ쮙ᗉ옮푊谸\uEA67뱾糂ᔗ.\uF594条렩ᒕ亗漴\uFFFD詬ᮉ\uE833妬嶦媙Ⅷ㰋䥥旵闄쳨\u2E20)
      {
        this.playbackState = ꡨ鬒ꛔ將\uEFF7\uE48E싓㥺숖\uEC59ꙃ쮙ᗉ옮푊谸\uEA67뱾糂ᔗ.즭ᦷ훜毨渖짴䊪휿凸鶠\uF470㕏댛뇾쑅槼\u2D2E\uE454\uFFFD໕;
        this.callbackEvent.Set();
        ThreadPool.QueueUserWorkItem((WaitCallback) (state => this.PlaybackThread()), (object) null);
      }
      else
      {
        if (this.playbackState != ꡨ鬒ꛔ將\uEFF7\uE48E싓㥺숖\uEC59ꙃ쮙ᗉ옮푊谸\uEA67뱾糂ᔗ.䭉Ⱝ賓\u08B6櫍䳱\uF6D0\uFFFD䭙퀏굣終䒃\u2722នꑴ퐇嶥\uE1F3䤉)
          return;
        this.Resume();
        this.callbackEvent.Set();
      }
    }

    private void PlaybackThread()
    {
      Exception e = (Exception) null;
      try
      {
        this.DoPlayback();
      }
      catch (Exception ex)
      {
        e = ex;
      }
      finally
      {
        this.playbackState = ꡨ鬒ꛔ將\uEFF7\uE48E싓㥺숖\uEC59ꙃ쮙ᗉ옮푊谸\uEA67뱾糂ᔗ.\uF594条렩ᒕ亗漴\uFFFD詬ᮉ\uE833妬嶦媙Ⅷ㰋䥥旵闄쳨\u2E20;
        this.RaisePlaybackStoppedEvent(e);
      }
    }

    private void DoPlayback()
    {
      while (this.playbackState != ꡨ鬒ꛔ將\uEFF7\uE48E싓㥺숖\uEC59ꙃ쮙ᗉ옮푊谸\uEA67뱾糂ᔗ.\uF594条렩ᒕ亗漴\uFFFD詬ᮉ\uE833妬嶦媙Ⅷ㰋䥥旵闄쳨\u2E20)
      {
        if (!this.callbackEvent.WaitOne(this.DesiredLatency))
        {
          int playbackState = (int) this.playbackState;
        }
        if (this.playbackState == ꡨ鬒ꛔ將\uEFF7\uE48E싓㥺숖\uEC59ꙃ쮙ᗉ옮푊谸\uEA67뱾糂ᔗ.즭ᦷ훜毨渖짴䊪휿凸鶠\uF470㕏댛뇾쑅槼\u2D2E\uE454\uFFFD໕)
        {
          int num = 0;
          foreach (WaveOutBuffer buffer in this.buffers)
          {
            if (buffer.InQueue || buffer.OnDone())
              ++num;
          }
          if (num == 0)
          {
            this.playbackState = ꡨ鬒ꛔ將\uEFF7\uE48E싓㥺숖\uEC59ꙃ쮙ᗉ옮푊谸\uEA67뱾糂ᔗ.\uF594条렩ᒕ亗漴\uFFFD詬ᮉ\uE833妬嶦媙Ⅷ㰋䥥旵闄쳨\u2E20;
            this.callbackEvent.Set();
          }
        }
      }
    }

    public void Pause()
    {
      if (this.playbackState != ꡨ鬒ꛔ將\uEFF7\uE48E싓㥺숖\uEC59ꙃ쮙ᗉ옮푊谸\uEA67뱾糂ᔗ.즭ᦷ훜毨渖짴䊪휿凸鶠\uF470㕏댛뇾쑅槼\u2D2E\uE454\uFFFD໕)
        return;
      this.playbackState = ꡨ鬒ꛔ將\uEFF7\uE48E싓㥺숖\uEC59ꙃ쮙ᗉ옮푊谸\uEA67뱾糂ᔗ.䭉Ⱝ賓\u08B6櫍䳱\uF6D0\uFFFD䭙퀏굣終䒃\u2722នꑴ퐇嶥\uE1F3䤉;
      濱Ɋ\uF57E穾ꎮᛩ烨᮹旝蚯䂤宫歝퇘勑텸痤펵岛\u4DE9 result;
      lock (this.waveOutLock)
        result = 珸\u25E1단ᑊ눵ꫤ\u1AC3ꥩ\uE659珟㳓坍鎸羅㺝ܩ\u173C\u2891\u2E15힘.బ戔㨤Ɦ㦢\uE4E5震輏箁携壙݄ơ믣㻀\u09FEꑊ\uFFFD\u2753\u0E3F(this.hWaveOut);
      if (result != 濱Ɋ\uF57E穾ꎮᛩ烨᮹旝蚯䂤宫歝퇘勑텸痤펵岛\u4DE9.\uEE95顠Ǘ亹\uEF0C㠵梑䍃빼\uE62E鏯ꪍ眱ﵘ\u242E\uE02B䘽ꌌ\u24D5靊)
        throw new 텆䙫簻冣캶\uFFFDꪃ뗫\u28E0\uFFFD㪠\uF818궤㤿淳寎\uE6B2䁻㡅톈(result, "waveOutPause");
    }

    private void Resume()
    {
      if (this.playbackState != ꡨ鬒ꛔ將\uEFF7\uE48E싓㥺숖\uEC59ꙃ쮙ᗉ옮푊谸\uEA67뱾糂ᔗ.䭉Ⱝ賓\u08B6櫍䳱\uF6D0\uFFFD䭙퀏굣終䒃\u2722នꑴ퐇嶥\uE1F3䤉)
        return;
      濱Ɋ\uF57E穾ꎮᛩ烨᮹旝蚯䂤宫歝퇘勑텸痤펵岛\u4DE9 result;
      lock (this.waveOutLock)
        result = 珸\u25E1단ᑊ눵ꫤ\u1AC3ꥩ\uE659珟㳓坍鎸羅㺝ܩ\u173C\u2891\u2E15힘.\uE79E葐竮\uF2D6幉ἄ뻿ᎃ鰓䒌屉ꆸ掀퐣歞幠\u22B2呂촲ࠍ(this.hWaveOut);
      if (result != 濱Ɋ\uF57E穾ꎮᛩ烨᮹旝蚯䂤宫歝퇘勑텸痤펵岛\u4DE9.\uEE95顠Ǘ亹\uEF0C㠵梑䍃빼\uE62E鏯ꪍ眱ﵘ\u242E\uE02B䘽ꌌ\u24D5靊)
        throw new 텆䙫簻冣캶\uFFFDꪃ뗫\u28E0\uFFFD㪠\uF818궤㤿淳寎\uE6B2䁻㡅톈(result, "waveOutRestart");
      this.playbackState = ꡨ鬒ꛔ將\uEFF7\uE48E싓㥺숖\uEC59ꙃ쮙ᗉ옮푊谸\uEA67뱾糂ᔗ.즭ᦷ훜毨渖짴䊪휿凸鶠\uF470㕏댛뇾쑅槼\u2D2E\uE454\uFFFD໕;
    }

    public void Stop()
    {
      if (this.playbackState == ꡨ鬒ꛔ將\uEFF7\uE48E싓㥺숖\uEC59ꙃ쮙ᗉ옮푊谸\uEA67뱾糂ᔗ.\uF594条렩ᒕ亗漴\uFFFD詬ᮉ\uE833妬嶦媙Ⅷ㰋䥥旵闄쳨\u2E20)
        return;
      this.playbackState = ꡨ鬒ꛔ將\uEFF7\uE48E싓㥺숖\uEC59ꙃ쮙ᗉ옮푊谸\uEA67뱾糂ᔗ.\uF594条렩ᒕ亗漴\uFFFD詬ᮉ\uE833妬嶦媙Ⅷ㰋䥥旵闄쳨\u2E20;
      濱Ɋ\uF57E穾ꎮᛩ烨᮹旝蚯䂤宫歝퇘勑텸痤펵岛\u4DE9 result;
      lock (this.waveOutLock)
        result = 珸\u25E1단ᑊ눵ꫤ\u1AC3ꥩ\uE659珟㳓坍鎸羅㺝ܩ\u173C\u2891\u2E15힘.㴾\uF0FE뉟偙쿣鈛檊\u055DꚔ폢\u2954篬顈\u0FF6ﾇ妴葼㞿㧚徰(this.hWaveOut);
      if (result != 濱Ɋ\uF57E穾ꎮᛩ烨᮹旝蚯䂤宫歝퇘勑텸痤펵岛\u4DE9.\uEE95顠Ǘ亹\uEF0C㠵梑䍃빼\uE62E鏯ꪍ眱ﵘ\u242E\uE02B䘽ꌌ\u24D5靊)
        throw new 텆䙫簻冣캶\uFFFDꪃ뗫\u28E0\uFFFD㪠\uF818궤㤿淳寎\uE6B2䁻㡅톈(result, "waveOutReset");
      this.callbackEvent.Set();
    }

    public long GetPosition()
    {
      lock (this.waveOutLock)
      {
        \uEF81렾ᯛꍧ矻섮\uFE61맿\uEA7A\uF804諍椚\uEB32\u252D藎览\uF27E坋飌湗 mmTime = new \uEF81렾ᯛꍧ矻섮\uFE61맿\uEA7A\uF804諍椚\uEB32\u252D藎览\uF27E坋飌湗();
        mmTime.ﺮ笎휶敏目틳숃䱣ⴉЪ悔侸빽㸞\u32B5긁\uF6E3䇂㾠\u2E53 = 4U;
        텆䙫簻冣캶\uFFFDꪃ뗫\u28E0\uFFFD㪠\uF818궤㤿淳寎\uE6B2䁻㡅톈.蹠鬽삕闦ڋଫ퐜螰梬갻\u27EF逇쭗ద먪䐧굚ᢧῇ衜(珸\u25E1단ᑊ눵ꫤ\u1AC3ꥩ\uE659珟㳓坍鎸羅㺝ܩ\u173C\u2891\u2E15힘.\uED3F뛶铥ၤ凴锢\uE803꼝\u32F3峈\uFAFD嶡\uE9D7䤈Ḻꨣ졑智O눤(this.hWaveOut, out mmTime, Marshal.SizeOf((object) mmTime)), "waveOutGetPosition");
        return mmTime.ﺮ笎휶敏目틳숃䱣ⴉЪ悔侸빽㸞\u32B5긁\uF6E3䇂㾠\u2E53 == 4U ? (long) mmTime.\uFFFD木イ嗜뉫墝㑕\uF679ꙶ췤波內덬\u19DE䎁ᩨ邡玟섃벸 : throw new Exception(string.Format("waveOutGetPosition: wType -> Expected {0}, Received {1}", (object) 4, (object) mmTime.ﺮ笎휶敏目틳숃䱣ⴉЪ悔侸빽㸞\u32B5긁\uF6E3䇂㾠\u2E53));
      }
    }

    public 裞䨖觤㥟㛴먰\uEC41\u136C嵹乢\uE98Cᘁቫ륺끂볃\uF732\uFFFD枽侏 OutputWaveFormat => this.waveStream.WaveFormat;

    public ꡨ鬒ꛔ將\uEFF7\uE48E싓㥺숖\uEC59ꙃ쮙ᗉ옮푊谸\uEA67뱾糂ᔗ PlaybackState => this.playbackState;

    public float Volume
    {
      get => this.volume;
      set
      {
        WaveOut.SetWaveOutVolume(value, this.hWaveOut, this.waveOutLock);
        this.volume = value;
      }
    }

    public void Dispose()
    {
      GC.SuppressFinalize((object) this);
      this.Dispose(true);
    }

    protected void Dispose(bool disposing)
    {
      this.Stop();
      if (disposing)
        this.DisposeBuffers();
      this.CloseWaveOut();
    }

    private void CloseWaveOut()
    {
      if (this.callbackEvent != null)
      {
        this.callbackEvent.Close();
        this.callbackEvent = (AutoResetEvent) null;
      }
      lock (this.waveOutLock)
      {
        if (!(this.hWaveOut != IntPtr.Zero))
          return;
        int num = (int) 珸\u25E1단ᑊ눵ꫤ\u1AC3ꥩ\uE659珟㳓坍鎸羅㺝ܩ\u173C\u2891\u2E15힘.\uF4E3\uED55䆷\uF26C\u2070થ뒞㓣\uF6CF\uE15C\u0A65\uECAEᦿ\uEC49둠錤\uFFFD軻\uE6F8叐(this.hWaveOut);
        this.hWaveOut = IntPtr.Zero;
      }
    }

    private void DisposeBuffers()
    {
      if (this.buffers == null)
        return;
      foreach (WaveOutBuffer buffer in this.buffers)
        buffer.Dispose();
      this.buffers = (WaveOutBuffer[]) null;
    }

    ~WaveOutEvent() => this.Dispose(false);

    private void RaisePlaybackStoppedEvent(Exception e)
    {
      EventHandler<鳷즤핿ེ嵔갔ᬅ벐յ\u297B\u3209䎪䌂\u2AA1侫\u3298嚃鲗쟈\uEDF5> handler = this.PlaybackStopped;
      if (handler == null)
        return;
      if (this.syncContext == null)
        handler((object) this, new 鳷즤핿ེ嵔갔ᬅ벐յ\u297B\u3209䎪䌂\u2AA1侫\u3298嚃鲗쟈\uEDF5(e));
      else
        this.syncContext.Post((SendOrPostCallback) (state => handler((object) this, new 鳷즤핿ེ嵔갔ᬅ벐յ\u297B\u3209䎪䌂\u2AA1侫\u3298嚃鲗쟈\uEDF5(e))), (object) null);
    }
  }
}
