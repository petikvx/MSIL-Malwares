// Decompiled with JetBrains decompiler
// Type: 1QlkzJZBRpL9X.ykkPlLjyntbr5
// Assembly: Udby4Jt48oXkJ, Version=3.17.2.31, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
// MVID: 37899E89-D673-4F5B-A193-2E4DF6A54096
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.MSIL.Gorgon.gen-bf535869266eca7a958714acade2ede1bff0e73f0aaa2702f389ededee6a8d6a.exe

using \u0031QlkzJZBRpL9X;
using \u0036mHL90hQ651VX;
using LW05ej0BDcVEz;
using mhZ8amQVr4JAO;
using QqIWQIVQdfvhc;
using QSS3PlDQAyMp9;
using rremZdV0lo9Ty;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Net;
using System.Runtime.CompilerServices;
using System.Threading.Tasks;
using yFt7pB2372H4i;

namespace \u0031QlkzJZBRpL9X
{
  internal class ykkPlLjyntbr5
  {
    private const string CHD83IS3MNbfV = "x-ms-PKeyAuth";
    private const string \u0039q4ceeKpLuFGi = "1.0";
    private const string LrrQLGKGeynlp = "WWW-Authenticate";
    private const string FD68lb9eeyPyL = "PKeyAuth";
    private const int f4x4j8F8aNgtX = 1000;
    private readonly Up2ciG6wVdM5T \u0036KepWjt2HG6o8;
    internal bool GRBJbvEgmMEH9;
    internal bool kqAPzqWMLXeCq = true;

    public ykkPlLjyntbr5(string uri, Up2ciG6wVdM5T callState)
    {
      this.kz5gjjBiXMN7i = ykkPlLjyntbr5.czI2tnhWww9Ry(uri);
      this.LGSNcRQFFlzBX = (IHttpClient) new Quu9ElPGoolUe(this.kz5gjjBiXMN7i, callState);
      this.\u0036KepWjt2HG6o8 = callState;
    }

    internal string kz5gjjBiXMN7i { get; set; }

    public IHttpClient LGSNcRQFFlzBX { get; private set; }

    public Up2ciG6wVdM5T \u0037tQ11Ns2I5cSp { get; private set; }

    public Task<T> Q0YWFKQ3XEt0o<T>()
    {
      // ISSUE: variable of a compiler-generated type
      ykkPlLjyntbr5.jBcLPaRLPKryE<T> stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003C\u003E4__this = this;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003C\u003Et__builder = AsyncTaskMethodBuilder<T>.Create();
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003C\u003E1__state = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003C\u003Et__builder.Start<ykkPlLjyntbr5.jBcLPaRLPKryE<T>>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.\u003C\u003Et__builder.Task;
    }

    private Task<T> T2VapPD2QuyJ6<T>(bool _param1)
    {
      // ISSUE: variable of a compiler-generated type
      ykkPlLjyntbr5.\u0039oq7x1bEBqB0G<T> stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003C\u003E4__this = this;
      // ISSUE: reference to a compiler-generated field
      stateMachine.respondToDeviceAuthChallenge = _param1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003C\u003Et__builder = AsyncTaskMethodBuilder<T>.Create();
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003C\u003E1__state = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003C\u003Et__builder.Start<ykkPlLjyntbr5.\u0039oq7x1bEBqB0G<T>>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.\u003C\u003Et__builder.Task;
    }

    private bool vm6xPjDI6uPej(IHttpWebResponse KM2oNG2nF23W1, bool EwCfHJzF5ASg1) => ((!pNLYNJuIGYGNT.YM0DoC0ZctKof ? 0 : (KM2oNG2nF23W1 != null ? 1 : 0)) & (EwCfHJzF5ASg1 ? 1 : 0)) != 0 && KM2oNG2nF23W1?.Headers != null && KM2oNG2nF23W1.StatusCode == HttpStatusCode.Unauthorized && KM2oNG2nF23W1.Headers.Contains("WWW-Authenticate") && KM2oNG2nF23W1.Headers.GetValues("WWW-Authenticate").FirstOrDefault<string>().StartsWith("PKeyAuth", StringComparison.OrdinalIgnoreCase);

    private IDictionary<string, string> qmyZ1cIStTSwM(IHttpWebResponse UnvFBaApvFJ06)
    {
      IDictionary<string, string> dictionary = (IDictionary<string, string>) new Dictionary<string, string>();
      foreach (string str in \u0037BKomckZ2VHww.ASdRicROyxLng(UnvFBaApvFJ06.Headers.GetValues("WWW-Authenticate").FirstOrDefault<string>().Substring("PKeyAuth".Length + 1), ','))
      {
        List<string> stringList = \u0037BKomckZ2VHww.ASdRicROyxLng(str, '=');
        dictionary.Add(stringList[0].Trim(), stringList[1].Trim().Replace("\"", ""));
      }
      return dictionary;
    }

    private Task<T> QZSgGytjfwRSf<T>(IHttpWebResponse OWHyVq3iR4UqD)
    {
      // ISSUE: variable of a compiler-generated type
      ykkPlLjyntbr5.PqmVmAyZU9dNS<T> stateMachine;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003C\u003E4__this = this;
      // ISSUE: reference to a compiler-generated field
      stateMachine.response = OWHyVq3iR4UqD;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003C\u003Et__builder = AsyncTaskMethodBuilder<T>.Create();
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003C\u003E1__state = -1;
      // ISSUE: reference to a compiler-generated field
      stateMachine.\u003C\u003Et__builder.Start<ykkPlLjyntbr5.PqmVmAyZU9dNS<T>>(ref stateMachine);
      // ISSUE: reference to a compiler-generated field
      return stateMachine.\u003C\u003Et__builder.Task;
    }

    private static string czI2tnhWww9Ry(string je6ESUQkClBDN)
    {
      string str1 = new HgU9ZQtKaZBWN().r1Fai89WUYAFi("ExtraQueryParameter");
      string str2 = je6ESUQkClBDN.IndexOf('?') > 0 ? "&" : "?";
      if (!string.IsNullOrWhiteSpace(str1))
        je6ESUQkClBDN = je6ESUQkClBDN + str2 + str1;
      return je6ESUQkClBDN;
    }
  }
}
