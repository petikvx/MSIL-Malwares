// Decompiled with JetBrains decompiler
// Type: aF1EEljJMevbc0dQO.HkH5KWgtmZX8ggIbB
// Assembly: bouNMGxVgGi4SRgWO, Version=3.0.0.0, Culture=neutral, PublicKeyToken=adb9793829ddae60
// MVID: 3F6A2AF1-3CCB-4F01-AA36-FA31C2E4CFE8
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Backdoor.MSIL.Agent.gen-bc408b9f362db28b2e931ff336ec5661cc0ce27b0cdc0ce215fec1b7381aca7f.exe

using Microsoft.TemplateEngine.Core.Contracts;
using System;
using System.Collections.Generic;
using System.Net;
using System.Net.Sockets;

namespace aF1EEljJMevbc0dQO
{
  public class HkH5KWgtmZX8ggIbB : IMacroConfig
  {
    private static readonly HashSet<int> FAmPvkgNY8LVZMroI = new HashSet<int>()
    {
      2049,
      3659,
      4045,
      6000,
      6665,
      6666,
      6667,
      6668,
      6669
    };

    public string QyQqub4eaL3kP16kO { get; }

    public string wTOeacyfwkx9G0jHg { get; }

    public string zjWxJqv7KTQtbrSWQ => "port";

    public Socket Q1xAmrqezAchNDevY { get; }

    public int Z93FoytMLKJBAAzGs { get; }

    public int dLT8uTKLakOdZNAqX { get; }

    public int NabfIU2S0sVvPO3MH { get; }

    public HkH5KWgtmZX8ggIbB(
      string variableName,
      string dataType,
      int fallback,
      int low,
      int high)
    {
      this.QyQqub4eaL3kP16kO = dataType;
      this.wTOeacyfwkx9G0jHg = variableName;
      int num = new Random().Next(low, high);
      for (int tQjW9TAER9CHWkYke = num; tQjW9TAER9CHWkYke <= high; ++tQjW9TAER9CHWkYke)
      {
        Socket Gy1Ln6uJDXgi6c94s;
        if (this.ZpwEoVyPXpZpUfpf5(tQjW9TAER9CHWkYke, out Gy1Ln6uJDXgi6c94s))
        {
          this.Q1xAmrqezAchNDevY = Gy1Ln6uJDXgi6c94s;
          this.Z93FoytMLKJBAAzGs = ((IPEndPoint) this.Q1xAmrqezAchNDevY.LocalEndPoint).Port;
          return;
        }
      }
      for (int tQjW9TAER9CHWkYke = low; tQjW9TAER9CHWkYke < num; ++tQjW9TAER9CHWkYke)
      {
        Socket Gy1Ln6uJDXgi6c94s;
        if (this.ZpwEoVyPXpZpUfpf5(tQjW9TAER9CHWkYke, out Gy1Ln6uJDXgi6c94s))
        {
          this.Q1xAmrqezAchNDevY = Gy1Ln6uJDXgi6c94s;
          this.Z93FoytMLKJBAAzGs = ((IPEndPoint) this.Q1xAmrqezAchNDevY.LocalEndPoint).Port;
          return;
        }
      }
      this.Z93FoytMLKJBAAzGs = fallback;
    }

    private bool ZpwEoVyPXpZpUfpf5(int tQjW9TAER9CHWkYke, out Socket Gy1Ln6uJDXgi6c94s)
    {
      Gy1Ln6uJDXgi6c94s = (Socket) null;
      if (HkH5KWgtmZX8ggIbB.FAmPvkgNY8LVZMroI.Contains(tQjW9TAER9CHWkYke))
        return false;
      try
      {
        if (Socket.OSSupportsIPv4)
          Gy1Ln6uJDXgi6c94s = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
        else if (Socket.OSSupportsIPv6)
          Gy1Ln6uJDXgi6c94s = new Socket(AddressFamily.InterNetworkV6, SocketType.Stream, ProtocolType.Tcp);
      }
      catch
      {
        Gy1Ln6uJDXgi6c94s?.Dispose();
        return false;
      }
      if (Gy1Ln6uJDXgi6c94s != null)
      {
        IPEndPoint localEP = new IPEndPoint(Gy1Ln6uJDXgi6c94s.AddressFamily == AddressFamily.InterNetworkV6 ? IPAddress.IPv6Any : IPAddress.Any, tQjW9TAER9CHWkYke);
        try
        {
          Gy1Ln6uJDXgi6c94s.Bind((EndPoint) localEP);
          return true;
        }
        catch
        {
          Gy1Ln6uJDXgi6c94s?.Dispose();
          return false;
        }
      }
      else
      {
        Gy1Ln6uJDXgi6c94s = (Socket) null;
        return false;
      }
    }
  }
}
