// Decompiled with JetBrains decompiler
// Type: Coache.FacturarProveedor.FacturaProveedorForm
// Assembly: IsCopyConstruc, Version=5.6.2.1, Culture=neutral, PublicKeyToken=null
// MVID: 1DA50973-FF9A-4563-8B8F-74E2573677DF
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.02-msil\HEUR-Trojan-Ransom.MSIL.Blocker.gen-136935297fa08738f6957068951067c699c91b2902f3ea14da650289cabfd29d.exe

using Coache.AbmProveedor;
using Coache.Business;
using Coache.Common;
using Coache.Core;
using Coache.Login;
using System;
using System.Collections;
using System.ComponentModel;
using System.Drawing;
using System.Linq;
using System.Windows.Forms;

namespace Coache.FacturarProveedor
{
  [PermissionRequired(new Functionalities[] {Functionalities.Facturar})]
  public class FacturaProveedorForm : Form
  {
    private Proveedor _proveedor;
    private ProveedoresForm _proveedoresForm;
    private IContainer components;
    private GroupBox groupBox;
    private DateTimePicker dtpHasta;
    private DateTimePicker dtpDesde;
    private Label label4;
    private Label label3;
    private Button btnFiltrar;
    private DataGridView dataGridView;
    private Button btnGenerarFactura;
    private Panel searchPanel;
    private Panel panel1;
    private Button btnBuscarProveedor;
    private TextBox txtProveedor;
    private Label label1;
    private DataGridViewTextBoxColumn Fecha;
    private DataGridViewTextBoxColumn Descripcion;
    private DataGridViewTextBoxColumn Codigo;
    private DataGridViewTextBoxColumn Precio;
    private Label lblResults;
    private Label label5;

    public FacturaProveedorForm()
    {
      this.InitializeComponent();
      this.dataGridView.AutoGenerateColumns = false;
      this.dtpDesde.Value = DateTime.Now.Subtract(TimeSpan.FromDays(180.0));
      this.dtpHasta.Value = DateTime.Now;
    }

    private void btnBuscarProveedor_Click(object sender, EventArgs e)
    {
      if (this._proveedoresForm == null)
      {
        this._proveedoresForm = new ProveedoresForm();
        this._proveedoresForm.SetSearchMode();
        this._proveedoresForm.OnUserSelected += new EventHandler<UserSelectedEventArgs>(this._proveedoresForm_OnUserSelected);
      }
      ViewsManager.LoadModal((Form) this._proveedoresForm);
    }

    private void _proveedoresForm_OnUserSelected(object sender, UserSelectedEventArgs e)
    {
      this._proveedor = e.User as Proveedor;
      this._proveedoresForm.Hide();
      this.txtProveedor.Text = this._proveedor.UserName;
    }

    private void btnFiltrar_Click(object sender, EventArgs e)
    {
      if (this._proveedor == null)
      {
        int num1 = (int) MessageBox.Show("Debe seleccionar un proveedor para poder ver los consumos");
      }
      else if (this.dtpDesde.Value > this.dtpHasta.Value)
      {
        int num2 = (int) MessageBox.Show("La fecha desde debe ser menor o igual que la fecha hasta");
      }
      else
      {
        this.dataGridView.DataSource = (object) new CompraCuponManager().GetParaFacturar(this._proveedor, this.dtpDesde.Value, this.dtpHasta.Value);
        this.dataGridView.Refresh();
      }
    }

    private void btnGenerarFactura_Click(object sender, EventArgs e)
    {
      if (this._proveedor == null)
      {
        int num1 = (int) MessageBox.Show("Debe seleccionar un proveedor para poder generar una factura");
      }
      else if (this.dtpDesde.Value > this.dtpHasta.Value)
      {
        int num2 = (int) MessageBox.Show("La fecha desde debe ser menor o igual que la fecha hasta");
      }
      else
      {
        BindingList<CompraCupon> dataSource = (BindingList<CompraCupon>) this.dataGridView.DataSource;
        if (dataSource == null || dataSource.Count == 0)
        {
          int num3 = (int) MessageBox.Show("No hay cupones consumidos para poder generar una factura");
        }
        else
        {
          double num4 = dataSource.Sum<CompraCupon>((Func<CompraCupon, double>) (x => x.Precio));
          if (MessageBox.Show(string.Format("Confirma emitir la factura para el proveedor '{0}' por ${1}?", (object) this._proveedor.UserName, (object) num4)) != DialogResult.OK)
            return;
          int num5 = (int) MessageBox.Show(string.Format("Se ha generado la factura Nro. {1} para el proveedor '{0}' por ${2}", (object) this._proveedor.UserName, (object) new FacturaManager().GenerarFactura(this._proveedor, dataSource, DateTime.Now), (object) num4));
          this.dataGridView.DataSource = (object) null;
          this.dataGridView.Refresh();
        }
      }
    }

    private void FacturaProveedorForm_Load(object sender, EventArgs e) => this.dataGridView.DataSourceChanged += new EventHandler(this.dataGridView_DataSourceChanged);

    private void dataGridView_DataSourceChanged(object sender, EventArgs e) => this.lblResults.Text = (this.dataGridView.DataSource as IList).Count.ToString();

    protected override void Dispose(bool disposing)
    {
      if (disposing && this.components != null)
        this.components.Dispose();
      base.Dispose(disposing);
    }

    private void InitializeComponent()
    {
      this.groupBox = new GroupBox();
      this.btnBuscarProveedor = new Button();
      this.btnFiltrar = new Button();
      this.txtProveedor = new TextBox();
      this.label1 = new Label();
      this.dtpHasta = new DateTimePicker();
      this.dtpDesde = new DateTimePicker();
      this.label4 = new Label();
      this.label3 = new Label();
      this.dataGridView = new DataGridView();
      this.Fecha = new DataGridViewTextBoxColumn();
      this.Descripcion = new DataGridViewTextBoxColumn();
      this.Codigo = new DataGridViewTextBoxColumn();
      this.Precio = new DataGridViewTextBoxColumn();
      this.btnGenerarFactura = new Button();
      this.searchPanel = new Panel();
      this.panel1 = new Panel();
      this.lblResults = new Label();
      this.label5 = new Label();
      this.groupBox.SuspendLayout();
      ((ISupportInitialize) this.dataGridView).BeginInit();
      this.searchPanel.SuspendLayout();
      this.panel1.SuspendLayout();
      this.SuspendLayout();
      this.groupBox.Anchor = AnchorStyles.Top | AnchorStyles.Left | AnchorStyles.Right;
      this.groupBox.Controls.Add((Control) this.btnBuscarProveedor);
      this.groupBox.Controls.Add((Control) this.btnFiltrar);
      this.groupBox.Controls.Add((Control) this.txtProveedor);
      this.groupBox.Controls.Add((Control) this.label1);
      this.groupBox.Controls.Add((Control) this.dtpHasta);
      this.groupBox.Controls.Add((Control) this.dtpDesde);
      this.groupBox.Controls.Add((Control) this.label4);
      this.groupBox.Controls.Add((Control) this.label3);
      this.groupBox.Location = new Point(12, 6);
      this.groupBox.Name = "groupBox";
      this.groupBox.Size = new Size(939, 103);
      this.groupBox.TabIndex = 2;
      this.groupBox.TabStop = false;
      this.groupBox.Text = "Filtro";
      this.btnBuscarProveedor.Location = new Point(200, 18);
      this.btnBuscarProveedor.Name = "btnBuscarProveedor";
      this.btnBuscarProveedor.Size = new Size(75, 23);
      this.btnBuscarProveedor.TabIndex = 12;
      this.btnBuscarProveedor.Text = "Buscar";
      this.btnBuscarProveedor.UseVisualStyleBackColor = true;
      this.btnBuscarProveedor.Click += new EventHandler(this.btnBuscarProveedor_Click);
      this.btnFiltrar.Location = new Point(200, 68);
      this.btnFiltrar.Name = "btnFiltrar";
      this.btnFiltrar.Size = new Size(75, 23);
      this.btnFiltrar.TabIndex = 0;
      this.btnFiltrar.Text = "Filtrar";
      this.btnFiltrar.UseVisualStyleBackColor = true;
      this.btnFiltrar.Click += new EventHandler(this.btnFiltrar_Click);
      this.txtProveedor.Location = new Point(93, 19);
      this.txtProveedor.Name = "txtProveedor";
      this.txtProveedor.ReadOnly = true;
      this.txtProveedor.Size = new Size(100, 20);
      this.txtProveedor.TabIndex = 11;
      this.label1.AutoSize = true;
      this.label1.Location = new Point(31, 22);
      this.label1.Name = "label1";
      this.label1.Size = new Size(56, 13);
      this.label1.TabIndex = 10;
      this.label1.Text = "Proveedor";
      this.dtpHasta.Format = DateTimePickerFormat.Short;
      this.dtpHasta.Location = new Point(93, 70);
      this.dtpHasta.Name = "dtpHasta";
      this.dtpHasta.Size = new Size(100, 20);
      this.dtpHasta.TabIndex = 9;
      this.dtpDesde.Format = DateTimePickerFormat.Short;
      this.dtpDesde.Location = new Point(93, 44);
      this.dtpDesde.Name = "dtpDesde";
      this.dtpDesde.Size = new Size(100, 20);
      this.dtpDesde.TabIndex = 8;
      this.label4.AutoSize = true;
      this.label4.Location = new Point(19, 73);
      this.label4.Name = "label4";
      this.label4.Size = new Size(68, 13);
      this.label4.TabIndex = 7;
      this.label4.Text = "Fecha Hasta";
      this.label3.AutoSize = true;
      this.label3.Location = new Point(16, 47);
      this.label3.Name = "label3";
      this.label3.Size = new Size(71, 13);
      this.label3.TabIndex = 6;
      this.label3.Text = "Fecha Desde";
      this.dataGridView.AllowUserToAddRows = false;
      this.dataGridView.AllowUserToDeleteRows = false;
      this.dataGridView.AllowUserToOrderColumns = true;
      this.dataGridView.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.Fill;
      this.dataGridView.ColumnHeadersHeightSizeMode = DataGridViewColumnHeadersHeightSizeMode.AutoSize;
      this.dataGridView.Columns.AddRange((DataGridViewColumn) this.Fecha, (DataGridViewColumn) this.Descripcion, (DataGridViewColumn) this.Codigo, (DataGridViewColumn) this.Precio);
      this.dataGridView.Dock = DockStyle.Fill;
      this.dataGridView.Location = new Point(0, 154);
      this.dataGridView.MultiSelect = false;
      this.dataGridView.Name = "dataGridView";
      this.dataGridView.SelectionMode = DataGridViewSelectionMode.FullRowSelect;
      this.dataGridView.Size = new Size(963, 347);
      this.dataGridView.TabIndex = 9;
      this.Fecha.DataPropertyName = "Fecha";
      this.Fecha.HeaderText = "Fecha";
      this.Fecha.Name = "Fecha";
      this.Fecha.ReadOnly = true;
      this.Descripcion.DataPropertyName = "Descripcion";
      this.Descripcion.HeaderText = "Descripción";
      this.Descripcion.Name = "Descripcion";
      this.Descripcion.ReadOnly = true;
      this.Codigo.DataPropertyName = "Codigo";
      this.Codigo.HeaderText = "Código";
      this.Codigo.Name = "Codigo";
      this.Codigo.ReadOnly = true;
      this.Precio.DataPropertyName = "Precio";
      this.Precio.HeaderText = "Precio";
      this.Precio.Name = "Precio";
      this.Precio.ReadOnly = true;
      this.btnGenerarFactura.Location = new Point(12, 10);
      this.btnGenerarFactura.Name = "btnGenerarFactura";
      this.btnGenerarFactura.Size = new Size(106, 23);
      this.btnGenerarFactura.TabIndex = 0;
      this.btnGenerarFactura.Text = "Generar Factura";
      this.btnGenerarFactura.UseVisualStyleBackColor = true;
      this.btnGenerarFactura.Click += new EventHandler(this.btnGenerarFactura_Click);
      this.searchPanel.Controls.Add((Control) this.groupBox);
      this.searchPanel.Dock = DockStyle.Top;
      this.searchPanel.Location = new Point(0, 39);
      this.searchPanel.Name = "searchPanel";
      this.searchPanel.Size = new Size(963, 115);
      this.searchPanel.TabIndex = 11;
      this.panel1.BackColor = SystemColors.ControlDark;
      this.panel1.Controls.Add((Control) this.lblResults);
      this.panel1.Controls.Add((Control) this.btnGenerarFactura);
      this.panel1.Controls.Add((Control) this.label5);
      this.panel1.Dock = DockStyle.Top;
      this.panel1.Location = new Point(0, 0);
      this.panel1.Name = "panel1";
      this.panel1.Size = new Size(963, 39);
      this.panel1.TabIndex = 10;
      this.lblResults.Anchor = AnchorStyles.Top | AnchorStyles.Right;
      this.lblResults.AutoSize = true;
      this.lblResults.Font = new Font("Microsoft Sans Serif", 8.25f, FontStyle.Bold, GraphicsUnit.Point, (byte) 0);
      this.lblResults.ForeColor = SystemColors.ControlLightLight;
      this.lblResults.Location = new Point(866, 15);
      this.lblResults.Name = "lblResults";
      this.lblResults.Size = new Size(14, 13);
      this.lblResults.TabIndex = 21;
      this.lblResults.Text = "0";
      this.label5.Anchor = AnchorStyles.Top | AnchorStyles.Right;
      this.label5.AutoSize = true;
      this.label5.Font = new Font("Microsoft Sans Serif", 8.25f, FontStyle.Bold, GraphicsUnit.Point, (byte) 0);
      this.label5.ForeColor = SystemColors.ControlLightLight;
      this.label5.Location = new Point(886, 15);
      this.label5.Name = "label5";
      this.label5.Size = new Size(65, 13);
      this.label5.TabIndex = 20;
      this.label5.Text = "resultados";
      this.AutoScaleDimensions = new SizeF(6f, 13f);
      this.AutoScaleMode = AutoScaleMode.Font;
      this.ClientSize = new Size(963, 501);
      this.Controls.Add((Control) this.dataGridView);
      this.Controls.Add((Control) this.searchPanel);
      this.Controls.Add((Control) this.panel1);
      this.Name = nameof (FacturaProveedorForm);
      this.Text = "Facturas";
      this.Load += new EventHandler(this.FacturaProveedorForm_Load);
      this.groupBox.ResumeLayout(false);
      this.groupBox.PerformLayout();
      ((ISupportInitialize) this.dataGridView).EndInit();
      this.searchPanel.ResumeLayout(false);
      this.panel1.ResumeLayout(false);
      this.panel1.PerformLayout();
      this.ResumeLayout(false);
    }
  }
}
