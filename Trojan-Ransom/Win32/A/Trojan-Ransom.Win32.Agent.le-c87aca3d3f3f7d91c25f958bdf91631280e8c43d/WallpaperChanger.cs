// Decompiled with JetBrains decompiler
// Type: setup.WallpaperChanger
// Assembly: setup, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 6FA179CD-C6DD-49E1-8167-579BB94FEB58
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00060-msil\Trojan-Ransom.Win32.Agent.le-c87aca3d3f3f7d91c25f958bdf91631280e8c43d.exe

using Microsoft.Win32;
using System.Runtime.InteropServices;

namespace setup
{
  internal class WallpaperChanger
  {
    private const int SPI_SETDESKWALLPAPER = 20;
    private const int SPIF_UPDATEINIFILE = 1;
    private const int SPIF_SENDWININICHANGE = 2;

    [DllImport("user32")]
    private static extern int SystemParametersInfo(
      int uAction,
      int uParam,
      [MarshalAs(UnmanagedType.LPStr)] string lpvParam,
      int fuWinIni);

    public static void SetWallpaper(string bitmapFile, WallpaperLocation style)
    {
      RegistryKey registryKey = Registry.CurrentUser.OpenSubKey("Control Panel\\Desktop", true);
      if (registryKey != null)
      {
        if (style == WallpaperLocation.Stretch)
        {
          registryKey.SetValue("TileWallpaper", (object) 0.ToString());
          registryKey.SetValue("Wallpaperstyle", (object) 2.ToString());
        }
        else
        {
          registryKey.SetValue("TileWallpaper", (object) style.ToString());
          registryKey.SetValue("Wallpaperstyle", (object) 0.ToString());
        }
        registryKey.Close();
      }
      WallpaperChanger.SystemParametersInfo(20, 0, bitmapFile, 3);
    }

    public static void RemoveWallpaper() => WallpaperChanger.SystemParametersInfo(20, 0, "\0", 3);
  }
}
