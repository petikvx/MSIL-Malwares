// Decompiled with JetBrains decompiler
// Type: Coache.HistorialCupones.HistorialCuponesForm
// Assembly: IsCopyConstruc, Version=5.6.2.1, Culture=neutral, PublicKeyToken=null
// MVID: 1DA50973-FF9A-4563-8B8F-74E2573677DF
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.02-msil\HEUR-Trojan-Ransom.MSIL.Blocker.gen-136935297fa08738f6957068951067c699c91b2902f3ea14da650289cabfd29d.exe

using Coache.Business;
using Coache.Common;
using Coache.Core;
using Coache.PedirDevolucion;
using System;
using System.Collections;
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.Drawing;
using System.Windows.Forms;

namespace Coache.HistorialCupones
{
  [PermissionRequired(new Functionalities[] {Functionalities.VerHistorialCupones})]
  public class HistorialCuponesForm : Form
  {
    private CompraCuponManager _manager = new CompraCuponManager();
    private IContainer components;
    private DataGridView dataGridView;
    private Button btnPedirDevolucion;
    private Panel panel1;
    private DataGridViewTextBoxColumn Fecha;
    private DataGridViewTextBoxColumn Descripcion;
    private DataGridViewTextBoxColumn Codigo;
    private DataGridViewTextBoxColumn Precio;
    private DataGridViewTextBoxColumn Estado;
    private Panel searchPanel;
    private Button btnFiltrar;
    private GroupBox groupBox;
    private Label label4;
    private Label label3;
    private Button btnRestablecer;
    private DateTimePicker dtpHasta;
    private DateTimePicker dtpDesde;
    private Label lblResults;
    private Label label5;

    public HistorialCuponesForm() => this.InitializeComponent();

    private void HistorialCuponesForm_Load(object sender, EventArgs e)
    {
      this.dtpDesde.Value = DateTime.Now.Subtract(TimeSpan.FromDays(7.0));
      this.dtpHasta.Value = DateTime.Now;
      this.dataGridView.DataSourceChanged += new EventHandler(this.dataGridView_DataSourceChanged);
      this.dataGridView.AutoGenerateColumns = false;
      this.GetList();
    }

    private void dataGridView_DataSourceChanged(object sender, EventArgs e) => this.lblResults.Text = (this.dataGridView.DataSource as IList).Count.ToString();

    private void btnRestablecer_Click(object sender, EventArgs e) => this.GetList();

    private void GetList()
    {
      DataGridView dataGridView = this.dataGridView;
      CompraCuponManager manager = this._manager;
      Cliente cliente = new Cliente();
      cliente.UserID = Session.User.UserID;
      DateTime dateTime = Convert.ToDateTime("2000-01-01");
      DateTime now = DateTime.Now;
      BindingList<CompraCupon> all = manager.GetAll(cliente, dateTime, now);
      dataGridView.DataSource = (object) all;
      this.dataGridView.Refresh();
    }

    private void btnFiltrar_Click(object sender, EventArgs e)
    {
      if (this.dtpDesde.Value > this.dtpHasta.Value)
      {
        int num = (int) MessageBox.Show("La fecha desde debe ser menor o igual que la fecha hasta");
      }
      else
      {
        DataGridView dataGridView = this.dataGridView;
        CompraCuponManager manager = this._manager;
        Cliente cliente = new Cliente();
        cliente.UserID = Session.User.UserID;
        DateTime fechaDesde = this.dtpDesde.Value;
        DateTime fechaHasta = this.dtpHasta.Value;
        BindingList<CompraCupon> all = manager.GetAll(cliente, fechaDesde, fechaHasta);
        dataGridView.DataSource = (object) all;
        this.dataGridView.Refresh();
      }
    }

    private void btnPedirDevolucion_Click(object sender, EventArgs e)
    {
      if (this.dataGridView.SelectedRows == null || this.dataGridView.SelectedRows.Count == 0)
        return;
      CompraCupon dataBoundItem = this.dataGridView.SelectedRows[0].DataBoundItem as CompraCupon;
      if (dataBoundItem.Estado == "Consumido")
      {
        int num1 = (int) MessageBox.Show("No se puede devolver una compra ya consumida");
      }
      else if (dataBoundItem.Estado == "Devuelto")
      {
        int num2 = (int) MessageBox.Show("No se puede devolver una compra ya devuelta");
      }
      else
      {
        DateTime fechaVencimiento = dataBoundItem.FechaVencimiento;
        int year = fechaVencimiento.Year;
        fechaVencimiento = dataBoundItem.FechaVencimiento;
        int month = fechaVencimiento.Month;
        fechaVencimiento = dataBoundItem.FechaVencimiento;
        int day = fechaVencimiento.Day;
        if (new DateTime(year, month, day, 23, 59, 59) < DateTime.Now)
        {
          int num3 = (int) MessageBox.Show("La fecha límite de devolución de la compra ha expirado");
        }
        else
        {
          PedirDevolucionForm pedirDevolucionForm = new PedirDevolucionForm(dataBoundItem);
          pedirDevolucionForm.OnCuponDevuelto += new EventHandler<CuponDevueltoEventArgs>(this.frm_OnCuponDevuelto);
          ViewsManager.LoadModal((Form) pedirDevolucionForm);
        }
      }
    }

    private void frm_OnCuponDevuelto(object sender, CuponDevueltoEventArgs e)
    {
      CompraCupon compraCupon1 = e.CompraCupon;
      CompraCuponManager manager = this._manager;
      Cliente cliente = new Cliente();
      cliente.UserID = Session.User.UserID;
      CompraCupon compraCupon2 = compraCupon1;
      string mensaje = e.Mensaje;
      manager.DevolverCompra(cliente, compraCupon2, mensaje);
      int index = ((Collection<CompraCupon>) this.dataGridView.DataSource).IndexOf(compraCupon1);
      compraCupon1.Estado = "Devuelto";
      ((Collection<CompraCupon>) this.dataGridView.DataSource)[index] = compraCupon1;
      this.dataGridView.Refresh();
      ((Form) sender).Close();
      int num = (int) MessageBox.Show("Se ha devuelto la compra");
    }

    protected override void Dispose(bool disposing)
    {
      if (disposing && this.components != null)
        this.components.Dispose();
      base.Dispose(disposing);
    }

    private void InitializeComponent()
    {
      this.dataGridView = new DataGridView();
      this.Fecha = new DataGridViewTextBoxColumn();
      this.Descripcion = new DataGridViewTextBoxColumn();
      this.Codigo = new DataGridViewTextBoxColumn();
      this.Precio = new DataGridViewTextBoxColumn();
      this.Estado = new DataGridViewTextBoxColumn();
      this.btnPedirDevolucion = new Button();
      this.panel1 = new Panel();
      this.searchPanel = new Panel();
      this.groupBox = new GroupBox();
      this.btnRestablecer = new Button();
      this.dtpHasta = new DateTimePicker();
      this.dtpDesde = new DateTimePicker();
      this.label4 = new Label();
      this.btnFiltrar = new Button();
      this.label3 = new Label();
      this.lblResults = new Label();
      this.label5 = new Label();
      ((ISupportInitialize) this.dataGridView).BeginInit();
      this.panel1.SuspendLayout();
      this.searchPanel.SuspendLayout();
      this.groupBox.SuspendLayout();
      this.SuspendLayout();
      this.dataGridView.AllowUserToAddRows = false;
      this.dataGridView.AllowUserToDeleteRows = false;
      this.dataGridView.AllowUserToOrderColumns = true;
      this.dataGridView.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.Fill;
      this.dataGridView.ColumnHeadersHeightSizeMode = DataGridViewColumnHeadersHeightSizeMode.AutoSize;
      this.dataGridView.Columns.AddRange((DataGridViewColumn) this.Fecha, (DataGridViewColumn) this.Descripcion, (DataGridViewColumn) this.Codigo, (DataGridViewColumn) this.Precio, (DataGridViewColumn) this.Estado);
      this.dataGridView.Dock = DockStyle.Fill;
      this.dataGridView.Location = new Point(0, 132);
      this.dataGridView.MultiSelect = false;
      this.dataGridView.Name = "dataGridView";
      this.dataGridView.SelectionMode = DataGridViewSelectionMode.FullRowSelect;
      this.dataGridView.Size = new Size(1018, 384);
      this.dataGridView.TabIndex = 6;
      this.Fecha.DataPropertyName = "Fecha";
      this.Fecha.HeaderText = "Fecha";
      this.Fecha.Name = "Fecha";
      this.Fecha.ReadOnly = true;
      this.Descripcion.DataPropertyName = "Descripcion";
      this.Descripcion.HeaderText = "Descripción";
      this.Descripcion.Name = "Descripcion";
      this.Descripcion.ReadOnly = true;
      this.Codigo.DataPropertyName = "Codigo";
      this.Codigo.HeaderText = "Código";
      this.Codigo.Name = "Codigo";
      this.Codigo.ReadOnly = true;
      this.Precio.DataPropertyName = "Precio";
      this.Precio.HeaderText = "Precio";
      this.Precio.Name = "Precio";
      this.Precio.ReadOnly = true;
      this.Estado.DataPropertyName = "Estado";
      this.Estado.HeaderText = "Estado";
      this.Estado.Name = "Estado";
      this.Estado.ReadOnly = true;
      this.btnPedirDevolucion.Location = new Point(12, 10);
      this.btnPedirDevolucion.Name = "btnPedirDevolucion";
      this.btnPedirDevolucion.Size = new Size(106, 23);
      this.btnPedirDevolucion.TabIndex = 0;
      this.btnPedirDevolucion.Text = "Pedir Devolución";
      this.btnPedirDevolucion.UseVisualStyleBackColor = true;
      this.btnPedirDevolucion.Click += new EventHandler(this.btnPedirDevolucion_Click);
      this.panel1.BackColor = SystemColors.ControlDark;
      this.panel1.Controls.Add((Control) this.lblResults);
      this.panel1.Controls.Add((Control) this.btnPedirDevolucion);
      this.panel1.Controls.Add((Control) this.label5);
      this.panel1.Dock = DockStyle.Top;
      this.panel1.Location = new Point(0, 0);
      this.panel1.Name = "panel1";
      this.panel1.Size = new Size(1018, 39);
      this.panel1.TabIndex = 7;
      this.searchPanel.Controls.Add((Control) this.groupBox);
      this.searchPanel.Dock = DockStyle.Top;
      this.searchPanel.Location = new Point(0, 39);
      this.searchPanel.Name = "searchPanel";
      this.searchPanel.Size = new Size(1018, 93);
      this.searchPanel.TabIndex = 8;
      this.groupBox.Anchor = AnchorStyles.Top | AnchorStyles.Left | AnchorStyles.Right;
      this.groupBox.Controls.Add((Control) this.btnRestablecer);
      this.groupBox.Controls.Add((Control) this.dtpHasta);
      this.groupBox.Controls.Add((Control) this.dtpDesde);
      this.groupBox.Controls.Add((Control) this.label4);
      this.groupBox.Controls.Add((Control) this.btnFiltrar);
      this.groupBox.Controls.Add((Control) this.label3);
      this.groupBox.Location = new Point(12, 6);
      this.groupBox.Name = "groupBox";
      this.groupBox.Size = new Size(994, 76);
      this.groupBox.TabIndex = 2;
      this.groupBox.TabStop = false;
      this.groupBox.Text = "Filtro";
      this.btnRestablecer.Location = new Point(282, 43);
      this.btnRestablecer.Name = "btnRestablecer";
      this.btnRestablecer.Size = new Size(75, 23);
      this.btnRestablecer.TabIndex = 1;
      this.btnRestablecer.Text = "Restablecer";
      this.btnRestablecer.UseVisualStyleBackColor = true;
      this.btnRestablecer.Click += new EventHandler(this.btnRestablecer_Click);
      this.dtpHasta.Format = DateTimePickerFormat.Short;
      this.dtpHasta.Location = new Point(95, 45);
      this.dtpHasta.Name = "dtpHasta";
      this.dtpHasta.Size = new Size(100, 20);
      this.dtpHasta.TabIndex = 9;
      this.dtpDesde.Format = DateTimePickerFormat.Short;
      this.dtpDesde.Location = new Point(95, 19);
      this.dtpDesde.Name = "dtpDesde";
      this.dtpDesde.Size = new Size(100, 20);
      this.dtpDesde.TabIndex = 8;
      this.label4.AutoSize = true;
      this.label4.Location = new Point(21, 48);
      this.label4.Name = "label4";
      this.label4.Size = new Size(68, 13);
      this.label4.TabIndex = 7;
      this.label4.Text = "Fecha Hasta";
      this.btnFiltrar.Location = new Point(201, 43);
      this.btnFiltrar.Name = "btnFiltrar";
      this.btnFiltrar.Size = new Size(75, 23);
      this.btnFiltrar.TabIndex = 0;
      this.btnFiltrar.Text = "Filtrar";
      this.btnFiltrar.UseVisualStyleBackColor = true;
      this.btnFiltrar.Click += new EventHandler(this.btnFiltrar_Click);
      this.label3.AutoSize = true;
      this.label3.Location = new Point(18, 22);
      this.label3.Name = "label3";
      this.label3.Size = new Size(71, 13);
      this.label3.TabIndex = 6;
      this.label3.Text = "Fecha Desde";
      this.lblResults.Anchor = AnchorStyles.Top | AnchorStyles.Right;
      this.lblResults.AutoSize = true;
      this.lblResults.Font = new Font("Microsoft Sans Serif", 8.25f, FontStyle.Bold, GraphicsUnit.Point, (byte) 0);
      this.lblResults.ForeColor = SystemColors.ControlLightLight;
      this.lblResults.Location = new Point(921, 15);
      this.lblResults.Name = "lblResults";
      this.lblResults.Size = new Size(14, 13);
      this.lblResults.TabIndex = 23;
      this.lblResults.Text = "0";
      this.label5.Anchor = AnchorStyles.Top | AnchorStyles.Right;
      this.label5.AutoSize = true;
      this.label5.Font = new Font("Microsoft Sans Serif", 8.25f, FontStyle.Bold, GraphicsUnit.Point, (byte) 0);
      this.label5.ForeColor = SystemColors.ControlLightLight;
      this.label5.Location = new Point(941, 15);
      this.label5.Name = "label5";
      this.label5.Size = new Size(65, 13);
      this.label5.TabIndex = 22;
      this.label5.Text = "resultados";
      this.AutoScaleDimensions = new SizeF(6f, 13f);
      this.AutoScaleMode = AutoScaleMode.Font;
      this.ClientSize = new Size(1018, 516);
      this.Controls.Add((Control) this.dataGridView);
      this.Controls.Add((Control) this.searchPanel);
      this.Controls.Add((Control) this.panel1);
      this.Name = nameof (HistorialCuponesForm);
      this.Text = "Historial de Cupones";
      this.Load += new EventHandler(this.HistorialCuponesForm_Load);
      ((ISupportInitialize) this.dataGridView).EndInit();
      this.panel1.ResumeLayout(false);
      this.panel1.PerformLayout();
      this.searchPanel.ResumeLayout(false);
      this.groupBox.ResumeLayout(false);
      this.groupBox.PerformLayout();
      this.ResumeLayout(false);
    }
  }
}
