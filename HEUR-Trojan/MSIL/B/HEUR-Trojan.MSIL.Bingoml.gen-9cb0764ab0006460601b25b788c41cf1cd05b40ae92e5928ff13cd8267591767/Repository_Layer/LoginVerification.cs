// Decompiled with JetBrains decompiler
// Type: HospitalMgmtSys.Repository_Layer.LoginVerification
// Assembly: HospitalMgmtSys, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: DCB6B3B1-E0A6-4826-8B58-606618F1AB2B
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.MSIL.Bingoml.gen-9cb0764ab0006460601b25b788c41cf1cd05b40ae92e5928ff13cd8267591767.exe

using HospitalMgmtSys.Data_Layer;
using System;
using System.Data;
using System.Windows.Forms;

namespace HospitalMgmtSys.Repository_Layer
{
  internal class LoginVerification
  {
    public static bool VerifyLogin(string username, string password)
    {
      try
      {
        DataSet dataSet = DataAccess.GetDataSet("select * from login where username = '" + username + "' and password = '" + password + "'");
        if (dataSet.Tables[0].Rows.Count == 1)
        {
          int num = (int) MessageBox.Show("Verification Successful");
          UserLoginInfo.Username = dataSet.Tables[0].Rows[0][nameof (username)].ToString();
          UserLoginInfo.Password = dataSet.Tables[0].Rows[0][nameof (password)].ToString();
          UserLoginInfo.Designation = dataSet.Tables[0].Rows[0]["designation"].ToString();
          UserLoginInfo.EmployeeID = Convert.ToInt32(dataSet.Tables[0].Rows[0]["empid"].ToString());
          UserLoginInfo.PersonID = Convert.ToInt32(DataAccess.GetDataSet("select * from person, employee where employee.empid = '" + (object) UserLoginInfo.EmployeeID + "' and employee.personid = person.personid").Tables[0].Rows[0]["personid"].ToString());
          return true;
        }
        int num1 = (int) MessageBox.Show("Invalid Credentials");
        return false;
      }
      catch (Exception ex)
      {
        int num = (int) MessageBox.Show(ex.Message);
        return false;
      }
    }

    public static bool UpdatePassword(string username, string oldPassword, string newPassword) => DataAccess.ExecuteQuery("update login\n                            set password = '" + newPassword + "'\n                            where username = '" + username + "' and password = '" + oldPassword + "';") == 1;

    public static int CreateLogin(string username, string password, string designation, int empId) => DataAccess.ExecuteQuery("insert into login values('" + username + "', '" + password + "', '" + designation + "', '" + (object) empId + "') ");

    public static int DeleteLoginInfo(int empID) => DataAccess.ExecuteQuery(string.Format("DELETE FROM login WHERE empid = '" + (object) empID + "'; "));

    public static bool CheckIfLoginCredAvailableForEmp(int empID) => DataAccess.RowExists("select * from login where empid = '" + (object) empID + "' ");
  }
}
