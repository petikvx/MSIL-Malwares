// Decompiled with JetBrains decompiler
// Type: ProtoBuf.BufferExtension
// Assembly: Stubv2.0, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: E945C042-2241-44AF-B826-4AD3FC72B170
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.03-msil\HEUR-Trojan-Spy.MSIL.Quasar.gen-a3f98ee0a78f039e0a9ea52dba13c713dc46f749512bd7d108cc9c05f57fc93d.exe

using System.IO;

namespace ProtoBuf
{
  public sealed class BufferExtension : IExtension
  {
    private byte[] buffer;

    int IExtension.GetLength() => this.buffer != null ? this.buffer.Length : 0;

    Stream IExtension.BeginAppend() => (Stream) new MemoryStream();

    void IExtension.EndAppend(Stream stream, bool commit)
    {
      using (stream)
      {
        int length1;
        if (!commit || (length1 = (int) stream.Length) <= 0)
          return;
        using (MemoryStream memoryStream = (MemoryStream) stream)
        {
          if (this.buffer == null)
          {
            this.buffer = memoryStream.ToArray();
          }
          else
          {
            int length2 = this.buffer.Length;
            byte[] to = new byte[length2 + length1];
            Helpers.BlockCopy(this.buffer, 0, to, 0, length2);
            Helpers.BlockCopy(memoryStream.GetBuffer(), 0, to, length2, length1);
            this.buffer = to;
          }
        }
      }
    }

    Stream IExtension.BeginQuery() => this.buffer != null ? (Stream) new MemoryStream(this.buffer) : Stream.Null;

    void IExtension.EndQuery(Stream stream) => stream?.Dispose();
  }
}
