// Decompiled with JetBrains decompiler
// Type: 364073242711.615347801101
// Assembly: 942981470147, Version=16.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
// MVID: 92EB186D-EC33-4501-B5FF-A65C9233BC32
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.04\HEUR-Exploit.MSIL.Shellcode.gen-f8bb0d6e016074f6759f74d8950983793a87aec3cd6d56569fa8809d5c55396a.exe

using \u003024006040525;
using \u003125899370856;
using \u003364073242711;
using \u003422039697287;
using \u003432388962105;
using \u003491295387409;
using \u003703682515837;
using \u003785947670411;
using \u003879061372040;
using Microsoft.PythonTools;
using Microsoft.PythonTools.Infrastructure;
using Microsoft.VisualStudio.TestPlatform.ObjectModel;
using Microsoft.VisualStudio.TestPlatform.ObjectModel.Adapter;
using Microsoft.VisualStudio.TestPlatform.ObjectModel.Logging;
using Newtonsoft.Json;
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.Linq;
using System.Reflection;

namespace \u003364073242711
{
  [FileExtension(".py")]
  [DefaultExecutorUri("executor://PythonUnitTestExecutor/v1")]
  public class \u003615347801101 : \u003014501432884
  {
    private IMessageLogger \u003788647113548;
    private static readonly string \u003183238499182 = PythonToolsInstallPath.GetFile("PythonFiles\\testing_tools\\run_adapter.py", (Assembly) null);

    public \u003615347801101()
      : base(\u003196266377257.UnitTest)
    {
    }

    public virtual void \u003535537631267(
      IEnumerable<string> _param1,
      \u003064588995134 _param2,
      IMessageLogger _param3,
      ITestCaseDiscoverySink _param4)
    {
      if (_param1 == null)
        throw new ArgumentNullException("sources");
      if (_param4 == null)
        throw new ArgumentNullException("discoverySink");
      this.\u003788647113548 = _param3 ?? throw new ArgumentNullException("logger");
      string str1 = _param2.\u003469965681879 ? Strings.WorkspaceText : Strings.ProjectText;
      this.\u003235206523595(StringExtensions.FormatUI(Strings.PythonTestDiscovererStartedMessage, new object[4]
      {
        (object) "unittest",
        (object) _param2.\u003123732749265,
        (object) str1,
        (object) _param2.\u003330083167913
      }));
      Dictionary<string, string> dictionary = this.\u003410564882083(_param1, _param2);
      string tempFileName = Path.GetTempFileName();
      string[] strArray = this.\u003404488133706(_param1, _param2, tempFileName);
      this.\u003235206523595("cd " + _param2.\u003106365127459);
      this.\u003235206523595("set " + _param2.\u003433255215837 + "=" + dictionary[_param2.\u003433255215837]);
      this.\u003235206523595(_param2.\u003383078423503 + " " + string.Join(" ", strArray));
      try
      {
        string str2 = \u003636458639326.\u003276332148891(_param2.\u003383078423503, dictionary, (IEnumerable<string>) strArray, _param2.\u003106365127459, _param2.\u003433255215837, _param2.\u003330083167913);
        if (!string.IsNullOrEmpty(str2))
          this.\u003105033564539(str2);
      }
      catch (TimeoutException ex)
      {
        this.\u003105033564539(Strings.PythonTestDiscovererTimeoutErrorMessage);
        return;
      }
      if (!File.Exists(tempFileName))
      {
        this.\u003105033564539(StringExtensions.FormatUI(Strings.PythonDiscoveryResultsNotFound, (object) tempFileName));
      }
      else
      {
        string str3 = File.ReadAllText(tempFileName);
        if (string.IsNullOrEmpty(str3))
          return;
        try
        {
          foreach (TestCase testCase in this.\u003791514180825((IList<\u003914934610860>) JsonConvert.DeserializeObject<List<\u003914934610860>>(str3), _param2.\u003634011796970))
          {
            if (_param2.\u003552596574495.TryGetValue(testCase.CodeFilePath, out string _))
              _param4.SendTestCase(testCase);
          }
        }
        catch (InvalidOperationException ex)
        {
          this.\u003105033564539(StringExtensions.FormatInvariant("Failed to parse: {0}", (object) ex.Message));
          this.\u003105033564539(str3);
        }
        catch (JsonException ex)
        {
          this.\u003105033564539(StringExtensions.FormatInvariant("Failed to parse: {0}", (object) ((Exception) ex).Message));
          this.\u003105033564539(str3);
        }
      }
    }

    internal IEnumerable<TestCase> \u003791514180825(
      IList<\u003914934610860> _param1_1,
      string _param2)
    {
      // ISSUE: object of a compiler-generated type is created
      // ISSUE: variable of a compiler-generated type
      \u003615347801101.\u003362313432840 obj = (\u003615347801101.\u003362313432840) new \u003302295231489.\u003363935585114();
      // ISSUE: reference to a compiler-generated field
      ((\u003302295231489.\u003363935585114) obj).\u003213274793767 = this;
      // ISSUE: reference to a compiler-generated field
      obj.\u003632992426880 = _param2;
      if (_param1_1 == null)
        throw new ArgumentNullException("results");
      // ISSUE: reference to a compiler-generated method
      return _param1_1.Where<\u003914934610860>((Func<\u003914934610860, bool>) (_param1_2 => _param1_2.\u003355072053103 != null)).SelectMany<\u003914934610860, TestCase>(new Func<\u003914934610860, IEnumerable<TestCase>>(obj.\u003832606261144)).Where<TestCase>((Func<TestCase, bool>) (_param1_3 => _param1_3 != null));
    }

    private TestCase \u003739016946476(\u003678478778254 _param1, string _param2)
    {
      try
      {
        return _param1.\u003179512822732(_param2);
      }
      catch (Exception ex)
      {
        this.\u003105033564539(ex.Message);
      }
      return (TestCase) null;
    }

    public string[] \u003404488133706(
      IEnumerable<string> _param1,
      \u003064588995134 _param2,
      string _param3)
    {
      return new List<string>()
      {
        \u003615347801101.\u003183238499182,
        "discover",
        "unittest",
        "--output-file",
        _param3,
        "--",
        _param2.\u003090245916323,
        _param2.\u003099984863850
      }.ToArray();
    }

    private Dictionary<string, string> \u003410564882083(
      IEnumerable<string> _param1,
      \u003064588995134 _param2)
    {
      string key = _param2.\u003433255215837;
      string str = this.\u003066514135484(_param1, _param2);
      Dictionary<string, string> dictionary = new Dictionary<string, string>();
      if (!string.IsNullOrWhiteSpace(key))
        dictionary[key] = str;
      foreach (KeyValuePair<string, string> keyValuePair in _param2.\u003615420650558)
        dictionary[keyValuePair.Key] = keyValuePair.Value;
      dictionary["PYTHONUNBUFFERED"] = "1";
      return dictionary;
    }

    private string \u003066514135484(IEnumerable<string> _param1, \u003064588995134 _param2)
    {
      List<string> source = _param2.\u003579671787876;
      source.Insert(0, _param2.\u003106365127459);
      return string.Join(";", source.Where<string>(new Func<string, bool>(Directory.Exists)).Distinct<string>((IEqualityComparer<string>) StringComparer.OrdinalIgnoreCase));
    }

    [Conditional("DEBUG")]
    private void \u003554811061930(string _param1) => this.\u003788647113548?.SendMessage((TestMessageLevel) 0, _param1);

    private void \u003235206523595(string _param1) => this.\u003788647113548?.SendMessage((TestMessageLevel) 0, _param1);

    private void \u003105033564539(string _param1) => this.\u003788647113548?.SendMessage((TestMessageLevel) 2, _param1);

    private void \u003068606652762(string _param1) => this.\u003788647113548?.SendMessage((TestMessageLevel) 1, _param1);
  }
}
