// Decompiled with JetBrains decompiler
// Type: s408709837000062.s011889756731155
// Assembly: s778197286190734, Version=16.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
// MVID: B8DB6840-BCA0-4EC3-93C1-1E026E238560
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.04\HEUR-Trojan.MSIL.PowerShell.gen-541fbec081719c440d95155189e5f90573351b94bbae41393656e91ca641bffa.exe

using Microsoft.VisualStudio.Debugger;
using Microsoft.VisualStudio.Debugger.ComponentInterfaces;
using Microsoft.VisualStudio.Debugger.CustomRuntimes;
using Microsoft.VisualStudio.Debugger.DefaultPort;
using Microsoft.VisualStudio.Debugger.Evaluation;
using Microsoft.VisualStudio.Debugger.Script;
using Microsoft.VisualStudio.Debugger.Symbols;
using s054820824151338;
using s218283947769621;
using s281269497025338;
using s286575929511236;
using s288411773683173;
using s347182466859981;
using s402371713847991;
using s614108905418704;
using s711430944279628;
using s712162411588747;
using s715892055337178;
using s717518496198425;
using s756178962572455;
using s798407459154654;
using s897922753738296;
using System;

namespace s408709837000062
{
  internal sealed class s011889756731155 : 
    IDkmScriptDocumentTreeNodeCreateNotification,
    IDkmScriptDocumentTreeNodeUnloadNotification,
    IDkmScriptDocumentContentInsertNotification,
    IDkmScriptDocumentContentRemoveNotification
  {
    private s004814079377862 s952118513835576 = new s004814079377862();
    private const string s100735176217681 = "Sourcemap (";
    private const string s249272498635603 = " sourceUrl: ";
    private const string s093692002699863 = ")";

    void IDkmScriptDocumentTreeNodeCreateNotification.s802385862982217(
      DkmScriptDocumentTreeNode s617074766346896,
      DkmWorkList s655520868495954,
      DkmEventDescriptor s378418376234013)
    {
      // ISSUE: variable of a compiler-generated type
      s011889756731155.s043977380303592 s043977380303592 = (s011889756731155.s043977380303592) new s244964523437792.s438858584809851();
      ((s244964523437792.s699476670423698) s043977380303592).s579463966932686 = this;
      // ISSUE: reference to a compiler-generated field
      s043977380303592.s980017244026339 = s617074766346896 as DkmScriptDocument;
      // ISSUE: reference to a compiler-generated field
      if (!s784750054165744.s244118639418623(s043977380303592.s980017244026339))
        return;
      // ISSUE: reference to a compiler-generated field
      s043977380303592.s980017244026339.SetRaiseContentEvents(true);
      // ISSUE: reference to a compiler-generated field
      if (string.IsNullOrEmpty(s784750054165744.s294592613433475(s043977380303592.s980017244026339, out string _)))
        return;
      // ISSUE: reference to a compiler-generated method
      s724996271790505 s724996271790505 = new s724996271790505(s043977380303592.s170824275119543);
      // ISSUE: reference to a compiler-generated field
      // ISSUE: reference to a compiler-generated field
      // ISSUE: reference to a compiler-generated field
      // ISSUE: reference to a compiler-generated field
      // ISSUE: reference to a compiler-generated field
      // ISSUE: method pointer
      DkmCustomMessage.Create(s043977380303592.s980017244026339.Module.Connection, s043977380303592.s980017244026339.Module.GetModuleInstances()[0].Process, s244964523437792.s034954014261499, 100, (object) s724996271790505, (object) null).SendLower(s655520868495954, s011889756731155.s304652841519565.s634315539255348 ?? (s011889756731155.s304652841519565.s634315539255348 = new DkmCompletionRoutine<DkmSendLowerAsyncResult>((object) s011889756731155.s043977380303592.s337090465041532, __methodptr(s613524783390722))));
    }

    void IDkmScriptDocumentTreeNodeUnloadNotification.s754993082366375(
      DkmScriptDocumentTreeNode s970257825293834,
      DkmEventDescriptor s510452251937692)
    {
      DkmScriptDocument dkmScriptDocument1 = s970257825293834 as DkmScriptDocument;
      if (s784750054165744.s244118639418623(dkmScriptDocument1))
      {
        this.s817550823694559(dkmScriptDocument1);
      }
      else
      {
        foreach (DkmModuleInstance s507194991732778 in s999023206205233.s263410713679995(s970257825293834.RuntimeInstance))
        {
          if (!((DkmDataContainer) s507194991732778).IsUnloaded)
          {
            DkmScriptDocument dkmScriptDocument2 = s463346742019277.s889720962331631(s507194991732778);
            if (dkmScriptDocument2 != null && ((DkmScriptDocumentTreeNode) dkmScriptDocument2).Parent == s970257825293834)
              s507194991732778.Unload();
          }
        }
      }
    }

    void IDkmScriptDocumentContentInsertNotification.s783824337163871(
      DkmScriptDocument s398231163636226,
      DkmTextSpan s478739154528696,
      string s526649045538554,
      DkmEventDescriptor s435880970695183)
    {
      if (s398231163636226.Flags == 1)
        this.s054617294376987(s398231163636226, s478739154528696, s526649045538554);
      else
        this.s703289125659625(s398231163636226);
    }

    void IDkmScriptDocumentContentRemoveNotification.s820671617756769(
      DkmScriptDocument s924022670468180,
      DkmTextSpan s204214292354424,
      int s041190881961683,
      DkmEventDescriptor s525495109465745)
    {
      this.s057000239221369(s924022670468180, s204214292354424);
    }

    private void s703289125659625(DkmScriptDocument s905123335508301)
    {
      this.s817550823694559(s905123335508301);
      s773164585635639 s968723705537676 = this.s907545368594867(s905123335508301);
      if (!((Uri) s968723705537676.s855299840177391 != (Uri) null))
        return;
      this.s352486574087997(s968723705537676);
    }

    internal s773164585635639 s907545368594867(DkmScriptDocument s177878070981653)
    {
      string s570321144088109;
      string s738672911825913 = s784750054165744.s294592613433475(s177878070981653, out s570321144088109);
      return this.s705754930146826(s177878070981653, s738672911825913, s570321144088109);
    }

    internal s773164585635639 s705754930146826(
      DkmScriptDocument s124545029250934,
      string s738672911825913,
      string s169118172700681)
    {
      string s855628288860574;
      string str = s784750054165744.s953707983334228(s124545029250934, out s855628288860574);
      string s303827098696697 = (string) null;
      s863674376552032 sourceMapUri = (s863674376552032) null;
      try
      {
        sourceMapUri = s124545029250934.SourceProjectItem == null ? this.s952118513835576.s326427845766250(str, s855628288860574, s169118172700681, s738672911825913, out s303827098696697) : this.s952118513835576.s092687979425624(str, s855628288860574, s169118172700681, s738672911825913);
      }
      catch (s615052226436758 ex)
      {
        DkmCustomMessage.Create(s124545029250934.Module.Connection, ((DkmScriptDocumentTreeNode) s124545029250934).Process, s244964523437792.s462897974219091, 103, (object) ex.s481953787600014, (object) s244964523437792.s688656307124444(ex.s169236158689056, ex.s695180977122614, ex.HResult)).SendHigher();
      }
      bool delayWebPackRootResolution = s124545029250934.SourceProjectItem == null;
      return new s773164585635639(s124545029250934, str, s855628288860574, s169118172700681, sourceMapUri, s303827098696697, delayWebPackRootResolution);
    }

    private void s054617294376987(
      DkmScriptDocument s655402221769277,
      DkmTextSpan s455773557702312,
      string s196090439557032)
    {
      string s738672911825913 = s028001312605085.s177918731804363(s196090439557032);
      string s169118172700681 = s028001312605085.s178429709172067(s196090439557032);
      s773164585635639 s968723705537676 = this.s705754930146826(s655402221769277, s738672911825913, s169118172700681);
      if (!((Uri) s968723705537676.s855299840177391 != (Uri) null) && ((DkmDataContainer) s655402221769277).GetDataItem<s631575415170554<s238241444304374>>() == null)
        return;
      this.s352486574087997(s968723705537676, s455773557702312.StartLine);
    }

    private string s583194750784721(s773164585635639 s049621656966761)
    {
      string str = ((DkmScriptDocumentTreeNode) s049621656966761.s382361428282642).Title;
      if (!string.IsNullOrEmpty(s049621656966761.s292315197362876))
        str = str + " sourceUrl: " + s049621656966761.s292315197362876;
      if ((Uri) s049621656966761.s855299840177391 != (Uri) null)
        str = "Sourcemap (" + str + ")";
      return str;
    }

    private DkmModule s402497568847320(s773164585635639 s043772608049119)
    {
      DkmScriptDocument s382361428282642 = s043772608049119.s382361428282642;
      DkmModuleId dkmModuleId = new DkmModuleId(Guid.NewGuid(), s382361428282642.Module.Id.SymbolProvider);
      string str1;
      if ((Uri) s043772608049119.s855299840177391 == (Uri) null)
      {
        str1 = this.s583194750784721(s043772608049119);
      }
      else
      {
        s863674376552032 s855299840177391 = s043772608049119.s855299840177391;
        str1 = s855299840177391.IsFile ? s855299840177391.LocalPath : s855299840177391.s397817210381655;
      }
      string str2 = str1;
      DkmCompilerId s113161445661479 = s157799658391161.s113161445661479;
      DkmTransportConnection connection = s382361428282642.Module.Connection;
      return DkmModule.Create(dkmModuleId, str2, s113161445661479, connection, (DkmDataItem) null);
    }

    private string s225167194938129(s773164585635639 s291056128121472, out string s137512733480171)
    {
      if (s784750054165744.s255736014058865(s291056128121472.s382361428282642))
      {
        s137512733480171 = this.s583194750784721(s291056128121472);
        return s137512733480171;
      }
      DkmScriptDocument s382361428282642 = s291056128121472.s382361428282642;
      s137512733480171 = "Sourcemap (" + s382361428282642.Url + ")";
      return "Sourcemap (" + s418527457472989.s202987665022571(s382361428282642.Url) + ")";
    }

    private void s352486574087997(s773164585635639 s968723705537676, int s619552676083677 = 0)
    {
      DkmScriptDocument s382361428282642 = s968723705537676.s382361428282642;
      DkmModule dkmModule1 = this.s402497568847320(s968723705537676);
      DkmRuntimeInstance dkmRuntimeInstance = s897083757685898.s586517144894301(((DkmScriptDocumentTreeNode) s382361428282642).RuntimeInstance);
      s631575415170554<s238241444304374> dataItem = ((DkmDataContainer) s382361428282642).GetDataItem<s631575415170554<s238241444304374>>();
      s238241444304374 firstSection = new s238241444304374(s619552676083677);
      if (dataItem == null)
      {
        s631575415170554<s238241444304374> s631575415170554 = new s631575415170554<s238241444304374>(firstSection);
        ((DkmDataContainer) s382361428282642).SetDataItem<s631575415170554<s238241444304374>>((DkmDataCreationDisposition) 1, s631575415170554);
      }
      else
        dataItem.AddSection(firstSection);
      DkmCustomSymbolFileId customSymbolFileId = DkmCustomSymbolFileId.Create(s382361428282642.Module.Id.SymbolProvider, 0, s463346742019277.s650012886643820(s968723705537676, s619552676083677, firstSection.s171440443555091));
      DkmModuleInstance[] dkmModuleInstanceArray = s999023206205233.s263410713679995(((DkmScriptDocumentTreeNode) s382361428282642).RuntimeInstance);
      DkmModuleInstance moduleInstance = s382361428282642.Module.GetModuleInstances()[0];
      string s137512733480171;
      DkmCustomModuleInstance customModuleInstance = DkmCustomModuleInstance.Create(this.s225167194938129(s968723705537676, out s137512733480171), s137512733480171, moduleInstance.TimeDateStamp, dkmRuntimeInstance, moduleInstance.Version, (DkmSymbolFileId) customSymbolFileId, moduleInstance.Flags, moduleInstance.MemoryLayout, moduleInstance.BaseAddress, (uint) ((int) moduleInstance.LoadOrder + dkmModuleInstanceArray.Length + 1), moduleInstance.Size, moduleInstance.LoadContext, moduleInstance.IsDisabled, dkmModule1, moduleInstance.MinidumpInfoPart, (DkmDataItem) null);
      s382361428282642.SetRaiseSymbolEvents(true);
      DkmModule dkmModule2 = dkmModule1;
      ((DkmModuleInstance) customModuleInstance).OnSymbolsUpdated(dkmModule2);
    }

    private void s817550823694559(DkmScriptDocument s626166754550110)
    {
      foreach (DkmModuleInstance dkmModuleInstance in s999023206205233.s327716358406216(s626166754550110))
        dkmModuleInstance.Unload();
    }

    private void s057000239221369(DkmScriptDocument s820793529922801, DkmTextSpan s650928766501799)
    {
      s631575415170554<s238241444304374> dataItem = ((DkmDataContainer) s820793529922801).GetDataItem<s631575415170554<s238241444304374>>();
      if (dataItem == null)
        return;
      s238241444304374 section = dataItem.FindSection(s650928766501799);
      if (section == null)
        return;
      dataItem.RemoveSection(section);
      if (dataItem.sections.Count == 0)
        ((DkmDataContainer) s820793529922801).RemoveDataItem<s631575415170554<s238241444304374>>();
      s999023206205233.s206113311814384(s820793529922801, section.s171440443555091)?.Unload();
    }
  }
}
