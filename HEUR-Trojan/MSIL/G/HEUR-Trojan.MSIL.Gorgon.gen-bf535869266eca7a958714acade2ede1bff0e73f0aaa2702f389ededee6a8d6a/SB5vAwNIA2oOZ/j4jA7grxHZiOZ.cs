// Decompiled with JetBrains decompiler
// Type: SB5vAwNIA2oOZ.j4jA7grxHZiOZ
// Assembly: Udby4Jt48oXkJ, Version=3.17.2.31, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
// MVID: 37899E89-D673-4F5B-A193-2E4DF6A54096
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Trojan.MSIL.Gorgon.gen-bf535869266eca7a958714acade2ede1bff0e73f0aaa2702f389ededee6a8d6a.exe

using \u0036mHL90hQ651VX;
using HqLTLdqt37SZu;
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Xml;
using System.Xml.Linq;
using TlfuIkkM6v6pC;
using zR0sAUCfwb9S8;

namespace SB5vAwNIA2oOZ
{
  internal class j4jA7grxHZiOZ
  {
    public const string \u0031I8VBDCIUvmms = "urn:oasis:names:tc:SAML:1.0:assertion";

    public string syIJDuYiTmJh2 { get; private set; }

    public string MMKVzUCcLWUM3 { get; private set; }

    public static j4jA7grxHZiOZ Y5jrOD8xmZb2J(
      Stream icDF3VEXMutC8,
      n6TGt2r3FxEvZ SIj1Mfojq9DCG)
    {
      return j4jA7grxHZiOZ.CZkJ04ZhmEs9G(j4jA7grxHZiOZ.LIYi7bt6YJKOm(icDF3VEXMutC8), SIj1Mfojq9DCG);
    }

    public static string KpuflwVllIBGf(XDocument XUaanxOy1rhvT, Up2ciG6wVdM5T m7jzxVU44FAST)
    {
      string str = (string) null;
      try
      {
        XElement xelement = XUaanxOy1rhvT.Descendants(bjImv8syFHPRL.SPI5rVH6dcQQT + "Body").FirstOrDefault<XElement>();
        if (xelement != null)
        {
          XElement kcfSAbvrP0CeD = xelement.Elements(bjImv8syFHPRL.SPI5rVH6dcQQT + "Fault").FirstOrDefault<XElement>();
          if (kcfSAbvrP0CeD != null)
            str = j4jA7grxHZiOZ.r77GL6m0WWYuN(kcfSAbvrP0CeD);
        }
      }
      catch (XmlException ex)
      {
        throw new LlM9VbgWu20VY("parsing_wstrust_response_failed", (Exception) ex);
      }
      return str;
    }

    private static string r77GL6m0WWYuN(XElement kcfSAbvrP0CeD)
    {
      XElement xelement1 = kcfSAbvrP0CeD.Elements(bjImv8syFHPRL.SPI5rVH6dcQQT + "Reason").FirstOrDefault<XElement>();
      if (xelement1 != null)
      {
        XElement xelement2 = xelement1.Elements(bjImv8syFHPRL.SPI5rVH6dcQQT + "Text").FirstOrDefault<XElement>();
        if (xelement2 != null)
        {
          using (XmlReader reader = xelement2.CreateReader())
          {
            int content = (int) reader.MoveToContent();
            return reader.ReadInnerXml();
          }
        }
      }
      return (string) null;
    }

    internal static XDocument LIYi7bt6YJKOm(Stream IHWrzLqSOvIkM)
    {
      try
      {
        return XDocument.Load(IHWrzLqSOvIkM, LoadOptions.None);
      }
      catch (XmlException ex)
      {
        throw new LlM9VbgWu20VY("parsing_wstrust_response_failed", (Exception) ex);
      }
    }

    internal static j4jA7grxHZiOZ CZkJ04ZhmEs9G(
      XDocument _param0,
      n6TGt2r3FxEvZ dvLduttVanjcg)
    {
      Dictionary<string, string> dictionary = new Dictionary<string, string>();
      try
      {
        XNamespace xnamespace = bjImv8syFHPRL.qlZ3NFn0gtT6B;
        if (dvLduttVanjcg == n6TGt2r3FxEvZ.WsTrust2005)
          xnamespace = bjImv8syFHPRL.MWclHSzE70lhZ;
        bool flag = true;
        if (dvLduttVanjcg == n6TGt2r3FxEvZ.WsTrust13 && _param0.Descendants(xnamespace + "RequestSecurityTokenResponseCollection").FirstOrDefault<XElement>() == null)
          flag = false;
        if (!flag)
          throw new LlM9VbgWu20VY("parsing_wstrust_response_failed");
        foreach (XElement descendant in _param0.Descendants(xnamespace + "RequestSecurityTokenResponse"))
        {
          XElement xelement1 = descendant.Elements(xnamespace + "TokenType").FirstOrDefault<XElement>();
          if (xelement1 != null)
          {
            XElement xelement2 = descendant.Elements(xnamespace + "RequestedSecurityToken").FirstOrDefault<XElement>();
            if (xelement2 != null)
              dictionary.Add(xelement1.Value, xelement2.FirstNode.ToString(SaveOptions.DisableFormatting));
          }
        }
      }
      catch (XmlException ex)
      {
        throw new LlM9VbgWu20VY("parsing_wstrust_response_failed", (Exception) ex);
      }
      if (dictionary.Count == 0)
        throw new LlM9VbgWu20VY("parsing_wstrust_response_failed");
      string key = dictionary.ContainsKey("urn:oasis:names:tc:SAML:1.0:assertion") ? "urn:oasis:names:tc:SAML:1.0:assertion" : dictionary.Keys.First<string>();
      return new j4jA7grxHZiOZ()
      {
        MMKVzUCcLWUM3 = key,
        syIJDuYiTmJh2 = dictionary[key]
      };
    }
  }
}
