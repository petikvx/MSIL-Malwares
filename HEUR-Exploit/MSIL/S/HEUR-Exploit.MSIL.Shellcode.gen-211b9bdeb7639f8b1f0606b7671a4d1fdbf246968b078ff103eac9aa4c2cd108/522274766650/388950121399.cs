// Decompiled with JetBrains decompiler
// Type: 522274766650.388950121399
// Assembly: 190180155270, Version=7.6.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35
// MVID: 20B0A582-54C5-4C64-BCB9-2AC73608F590
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.03\HEUR-Exploit.MSIL.Shellcode.gen-211b9bdeb7639f8b1f0606b7671a4d1fdbf246968b078ff103eac9aa4c2cd108.exe

using \u003041130631579;
using \u003091015534910;
using \u003109247418335;
using \u003193754076629;
using \u003290215332830;
using \u003365260957738;
using \u003438849876263;
using \u003522274766650;
using \u003594355096097;
using \u003715751089460;
using \u003882244590153;
using Microsoft.ProgramSynthesis.Utils;
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Reflection;
using System.Runtime.CompilerServices;
using System.Text;
using System.Threading;
using System.Threading.Tasks;

namespace \u003522274766650
{
  public class \u003388950121399
  {
    private static readonly Lazy<Dictionary<\u003197692273545, List<Type>>> \u003498522730696 = new Lazy<Dictionary<\u003197692273545, List<Type>>>(new Func<Dictionary<\u003197692273545, List<Type>>>(\u003388950121399.\u003157678154973), LazyThreadSafetyMode.ExecutionAndPublication);
    private static readonly Lazy<Dictionary<\u003197692273545, List<Type>>> \u003769970765147 = new Lazy<Dictionary<\u003197692273545, List<Type>>>(new Func<Dictionary<\u003197692273545, List<Type>>>(\u003388950121399.\u003212104098625), LazyThreadSafetyMode.ExecutionAndPublication);
    private static readonly Lazy<Dictionary<\u003197692273545, List<Type>>> \u003468469569421 = new Lazy<Dictionary<\u003197692273545, List<Type>>>(new Func<Dictionary<\u003197692273545, List<Type>>>(\u003388950121399.\u003721797432676), LazyThreadSafetyMode.ExecutionAndPublication);
    private const int \u003367043231980 = 268435456;

    internal static Dictionary<\u003197692273545, List<Type>> \u003726250743519 => \u003388950121399.\u003498522730696.Value;

    internal static Dictionary<\u003197692273545, List<Type>> \u003567666756882 => \u003388950121399.\u003769970765147.Value;

    internal static Dictionary<\u003197692273545, List<Type>> \u003387857781994 => \u003388950121399.\u003468469569421.Value;

    private static IEnumerable<Type> \u003361500586396(Type _param0, bool _param1 = true)
    {
      // ISSUE: object of a compiler-generated type is created
      // ISSUE: variable of a compiler-generated type
      \u003388950121399.\u003157742170705 obj = (\u003388950121399.\u003157742170705) new \u003388495369049.\u003238171626529();
      // ISSUE: reference to a compiler-generated field
      ((\u003388495369049.\u003238171626529) obj).\u003356804987172 = _param0;
      // ISSUE: reference to a compiler-generated field
      obj.\u003375451619815 = _param1;
      // ISSUE: reference to a compiler-generated method
      return ((IEnumerable<Type>) typeof (\u003268629952928).GetTypeInfo().Assembly.GetTypes()).Where<Type>(new Func<Type, bool>(obj.\u003540980965722));
    }

    private static Dictionary<\u003197692273545, List<Type>> \u003157678154973()
    {
      Dictionary<\u003197692273545, List<Type>> dictionary = new Dictionary<\u003197692273545, List<Type>>();
      foreach (Type type in \u003388950121399.\u003361500586396(typeof (\u003268629952928)))
      {
        if (!(Activator.CreateInstance(type) is \u003268629952928 instance))
          throw new InvalidOperationException(FormattableString.Invariant(FormattableStringFactory.Create("Could not construct an object of type \"{0}\"", (object) type)));
        foreach (\u003197692273545 obj in instance.\u003288651929624)
          CollectionUtils.GetOrCreateValue<\u003197692273545, List<Type>>((IDictionary<\u003197692273545, List<Type>>) dictionary, obj).Add(type);
      }
      return dictionary;
    }

    private static Dictionary<\u003197692273545, List<Type>> \u003332313574459(
      Type _param0)
    {
      // ISSUE: object of a compiler-generated type is created
      // ISSUE: variable of a compiler-generated type
      \u003388950121399.\u003647051307735 obj = (\u003388950121399.\u003647051307735) new \u003388950121399.\u003157742170705();
      // ISSUE: reference to a compiler-generated field
      ((\u003388950121399.\u003157742170705) obj).\u003480729433443 = _param0;
      Dictionary<\u003197692273545, List<Type>> dictionary = new Dictionary<\u003197692273545, List<Type>>();
      foreach (KeyValuePair<\u003197692273545, List<Type>> keyValuePair in \u003388950121399.\u003726250743519)
      {
        // ISSUE: reference to a compiler-generated field
        // ISSUE: reference to a compiler-generated field
        // ISSUE: reference to a compiler-generated method
        List<Type> list = keyValuePair.Value.Where<Type>(obj.\u003903316417693 ?? (obj.\u003903316417693 = new Func<Type, bool>(obj.\u003352603625450))).ToList<Type>();
        if (list.Count > 0)
          dictionary[keyValuePair.Key] = list;
      }
      return dictionary;
    }

    private static Dictionary<\u003197692273545, List<Type>> \u003212104098625() => \u003388950121399.\u003332313574459(typeof (\u003763884075713));

    private static Dictionary<\u003197692273545, List<Type>> \u003721797432676() => \u003388950121399.\u003332313574459(typeof (\u003134945228346));

    internal Stream \u003596786186558 { get; }

    internal Encoding \u003849674423283 { get; private set; }

    internal byte[] \u003999673055061 { get; private set; }

    internal string \u003142047329050 { get; private set; }

    private void \u003893218585198()
    {
      if (this.\u003849674423283 == null)
      {
        \u003212044566473 obj = \u003628028891362.\u003693835383146(this.\u003999673055061);
        if (obj == \u003212044566473.Unknown)
          return;
        this.\u003849674423283 = Encoding.GetEncoding(obj.\u003877788016044());
      }
      try
      {
        this.\u003142047329050 = this.\u003849674423283.\u003867310156419(this.\u003999673055061, out bool _).Normalize();
      }
      catch (Exception ex)
      {
        this.\u003142047329050 = (string) null;
      }
    }

    private void \u003921992736489()
    {
      if (this.\u003596786186558 != null)
      {
        this.\u003999673055061 = new byte[Math.Min(this.\u003596786186558.Length, 268435456L)];
        IOUtils.RepeatRead(this.\u003596786186558, this.\u003999673055061, 0, this.\u003999673055061.Length);
        this.\u003893218585198();
      }
      else
      {
        if (this.\u003142047329050 == null)
          return;
        this.\u003999673055061 = Encoding.Unicode.GetBytes(this.\u003142047329050);
      }
    }

    private Task<\u003369096608817> \u003253997519543(
      Type _param1,
      out \u003268629952928 _param2)
    {
      // ISSUE: object of a compiler-generated type is created
      // ISSUE: variable of a compiler-generated type
      \u003388950121399.\u003517837560999 obj = (\u003388950121399.\u003517837560999) new \u003388950121399.\u003647051307735();
      // ISSUE: reference to a compiler-generated field
      obj.\u003156410839591 = this;
      // ISSUE: reference to a compiler-generated field
      ((\u003388950121399.\u003647051307735) obj).\u003832738634068 = Activator.CreateInstance(_param1);
      // ISSUE: reference to a compiler-generated field
      // ISSUE: reference to a compiler-generated field
      _param2 = ((\u003388950121399.\u003647051307735) obj).\u003832738634068 != null ? ((\u003388950121399.\u003647051307735) obj).\u003832738634068 as \u003268629952928 : throw new InvalidOperationException(FormattableString.Invariant(FormattableStringFactory.Create("Could not instantiate detector of type: {0}.", (object) _param1)));
      if (typeof (\u003134945228346).GetTypeInfo().IsAssignableFrom(_param1))
      {
        // ISSUE: reference to a compiler-generated method
        return this.\u003142047329050 == null ? (Task<\u003369096608817>) null : new Task<\u003369096608817>(new Func<\u003369096608817>(obj.\u003895374054764));
      }
      if (typeof (\u003763884075713).GetTypeInfo().IsAssignableFrom(_param1))
      {
        // ISSUE: reference to a compiler-generated method
        return new Task<\u003369096608817>(new Func<\u003369096608817>(obj.\u003257111941857));
      }
      throw new InvalidOperationException(FormattableString.Invariant(FormattableStringFactory.Create("Could not make file type detection task for detector type: {0}.", (object) _param1)));
    }

    private \u003197692273545 \u003252933932037(IEnumerable<Type> _param1_1)
    {
      List<Record<Task<\u003369096608817>, \u003268629952928>> source1 = new List<Record<Task<\u003369096608817>, \u003268629952928>>();
      foreach (Type type in _param1_1)
      {
        \u003268629952928 obj;
        Task<\u003369096608817> task = this.\u003253997519543(type, out obj);
        if (task != null)
          source1.Add(Record.Create<Task<\u003369096608817>, \u003268629952928>(task, obj));
      }
      foreach (IGrouping<int, Record<Task<\u003369096608817>, \u003268629952928>> grouping in (IEnumerable<IGrouping<int, Record<Task<\u003369096608817>, \u003268629952928>>>) ((IEnumerable<Record<Task<\u003369096608817>, \u003268629952928>>) source1).GroupBy<Record<Task<\u003369096608817>, \u003268629952928>, int>((Func<Record<Task<\u003369096608817>, \u003268629952928>, int>) (_param1_2 => _param1_2.Item2.\u003146046690039)).OrderBy<IGrouping<int, Record<Task<\u003369096608817>, \u003268629952928>>, int>((Func<IGrouping<int, Record<Task<\u003369096608817>, \u003268629952928>>, int>) (_param1_3 => _param1_3.Key)))
      {
        List<Task<\u003369096608817>> source2 = new List<Task<\u003369096608817>>();
        foreach (Record<Task<\u003369096608817>, \u003268629952928> record in (IEnumerable<Record<Task<\u003369096608817>, \u003268629952928>>) grouping)
        {
          record.Item1.Start();
          source2.Add(record.Item1);
        }
        Task[] array = source2.Cast<Task>().ToArray<Task>();
        Task.WaitAll(array);
        foreach (Task<\u003369096608817> task in array)
        {
          \u003369096608817 result = task.Result;
          if (result.\u003919619479674 != \u003197692273545.Unknown)
            return result.\u003919619479674;
        }
      }
      return \u003197692273545.Unknown;
    }

    private \u003197692273545 \u003376688371260()
    {
      this.\u003921992736489();
      try
      {
        return this.\u003252933932037(this.\u003999673055061 == null ? \u003388950121399.\u003387857781994.SelectMany<KeyValuePair<\u003197692273545, List<Type>>, Type>((Func<KeyValuePair<\u003197692273545, List<Type>>, IEnumerable<Type>>) (_param1 => (IEnumerable<Type>) _param1.Value)) : \u003388950121399.\u003726250743519.SelectMany<KeyValuePair<\u003197692273545, List<Type>>, Type>((Func<KeyValuePair<\u003197692273545, List<Type>>, IEnumerable<Type>>) (_param1 => (IEnumerable<Type>) _param1.Value)));
      }
      catch (Exception ex)
      {
        return \u003197692273545.Unknown;
      }
    }

    private \u003388950121399(Stream stream, Encoding encoding = null)
    {
      this.\u003596786186558 = stream;
      this.\u003849674423283 = encoding;
    }

    private \u003388950121399(string contents) => this.\u003142047329050 = contents;

    public static \u003197692273545 \u003183736093898(
      string _param0,
      Encoding _param1 = null)
    {
      using (FileStream fileStream = new FileStream(_param0, FileMode.Open, FileAccess.Read, FileShare.Read))
        return \u003388950121399.\u003104670146685((Stream) fileStream, Path.GetExtension(_param0), _param1);
    }

    public static \u003197692273545 \u003104670146685(
      Stream _param0,
      string _param1 = null,
      Encoding _param2 = null)
    {
      return new \u003388950121399(_param0, _param2).\u003376688371260();
    }

    public static \u003197692273545 \u003739869274424(
      string _param0,
      string _param1 = null)
    {
      return new \u003388950121399(_param0).\u003376688371260();
    }

    public static \u003197692273545 \u003487528373694(
      byte[] _param0,
      string _param1 = null,
      Encoding _param2 = null)
    {
      using (MemoryStream memoryStream = new MemoryStream(_param0))
        return \u003388950121399.\u003104670146685((Stream) memoryStream, _param1, _param2);
    }
  }
}
