// Decompiled with JetBrains decompiler
// Type: s914955847573057.s424076493653259
// Assembly: s802785987160928, Version=1.0.0.0, Culture=neutral, PublicKeyToken=8d3bb6c79cff225a
// MVID: E562BAAF-678F-45B2-A19A-CFBF160B1BAF
// Assembly location: C:\Users\Administrateur\Downloads\Bazaar.2022.04\Trojan.Win64.Injects.byr-71d4abb6ea36ebfca83e1b236cadfd303a41fe6d642637197c630ec1263b20db.exe

using s193316744763357;
using s214007568862378;
using s254766793960553;
using s362420967940830;
using s440368503734842;
using s465337320084666;
using s518386422255270;
using s740588166303995;
using s767203895605925;
using s795291577363067;
using s879975036501734;
using System;
using System.Collections.Generic;
using System.Reflection;
using System.Runtime.InteropServices;
using System.Runtime.Serialization;
using System.Threading;
using System.Threading.Tasks;

namespace s914955847573057
{
  public static class s424076493653259
  {
    private const ulong s401879480084256 = 18446744073709551615;
    private static AsyncLocal<s424076493653259.s453905211137903> s680942602127002 = new AsyncLocal<s424076493653259.s453905211137903>(new Action<AsyncLocalValueChangedArgs<s424076493653259.s453905211137903>>(s424076493653259.s552104230499044));
    private static Lazy<IList<IDisposable>> s820857077674338 = new Lazy<IList<IDisposable>>(new Func<IList<IDisposable>>(s424076493653259.s520130591284795));
    private static Lazy<s960412633860805> s018220860452112 = new Lazy<s960412633860805>(new Func<s960412633860805>(s424076493653259.s808008271762046));
    private static Lazy<ThreadLocal<s424076493653259.s488297177572616>> s608149552396311 = new Lazy<ThreadLocal<s424076493653259.s488297177572616>>(new Func<ThreadLocal<s424076493653259.s488297177572616>>(s424076493653259.s192120587607479));
    private static Lazy<s754392368222187> s224292191255992 = new Lazy<s754392368222187>(new Func<s754392368222187>(s424076493653259.s233020040629206));

    private static string s448194743609476(string s481752108669659) => string.Format("{0}[T:{1}]: {2}", (object) nameof (s424076493653259), (object) Thread.CurrentThread.ManagedThreadId, (object) s481752108669659);

    private static void s152622488420433(string s896507405994076, params object[] s967437048344211) => s095683830799280.s567800687732192.s411925689910680(s424076493653259.s448194743609476(s896507405994076), s967437048344211);

    private static void s719206956684263(Exception s945572592597408) => s095683830799280.s567800687732192.s807263002219417(s945572592597408);

    private static void s940659201817219(string s468961703443687, params object[] s458009813207201) => s095683830799280.s567800687732192.s411925689910680(s424076493653259.s448194743609476(s468961703443687), s458009813207201);

    private static void s552104230499044(
      AsyncLocalValueChangedArgs<s424076493653259.s453905211137903> s326447229194584)
    {
      if (!s326447229194584.ThreadContextChanged)
        return;
      using (s984343181077700.s832495161073656(s424076493653259.s087590591973578))
      {
        try
        {
          if (s326447229194584.PreviousValue != null && s424076493653259.s689801368711584.s274648187692696)
          {
            using (s424076493653259.s689801368711584.s076536868900315.s599267095129781(s424076493653259.s087590591973578))
            {
              s424076493653259.s940659201817219("Popping async shadow frame.");
              if (s424076493653259.s687157307100975(ulong.MaxValue, false))
                s424076493653259.s689801368711584.s274648187692696 = false;
            }
          }
          if (s326447229194584.CurrentValue != null)
          {
            if (s326447229194584.CurrentValue.s990678695328235)
            {
              s424076493653259.s680942602127002.Value = (s424076493653259.s453905211137903) null;
            }
            else
            {
              uint s505411960150321 = s326447229194584.CurrentValue.s505411960150321;
              s424076493653259.s224292191255992.Value?.s153396788378840(s505411960150321);
              s424076493653259.s940659201817219("Setting thread activity ID to {0}.", (object) s505411960150321);
              s424076493653259.s087590591973578.s094846620837958(s505411960150321);
              using (s424076493653259.s689801368711584.s076536868900315.s599267095129781(s424076493653259.s087590591973578))
              {
                if (s424076493653259.s689801368711584.s076536868900315.s727298766669709)
                  return;
                s424076493653259.s784953948001175();
                s424076493653259.s940659201817219("Pushing async shadow frame.");
                s424076493653259.s689801368711584.s274648187692696 = true;
                s424076493653259.s032067221559490(ulong.MaxValue, false, true);
              }
            }
          }
          else
            s424076493653259.s224292191255992.Value?.s963664529984509();
        }
        catch (Exception ex1)
        {
          try
          {
            s424076493653259.s719206956684263(ex1);
          }
          catch (Exception ex2)
          {
          }
        }
      }
    }

    private static void s398689258744917(object s782559856011822, EventArgs s752266371766111)
    {
      List<IDisposable> disposableList = new List<IDisposable>((IEnumerable<IDisposable>) s424076493653259.s820857077674338.Value);
      s424076493653259.s820857077674338.Value.Clear();
      foreach (IDisposable disposable in (IEnumerable<IDisposable>) disposableList)
        disposable.Dispose();
    }

    private static IList<IDisposable> s520130591284795()
    {
      s960722123908825.s816576190172751();
      s960722123908825.s187024753060971 += new EventHandler(s424076493653259.s398689258744917);
      return (IList<IDisposable>) new List<IDisposable>();
    }

    private static s960412633860805 s808008271762046()
    {
      s960412633860805 runtime = s790454962121287.s340151979444051();
      s424076493653259.s494117374087228.Add((IDisposable) new s059574799999298(runtime, (object) new s424076493653259.s434202309702116()));
      s424076493653259.s494117374087228.Add((IDisposable) runtime);
      return runtime;
    }

    private static ThreadLocal<s424076493653259.s488297177572616> s192120587607479()
    {
      ThreadLocal<s424076493653259.s488297177572616> threadLocal = new ThreadLocal<s424076493653259.s488297177572616>((Func<s424076493653259.s488297177572616>) (() => (s424076493653259.s488297177572616) new s424076493653259.s453905211137903()));
      s424076493653259.s494117374087228.Add((IDisposable) threadLocal);
      return threadLocal;
    }

    private static s754392368222187 s233020040629206() => s424076493653259.s087590591973578.s068605291677468 != null ? new s754392368222187(s424076493653259.s087590591973578.s068605291677468) : (s754392368222187) null;

    public static void s901767051117351(ulong s965830384585812)
    {
      using (s984343181077700.s832495161073656(s424076493653259.s087590591973578))
      {
        try
        {
          if (!s424076493653259.s511399658490512)
            return;
          s424076493653259.s489906179715893();
        }
        catch (Exception ex)
        {
          s424076493653259.s719206956684263(ex);
          throw;
        }
      }
    }

    public static void s763592390332082(ulong s754267731659879, bool s373680971169248)
    {
      using (s984343181077700.s832495161073656(s424076493653259.s087590591973578))
      {
        s424076493653259.s940659201817219("Completing method with function ID 0x{0:X}", (object) s754267731659879);
        try
        {
          s775788418010176 s496843175129149;
          if (!s424076493653259.s689801368711584.s076536868900315.s209270748417790(s754267731659879, out s496843175129149))
            return;
          s496843175129149.s105885803816556 = true;
          uint s759620939653359 = s424076493653259.s689801368711584.s759620939653359;
          if (s424076493653259.s689801368711584.s274648187692696)
          {
            s424076493653259.s940659201817219("Async recording was started with function ID 0x{0:X}", (object) s424076493653259.s680942602127002.Value.s098551953834443);
            if (!s424076493653259.s680942602127002.Value.s575699294395452)
              return;
            if ((long) s424076493653259.s680942602127002.Value.s098551953834443 != (long) s496843175129149.s650232807345924)
            {
              s424076493653259.s152622488420433("Function ID {0} started async recording but function ID {1} claims to be eligible to complete the activity.", (object) s424076493653259.s680942602127002.Value.s098551953834443, (object) s496843175129149.s650232807345924);
            }
            else
            {
              s424076493653259.s797688071750318(s759620939653359);
              s424076493653259.s680942602127002.Value = (s424076493653259.s453905211137903) null;
            }
          }
          else
          {
            s775788418010176 s626618765262356;
            if (!s424076493653259.s689801368711584.s076536868900315.s579526503544806(out s626618765262356))
            {
              s424076493653259.s152622488420433("Could not find the frame that started recording for this activity.");
            }
            else
            {
              if (s496843175129149 != s626618765262356)
                return;
              s424076493653259.s797688071750318(s759620939653359);
            }
          }
        }
        catch (Exception ex)
        {
          s424076493653259.s719206956684263(ex);
          throw;
        }
        finally
        {
          s424076493653259.s940659201817219("Completed method with function ID 0x{0:X}", (object) s754267731659879);
        }
      }
    }

    private static void s797688071750318(uint s295264319786897)
    {
      s424076493653259.s940659201817219("Completing activity ID {0}.", (object) s295264319786897);
      if (s424076493653259.s940440935196014)
      {
        s424076493653259.s680942602127002.Value.s326397886515320();
        s424076493653259.s224292191255992.Value?.s282011253326319(s295264319786897);
      }
      s424076493653259.s087590591973578.s781089325829683(s295264319786897);
      s424076493653259.s940659201817219("Completed activity ID {0}.", (object) s295264319786897);
    }

    public static void s556583407058049(
      ulong s690064644274174,
      bool s974485121312741,
      bool s730056598481459)
    {
      using (s984343181077700.s832495161073656(s424076493653259.s087590591973578))
      {
        try
        {
          if (!s424076493653259.s087590591973578.s852944436484327)
            s424076493653259.s087590591973578.s622400597503649();
          if (s424076493653259.s511399658490512 && s424076493653259.s689801368711584.s076536868900315.s727298766669709)
          {
            using (s424076493653259.s689801368711584.s076536868900315.s599267095129781(s424076493653259.s087590591973578))
            {
              if (!s424076493653259.s689801368711584.s751253357067784)
                s424076493653259.s011081973330405();
            }
          }
          s424076493653259.s032067221559490(s690064644274174, s974485121312741, s730056598481459);
        }
        catch (Exception ex)
        {
          s424076493653259.s719206956684263(ex);
          throw;
        }
      }
    }

    private static void s032067221559490(
      ulong s673785096776537,
      bool s736226174950902,
      bool s013286920649708)
    {
      s424076493653259.s689801368711584.s076536868900315.s733588821216499(s673785096776537, s736226174950902);
      s424076493653259.s087590591973578.s476084563495243(s673785096776537, s013286920649708);
    }

    public static void s853099027069023(ulong s754528274885199, bool s989732751021204)
    {
      using (s984343181077700.s832495161073656(s424076493653259.s087590591973578))
      {
        try
        {
          s424076493653259.s687157307100975(s754528274885199, s989732751021204);
        }
        catch (Exception ex)
        {
          s424076493653259.s719206956684263(ex);
          throw;
        }
      }
    }

    private static bool s687157307100975(ulong s061664837656716, bool s424526573247539)
    {
      s424076493653259.s087590591973578.s324448413406438(s061664837656716);
      bool flag = false;
      if (s424076493653259.s689801368711584.s076536868900315.s209270748417790(s061664837656716, out s775788418010176 _))
      {
        s424076493653259.s689801368711584.s076536868900315.s474915752977342();
        flag = true;
      }
      return flag;
    }

    private static void s143479362976380(bool s065765021441456, bool s639103072120945)
    {
      s424076493653259.s453905211137903 s453905211137903 = s424076493653259.s680942602127002.Value.s308883644650760();
      s453905211137903.s575699294395452 = s065765021441456;
      s453905211137903.s595482459243056 = s639103072120945;
      s424076493653259.s680942602127002.Value = s453905211137903;
    }

    private static void s011081973330405() => s424076493653259.s143479362976380(false, false);

    private static void s784953948001175() => s424076493653259.s143479362976380(s424076493653259.s680942602127002.Value.s595482459243056, false);

    private static void s489906179715893()
    {
      int num = s424076493653259.s680942602127002.Value.s575699294395452 ? 1 : 0;
      s424076493653259.s143479362976380(num != 0, num != 0);
    }

    private static bool s511399658490512 => s424076493653259.s680942602127002.Value != null;

    private static bool s940440935196014 => s424076493653259.s511399658490512 && !s424076493653259.s680942602127002.Value.s990678695328235;

    private static s424076493653259.s488297177572616 s689801368711584 => s424076493653259.s608149552396311.Value.Value;

    private static IList<IDisposable> s494117374087228 => s424076493653259.s820857077674338.Value;

    private static s960412633860805 s087590591973578 => s424076493653259.s018220860452112.Value;

    private class s453905211137903
    {
      private TaskCompletionSource<object> s401426390144248;

      private s453905211137903(s424076493653259.s453905211137903 state)
      {
        lock (s507753835847680.s610262370468970.s100667261216227)
          s424076493653259.s940659201817219("Created async state #{0}", (object) s507753835847680.s610262370468970.s100667261216227.GetId((object) this, out bool _));
        this.s401426390144248 = state.s401426390144248;
        this.s505411960150321 = state.s505411960150321;
        this.s575699294395452 = state.s575699294395452;
        this.s595482459243056 = state.s595482459243056;
        this.s098551953834443 = state.s098551953834443;
      }

      public void s326397886515320() => this.s401426390144248.TrySetResult((object) null);

      public s424076493653259.s453905211137903 s308883644650760()
      {
        s424076493653259.s453905211137903 s453905211137903 = new s424076493653259.s453905211137903(this);
        lock (s507753835847680.s610262370468970.s100667261216227)
        {
          bool firstTime;
          s424076493653259.s940659201817219("Copied async state from #{0} to #{1}.", (object) s507753835847680.s610262370468970.s100667261216227.GetId((object) this, out firstTime), (object) s507753835847680.s610262370468970.s100667261216227.GetId((object) s453905211137903, out firstTime));
        }
        return s453905211137903;
      }

      public uint s505411960150321 { get; }

      public bool s575699294395452 { get; set; }

      public bool s595482459243056 { get; set; }

      public ulong s098551953834443 { get; }

      public bool s990678695328235 => this.s401426390144248.Task.IsCompleted;

      static s453905211137903() => s507753835847680.s610262370468970.s100667261216227 = new ObjectIDGenerator();

      public s453905211137903() => this.s232332230588334 = new s507753835847680();
    }

    private class s488297177572616
    {
      private static readonly IntPtr s252625101295402;

      public s507753835847680 s076536868900315 => ((s424076493653259.s453905211137903) this).s232332230588334;

      public bool s274648187692696 { get; set; }

      public bool s751253357067784
      {
        get
        {
          s775788418010176 s042709586415899;
          return this.s076536868900315.s981035436828707(out s042709586415899) && ulong.MaxValue == s042709586415899.s650232807345924;
        }
      }

      public uint s759620939653359 { get; set; }

      public int s606170474120315([MarshalAs(UnmanagedType.Interface)] IRecordRuntime s402264987498228)
      {
        uint num = s424076493653259.s087590591973578.s888434989091133();
        s424076493653259.s689801368711584.s759620939653359 = num;
        s424076493653259.s940659201817219("Activity ID {0} started recording on current thread.", (object) num);
        s775788418010176 s042709586415899;
        if (s424076493653259.s689801368711584.s076536868900315.s981035436828707(out s042709586415899))
        {
          s042709586415899.s882366201092505 = true;
          if (!s424076493653259.s511399658490512 && s042709586415899.s931393618492295)
          {
            s424076493653259.s940659201817219("Begin async execution tracking of activity ID {0}.", (object) num);
            s424076493653259.s680942602127002.Value = (s424076493653259.s453905211137903) new s507753835847680.s610262370468970(num, s042709586415899.s650232807345924);
            s424076493653259.s224292191255992?.Value.s532715851767464(num);
          }
        }
        if (!s424076493653259.s434202309702116.s474453190103776.Value)
        {
          ((s424076493653259.s434202309702116) this).s622915934407500(s402264987498228);
          s424076493653259.s434202309702116.s474453190103776.Value = true;
        }
        return 0;
      }
    }

    private class s434202309702116 : IRecordStartEndEvents
    {
      private static readonly ThreadLocal<bool> s474453190103776;
      public static readonly s424076493653259.s899388490914126 s886468496528381 = new s424076493653259.s899388490914126();

      public int s536815659740078([MarshalAs(UnmanagedType.Interface)] IRecordRuntime s558460958319759)
      {
        s424076493653259.s940659201817219("Activity ID {0} stopped recording on current thread.", (object) s424076493653259.s689801368711584.s759620939653359);
        s424076493653259.s689801368711584.s076536868900315.s207143662383960();
        return 0;
      }

      private void s622915934407500(IRecordRuntime s831564732613070)
      {
        IntPtr memOffset = s424076493653259.s434202309702116.s570462324344984();
        if (!(memOffset != IntPtr.Zero))
          return;
        s831564732613070.RecordMemory(memOffset, s424076493653259.s488297177572616.s252625101295402);
      }

      private static IntPtr s570462324344984()
      {
        try
        {
          FieldInfo field = typeof (Thread).GetField("_DONT_USE_InternalThread", BindingFlags.Instance | BindingFlags.NonPublic);
          if (field == (FieldInfo) null)
            field = typeof (Thread).GetField("DONT_USE_InternalThread", BindingFlags.Instance | BindingFlags.NonPublic);
          if (field != (FieldInfo) null)
            return (IntPtr) field.GetValue((object) Thread.CurrentThread);
          s424076493653259.s152622488420433("The Thread type is missing the InternalThread field.");
        }
        catch (Exception ex)
        {
          s424076493653259.s719206956684263(ex);
        }
        return IntPtr.Zero;
      }

      static s434202309702116()
      {
        s424076493653259.s488297177572616.s252625101295402 = (IntPtr) 3072;
        // ISSUE: reference to a compiler-generated field
        // ISSUE: reference to a compiler-generated method
        s424076493653259.s434202309702116.s474453190103776 = new ThreadLocal<bool>(new Func<bool>(s754392368222187.s844881987130160.s423249017750917.s113723216842560.s007039914204918));
      }

      static s434202309702116()
      {
      }
    }
  }
}
